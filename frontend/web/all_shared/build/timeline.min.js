!function(e,t){"use strict";var i,n,s,l,a,o,d,r=e.App||{};function c(e,t,i,n,s,l,a){this.enabled=!1,this.selectedEventsIds=[],this.canMultipleAdd=e,this.canMultipleUpdate=t,this.canSoftDelete=i,this.canDelete=n,this.multipleAddUrl=s,this.multipleUpdateUrl=l,this.multipleDeleteUrl=a,this.timeline=null}function m(){return'\n        <div class="selected-event">\n               <span class="circle"></span>\n        </div>'.trim()}c.prototype.init=function(e,r){this.timeline=r,t("#"+e).html(function(){return`\n        ${i=this.canMultipleAdd,i?'<a class="btn btn-success btn-sm" id="btn-shift-event-add"><i class="fa fa-plus-circle"></i> Add Multiple Events</a>':""}\n        <a id="multiple-manage-mode-btn" class="btn btn-warning btn-sm"><i class="fa fa-th-large"></i> Multiple Manage Mode</a>\n        <a id="btn-multiple-exit-mode" class="btn btn-danger btn-sm" style="display: none;"><i class="fas fa-times-circle"></i> Exit Mode</a>\n        \n        <div class="btn-group" id="check_uncheck_btns" style="display: none; margin-bottom: 4px; height: 28px; margin-left: 7px;">\n            <button id="btn-check-all" class="btn btn-sm btn-default"><span class="fa fa-square-o"></span> Select All</button>\n\n            <button type="button" class="btn btn-default dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                <span class="sr-only">Toggle Dropdown</span>\n            </button>\n            <div class="dropdown-menu">\n                  ${t=this.canMultipleUpdate,t?'<a class="dropdown-item" id="btn-multiple-update-events"><i class="fa fa-edit text-warning"></i> Update Events</a>':""}\n                  ${e=this.canMultipleUpdate,e?'<a class="dropdown-item" id="btn-multiple-delete-events"><i class="fa fa-trash text-danger"></i> Delete Events</a>':""}\n            </div>\n        </div>\n        `;var e;var t;var i}.call(this)),i=t("#btn-check-all"),n=t("#multiple-manage-mode-btn"),s=t("#check_uncheck_btns"),l=t("#btn-multiple-exit-mode"),a=t("#btn-shift-event-add"),o=t("#btn-multiple-update-events"),d=t("#btn-multiple-delete-events"),i.on("click",function(e){e.preventDefault();let i=this.timeline.getEvents();if(!i.length)return createNotify("Warning","There are no events. Update the filter or add another event.","warning"),!1;let n=t(e.target);this.selectedEventsIds.length?(t(".selected-event").remove(),this.selectedEventsIds=[],n.removeClass(["btn-warning","checked"]).addClass("btn-default").html('<span class="fa fa-square-o"></span> Select All')):(i.forEach(function(e,t){this.selectedEventsIds.push(e.id)}.bind(this)),t(".mbsc-schedule-event").append(m()),n.removeClass("btn-default").addClass(["btn-warning","checked"]).html('<span class="fa fa-check-square-o"></span> Uncheck All ('+this.selectedEventsIds.length+")"))}.bind(this)),n.on("click",function(e){e.preventDefault(),t(e.target).hide(),s.show(),l.show(),this.enable(),this.timeline.timeline.setOptions({clickToCreate:!1,dragToCreate:!1,dragToMove:!1,dragToResize:!1}),t("#calendar").addClass("multiple-manage-mode")}.bind(this)),l.on("click",function(e){e.preventDefault(),s.hide(),l.hide(),n.show(),this.disable(),this.timeline.refreshManageOptions(),t(".selected-event").remove(),this.selectedEventsIds=[],i.removeClass(["btn-warning","checked"]).addClass("btn-default").html('<span class="fa fa-square-o"></span> Select All'),t("#calendar").removeClass("multiple-manage-mode")}.bind(this)),o.on("click",function(e){if(e.preventDefault(),!this.selectedEventsIds.length)return createNotify("Warning","You have not selected any events","warning"),!1;let i=t("#modal-md");i.find(".modal-title").html("Multiple update selected Shift(s)"),i.find(".modal-body").html('<div style="text-align:center;font-size: 40px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),i.find(".modal-body").load(this.multipleUpdateUrl,{eventIds:JSON.stringify(this.selectedEventsIds),showForm:1},function(e,t,n){"error"==t?createNotifyByObject({title:"Error",type:"error",text:n.statusText}):i.modal({backdrop:"static",show:!0})})}.bind(this)),d.on("click",function(e){if(e.preventDefault(),!this.selectedEventsIds.length)return createNotify("Warning","You have not selected any events","warning"),!1;this.canDelete&&setTimeout(function(e){var i=t(".mbsc-alert-message");i.html('<label><input type="checkbox" id="delete_permanently" mbsc-checkbox data-label="Delete Permanently" data-color="danger" /></label>'),mobiscroll.enhance(i[0])},100);mobiscroll.confirm({title:"Are you sure you want to delete event(s)?",message:"",okText:"Yes",cancelText:"No",callback:function(e){if(e){let e=t("#delete_permanently").is(":checked")?1:2;this.timeline.enableLoader(),t.ajax({url:this.multipleDeleteUrl,type:"post",dataType:"json",cache:!1,data:{selectedEvents:this.selectedEventsIds,deletePermanently:e},success:function(e){e.error?createNotify("Error",e.message,"error"):(this.selectedEventsIds.forEach(function(e,t){this.timeline.removeEvent(e)}.bind(this)),e.timelineData&&this.timeline.addEvents(JSON.parse(e.timelineData)),t(".selected-event").remove(),createNotify("Success","Event(s) successfully deleted","success"),this.selectedEventsIds=[],i.removeClass(["btn-warning","checked"]).addClass("btn-default").html('<span class="fa fa-square-o"></span> Select All'))}.bind(this),error:function(e){createNotify("Error",e.responseText,"error")},complete:function(){this.timeline.disableLoader()}.bind(this)})}}.bind(this)})}.bind(this)),a.on("click",function(e){if(e.preventDefault(),this.isEnabled())return createNotify("Warning","You cannot perform this action in multiple manage mode","warning"),!1;let i=t("#modal-md");i.find(".modal-title").html("Add Multiple Events"),i.find(".modal-body").html('<div style="text-align:center;font-size: 40px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),i.find(".modal-body").load(this.multipleAddUrl,{},function(e,t,n){"error"==t?createNotifyByObject({title:"Error",type:"error",text:n.statusText}):i.modal({backdrop:"static",show:!0})})}.bind(this))},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.isEnabled=function(){return!0===this.enabled},c.prototype.resetSelectedEvents=function(){t(".selected-event").remove(),this.selectedEventsIds=[],i.removeClass(["btn-warning","checked"]).addClass("btn-default").html('<span class="fa fa-square-o"></span> Select All')},c.prototype.toggleEventSelection=function(e,n){let s=t(e).closest(".mbsc-schedule-event"),l=s.find(".selected-event"),a=this.selectedEventsIds.indexOf(n.id);-1===a?(s.append(m()),this.selectedEventsIds.push(n.id),i.removeClass("btn-default").addClass(["btn-warning","checked"]).html('<span class="fa fa-check-square-o"></span> Uncheck All ('+this.selectedEventsIds.length+")")):(this.selectedEventsIds.splice(a,1),l.remove(),this.selectedEventsIds.length?i.removeClass("btn-default").addClass(["btn-warning","checked"]).html('<span class="fa fa-check-square-o"></span> Uncheck All ('+this.selectedEventsIds.length+")"):i.removeClass(["btn-warning","checked"]).addClass("btn-default").html('<span class="fa fa-square-o"></span> Select All'))},r.MultipleManageModule=c,e.App=r}(window,$),function(e,t,i){"use strict";var n=t.App||{};let s,l;function a(e){this.formElementId=e,(s=i("#filter-calendar-form-btn")).on("click",function(e){e.preventDefault(),l=s.html(),s.html('<span class="spinner-border spinner-border-sm"></span> Loading').prop("disabled",!0);let i=this.getQueryString();this.timeline.enableLoader(),this.timeline.getCalendarEvents(i).then(()=>{t.history.replaceState(null,null,"?"+i+"&appliedFilter=1")}).finally(function(){s.html(l).prop("disabled",!1),this.timeline.disableLoader()}.bind(this))}.bind(this))}a.prototype.init=function(e){this.timeline=e},a.prototype.getQueryString=function(){let t=e.getElementById(this.formElementId),i=new FormData(t);return i.delete("_csrf-frontend"),new URLSearchParams(i).toString()},a.prototype.disableSubmitBtn=function(){let e=i("#filter-calendar-form-btn");l=e.html(),e.html('<span class="spinner-border spinner-border-sm"></span> Loading').prop("disabled",!0)},a.prototype.enableSubmitBtn=function(){s.html(l).prop("disabled",!1)},n.TimelineFormFilter=a,t.App=n}(document,window,$),function(e,t,i){"use strict";var n,s,l=e.App||{};function a(e,t,i,n,s,l,a,o){this.canUpdateEvent=e,this.canViewEventLog=t,this.canSoftDelete=i,this.canDelete=n,this.openModalEventDetailsUrl=s,this.openModalEventLogsUrl=l,this.openModalEventEditUrl=a,this.deleteEventUrl=o}a.prototype.init=function(e,l){this.timeline=l,t("#"+e).html(function(){return`\n        <div id="custom-event-tooltip-popup" class="md-tooltip">\n            <div id="tooltip-event-header" class="md-tooltip-header">\n                <span id="tooltip-event-name-age" class="md-tooltip-name-age"></span>\n            </div>\n            <div class="md-tooltip-info">\n                <div class="md-tooltip-title">\n                  Title: <span id="tooltip-event-title" class="md-tooltip-title md-tooltip-text"></span>\n                </div>\n                <div class="md-tooltip-title">\n                    Status: <span id="tooltip-event-status" class="md-tooltip-status md-tooltip-text"></span>\n                </div>\n                <div class="md-tooltip-title">Event Range: <span id="tooltip-event-time" class="md-tooltip-text"></span></div>\n                <button id="tooltip-event-view" class="btn btn-sm btn-primary" title="View Details"><i class="fa fa-eye"></i></button>\n                ${function(){return this.canUpdateEvent?'<button id="tooltip-event-edit" class="btn btn-sm btn-warning" title="Edit event"><i class="fas fa-pencil-square"></i></button>':""}.call(this)}\n                ${function(){return this.canViewEventLog?'<button id="tooltip-event-logs" class="btn btn-sm btn-info" title="View Logs"><i class="fas fa-history"></i></button>':""}.call(this)}\n                ${function(){return this.canSoftDelete?'<button id="tooltip-event-delete" class="btn btn-sm btn-danger" title="Delete Event"><i class="fa fa-trash"></i></button>':""}.call(this)}\n            </div>\n        </div>\n        `.trim()}.call(this)),this.tooltipElement=t("#custom-event-tooltip-popup"),this.tooltip=this.tooltipElement.mobiscroll().popup({display:"anchored",touchUi:!1,showOverlay:!1,contentPadding:!1,closeOnOverlayClick:!1,width:350}).mobiscroll("getInst"),this.tooltipElement.mouseenter(function(e){n&&(clearTimeout(n),n=null)}.bind(this)),this.tooltipElement.mouseleave(function(e){n=setTimeout(function(){this.tooltip.close()}.bind(this),200)}.bind(this)),this.deleteButton=t("#tooltip-event-delete"),this.header=t("#tooltip-event-header"),this.data=t("#tooltip-event-name-age"),this.time=t("#tooltip-event-time"),this.status=t("#tooltip-event-status"),this.title=t("#tooltip-event-title"),this.view=t("#tooltip-event-view"),this.viewLogs=t("#tooltip-event-logs"),this.editBtn=t("#tooltip-event-edit"),this.view.on("click",function(e){e.preventDefault(),function(e){let i=t("#modal-md"),n=this.openModalEventDetailsUrl+"?id="+e;t("#modal-md-label").html("Schedule Event: "+e),i.find(".modal-body").html(""),i.find(".modal-body").load(n,function(e,t,n){"error"===t?alert(e):i.modal("show")})}.call(this,s.id),this.tooltip.close()}.bind(this)),this.editBtn.on("click",function(e){e.preventDefault(),function(e){let i=t("#modal-md");i.find(".modal-body").html('<div style="text-align:center;font-size: 40px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),i.find(".modal-title").html("Edit event"),i.find(".modal-body").load(this.openModalEventEditUrl+"?eventId="+e,{},function(e,t,n){"error"===t?createNotifyByObject({title:"Error",type:"error",text:n.statusText}):i.modal({backdrop:"static",show:!0})})}.call(this,s.id),this.tooltip.close()}.bind(this)),this.viewLogs.on("click",function(e){e.preventDefault(),function(e){let i=t("#modal-lg"),n=this.openModalEventLogsUrl+"?id="+e;t("#modal-md-label").html("Schedule Event Logs: "+e),i.find(".modal-body").html(""),i.find(".modal-body").load(n,function(e,t,n){"error"===t?createNotify("Error",e,"error"):i.modal("show")})}.call(this,s.id),this.tooltip.close()}.bind(this)),this.deleteButton.on("click",function(e){e.preventDefault(),function(){this.canDelete&&setTimeout(function(e){var n=t(".mbsc-alert-message");n.html('\n        <label>\n            <input type="checkbox" id="delete_permanently" mbsc-checkbox data-label="Delete Permanently" data-color="danger" />\n        </label>'.trim()),i.enhance(n[0])},100);i.confirm({title:"Are you sure you want to delete event?",message:"",okText:"Yes",cancelText:"No",callback:function(e){if(e){let e=t("#delete_permanently").is(":checked")?1:2;t.ajax({url:this.deleteEventUrl,data:{shiftId:s.id,deletePermanently:e},type:"post",cache:!1,dataType:"json",success:function(e){e.error?createNotify("Error",e.message,"error"):(this.timeline.removeEvent(s.id),e.timelineData&&this.timeline.addEvent(JSON.parse(e.timelineData)),this.tooltip.close(),createNotify("Success",e.message,"success"))}.bind(this),error:function(e){createNotify("Error",e.responseText,"error")}})}}.bind(this)})}.call(this),this.tooltip.close()}.bind(this))},a.prototype.customize=function(e,t,i,n,s,l){this.header.css("background-color",e||t),this.data.text(i),this.time.text(n),this.title.text(s),this.status.text(l)},a.prototype.setEvent=function(e){s=e},a.prototype.setOptions=function(e){this.tooltip.setOptions(e)},a.prototype.open=function(e){clearTimeout(n),n=null,this.tooltip.open()},l.TimelineTooltip=a,e.App=l}(window,$,mobiscroll),function(e,t,i,n){"use strict";var s,l,a=e.App||{},o=i.util.datetime.formatDate,d=!1,r=!1;function c(e,t,i,n,s,l,a,o,d){this.timelineElementSelectorId=e,this.elementSelectorWrapperId=t,this.timeline=null,this.formFilter=i,this.multipleManageModule=n,this.calendarEventsAjaxUrl=s,this.createSingleEventFormUrl=l,this.updateEventUrl=a,this.invalidGroupResources=[],this.tooltip=o,this.today=d}function m(e){return`\n        <div class="md-work-week-cont" title="'+resource.title+'">\n            <div class="md-work-week-name" style="display: flex; justify-content: space-between;">\n                <span>${e.name}</span> <span style="margin-right: 10px;">${e.icons.join(" ")}</span>\n            </div>\n            <div class="md-work-week-description">${e.description}</div>\n        </div>`.trim()}function p(){return'\n            <div mbsc-calendar-nav class="md-work-week-nav"></div>\n            <div class="md-work-week-picker">\n                <label>Day (hours)<input mbsc-segmented type="radio" name="switching-timeline-view" value="day" class="md-timeline-view-change" checked></label>\n                <label>7 Days<input mbsc-segmented type="radio" name="switching-timeline-view" value="7day" class="md-timeline-view-change"></label>\n                <label>30 Days<input mbsc-segmented type="radio" name="switching-timeline-view" value="30days" class="md-timeline-view-change"></label>\n                <label>Week<input mbsc-segmented type="radio" name="switching-timeline-view" value="week" class="md-timeline-view-change"></label>\n                <label>Month<input mbsc-segmented type="radio" name="switching-timeline-view" value="month" class="md-timeline-view-change"></label>\n                <label>Month (day)<input mbsc-segmented type="radio" name="switching-timeline-view" value="month-day" class="md-timeline-view-change"></label>\n            </div>\n            <div mbsc-calendar-prev class="md-work-week-prev"></div>\n            <div mbsc-calendar-today class="md-work-week-today"></div>\n            <div mbsc-calendar-next class="md-work-week-next"></div>'.trim()}function h(e){this.multipleManageModule.isEnabled()&&this.multipleManageModule.resetSelectedEvents();let i=e.firstDay.getUTCFullYear()+"-"+(e.firstDay.getUTCMonth()+1)+"-"+(e.firstDay.getUTCDate()+1),n=e.lastDay.getUTCFullYear()+"-"+(e.lastDay.getUTCMonth()+1)+"-"+e.lastDay.getUTCDate();t("#startDate").val(i),t("#endDate").val(n),this.formFilter.disableSubmitBtn(),this.getCalendarEvents(this.formFilter.getQueryString()).finally(function(){this.formFilter.enableSubmitBtn()}.bind(this))}function u(e){var t=e.event;if(this.multipleManageModule.isEnabled())this.multipleManageModule.toggleEventSelection(e.domEvent.target,t);else{let n=new Date(t.start),l=new Date(t.end);var i=o("YYYY-MM-DD H:mm",n)+" - "+o("YYYY-MM-DD H:mm",l);s=t,this.tooltip.setEvent(s),this.tooltip.customize(t.borderColor,t.color,t.title,i,t.description,t.status),this.tooltip.setOptions({anchor:e.domEvent.target}),this.tooltip.open()}}function v(e){let n=e.event,s=e.oldEvent;i.confirm({title:"Are you sure you want to update event?",okText:"Yes",cancelText:"No",callback:function(l){if(l){let l,a;l=n.resource,a=s.resource;let o=f(new Date(n.start)),d=f(new Date(n.end)),r={eventId:e.event.id,newUserId:l,oldUserId:a,dateTimeStart:o,dateTimeEnd:d};t.post(this.updateEventUrl,r,function(e){e.error?createNotify("Error",e.message,"error"):i.toast({message:"Event updated successfully"})})}else this.removeEvent(n),this.timeline.addEvent(s)}.bind(this)})}function f(e){let[t,i,n]=[e.getFullYear(),e.getMonth()+1,e.getDate()],s=e.getHours();s=(s<10?"0":"")+s;let l=e.getMinutes();return t+"-"+i+"-"+n+" "+s+":"+(l=(l<10?"0":"")+l)}c.prototype.init=function(e){i.momentTimezone.moment=n,d=e.canCreate,r=e.canUpdate,l=t("#"+this.elementSelectorWrapperId),this.timeline=t("#"+this.timelineElementSelectorId).mobiscroll().eventcalendar({view:{timeline:{type:"day",size:2},refDate:this.today},theme:"ios",themeVariant:"light",timeFormat:"HH:mm",dataTimezone:"utc",displayTimezone:e.userTimeZone,timezonePlugin:i.momentTimezone,clickToCreate:d,dragToCreate:d,dragToMove:r,dragToResize:r,renderResource:m.bind(this),renderHeader:p.bind(this),onPageLoading:h.bind(this),onCellDoubleClick:function(e,t){if(this.multipleManageModule.isEnabled())return createNotify("Warning","You cannot add event in multiple manage mode","warning"),!1}.bind(this),onEventDragEnd:function(e,t){this.timeline.setOptions({invalid:this.invalidGroupResources,colors:[]})}.bind(this),onCellClick:function(e){if(this.multipleManageModule.isEnabled())return!1}.bind(this),onEventCreated:function(e,i){if(this.multipleManageModule.isEnabled())return!1;(function(e){let i=e.resource,n=f(new Date(e.start)),s=t("#modal-md");s.find(".modal-title").html("Add event for user"),s.on("hide.bs.modal",function(t){this.removeEvent(e)}.bind(this)),s.modal("show").find(".modal-body").html('<div style="text-align:center;font-size: 40px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),t.get(this.createSingleEventFormUrl+"?userId="+i+"&startDate="+n,function(e){s.find(".modal-body").html(e)}).fail(function(e){setTimeout(function(){s.modal("hide"),createNotify("Error",e.statusText,"error")},800)})}).call(this,e.event)}.bind(this),onEventClick:u.bind(this),onEventUpdated:v.bind(this)}).mobiscroll("getInst"),t(".md-timeline-view-change").change(function(e){switch(e.target.value){case"day":this.timeline.setOptions({view:{timeline:{type:"day",size:2},refDate:this.today}}),this.multipleManageModule.isEnabled()&&this.multipleManageModule.resetSelectedEvents();break;case"month":this.timeline.setOptions({view:{timeline:{type:"month",timeCellStep:360,timeLabelStep:360},refDate:this.today}}),this.multipleManageModule.isEnabled()&&this.multipleManageModule.resetSelectedEvents();break;case"7day":this.timeline.setOptions({view:{timeline:{type:"day",timeCellStep:360,timeLabelStep:360,size:7},refDate:this.today}}),this.multipleManageModule.isEnabled()&&this.multipleManageModule.resetSelectedEvents();break;case"30days":this.timeline.setOptions({view:{timeline:{type:"day",timeCellStep:720,timeLabelStep:720,size:30},refDate:this.today}}),this.multipleManageModule.isEnabled()&&this.multipleManageModule.resetSelectedEvents();break;case"week":this.timeline.setOptions({view:{timeline:{type:"week",timeCellStep:720,timeLabelStep:720},refDate:this.today}}),this.multipleManageModule.isEnabled()&&this.multipleManageModule.resetSelectedEvents();break;case"month-day":this.timeline.setOptions({view:{timeline:{type:"month",timeCellStep:1440,timeLabelStep:1440}}}),this.multipleManageModule.isEnabled()&&this.multipleManageModule.resetSelectedEvents()}}.bind(this)),this.tooltip.init(e.tooltipElementSelectorId,this),this.multipleManageModule.init(e.multipleModuleElementSelectorId,this),this.formFilter.init(this)},c.prototype.getCalendarEvents=function(e){return new Promise(function(n,s){t.getJSON(this.calendarEventsAjaxUrl+"?"+e,function(e){e.error?(createNotify("Error",e.message,"error"),s()):(this.invalidGroupResources=[{recurring:{repeat:"daily"},resource:e.firstLevelResources}],this.timeline.setOptions({resources:e.resources,invalid:this.invalidGroupResources}),this.setEvents(e.data),i.toast({message:"New events loaded"}),n())}.bind(this),"jsonp")}.bind(this))},c.prototype.setEvents=function(e){this.timeline.setEvents(e)},c.prototype.addEvent=function(e){this.timeline.addEvent(e)},c.prototype.addEvents=function(e){e.forEach(function(e){this.timeline.addEvent(e)}.bind(this))},c.prototype.removeEvent=function(e){this.timeline.removeEvent(e)},c.prototype.enableLoader=function(){l.append('<div class="text-center calendar-filter-overlay">\n            <div class="spinner-border m-5" role="status">\n                <span class="sr-only">Loading...</span>\n            </div>\n        </div>')},c.prototype.disableLoader=function(){t(".calendar-filter-overlay").remove()},c.prototype.getEvents=function(){return this.timeline._events},c.prototype.refreshManageOptions=function(){this.timeline.setOptions({clickToCreate:d,dragToCreate:d,dragToMove:r,dragToResize:r})},a.ShiftTimeline=c,e.App=a}(window,$,mobiscroll,moment);