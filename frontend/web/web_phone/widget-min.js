window.phoneWidget={},window.phoneWidget.storage={},function(){window.phoneWidget.eventDispatcher=new class{constructor(){this.events={}}addListener(e,t){return"function"!=typeof t?(console.error(`The listener callback must be a function, the given type is ${typeof t}`),!1):"string"!=typeof e?(console.error(`The event name must be a string, the given type is ${typeof e}`),!1):(void 0===this.events[e]&&(this.events[e]={listeners:[]}),void this.events[e].listeners.push(t))}removeListener(e,t){if(void 0===this.events[e])return console.error(`This event: ${e} does not exist`),!1;this.events[e].listeners=this.events[e].listeners.filter(e=>e.toString()!==t.toString())}dispatch(e,t){if(void 0===this.events[e])return console.error(`This event: ${e} does not exist`),!1;this.events[e].listeners.forEach(e=>{e(t)})}}}(),window.phoneWidget.events={callUpdate:"callUpdate",conferenceUpdate:"conferenceUpdate"},function(){window.phoneWidget.call={Call:function e(t){this.data=t,this.canTransfer=function(){return conferenceBase?3!==this.data.typeId&&"In progress"===this.data.status&&!this.data.isInternal:"In progress"===this.data.status},this.block=function(){this.data.blocked=!0},this.unBlock=function(){this.data.blocked=!1},this.isBlocked=function(){return!0===this.data.blocked},this.canHoldUnHold=function(){return 3!==this.data.typeId&&"In progress"===this.data.status&&(!this.data.isInternal||this.data.isInternal&&this.data.isConferenceCreator)},this.setHoldRequestState=function(){return!(this.isBlocked()||!this.canHoldUnHold()||(this.data.isHold?(createNotify("Error","Call is already Hold.","error"),1):(this.data.sentHoldUnHoldRequest=!0,this.block(),this.save(),0)))},this.setUnHoldRequestState=function(){return!(this.isBlocked()||!this.canHoldUnHold()||(this.data.isHold?(this.data.sentHoldUnHoldRequest=!0,this.block(),this.save(),0):(createNotify("Error","Call is already UnHold.","error"),1)))},this.unSetHoldUnHoldRequestState=function(){this.data.sentHoldUnHoldRequest=!1,this.unBlock(),this.save()},this.isSentHoldUnHoldRequestState=function(){return!0===this.data.sentHoldUnHoldRequest},this.hold=function(){this.unBlock(),this.data.sentHoldUnHoldRequest=!1,this.data.holdStartTime=Date.now(),this.data.isHold=!0,this.save()},this.unHold=function(){this.unBlock(),this.data.sentHoldUnHoldRequest=!1,this.data.holdStartTime=0,this.data.isHold=!1,this.save()},this.setMuteRequestState=function(){return!this.isBlocked()&&(this.data.isMute?(createNotify("Error","Call is already Mute.","error"),!1):(this.data.sentMuteUnMuteRequest=!0,this.block(),this.save(),!0))},this.setUnMuteRequestState=function(){return!this.isBlocked()&&(this.data.isMute?(this.data.sentMuteUnMuteRequest=!0,this.block(),this.save(),!0):(createNotify("Error","Call is already UnMute.","error"),!1))},this.unSetMuteUnMuteRequestState=function(){this.data.sentMuteUnMuteRequest=!1,this.unBlock(),this.save()},this.isSentMuteUnMuteRequestState=function(){return!0===this.data.sentMuteUnMuteRequest},this.mute=function(){this.unBlock(),this.data.sentMuteUnMuteRequest=!1,this.data.isMute=!0,this.save()},this.unMute=function(){this.unBlock(),this.data.sentMuteUnMuteRequest=!1,this.data.isMute=!1,this.save()},this.setHangupRequestState=function(){return!this.isBlocked()&&(this.data.sentHangupRequest=!0,this.block(),this.save(),!0)},this.unSetHangupRequestState=function(){this.data.sentHangupRequest=!1,this.unBlock(),this.save()},this.isSentHangupRequestState=function(){return!0===this.data.sentHangupRequest},this.setReturnHoldCallRequestState=function(){return!this.isBlocked()&&("Hold"!==this.data.status?(createNotify("Error","Call is not in status Hold.","error"),!1):(this.data.sentReturnHoldCallRequest=!0,this.block(),this.save(),!0))},this.unSetReturnHoldCallRequestState=function(){this.data.sentReturnHoldCallRequest=!1,this.unBlock(),this.save()},this.isSentReturnHoldCallRequestState=function(){return!0===this.data.sentReturnHoldCallRequest},this.setAcceptCallRequestState=function(){return!this.isBlocked()&&(this.data.sentAcceptCallRequest=!0,this.block(),this.save(),!0)},this.unSetAcceptCallRequestState=function(){this.data.sentAcceptCallRequest=!1,this.unBlock(),this.save()},this.isSentAcceptCallRequestState=function(){return!0===this.data.sentAcceptCallRequest},this.setAddNoteRequestState=function(){return this.isBlocked()?(createNotify("Error","Call is blocked. Please wait some seconds.","error"),!1):(this.data.sentAddNoteRequest=!0,this.block(),this.save(),!0)},this.unSetAddNoteRequestState=function(){this.data.sentAddNoteRequest=!1,this.unBlock(),this.save()},this.isSentAddNoteRequestState=function(){return!0===this.data.sentAddNoteRequest},this.setRejectInternalRequest=function(){return this.isBlocked()?(createNotify("Error","Call is blocked. Please wait some seconds.","error"),!1):(this.data.sentRejectInternalRequest=!0,this.block(),this.save(),!0)},this.unSetRejectInternalRequest=function(){this.data.sentRejectInternalRequest=!1,this.unBlock(),this.save()},this.isSentRejectInternalRequest=function(){return!0===this.data.sentRejectInternalRequest},this.getDuration=function(){let e=this.data.duration||0;return this.data.timeQueuePushed?Math.floor((Date.now()-parseInt(this.data.timeQueuePushed))/1e3)+parseInt(e):e},this.getHoldDuration=function(){let e=0;return this.data.holdStartTime&&(e=Math.floor((Date.now()-parseInt(this.data.holdStartTime))/1e3)),e},this.clone=function(){return new e(this.data)},this.save=function(){window.phoneWidget.eventDispatcher.dispatch(this.getEventUpdateName(),{call:this})},this.getEventUpdateName=function(){return window.phoneWidget.events.callUpdate+this.data.callSid}}}}(),function(){function e(t){this.data=t,this.getDuration=function(){let e=this.data.duration||0;return this.data.timeStoragePushed?Math.floor((Date.now()-parseInt(this.data.timeStoragePushed))/1e3)+parseInt(e):e},this.clone=function(){return new e(this.data)}}window.phoneWidget.conference={Conference:function t(a){this.data=a,this.getCountParticipants=function(){return this.data.participants.length},this.getParticipants=function(){let t=[],a=this.data.timeStoragePushed;return this.data.participants.forEach(function(n){n.timeStoragePushed=a,t.push(new e(n))}),t},this.getDuration=function(){let e=this.data.duration||0;return this.data.timeStoragePushed?Math.floor((Date.now()-parseInt(this.data.timeStoragePushed))/1e3)+parseInt(e):e},this.clone=function(){return new t(this.data)},this.getEventUpdateName=function(){return window.phoneWidget.events.conferenceUpdate+this.data.sid},this.save=function(){window.phoneWidget.eventDispatcher.dispatch(this.getEventUpdateName(),{conference:this})}}}}(),function(){window.phoneWidget.requesters={CallRequester:function(){this.settings={holdUrl:"",unHoldUrl:"",acceptCallUrl:"",muteUrl:"",unMuteUrl:"",returnHoldCallUrl:"",ajaxHangupUrl:"",callAddNoteUrl:"",sendDigitUrl:"",prepareCurrentCallsUrl:"",callLogInfoUrl:"",callInfoUrl:"",clientInfoUrl:""},this.init=function(e){Object.assign(this.settings,e)},this.hold=function(e){let t=$(".btn-hold-call");t.html('<i class="fa fa-spinner fa-spin"> </i> <span>On Hold</span>'),t.prop("disabled",!0),$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.holdUrl}).done(function(a){a.error&&(createNotify("Hold",a.message,"error"),t.html('<i class="fa fa-pause"> </i> <span>Hold</span>'),t.prop("disabled",!1),e.unSetHoldUnHoldRequestState())}).fail(function(){createNotify("Hold","Server error","error"),t.html('<i class="fa fa-pause"> </i> <span>Hold</span>'),t.prop("disabled",!1),e.unSetHoldUnHoldRequestState()})},this.unHold=function(e){let t=$(".btn-hold-call");t.html('<i class="fa fa-spinner fa-spin"> </i> <span>Resume</span>'),t.prop("disabled",!0),$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.unHoldUrl}).done(function(a){a.error&&(createNotify("Resume",a.message,"error"),t.html('<i class="fa fa-play"> </i> <span>Resume</span>'),t.prop("disabled",!1),e.unSetHoldUnHoldRequestState())}).fail(function(){createNotify("Resume","Server error","error"),t.html('<i class="fa fa-play"> </i> <span>Resume</span>'),t.prop("disabled",!1),e.unSetHoldUnHoldRequestState()})},this.accept=function(e){$.ajax({type:"post",url:this.settings.acceptCallUrl,dataType:"json",data:{act:"accept",call_sid:e.data.callSid}}).done(function(t){t.error&&(createNotify("Accept Call",t.message,"error"),e.unSetAcceptCallRequestState())}).fail(function(){createNotify("Accept Call","Server error","error"),e.unSetAcceptCallRequestState()})},this.mute=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.muteUrl}).done(function(t){t.error&&(createNotify("Mute",t.message,"error"),e.unSetMuteUnMuteRequestState())}).fail(function(){createNotify("Mute","Server error","error"),e.unSetMuteUnMuteRequestState()})},this.unMute=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.unMuteUrl}).done(function(t){t.error&&(createNotify("UnMute",t.message,"error"),e.unSetMuteUnMuteRequestState())}).fail(function(){createNotify("UnMute","Server error","error"),e.unSetMuteUnMuteRequestState()})},this.returnHoldCall=function(e){$.ajax({type:"post",url:this.settings.returnHoldCallUrl,dataType:"json",data:{call_sid:e.data.callSid}}).done(function(t){t.error&&(createNotify("Return Hold Call",t.message,"error"),e.unSetReturnHoldCallRequestState())}).fail(function(){createNotify("Return Hold Call","Server error","error"),e.unSetReturnHoldCallRequestState()})},this.hangupOutgoingCall=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.ajaxHangupUrl}).done(function(t){t.error&&(createNotify("Hangup",t.message,"error"),e.unSetHangupRequestState())}).fail(function(){createNotify("Hangup","Server error","error"),e.unSetHangupRequestState()})},this.addNote=function(e,t,a){$.ajax({type:"post",data:{note:t,callSid:e.data.callSid},url:this.settings.callAddNoteUrl,dataType:"json"}).done(function(t){t.error?createNotify("Add Note",t.message,"error"):(createNotify("Add Note",t.message,"success"),a.value=""),e.unSetAddNoteRequestState()}).fail(function(){createNotify("Add Note","Server error","error"),e.unSetAddNoteRequestState()})},this.sendDigit=function(e,t){$.ajax({type:"post",data:{conference_sid:e,digit:t},url:this.settings.sendDigitUrl,dataType:"json"}).done(function(e){e.error&&createNotify("Send digit",e.message,"error")}).fail(function(){createNotify("Send digit","Server error","error")})},this.acceptInternalCall=function(e,t){$.ajax({type:"post",data:{},url:this.settings.prepareCurrentCallsUrl,dataType:"json"}).done(function(a){a.error?(createNotify("Prepare current call",a.message,"error"),e.unSetAcceptCallRequestState()):t.accept()}).fail(function(){createNotify("Prepare current call","Server error","error"),e.unSetAcceptCallRequestState()})},this.callLogInfo=function(e){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>'),$("#call-box-modal-label").html("Call Info"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{sid:e},url:this.settings.callLogInfoUrl}).done(function(e){$("#call-box-modal .modal-body").html(e)}).fail(function(e,t,a){createNotify("Call info",e.responseText,"error")})},this.callInfo=function(e){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>'),$("#call-box-modal-label").html("Call Info"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{sid:e},url:this.settings.callInfoUrl}).done(function(e){$("#call-box-modal .modal-body").html(e)}).fail(function(e,t,a){createNotify("Call info",e.responseText,"error")})},this.clientInfo=function(e,t){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>');let a=t?"Client details":"Contact info";$("#call-box-modal-label").html(a+" ("+e+")"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{client_id:e},url:this.settings.clientInfoUrl}).done(function(e){$("#call-box-modal .modal-body").html(e)}).fail(function(e,t,n){createNotify(a,e.responseText,"error")})}}}}(),function(){window.phoneWidget.oldWidget=new function(){this.hold=function(){let e=$(".btn-hold-call");e.html('<i class="fa fa-play"> </i> <span>Resume</span>'),e.attr("data-mode","hold"),e.prop("disabled",!1)},this.unHold=function(){let e=$(".btn-hold-call");e.html('<i class="fa fa-pause"> </i> <span>Hold</span>'),e.attr("data-mode","unhold"),e.prop("disabled",!1)}}}();class PhoneWidgetTimer extends React.Component{constructor(e){super(e),this.state={duration:0,timeStart:0}}componentDidMount(){this.startTimer()}componentDidUpdate(e){this.state.timeStart!==this.props.timeStart&&this.startTimer()}componentWillUnmount(){clearInterval(this.timer)}startTimer(){clearInterval(this.timer),this.setState({duration:this.props.duration,timeStart:this.props.timeStart}),this.timer=setInterval(()=>this.setState({duration:this.state.duration+1}),1e3)}formatDuration(e){let t="",a=Math.floor(e/60/60),n=Math.floor(e/60)-60*a,i=e%60;return a>0&&(t=a.toString().padStart(2,"0")+":"),t+=n.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")}render(){return this.props.styleClass&&this.state.duration>3599?React.createElement("span",{className:this.props.styleClass},this.formatDuration(this.state.duration)):this.formatDuration(this.state.duration)}}class CallActionTimer extends React.Component{constructor(e){super(e),this.state={duration:0,timeStart:0}}componentDidMount(){this.startTimer()}componentDidUpdate(e){this.state.timeStart!==this.props.timeStart&&this.startTimer()}componentWillUnmount(){clearInterval(this.timer)}startTimer(){clearInterval(this.timer),this.setState({duration:this.props.duration,timeStart:this.props.timeStart}),this.timer=setInterval(()=>this.setState({duration:this.state.duration+1}),1e3)}formatDuration(e){let t="",a=Math.floor(e/60/60),n=Math.floor(e/60)-60*a,i=e%60;return a>0&&(t=a.toString().padStart(2,"0")+":"),t+=n.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")}render(){return React.createElement(React.Fragment,null,React.createElement("span",{className:"call-in-action__time"},this.formatDuration(this.state.duration)))}}class ActivePane extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement(ActiveContactInfo,{call:e}),React.createElement("div",{className:"actions-container"},React.createElement(CallBtns,{call:e}),React.createElement(SoundIndication,null)),React.createElement(ActivePaneControls,{call:e,controls:this.props.controls}))}}function ActiveContactInfo(e){let t=e.call;return React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},3!==t.data.typeId?React.createElement("span",{className:"contact-info-card__label"},t.data.type):"",React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info"},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,t.data.contact.name))),React.createElement("div",{className:"contact-info-card__line history-details"},3!==t.data.typeId?React.createElement("span",{className:"contact-info-card__call-type"},t.data.contact.phone):"")))}function CallBtns(e){let t=e.call,a="call-pane__call-btns";return t.data.isHold?a+=" is-on-hold":a+=" is-on-call",React.createElement("div",{className:a},React.createElement("button",{className:"call-pane__mute",id:"call-pane__mute",disabled:t.data.isListen||t.data.isHold||t.isSentMuteUnMuteRequestState(),"data-call-sid":t.data.callSid,"data-is-muted":t.data.isMute,"data-active":!(t.data.isListen||t.data.isHold)},t.isSentMuteUnMuteRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):t.data.isMute?React.createElement("i",{className:"fas fa-microphone-alt-slash"}," "):React.createElement("i",{className:"fas fa-microphone"}," ")),t.data.isHold?React.createElement(CallingStateBlockHold,{call:t}):React.createElement(CallingStateBlock,{call:t}),React.createElement("button",{className:"call-pane__end-call",id:"cancel-active-call","data-call-sid":t.data.callSid,disabled:t.isSentHangupRequestState()},t.isSentHangupRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))}function CallingStateBlock(e){let t=e.call;return React.createElement("button",{className:t.data.isListen||t.data.isCoach?"call-pane__start-call calling-state-block join":"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},t.data.isListen||t.data.isCoach?React.createElement("i",{className:"fa fa-headphones-alt"}," "):"",React.createElement("span",{className:"call-in-action__text"},t.data.isCoach?"Coaching":t.data.isListen?"Listening":t.data.isBarge?"Barge":"on call"),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now(),styleClass:"more"}))))}function CallingStateBlockHold(e){let t=e.call;return React.createElement("button",{className:"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},React.createElement("span",{className:"call-in-action__text"},"on hold"),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:t.getHoldDuration(),timeStart:Date.now(),styleClass:"more"}))))}function SoundIndication(){return React.createElement("div",{className:"sound-indication"},React.createElement("div",{className:"sound-control-wrap",id:"wg-call-volume"},React.createElement("i",{className:"fa fa-volume-down"}," "),React.createElement("div",{className:"sound-controls"},React.createElement("div",{className:"progres-wrap"},React.createElement("div",{className:"sound-progress"}," "),React.createElement("div",{className:"sound-ovf",style:{right:"-100%"}}," ")))),React.createElement("div",{className:"sound-control-wrap",id:"wg-call-microphone"},React.createElement("i",{className:"fa fa-microphone"}," "),React.createElement("div",{className:"sound-controls"},React.createElement("div",{className:"progres-wrap"},React.createElement("div",{className:"sound-progress"}," "),React.createElement("div",{className:"sound-ovf",style:{right:"-30%"}}," ")))))}class IncomingPane extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__label"},e.data.type),React.createElement("div",{className:"credential"},React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info"},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,e.data.contact.name)),React.createElement("div",{className:"contact-info-card__phone"},React.createElement("span",null," ")))),React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__call-type"},e.data.contact.phone)))),React.createElement(IncomingActions,{call:e}))}}function IncomingActions(e){let t=e.call;return t.data.isInternal?React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns"},React.createElement("button",{className:"call-pane__end-call end-internal",id:"hide-incoming-call","data-call-sid":t.data.callSid},React.createElement("i",{className:"fa fa-angle-double-right"}," ")),React.createElement("button",{className:"call-pane__start-call calling-state-block","data-call-sid":t.data.callSid,onClick:()=>acceptInternalCall(t)},t.isSentAcceptCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call","data-call-sid":t.data.callSid,onClick:()=>rejectInternalCall(t)},t.isSentRejectInternalRequest()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))):React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns"},React.createElement("button",{className:"call-pane__start-call calling-state-block",id:"btn-accept-call","data-from-internal":t.data.fromInternal,"data-call-sid":t.data.callSid,disabled:t.isSentAcceptCallRequestState()},t.isSentAcceptCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call",id:"hide-incoming-call","data-call-sid":t.data.callSid},React.createElement("i",{className:"fa fa-angle-double-right"}," "))))}function ActivePaneControls(e){return React.createElement("ul",{className:"in-call-controls"},e.controls.hold.show?React.createElement(ButtonHold,{call:e.call,controls:e.controls}):"",e.controls.transfer.show?React.createElement(ButtonTransfer,{call:e.call,controls:e.controls}):"",React.createElement(ButtonAddPerson,{call:e.call,controls:e.controls}),React.createElement(ButtonDialpad,{call:e.call,controls:e.controls}),React.createElement(ButtonAddNote,{call:e.call,controls:e.controls}))}function ButtonHold(e){return React.createElement("li",{className:"in-call-controls__item","data-mode":e.call.data.isHold?"hold":"unhold",id:"wg-hold-call","data-call-sid":e.call.data.callSid,"data-active":e.controls.hold.active},React.createElement("a",{href:"#",className:"in-call-controls__action"},e.call.isSentHoldUnHoldRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin hold-loader"}," "):e.call.data.isHold?React.createElement("i",{className:"fa fa-play"}," "):React.createElement("i",{className:"fa fa-pause"}," "),React.createElement("span",null,e.call.data.isHold?"Resume":"On Hold")))}function ButtonTransfer(e){return React.createElement("li",{className:"in-call-controls__item wg-transfer-call","data-call-sid":e.call.data.callSid,"data-active":e.controls.transfer.active},React.createElement("a",{href:"#",className:"in-call-controls__action"},React.createElement("i",{className:"fa fa-random"}," "),React.createElement("span",null,"Transfer")))}function ButtonAddPerson(e){return React.createElement("li",{className:"in-call-controls__item",id:"wg-add-person","data-active":e.controls.addPerson.active},React.createElement("a",{href:"#",className:"in-call-controls__action js-add-to-conference","data-toggle-tab":"tab-contacts"},React.createElement("i",{className:"fa fa-plus"}," "),React.createElement("span",null,"Add Person")))}function ButtonDialpad(e){return React.createElement("li",{className:"in-call-controls__item",id:"wg-dialpad","data-active":e.controls.dialpad.active},React.createElement("a",{href:"#",className:"in-call-controls__action js-toggle-dial"},React.createElement("i",{className:"fa fa-th"}," "),React.createElement("span",null,"Dialpad")))}function ButtonAddNote(e){return React.createElement("li",{className:"in-call-controls__item",id:"wg-add-note"},React.createElement("a",{href:"#",className:"in-call-controls__action"},React.createElement("i",{className:"fa fa-newspaper-o"}," "),React.createElement("span",null,"Add Note")))}function CallInfo(e){return React.createElement("div",{className:"calling-from-info"},React.createElement("div",{className:"static-number-indicator"},e.project?React.createElement("span",{className:"static-number-indicator__label"},e.project):"",e.project&&e.source?React.createElement("i",{className:"static-number-indicator__separator"}," "):"",e.source?React.createElement("span",{className:"static-number-indicator__name"},e.source):""))}class ListItem extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement("li",{className:"call-in-progress__list-item"},React.createElement("div",{className:"call-in-progress__call-item call-list-item","data-call-status":e.data.queue},React.createElement("div",{className:"call-list-item__info"},React.createElement("ul",{className:"call-list-item__info-list call-info-list"},React.createElement("li",{className:"call-info-list__item"},React.createElement("b",{className:"call-info-list__contact-icon"},React.createElement("i",{className:"fa fa-user"}," ")),React.createElement("span",{className:"call-info-list__name"},e.data.contact.name)),e.data.contact.company?React.createElement("li",{className:"call-info-list__item"},React.createElement("span",{className:"call-info-list__company"},e.data.contact.company)):"",2===e.data.typeId||1===e.data.typeId||4===e.data.typeId?React.createElement("li",{className:"call-info-list__item"},React.createElement("span",{className:"call-info-list__number"},e.data.contact.phone)," "):""),React.createElement("div",{className:"call-list-item__info-action call-info-action"},React.createElement("span",{className:"call-info-action__timer"},React.createElement(PhoneWidgetTimer,{duration:e.getDuration(),timeStart:Date.now()})),"inProgress"===e.data.queue&&3!==e.data.typeId||3===e.data.typeId&&!e.data.isListen&&!e.data.isHold?React.createElement("a",{href:"#",className:"call-info-action__more"},React.createElement("i",{className:"fa fa-ellipsis-h"}," ")):""),React.createElement(ListItemMenu,{call:e})),React.createElement("div",{className:"call-list-item__main-action"},React.createElement("a",{href:"#",className:"call-list-item__main-action-trigger btn-item-call-queue","data-type-action":"inProgress"===e.data.queue?"hangup":"hold"===e.data.queue?"return":e.data.isInternal?"acceptInternal":"accept","data-call-sid":e.data.callSid,"data-from-internal":e.data.fromInternal},e.isSentAcceptCallRequestState()||e.isSentHangupRequestState()||e.isSentReturnHoldCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"phone-icon phone-icon--start fa fa-phone"})," ",React.createElement("i",{className:"phone-icon phone-icon--end fa fa-phone-slash"})," ")))))}}function ListItemMenu(e){let t=e.call;return"inProgress"!==t.data.queue?null:3===t.data.typeId?React.createElement(ListItemMenuJoinCall,{call:t}):t.data.isInternal?t.data.isConferenceCreator?React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(React.Fragment,null,React.createElement(ListItemBtnHold,{call:t}),React.createElement(ListItemBtnMute,{call:t}))):React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnMute,{call:t})):React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnTransfer,{call:t}),conferenceBase?React.createElement(React.Fragment,null,React.createElement(ListItemBtnHold,{call:t}),React.createElement(ListItemBtnMute,{call:t})):"")}function ListItemBtnTransfer(e){return React.createElement("li",{className:"call-item-menu__list-item wg-transfer-call","data-call-sid":e.call.data.callSid},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},React.createElement("i",{className:"fa fa-random"}," ")))}function ListItemBtnHold(e){let t=e.call;return React.createElement("li",{className:"call-item-menu__list-item list_item_hold","data-mode":t.data.isHold?"hold":"unhold","data-call-sid":t.data.callSid},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},t.isSentHoldUnHoldRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):t.data.isHold?React.createElement("i",{className:"fa fa-play"}," "):React.createElement("i",{className:"fa fa-pause"}," ")))}function ListItemBtnMute(e){let t=e.call;return t.data.isHold?null:React.createElement("li",{className:"call-item-menu__list-item list_item_mute","data-call-sid":t.data.callSid,"data-is-muted":t.data.isMute},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},t.isSentMuteUnMuteRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):t.data.isMute?React.createElement("i",{className:"fas fa-microphone-alt-slash"}," "):React.createElement("i",{className:"fas fa-microphone"}," ")))}function ListItemMenuJoinCall(e){let t=e.call;return t.data.isListen?null:React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnMute,{call:t}))}function Groups(e){const t=[];let a=Object.assign({},e);void 0!==a.groups.external&&(t.push(React.createElement(GroupItem,{key:"external",group:{calls:a.groups.external.calls,project:"",department:"External Contacts"}})),delete a.groups.external);void 0!==a.groups.internal&&(t.push(React.createElement(GroupItem,{key:"internal",group:{calls:a.groups.internal.calls,project:"",department:"Internal Contacts"}})),delete a.groups.internal);for(let e in a.groups)"inArray"!==e&&t.push(React.createElement(GroupItem,{key:e,group:a.groups[e]}));return React.createElement("ul",{className:"calls-separator"},t)}function GroupItem(e){return React.createElement("li",{className:"calls-separator__list-item"},React.createElement("div",{className:"static-number-indicator"},e.group.project?React.createElement("span",{className:"static-number-indicator__label"},e.group.project):"",e.group.project&&e.group.department?React.createElement("i",{className:"static-number-indicator__separator"}," "):"",e.group.department?React.createElement("span",{className:"static-number-indicator__name"},e.group.department):""),React.createElement("ul",{className:"call-in-progress"},e.group.calls.map(e=>React.createElement(ListItem,{key:e.data.callSid,call:e}))))}function AllQueues(e){return React.createElement(React.Fragment,null,countProperties(e.active)>0?React.createElement(QueueItem,{groups:e.active,name:"Active Calls",type:"active"}):"",countProperties(e.direct)>0?React.createElement(QueueItem,{groups:e.direct,name:"Direct Line",type:"direct"}):"",countProperties(e.general)>0?React.createElement(QueueItem,{groups:e.general,name:"General Line",type:"general"}):"")}function QueueItem(e){return React.createElement("li",{className:"queue-separator__item","data-queue-type":e.type},e.name?React.createElement("div",{className:"queue-separator__name"},e.name):"",React.createElement(Groups,{groups:e.groups}))}function countProperties(e){let t=0;for(let a in e)e.hasOwnProperty(a)&&++t;return t}class OutgoingPane extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__label"},e.data.type),React.createElement("div",{className:"credential"},React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info"},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,e.data.contact.name)),React.createElement("div",{className:"contact-info-card__phone"},React.createElement("span",null," ")))),React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__call-type"},e.data.contact.phone)))),React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns is-pending"},React.createElement("button",{className:"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},React.createElement("span",{className:"call-in-action__text"},e.data.status),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:e.getDuration(),timeStart:Date.now()}))),React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call",id:"cancel-outgoing-call","data-call-sid":e.data.callSid,disabled:e.isSentHangupRequestState()},e.isSentHangupRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))))}}function ContactInfo(e){return React.createElement(React.Fragment,null,React.createElement("div",{className:"additional-info__header"},React.createElement("div",{className:"agent-text-avatar"},React.createElement("span",null,e.avatar)),React.createElement(ContactInfoHeader,e),React.createElement("a",{href:"#",className:"additional-info__close"},React.createElement("i",{className:"fas fa-times"}," "))),React.createElement("div",{className:"additional-info__body scrollable-block"},React.createElement("ul",{className:"info-listing incoming-info"},React.createElement("li",null,React.createElement("small",{className:"incoming-info__label"},"Name"),React.createElement("span",{className:"incoming-info__value"},e.name)))))}function ContactInfoHeader(e){return e.canContactDetails||e.canCallInfo?React.createElement(React.Fragment,null,e.canContactDetails&&e.id?React.createElement("a",{href:"#","data-client-id":e.id,"data-is-client":e.isClient,className:"cw-call-contact-info cw-btn-client-info"},React.createElement("span",{className:"additional-info__header-title"},e.isClient?"Client details":"Contact info")):React.createElement("span",{className:"additional-info__header-title"},e.isClient?"Client details":"Contact info"),e.canCallInfo?React.createElement(React.Fragment,null,"  /  ",React.createElement("a",{href:"#","data-call-sid":e.callSid,className:"cw-call-contact-info pw-btn-call-info"},React.createElement("span",{className:"additional-info__header-title"},"Call info"))," "):""):React.createElement("span",{className:"additional-info__header-title"},e.isClient?"Client details":"Contact info")}class ConferencePane extends React.Component{constructor(e){super(e),this.state={call:e.call,conference:e.conference}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler()),window.phoneWidget.eventDispatcher.addListener(this.state.conference.getEventUpdateName(),this.conferenceUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler()),window.phoneWidget.eventDispatcher.removeListener(this.state.conference.getEventUpdateName(),this.conferenceUpdateHandler())}callUpdateHandler(){let e=this;return function(t){e.setState({call:t.call})}}conferenceUpdateHandler(){let e=this;return function(t){e.setState({conference:t.conference})}}render(){let e=this.state.call,t=this.state.conference,a=t.getCountParticipants();return React.createElement(React.Fragment,null,React.createElement("div",{className:"call-details"},React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__participants"},React.createElement("i",{className:"call-details__participants-len"},a)," Participants")),React.createElement("div",{className:"call-details__col"},React.createElement("a",{href:"#",className:"call-details__nav-btn call-details__nav-btn--more"},"Details"))),React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement(ParticipantShortList,{conference:t}),React.createElement("div",{className:"actions-container"},React.createElement(CallBtns,{call:e}),React.createElement(SoundIndication,null)),React.createElement(ActivePaneControls,{call:e,controls:this.props.controls}),React.createElement("div",{className:"conference-call-details"},React.createElement("div",{className:"call-details"},React.createElement("div",{className:"call-details__col"},React.createElement("a",{href:"#",className:"call-details__nav-btn call-details__nav-btn--back"},"Back")),React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__participants"},React.createElement("i",{className:"fa fa-users"}," ")," ",a)),React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__time"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now()})))),React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement(ParticipantList,{conference:t})))}}function ParticipantList(e){let t=e.conference,a=[];for(let e of t.getParticipants())a.push(React.createElement(ParticipantItem,{key:e.data.callSid,participant:e}));return React.createElement("ul",{className:"conference-call__detailed participant-list scrollable-block"},a)}function ParticipantItem(e){let t=e.participant,a="participant-list__item participant";return"coaching"===t.data.type&&(a+=" participant-list__item--coach"),React.createElement("li",{className:a},React.createElement("div",{className:"participant__avatar"},React.createElement("span",null,t.data.avatar)),React.createElement("div",{className:"participant__info"},React.createElement("span",{className:"participant__name"},t.data.name),React.createElement("span",{className:"participant__phone"},t.data.phone),"coaching"===t.data.type?React.createElement("span",{className:"participant__status"},React.createElement("i",{className:"fa fa-headphones-alt"}," ")," coaching"):""),React.createElement("div",{className:"participant__action"},React.createElement("b",{className:"participant__timer"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now()}))))}function ParticipantShortList(e){let t=e.conference,a=[],n=t.getCountParticipants();if(n>10){let e=0;for(let n of t.getParticipants())if(a.push(React.createElement(ParticipantShortItem,{key:n.data.callSid,participant:n})),9===++e)break}else for(let e of t.getParticipants())a.push(React.createElement(ParticipantShortItem,{key:e.data.callSid,participant:e}));return React.createElement("div",{className:"conference-call"},React.createElement("ul",{className:"conference-call__list"},a,n>10?React.createElement("li",null,React.createElement("div",{className:"conference-call__collapsed"},React.createElement("span",{className:"conference-call__name"},"and ",React.createElement("i",null,n-9)," more..."))):""))}function ParticipantShortItem(e){let t=e.participant,a="conference-call__thumbnail";return"coaching"===t.data.type&&(a+=" conference-call__thumbnail--coaching"),React.createElement("li",null,React.createElement("div",{className:a},React.createElement("div",{className:"conference-call__avatar"},t.data.avatar),React.createElement("span",{className:"conference-call__name"},t.data.name),"coaching"===t.data.type?React.createElement("i",{className:"conference-call__icon"},React.createElement("i",{className:"fa fa-headphones-alt"}," ")):""))}class AddNote extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement("div",{className:"additional-info__header"},React.createElement("span",{className:"additional-info__header-title"},"Add Note"),React.createElement("a",{href:"#",className:"additional-info__close"},React.createElement("i",{className:"fas fa-times"}," "))),React.createElement("div",{className:"additional-info__body scrollable-block add-note-block"},React.createElement("textarea",{id:"active_call_add_note",cols:"30",rows:"10",placeholder:"Enter Note...",disabled:e.isSentAddNoteRequestState(),defaultValue:""}),React.createElement("button",{id:"active_call_add_note_submit","data-call-sid":e.data.callSid,disabled:e.isSentAddNoteRequestState()},e.isSentAddNoteRequestState()?React.createElement(React.Fragment,null,React.createElement("i",{className:"fa fa-spinner fa-spin"}," ")," Save"):"Save")))}}class DesktopNotification extends React.Component{constructor(e){super(e)}render(){let e=this.props.notifications.map(e=>React.createElement(NotificationItem,{key:e.key,notification:e,source:"desktop"}));return React.createElement("div",{className:"phone-notifications"},React.createElement("ul",{className:"phone-notifications__list"},e))}}class PhoneWidgetNotification extends React.Component{constructor(e){super(e)}render(){let e="phone-notifications";return this.props.notification.isDeleted||this.props.notification.isNew||(e+=" phone-notifications--shown"),"general"===this.props.notification.queue?e+=" phone-notifications--general-calls":"direct"===this.props.notification.queue?e+=" phone-notifications--direct-calls":"active"!==this.props.notification.queue&&"hold"!==this.props.notification.queue||(e+=" phone-notifications--active-calls"),React.createElement("div",{className:e},React.createElement("ul",{className:"phone-notifications__list"},React.createElement(NotificationItem,{key:this.props.notification.key,notification:this.props.notification,source:"phone"})))}}function NotificationItem(e){return e.notification.type===window.phoneWidget.notifier.types.incomingCall?React.createElement(IncomingCallNotificationItem,{notification:e.notification,source:e.source}):null}class IncomingCallNotificationItem extends React.Component{constructor(e){super(e),this.state={notification:e.notification}}componentDidMount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.desktopUpdateHandler())}componentWillUnmount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.desktopUpdateHandler())}phoneUpdateHandler(){let e=this;return function(t){let a=t.call,n=e.state.notification;n.isSentAcceptCallRequestState=a.isSentAcceptCallRequestState(),n.isSentReturnHoldCallRequestState=a.isSentReturnHoldCallRequestState(),e.setState({notification:n})}}desktopUpdateHandler(){let e=this;return function(t){let a=t.call,n=e.state.notification;n.isSentAcceptCallRequestState=a.isSentAcceptCallRequestState(),n.isSentReturnHoldCallRequestState=a.isSentReturnHoldCallRequestState(),e.setState({notification:n})}}render(){let e=this.state.notification,t=e.duration||0;e.timePushed&&(t=Math.floor((Date.now()-parseInt(e.timePushed))/1e3)+parseInt(t));let a="";return e.project&&e.department?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("b",{className:"incoming-notification__project-name"},e.project),React.createElement("i",null,"•"),React.createElement("span",{className:"incoming-notification__position"},e.department)):e.project?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("b",{className:"incoming-notification__project-name"},e.project)):e.department?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("span",{className:"incoming-notification__position"},e.department)):e.isInternal&&(a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("span",{className:"incoming-notification__position"},"Internal"))),React.createElement("li",{className:e.isDeleted||e.isNew?"phone-notifications__item":"phone-notifications__item phone-notifications__item--shown"},React.createElement("div",{className:"incoming-notification"},React.createElement("i",{className:"user-icn"},e.name[0]),React.createElement("div",{className:"incoming-notification__inner"},React.createElement("div",{className:"incoming-notification__info"},React.createElement("div",{className:"incoming-notification__general-info"},React.createElement("b",{className:"incoming-notification__name"},e.name),React.createElement("span",{className:"incoming-notification__phone"},e.phone),a),React.createElement("div",{className:"incoming-notification__timer"},React.createElement("span",null,React.createElement(PhoneWidgetTimer,{duration:t,timeStart:Date.now()})))),React.createElement("div",{className:"incoming-notification__action-list"},React.createElement("div",{className:"incoming-notification__dynamic"},e.canCallInfo?React.createElement("a",{href:"#","data-call-sid":e.callSid,className:"incoming-notification__action incoming-notification__action--info pw-btn-call-info"},React.createElement("i",{className:"fa fa-info"}," ")):"",React.createElement("a",{href:"#",className:"incoming-notification__action incoming-notification__action--phone btn-item-call-queue","data-type-action":"hold"===e.queue?"return":e.isInternal?"acceptInternal":"accept","data-call-sid":e.callSid,"data-from-internal":e.fromInternal},e.isSentAcceptCallRequestState||e.isSentReturnHoldCallRequestState?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone"}," "))),"phone"===this.props.source?React.createElement("a",{href:"#","data-call-sid":e.key,className:"incoming-notification__action incoming-notification__action--min pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-alt-down"}," ")):React.createElement("a",{href:"#","data-call-sid":e.key,className:"incoming-notification__action incoming-notification__action--max pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-down"}," "))))))}}var PhoneWidgetContactInfo=function(){let e=$("#contact-info"),t=document.getElementById("contact-info");return{load:function(e){e.avatar=e.name.charAt(0),e.avatar.toUpperCase(),ReactDOM.render(React.createElement(ContactInfo,e),t)},hide:function(){e.hide()}}}(),PhoneWidgetDialpad=function(){let e=$(".dial-popup");return{hide:function(){e.hide()}}}();class PhoneWidgetPaneActiveBtn{constructor(e,t){this.pane=e,this.btn=null,this.id=t}init(){return this.btn=this.pane.find(this.id),this}show(){return this.btn.show(),this}hide(){return this.btn.hide(),this}enable(){return this.btn.attr("data-disabled",!1),this}disable(){return this.btn.attr("data-disabled",!0),this}active(){return this.btn.attr("data-active",!0),this}isActive(){return"true"===this.btn.attr("data-active")}inactive(){return this.btn.attr("data-active",!1),this}}class PhoneWidgetPaneActiveBtnHold extends PhoneWidgetPaneActiveBtn{constructor(e){super(e,"#wg-hold-call")}sendRequest(){this.disable();let e="Resume";return"unhold"===this.btn.attr("data-mode")&&(e="On Hold"),this.btn.children().html('<i class="fa fa-spinner fa-spin"> </i><span>'+e+"</span>"),this}unhold(){return this.btn.attr("data-mode","unhold"),this.btn.children().html('<i class="fa fa-pause"> </i><span>On Hold</span>'),this}hold(){return this.btn.attr("data-mode","hold"),this.btn.children().html('<i class="fa fa-play"> </i><span>Resume</span>'),this}}class PhoneWidgetPaneActiveBtnMute extends PhoneWidgetPaneActiveBtn{constructor(e){super(e,"#call-pane__mute")}sendRequest(){return this.disable(),this.btn.attr("data-is-muted",null),this.btn.html('<i class="fa fa-spinner fa-spin"> </i>'),this}mute(){return this.enable(),this.btn.attr("data-is-muted",!0),this.btn.html('<i class="fas fa-microphone-alt-slash"> </i>'),this}isMute(){return"true"===this.btn.attr("data-is-muted")}unMute(){return this.enable(),this.btn.attr("data-is-muted",!1),this.btn.html('<i class="fas fa-microphone"> </i>'),this}disable(){return this.btn.attr("disabled",!0),this}enable(){return this.btn.attr("disabled",!1),this}}var PhoneWidgetPaneActive=function(){let e=null;let t=$("#call-pane-calling"),a=document.getElementById("call-pane-calling"),n=document.getElementById("add-note"),i=PhoneWidgetContactInfo,l=PhoneWidgetDialpad,c={hold:new PhoneWidgetPaneActiveBtnHold(t),mute:new PhoneWidgetPaneActiveBtnMute(t)},o=!0,s=!0;function r(l,o){var s;null!=o?(t.addClass("call-pane-calling--conference"),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(ConferencePane,{call:l,controls:d(l),conference:o}),a)):(t.removeClass("call-pane-calling--conference"),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(ActivePane,{call:l,controls:d(l)}),a)),ReactDOM.unmountComponentAtNode(n),ReactDOM.render(React.createElement(AddNote,{call:l}),n),$(".dialpad_btn_active").attr("data-conference-sid",l.data.conferenceSid),$("#call-pane__dial-number_active_dialpad").val(""),i.load(l.data.contact),s=l.data.callSid,e=s,c.hold.init(),c.mute.init()}function d(e){let t={hold:{active:!0,show:o},transfer:{active:!0,show:s},addPerson:{active:!1},dialpad:{active:!0}};return 3===e.data.typeId&&(t.hold.active=!1,t.transfer.active=!1,t.addPerson.active=!1,t.dialpad.active=!1),e.data.isInternal&&(t.hold.active=!!e.data.isConferenceCreator,t.transfer.active=!1,t.addPerson.active=!1,t.dialpad.active=!1),conferenceBase||(t.hold.active=!1,t.transfer.active=!0,t.addPerson.active=!1,t.dialpad.active=!1),t}function u(){i.hide(),l.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),t.addClass("is_active"),$('[data-toggle-tab="tab-phone"]').attr("data-call-in-progress",!0)}function m(){$('[data-toggle-tab="tab-phone"]').attr("data-call-in-progress",!1)}return{setup:function(e,t){o=e,s=t},buttons:c,init:function(e,t){r(e,t),u(),PhoneWidgetCall.iconUpdate()},load:r,show:u,hide:function(){t.removeClass("is_active"),m()},getCallSid:function(){return e},removeCallSid:function(){e=null},isActive:function(){return t.hasClass("is_active")},removeCallInProgressIndicator:m}}(),PhoneWidgetPaneIncoming=function(){let e=null;let t=$("#call-pane-incoming"),a=document.getElementById("call-pane-incoming"),n=PhoneWidgetContactInfo,i=PhoneWidgetDialpad;function l(t){var i;n.load(t.data.contact),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(IncomingPane,{call:t}),a),i=t.data.callSid,e=i}function c(){n.hide(),i.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),t.addClass("is_active")}function o(e,t){let a="";t?a=e+"+"+t:e>1&&(a=e),widgetIcon.update({type:"incoming",timer:!1,text:null,currentCalls:a,status:"online"})}return{init:function(e,t,a){l(e),c(),o(t,a)},load:l,show:c,hide:function(){ReactDOM.unmountComponentAtNode(a),t.removeClass("is_active")},getCallSid:function(){return e},removeCallSid:function(){e=null},isActive:function(){return t.hasClass("is_active")},initWidgetIcon:o}}(),PhoneWidgetPaneOutgoing=function(){let e=null;let t=$("#call-pane-outgoing"),a=document.getElementById("call-pane-outgoing"),n=PhoneWidgetContactInfo,i=PhoneWidgetDialpad;function l(t){var i;n.load(t.data.contact),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(OutgoingPane,{call:t}),a),i=t.data.callSid,e=i}function c(){n.hide(),i.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),t.addClass("is_active")}return{init:function(e){l(e),c(),widgetIcon.update({type:"outgoing",timer:!0,timerStamp:e.getDuration(),text:e.data.status,currentCalls:null,status:"online"})},load:l,show:c,hide:function(){ReactDOM.unmountComponentAtNode(a),t.removeClass("is_active")},getCallSid:function(){return e},removeCallSid:function(){e=null},isActive:function(){return t.hasClass("is_active")}}}();function PhoneWidgetPaneQueue(e){let t=e,a=this,n=".call-filter__toggle",i=null;function l(){let e=Object.assign({},t.active.all()),a=Object.assign({},t.hold.all());for(let t in a)void 0===e[t]?e[t]=a[t]:a[t].calls.forEach(function(a){e[t].calls.push(a)});return e}function c(){ReactDOM.render(React.createElement(QueueItem,{groups:l(),type:"active",name:""}),document.getElementById("queue-separator")),i="active"}function o(){ReactDOM.render(React.createElement(QueueItem,{groups:t.direct.all(),type:"direct",name:""}),document.getElementById("queue-separator")),i="direct"}function s(){ReactDOM.render(React.createElement(QueueItem,{groups:t.general.all(),type:"general",name:""}),document.getElementById("queue-separator")),i="general"}function r(){ReactDOM.render(React.createElement(AllQueues,{active:l(),direct:t.direct.all(),general:t.general.all()}),document.getElementById("queue-separator")),i="all"}function d(e){var t=$(".widget-line-overlay__queue-marker");switch(t.removeClass("tab-active"),t.removeClass("tab-direct"),t.removeClass("tab-general"),t.removeClass("tab-all"),$(e).attr("data-call-filter")){case"active":$("[data-queue-marker]").html("Active Calls"),t.addClass("tab-active");break;case"direct":$("[data-queue-marker]").html("Direct Line"),t.addClass("tab-direct");break;case"general":$("[data-queue-marker]").html("General Line"),t.addClass("tab-general");break;case"all":$("[data-queue-marker]").html("Calls Queue")}}$(document).on("click",n,function(e){switch(e.preventDefault(),$(this).attr("data-call-filter")){case"active":c();break;case"direct":o();break;case"general":s()}$(n).removeClass("is-checked"),$(this).addClass("is-checked"),d($(this)),a.show(),$("[data-toggle-tab]").removeClass("is_active")}),$(document).on("click",".widget-line-overlay__show-all-queues",function(e){e.preventDefault(),$(n).addClass("is-checked"),d($(this)),r()}),this.openAllCalls=function(){let e=$(".widget-line-overlay__show-all-queues");$(n).addClass("is-checked"),d(e),$("[data-toggle-tab]").removeClass("is_active"),r(),a.show()},this.refresh=function(){$(".call-filter__toggle--line-active").html(t.hold.count()+t.active.count()),$(".call-filter__toggle--line-direct").html(t.direct.count()),$(".call-filter__toggle--line-general").html(t.general.count()),"active"===i?c():"direct"===i?o():"general"===i?s():"all"===i&&r()},this.show=function(){$(".widget-line-overlay").show()},this.hide=function(){$(".widget-line-overlay").hide(),$(n).removeClass("is-checked")}}function stateTimer(){var e=null;return{start:function(t,a){var n=Math.floor(a%60),i=Math.floor((a-n)/60),l=Math.floor((a-i)/60);e=setInterval(function(){n=Math.floor(a%60),i=Math.floor((a-n)/60%60),l=Math.floor(a/3600),86399===a&&(a=0),parseInt(n)<10&&(n="0"+n),parseInt(i)<10&&(i="0"+i),parseInt(l)<10&&(l="0"+l),a++,$(t).html(l+":"+i+":"+n)},1e3)},clear:function(){clearInterval(e)}}}function formatPhoneNumber(e){let t=(""+e).replace(/\D/g,"").match(/^(1|)?(\d{3})(\d{3})(\d{4})$/);return t?[t[1]?"+1 ":"","(",t[2],") ",t[3],"-",t[4]].join(""):e}function toSelect(e,t,a){var n=$(e);optionClass="dropdown-item";var i="optionselected";function l(e,t){let a='<div class="dropdown">'+e+'<div class="dropdown-menu" >'+function(e){let t=[];return e.length>1&&e.forEach(function(e){t.push('<button class="dropdown-item" type="button" value="'+e.value+'" data-info-project="'+e.project+'" data-info-project-id="'+e.projectId+'"><small class="current-number__phone">'+formatPhoneNumber(e.value)+'</small><span class="current-number__identifier">'+e.project+"</span></button>")}),t}(t).join("")+"</div>";return a+="</div>"}return this.data={value:t.selected.value,project:t.selected.project,projectId:t.selected.projectId},this.primaryData={value:t.primary&&t.primary.value||null,project:t.primary&&t.primary.project||null,projectId:t.primary&&t.primary.projectId||null},this.getData=function(){return this.data},this.setData=function(){return function(e){this.data.value=e.value,this.data.project=e.project,this.data.projectId=e.projectId}.bind(this)},this.setPrimaryData=function(){return function(e){console.log(e),this.primaryData.value=e.value,this.primaryData.project=e.project,this.primaryData.projectId=e.projectId}.bind(this)},this.getPrimaryData=function(){return this.primaryData},this.clearPrimaryData=function(){return function(){return this.primaryData.value=null,this.primaryData.project=null,this.primaryData.projectId=null,this}.bind(this)},function(e){let t=e.options.length;n.append(l(function(e,t,a,n,i){let l="";return i>1&&(l='<i class="fa fa-chevron-down"></i>'),'<button value="'+e+'" data-info-project="'+t+'" data-info-project-id="'+n+'" class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><small class="current-number__phone current-number__selected-nr">'+formatPhoneNumber(e)+'</small><span class="current-number__identifier current-number__selected-project">'+t+"</span>"+l+"</button>"}(e.selected.value,e.selected.project,e.selected.id,e.selected.projectId,t),e.options))}(t),$(n).on(i,$(".dropdown-toggle"),function(e){var t=e.target,i=n.find(".current-number__selected-nr"),l=n.find(".current-number__selected-project");$(t).find(".dropdown-toggle").val(this.data.value),i.text(this.data.value),l.text(this.data.project),"function"==typeof a&&a.call(this)}.bind(this)),$(n).on("click",".dropdown-item",function(){!function(e){this.data.value=e.val(),this.data.project=e.attr("data-info-project"),this.data.projectId=e.attr("data-info-project-id"),$(n).trigger(i)}($(this))}),{getData:this.getData(),setData:this.setData(),setPrimaryData:this.setPrimaryData(),getPrimaryData:this.getPrimaryData(),clearPrimaryData:this.clearPrimaryData()}}function handleWidgetIcon(){var e,t=$(".phone-widget-icon"),a=".widget-icon-inner",n="animate",i=null;function l(e){$(a).removeClass(n);var t,l,c,o,s,r=".widget-icon-inner",d=".phone-widget-icon__time";e.timer&&$(d).html(null),clearInterval(i),$(r).attr("data-wi-status",e.status),$(r).attr("data-wi-type",e.type),$(".phone-widget-icon__ongoing").html(e.currentCalls),$(".phone-widget-icon__text").html(e.text),e.timer?(t=d,l=e.timerStamp,c=Math.floor(l%60),o=Math.floor((l-c)/60),s=Math.floor((l-o)/60),i=setInterval(function(){c=Math.floor(l%60),o=Math.floor((l-c)/60%60),s=Math.floor(l/3600),86399===l&&(l=0),parseInt(c)<10&&(c="0"+c),parseInt(o)<10&&(o="0"+o),parseInt(s)<10&&(s="0"+s),l++,$(t).html(s+":"+o+":"+c)},1e3)):$(d).html(null),e=null,$(a).addClass(n)}return{init:function(){e='<div class="widget-icon-inner" data-wi-type="'+"default"+'" data-wi-status="'+!1+'"><div class="standby-phone"><i class="fa fa-phone-volume icon-phone-answer"></i><div class="phone-widget-icon__state"><span class="phone-widget-icon__ongoing"></span><span class="phone-widget-icon__text"></span><span class="phone-widget-icon__time"></span></div><i class="fa fa-phone icon-phone"></i></div></div>',$(t).append(e)},update:function(e){l(e)}}}function callsFilter(e){return{init:function(){},reset:function(){$(".widget-line-overlay").hide();$(".call-filter__toggle").removeClass("is-checked")}}}function widgetStatus(e,t){let a=t;var n=".status-confirmation",i={status:!!$(e).attr("checked"),shown:!1};function l(){$("#pw_status_name").text("ON")}function c(){$("#pw_status_name").text("OFF")}return $(document).on("click","[data-status-action]",function(t){t.preventDefault(),function(t){if("true"===t.attr("data-status-action")){t.html('<i class="fa fa-spinner fa-spin"></i>');let n=1;i.status&&(n=2),$.ajax({type:"post",data:{type_id:n},url:a}).done(function(t){let a=!0;2===n?(a=!1,c()):l(),$(e).prop("checked",a),i.status=a}).fail(function(){new PNotify({title:"Change status",type:"error",text:"Server error",hide:!0})}).always(function(){t.html('<i class="fa fa-check"></i>'),i.shown&&$(".status-confirmation-tooltip").detach(),i.shown=!1})}else i.shown&&$(".status-confirmation-tooltip").detach(),i.shown=!1}($(this))}),$(document).on("click",e,function(e){var t;e.preventDefault(),i.shown||(i.shown=!0,$(n).append('<div class="status-confirmation-tooltip"><span>Switch to <i class="'+((t=i.status)?"occupied":"online")+'">'+(t?"OFF":"ON")+'</i> ?</span><div class="status-action-group"><a href="#" data-status-action="false">NO</a><a href="#" data-status-action="true"><i class="fa fa-check"></i></a></div></div>'))}),$(document).on("click",".phone-widget",function(e){i.shown&&!$(e.target).closest(".number-toggle").length&&($(".status-confirmation-tooltip").detach(),i.shown=!1)}),{getStatus:function(){switch(i.status){case!0:return 1;case!1:return 2}},setStatus:function(t){1===t?(i.status=!0,l()):(i.status=!1,c()),$(n).html(""),$(".status-confirmation-tooltip").detach(),i.shown=!1,$(e).prop("checked",i.status)}}}!function(){function e(){this.calls=[],this.add=function(e){return null!==this.getIndex(e.callSid)?null:(function(e){e.timeQueuePushed=Date.now(),e.blocked=!1,e.sentHoldUnHoldRequest=!1,e.sentMuteUnMuteRequest=!1,e.sentHangupRequest=!1,e.sentReturnHoldCallRequest=!1,e.sentAcceptCallRequest=!1,e.sentAddNoteRequest=!1,e.sentRejectInternalRequest=!1}(e),e.isHold&&(e.holdStartTime=Date.now()-1e3*parseInt(e.holdDuration)),this.calls.unshift(e),new window.phoneWidget.call.Call(e))},this.remove=function(e){let t=this.getIndex(e);return null!==t&&(this.calls.splice(t,1),!0)},this.getIndex=function(e){let t=null;return this.calls.forEach(function(a,n){if(a.callSid===e)return t=n,!1}),t},this.getLast=function(){let e=null;for(let t in this.calls)"inArray"!==t&&(e=this.calls[t]);return null==e?null:new window.phoneWidget.call.Call(e)},this.getFirst=function(){let e=null;for(let t in this.calls)if("inArray"!==t){e=this.calls[t];break}return null==e?null:new window.phoneWidget.call.Call(e)},this.one=function(e){let t=this.getIndex(e);return null!==t?new window.phoneWidget.call.Call(this.calls[t]):null},this.count=function(){return this.calls.length},this.all=function(){let e=[];return this.calls.forEach(function(t){e.push(new window.phoneWidget.call.Call(t))}),e},this.showAll=function(){this.calls.forEach(function(e){console.log(e)})},this.reset=function(){this.calls=[]}}class t{constructor(e,t){this.queue=e,this.queueName=t}getList(){let e=[],t=this;return this.queue.all().forEach(function(a){a.data.queue===t.queueName&&e.push(a)}),e}one(e){return this.queue.one(e)}all(){let e=this.getList();if(e.length<1)return[];let t=[],a="";return e.forEach(function(e){return e.data.isInternal?(t.internal||(t.internal={calls:[]}),void t.internal.calls.push(e)):e.data.project?(a=e.data.project+e.data.department,t[a]||(t[a]={project:e.data.project,department:e.data.department,calls:[]}),void t[a].calls.push(e)):(t.external||(t.external={calls:[]}),void t.external.calls.push(e))}),t}count(){return this.getList().length}add(e){return this.queue.add(e)}getLast(){return this.queue.getLast()}getFirst(){return this.queue.getFirst()}remove(e){this.queue.remove(e)}reset(){this.queue.reset()}}window.phoneWidget.queue={Queue:e,Direct:class extends t{constructor(e){super(e,"direct")}},Hold:class extends t{constructor(e){super(e,"hold")}},General:class extends t{constructor(e){super(e,"general")}},Active:function(){return new t(new e,"inProgress")}}}(),function(){window.phoneWidget.storage.conference=new function(){this.conferences=[],this.add=function(e){return null!==this.getIndex(e.sid)?null:(function(e){e.timeStoragePushed=Date.now()}(e),this.conferences.unshift(e),new window.phoneWidget.conference.Conference(e))},this.remove=function(e){let t=this.getIndex(e);null!==t&&this.conferences.splice(t,1)},this.getIndex=function(e){let t=null;return this.conferences.forEach(function(a,n){if(a.sid===e)return t=n,!1}),t},this.removeByParticipantCallSid=function(e){let t=this.getIndexByParticipantCallSid(e);null!==t&&this.conferences.splice(t,1)},this.getIndexByParticipantCallSid=function(e){let t=null;return this.conferences.forEach(function(a,n){a.participants.forEach(function(a){a.callSid===e&&(t=n)})}),t},this.one=function(e){let t=this.getIndex(e);return null!==t?new window.phoneWidget.conference.Conference(this.conferences[t]):null},this.update=function(e){this.remove(e.sid);let t=this.add(e);null!==t?t.save():console.log("conference not added to storage")},this.showAll=function(){this.conferences.forEach(function(e){console.log(e)})},this.reset=function(){this.conferences=[]}}}(),function(){function e(){this.notifications=[],this.add=function(e,t,a){return null===this.getIndex(e)&&(a.key=e,a.type=t,a.timePushed=Date.now(),this.notifications.unshift(a),a)},this.remove=function(e){let t=this.getIndex(e);return null!==t&&(this.notifications.splice(t,1),!0)},this.getIndex=function(e){let t=null;return this.notifications.forEach(function(a,n){a.key===e&&(t=n)}),t},this.getLast=function(){let e=null;for(let t in this.notifications)"inArray"!==t&&(e=this.notifications[t]);return null==e?null:e},this.getFirst=function(){let e=null;for(let t in this.notifications)if("inArray"!==t){e=this.notifications[t];break}return null==e?null:e},this.one=function(e){let t=this.getIndex(e);return null!==t?this.notifications[t]:null},this.count=function(){return this.notifications.length},this.all=function(){return this.notifications},this.showAll=function(){this.notifications.forEach(function(e){console.log(e)})},this.reset=function(){this.notifications=[]}}function t(){this.$container=document.getElementById("desktop-phone-notifications"),this.notify=function(e){ReactDOM.render(React.createElement(DesktopNotification,{notifications:e}),this.$container)},this.reset=function(){ReactDOM.unmountComponentAtNode(this.$container),this.$container.innerHTML=""}}function a(){this.$container=document.getElementById("widget-phone-notifications"),this.notificationKey=null,this.notify=function(e){this.notificationKey=e.key,ReactDOM.render(React.createElement(PhoneWidgetNotification,{notification:e}),this.$container)},this.reset=function(){ReactDOM.unmountComponentAtNode(this.$container),this.$container.innerHTML=""},this.isEqual=function(e){return this.notificationKey===e}}window.phoneWidget.notifier=new function(){this.notifications=new e,this.notifiers={desktop:new t,phone:new a},this.add=function(e,t,a){if(!1===this.notifications.add(e,t,a))return!1;a.isNew=!0,this.notifiers.desktop.notify(this.notifications.all()),this.notifiers.phone.notify(a),a.isNew=!1;let n=this;return setTimeout(function(){n.notifiers.desktop.notify(n.notifications.all()),n.notifiers.phone.notify(a)},50),!0},this.remove=function(e){let t=this.notifications.one(e);if(null===t)return!1;t.isDeleted=!0,this.notifiers.desktop.notify(this.notifications.all()),this.notifiers.phone.isEqual(t.key)&&this.notifiers.phone.notify(t),this.notifications.remove(e);let a=this;return setTimeout(function(){a.notifiers.desktop.notify(a.notifications.all()),a.notifiers.phone.isEqual(t.key)&&a.notifiers.phone.reset(),0===a.notifications.count()&&a.notifiers.desktop.reset()},400),!0},this.reset=function(){this.notifiers.desktop.reset(),this.notifiers.phone.reset()}},window.phoneWidget.notifier.types={incomingCall:"incomingCall"}}(),$(document).ready(function(){var e;window.widgetIcon=new handleWidgetIcon,widgetIcon.init(),$phoneTabAnchor=$("[data-toggle-tab]");var t=!1;$phoneTabAnchor.on("click",function(){if($current="#"+$(this).data("toggle-tab"),$phoneTabAnchor.removeClass("is_active"),$(this).addClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$($current).addClass("is_active"),$(".widget-modal").hide(),$(".collapsible-container").collapse("hide"),h.reset(),"tab-history"===$(this).data("toggle-tab")){t||(t=!0,$.ajax({url:"/call-log/ajax-get-call-history",type:"post",data:{},dataType:"json",beforeSend:function(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>')},success:function(t){$("#tab-history .simplebar-content").append(t.html),e.recalculate(),$("#tab-history").attr("data-page",t.page)},complete:function(e){$($current).find(".wg-history-load").remove()},error:function(e,t){}})),parseInt($(this).attr("data-missed-calls"))>0&&PhoneWidgetCall.requestClearMissedCalls()}"#tab-contacts"===$current&&(PhoneWidgetContacts.fullListIsEmpty(),$(this).hasClass("js-add-to-conference")?(window.localStorage.setItem("contactSelectableState",1),$(".contacts-list").addClass("contacts-list--selection"),$(".selection-amount").show()):(window.localStorage.setItem("contactSelectableState",0),$(".contacts-list").removeClass("contacts-list--selection"),$(".submit-selected-contacts").slideUp(10),$(".selection-amount").hide()),PhoneWidgetContacts.requestFullList())}),$(".phone-widget__tab").each(function(t,a){var n=new SimpleBar(a);n.getContentElement(),"tab-history"===$(a).attr("id")&&(!function(t){var a=!1;t.getScrollElement().addEventListener("scroll",function(t){if(t.target.scrollTop+t.target.clientHeight===t.target.scrollHeight&&!a){var n=$("#tab-history").attr("data-page");$.ajax({url:"/call-log/ajax-get-call-history",type:"post",data:{page:n,uid:userId},dataType:"json",beforeSend:function(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>'),a=!0},success:function(t){$("#tab-history .simplebar-content").append(t.html),e.recalculate(),$("#tab-history").attr("data-page",t.page),t.rows||(a=!1)},complete:function(){$($current).find(".wg-history-load").remove()},error:function(e,t){}})}})}(n),e=n),"tab-contacts"===$(a).attr("id")&&void 0!==PhoneWidgetContacts&&PhoneWidgetContacts.initLazyLoadFullList(n)}),$(".js-toggle-contact-info").on("click",function(){$(".contact-modal-info").show()}),$(".subject-option__add").on("click",function(){if(!$(this).hasClass("added")){switch($(this).data("add-type")){case"cc":$(".email-modal__modal-input-list").append('<input type="text" class="email-modal__contact-input additional-subj" placeholder="CC">');break;case"bcc":$(".email-modal__modal-input-list").append('<input type="text" class="email-modal__contact-input additional-subj" placeholder="BCC">')}$(this).addClass("added")}});var a=$(".scrollable-block"),n=$(".additional-bar__body"),i=$(".contact-modal-info"),l=$(".suggested-contacts"),c=new SimpleBar(l[0]);new SimpleBar(i[0]).getContentElement(),c.getContentElement(),$(n).each(function(e,t){new SimpleBar(t).getContentElement()}),$(".toggle-bar-settings").on("click",function(){$("#bar-settings").slideToggle(150),$("#bar-logs").slideUp(150)}),$(".additional-bar__close").on("click",function(){$(this).parents(".additional-bar").slideUp(150)}),$(".toggle-bar-logs").on("click",function(){$("#bar-logs").slideToggle(150),$("#bar-settings").slideUp(150)}),$(".additional-bar__close").on("click",function(){$(this).parents(".additional-bar").slideUp(150)});var o=$(".tab-trigger.active-tab").attr("href");$(o).show(),$(".tab-trigger").on("click",function(e){e.preventDefault(),$(".tab-trigger").removeClass("active-tab"),$(this).addClass("active-tab"),$(".tabs__item").hide(),$($(this).attr("href")).show()}),$(a).each(function(e,t){new SimpleBar(t).getContentElement()});var s=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;function r(e,t,a){this.context=e,this.status=0,this.freq1=t,this.freq2=a}r.prototype.setup=function(){this.osc1=u.createOscillator(),this.osc2=u.createOscillator(),this.osc1.frequency.value=this.freq1,this.osc2.frequency.value=this.freq2,this.gainNode=this.context.createGain(),this.gainNode.gain.value=.25,this.filter=this.context.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency=8e3,this.osc1.connect(this.gainNode),this.osc2.connect(this.gainNode),this.gainNode.connect(this.filter),this.filter.connect(u.destination)},r.prototype.start=function(){this.setup(),this.osc1.start(0),this.osc2.start(0),this.status=1},r.prototype.stop=function(){this.osc1.stop(0),this.osc2.stop(0),this.status=0};var d={1:{f1:697,f2:1209},2:{f1:697,f2:1336},3:{f1:697,f2:1477},4:{f1:770,f2:1209},5:{f1:770,f2:1336},6:{f1:770,f2:1477},7:{f1:852,f2:1209},8:{f1:852,f2:1336},9:{f1:852,f2:1477},"✱":{f1:941,f2:1209},0:{f1:941,f2:1336},"#":{f1:941,f2:1477},"+":{f1:941,f2:1497}},u=new s,m=new r(u,350,440),f=null,p=null;$(".dialpad_btn_init").on("mousedown touchstart",function(e){e.preventDefault();var t=$(this).val();f=t,p=setInterval(function(){if("0"===f){let e=$(".call-pane__dial-number").val();e&&(e=e.substring(0,e.length-1),e+="+",$(".call-pane__dial-number").val(e))}clearInterval(p)},700);var a=d[t];m.freq1=a.f1,m.freq2=a.f2,0==m.status&&m.start();let n=$(".call-pane__dial-number").val();$(".call-pane__dial-number").val(n+t),$(".call-pane__dial-clear-all").addClass("is-shown"),$(".call-pane__dial-number").focus()}),$(".dialpad_btn_active").on("mousedown touchstart",function(e){e.preventDefault();var t=$(this).val(),a="✱"===t?"*":t;let n=$(this).attr("data-conference-sid"),i=$("#call-pane__dial-number_active_dialpad").val();$("#call-pane__dial-number_active_dialpad").val(i+t),$(".call-pane__dial-clear-all").addClass("is-shown"),$("#call-pane__dial-number_active_dialpad").focus(),PhoneWidgetCall.callRequester.sendDigit(n,a)}),$(window).on("mouseup touchend",function(){void 0!==m&&m.status&&m.stop(),clearInterval(p)}),$(".call_pane_dialpad_clear_number_active_dialpad").on("click",function(e){e.preventDefault(),$("#call-pane__dial-number_active_dialpad").val("")}),$(".call_pane_dialpad_clear_number").on("click",function(e){e.preventDefault(),$("#call-pane__dial-number").val("").attr("readonly",!1).prop("readonly",!1),resetDialNumberData(),$("#call-to-label").text(""),$(".suggested-contacts").removeClass("is_active"),$(".dialpad_btn_init").attr("disabled",!1).removeClass("disabled"),$(".call-pane__correction").attr("disabled",!1)}),$(".call_pane_dialpad_clear_number_disabled").on("click",function(e){e.preventDefault(),$(".call-pane__dial-number").val("").attr("readonly",!0).prop("readonly",!0),$("#call-to-label").text(""),$(".suggested-contacts").removeClass("is_active"),resetDialNumberData()}),$(".call-pane__correction").on("click",function(e){e.preventDefault();var t=$(".call-pane__dial-number").val();$(".call-pane__dial-number").val(t.slice(0,-1)),1===t.length&&$(".suggested-contacts").removeClass("is_active")}),$(".js-edit-mode").on("click",function(e){if(e.preventDefault(),$(this).hasClass("is-editing"))return $(this).removeClass("is-editing"),$(".contact-modal-info").find(".contact-full-info").removeClass("edit-mode"),$(this).find("span").text("Edit"),void $(".contact-modal-info").find(".contact-full-info .form-control").each(function(e,t){$(t).attr("readonly",!0),$(t).attr("disabled",!0)});$(".contact-modal-info").find(".contact-full-info").addClass("edit-mode"),$(this).addClass("is-editing"),$(".contact-modal-info").find(".contact-full-info .form-control").each(function(e,t){$(t).attr("readonly",!1),$(t).attr("disabled",!1)}),$(".is-editing").find("span").text("Save")}),$(".select-contact-type").on("change",function(){$(this).closest(".form-control-wrap").attr("data-type",$(this).val().toLowerCase())}),$(".js-toggle-phone-widget").on("click",function(e){e.preventDefault(),$(".phone-widget").toggleClass("is_active"),$(this).toggleClass("is-mirror")}),$(".phone-widget__close").on("click",function(e){e.preventDefault(),$(".phone-widget").toggleClass("is_active"),$(".js-toggle-phone-widget").toggleClass("is-mirror")}),$(".js-call-tab-trigger").on("click",function(e){e.preventDefault(),$(".widget-modal").hide(),$(".phone-widget__tab").removeClass("is_active"),$("#tab-phone").addClass("is_active"),$("[data-toggle-tab]").removeClass("is_active"),$('[data-toggle-tab="tab-phone"]').addClass("is_active")}),$(document).on("click",".widget-modal__close",function(){$(".widget-modal").hide(),$(".phone-widget__tab").removeClass("ovf-hidden"),$(".collapsible-container").collapse("hide"),$(".subject-option__add").removeClass("added"),$(".additional-subj").remove()});var h=new callsFilter([{project:"ovago",department:"sales",id:1,calls:[{state:"inProgress",length:6001,id:1,contact:{name:"Geff Robertson1",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"hold",length:2201,id:2,contact:{name:"John Doe2",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:3201,id:3,contact:{name:"John Doe6",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"hold",length:6201,id:4,contact:{name:"John Doe7",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]},{project:null,department:"SALES",id:2,calls:[{state:"general",length:5301,id:2,contact:{name:"John Doe4",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"general",length:5301,id:3,contact:{name:"John Doe5",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:5401,id:4,contact:{name:"John Doe8",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:6241,id:1,contact:{name:"Gerrombo Saltison3",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]},{project:"wowfare",department:null,id:2,calls:[{state:"general",length:5301,id:2,contact:{name:"John Doe4",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"general",length:5301,id:3,contact:{name:"John Doe5",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:5401,id:4,contact:{name:"John Doe8",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:6241,id:1,contact:{name:"Gerrombo Saltison3",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]}]);window.historySimpleBar=e}),$(document).on("click",".call-item-menu__close",function(e){e.preventDefault(),$(this).closest(".call-list-item").removeClass("call-list-item--menu")}),$(document).on("click",".call-info-action__more",function(e){e.preventDefault(),$(this).closest(".call-list-item").addClass("call-list-item--menu")}),$(document).on("click",".call-details__nav-btn--more",function(e){e.preventDefault(),$(".conference-call-details").addClass("is_active")}),$(document).on("click",".call-details__nav-btn--back",function(e){e.preventDefault(),$(".conference-call-details").removeClass("is_active")}),function(){window.phoneWidget.audio={Incoming:function(e){this.queues=e,this.audio=new Audio("/js/sounds/incoming_call.mp3"),this.audio.volume=.3,this.audio.loop=!0,this.play=function(){"visible"!==document.visibilityState?this.pause():this.audio.play()},this.pause=function(){this.audio.pause()},this.muted=function(){this.audio.muted=!0,this.indicatorMuted()},this.unMuted=function(){this.audio.muted=!1,this.indicatorUnMuted()},this.isMuted=function(){return!0===this.audio.muted},this.refresh=function(){this.queues.active.count()>0?this.pause():this.queues.direct.count()>0||this.queues.general.count()>0?this.play():this.pause()},this.indicatorMuted=function(){$("#incoming-sound-indicator").attr("data-status",0).html('<i class="fa fa-volume-off text-danger"> </i>').attr("title","Incoming Call - Volume OFF")},this.indicatorUnMuted=function(){$("#incoming-sound-indicator").attr("data-status",1).html('<i class="fa fa-volume-up text-success"> </i>').attr("title","Incoming Call - Volume ON")}}}}();var PhoneWidgetCall=function(){this.connection="";let e=null,t={ajaxCallRedirectGetAgents:"",callStatusUrl:"",ajaxSaveCallUrl:"",clearMissedCallsUrl:""},a=new window.phoneWidget.requesters.CallRequester,n=new window.phoneWidget.queue.Queue,i={wait:n,direct:new window.phoneWidget.queue.Direct(n),hold:new window.phoneWidget.queue.Hold(n),general:new window.phoneWidget.queue.General(n),outgoing:new window.phoneWidget.queue.Queue,active:window.phoneWidget.queue.Active()},l={conference:window.phoneWidget.storage.conference},c={active:PhoneWidgetPaneActive,outgoing:PhoneWidgetPaneOutgoing,incoming:PhoneWidgetPaneIncoming,queue:new PhoneWidgetPaneQueue(i)},o={incoming:new window.phoneWidget.audio.Incoming(i)};function s(){PhoneWidgetContactInfo.hide(),PhoneWidgetDialpad.hide(),function(){let e=i.outgoing.getLast();if(null!==e)return c.outgoing.init(e),!0;return!1}()||function(){let e=i.active.getLast();if(null!==e){let t=l.conference.one(e.data.conferenceSid);return null!==t&&t.getCountParticipants()>2?(c.active.init(e,t),!0):(c.active.init(e),!0)}return!1}()||(r(),$("#tab-phone .call-pane-initial").removeClass("is_active"),$("#tab-phone .call-pane").addClass("is_active"))}function r(){let t=i.direct.count()+i.general.count(),a=i.hold.count(),n=i.active.count()+a;if(t<1&&n<1)return void widgetIcon.update({type:"default",timer:!1,text:null,currentCalls:null,status:1===e.getStatus()});let l="";if(t>0&&n>0)l=t+"+"+n;else if(t>0&&n<1)l=t>1?t:"";else if(t<1&&n>0){if(a<1){let t=i.active.getLast();return null===t?void console.log("Not found last active call"):t.data.isHold?void widgetIcon.update({type:"hold",timer:!0,timerStamp:t.getHoldDuration(),text:"on hold",currentCalls:null,status:1===e.getStatus()}):void widgetIcon.update({type:"inProgress",timer:!0,timerStamp:t.getDuration(),text:"on call",currentCalls:null,status:1===e.getStatus()})}l=1===a?"":n}widgetIcon.update({type:"incoming",timer:!1,text:null,currentCalls:l,status:1===e.getStatus()})}function d(e){console.log("incoming call");let t=n.add(e);return null===t?(console.log("Call is already exist in Wait Queue"),!1):"hold"===t.data.queue?(console.log("hold call"),c.queue.refresh(),E(t),!1):(c.queue.refresh(),c.queue.hide(),E(t),o.incoming.refresh(),r(),void f())}function u(e){console.log("outgoing call");let t=null;if(e.callSid){if(null===(t=i.outgoing.add(e)))return console.log("Call is already exist in Outgoing Queue"),!1}else t=new window.phoneWidget.call.Call(e);c.outgoing.init(t),f(),p()}function m(e){i.active.remove(e),i.outgoing.remove(e),n.remove(e),l.conference.removeByParticipantCallSid(e),o.incoming.refresh(),c.queue.refresh();let t=!1;c.active.getCallSid()===e&&(c.active.removeCallSid(),c.active.removeCallInProgressIndicator(),window.connection="",c.active.isActive()&&(t=!0)),c.outgoing.getCallSid()===e&&(c.outgoing.removeCallSid(),c.outgoing.isActive()&&(t=!0));let a=b(e);(t||a)&&s()}function f(){$(".phone-widget").addClass("is_active"),$(".js-toggle-phone-widget").removeClass("is-mirror")}function p(){$(".phone-widget__tab").removeClass("is_active"),$("[data-toggle-tab]").removeClass("is_active"),$("#tab-phone").addClass("is_active"),$("[data-toggle-tab]").each(function(e){"tab-phone"===$(this).data("toggle-tab")&&$(this).addClass("is_active")})}function h(e){return!("undefined"==typeof device||null==device||device&&"ready"!==device._status)||(createNotify(e,"Please try again after some seconds. Device is not ready.","warning"),!1)}function g(e,t){if(!h("Accept Call"))return!1;if("false"!==t&&window.connection)window.connection.accept(),$("#tab-phone .call-pane-initial").removeClass("is_active"),$("#tab-phone .call-pane-calling").addClass("is_active"),$("#call-controls2").hide();else{let t=n.one(e);if(null===t)return createNotify("Error","Not found call on Wait Queue","error"),!1;if(!t.setAcceptCallRequestState())return!1;a.accept(t)}}function v(e){$('[data-toggle-tab="tab-history"]').attr("data-missed-calls",e)}function _(e){let t=i.active.one(e);return null===t?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!t.setHoldRequestState()&&void a.hold(t)}function R(e){let t=i.active.one(e);return null===t?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!t.setUnHoldRequestState()&&void a.unHold(t)}function E(e){return window.phoneWidget.notifier.add(e.data.callSid,window.phoneWidget.notifier.types.incomingCall,{callSid:e.data.callSid,queue:e.data.queue,name:e.data.contact.name,phone:e.data.contact.phone,project:e.data.project,department:e.data.department,duration:e.data.duration,canCallInfo:e.data.contact.canCallInfo,isInternal:e.data.isInternal,fromInternal:e.data.fromInternal,eventName:e.getEventUpdateName()})}function b(e){return window.phoneWidget.notifier.remove(e)}return{init:function(n){a.init(n),Object.assign(t,n),(e=new widgetStatus(".call-status-switcher",n.updateStatusUrl)).setStatus(n.status),r(),v(n.countMissedCalls),c.active.setup(n.btnHoldShow,n.btnTransferShow),function(){let e=this;$(document).on("click",".queue-separator .list_item_mute",function(e){let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(t);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;if(n.data.isMute){if(!n.setUnMuteRequestState())return!1;a.unMute(n)}else{if(!n.setMuteRequestState())return!1;a.mute(n)}}),$(document).on("click",".call-pane-calling #call-pane__mute",function(t){let n=$(this);if(conferenceBase){let e=$(this).attr("data-call-sid");if(!e)return createNotify("Error","Not found Call SID","error"),!1;let t=i.active.one(e);if(null===t)return createNotify("Error","Not found Call on Active Queue","error"),!1;if(t.data.isMute){if(!t.setUnMuteRequestState())return!1;a.unMute(t)}else{if(!t.setMuteRequestState())return!1;a.mute(t)}}else{let t=e.connection,a=$("#btn-mute-microphone");"false"===n.attr("data-is-muted")?t&&(t.mute(!0),t.isMuted()?(c.active.buttons.mute.mute(),a.html('<i class="fa fa-microphone"></i> Unmute').removeClass("btn-success").addClass("btn-warning")):new PNotify({title:"Mute",type:"error",text:"Error",hide:!0})):t&&(t.mute(!1),t.isMuted()?new PNotify({title:"Unmute",type:"error",text:"Error",hide:!0}):(c.active.buttons.mute.unMute(),a.html('<i class="fa fa-microphone"></i> Mute').removeClass("btn-warning").addClass("btn-success")))}})}(),$(document).on("click",".wg-transfer-call",function(e){e.preventDefault();let a=$(this).attr("data-call-sid");if(!a)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(a);return null===n?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!n.canTransfer()&&void function(e){if(void 0===t.ajaxCallRedirectGetAgents)return alert("Ajax call redirect url is not set"),!1;let a=$("#web-phone-redirect-agents-modal");a.modal("show").find(".modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),$("#web-phone-redirect-agents-modal-label").html("Transfer Call"),$.post(t.ajaxCallRedirectGetAgents,{sid:e}).done(function(e){a.find(".modal-body").html(e)})}(n.data.callSid)}),$(document).on("click","#btn-accept-call",function(){let e=$(this);g(e.attr("data-call-sid"),e.attr("data-from-internal"))}),$(document).on("click",".btn-item-call-queue",function(){let e=$(this),t=$(this).attr("data-type-action");if("accept"===t)return g(e.attr("data-call-sid"),e.attr("data-from-internal")),!1;if("acceptInternal"===t){let t=i.direct.one(e.attr("data-call-sid"));return null===t?(createNotify("Accept Internal Call","Not found Call on Direct Incoming Queue","error"),!1):(acceptInternalCall(t),!1)}return"hangup"===t?(hangup(e.attr("data-call-sid")),!1):"return"===t?(function(e){if(!h("Return Hold Call"))return!1;let t=i.hold.one(e);null===t?createNotify("Error","Not found call on Hold Queue","error"):t.setReturnHoldCallRequestState()&&a.returnHoldCall(t)}(e.attr("data-call-sid")),!1):void console.log("Undefined type action")}),$(document).on("click","#reject-incoming-call",function(e){e.preventDefault(),window.connection&&(window.connection.reject(),$.get(t.ajaxSaveCallUrl+"?sid="+window.connection.parameters.CallSid),$("#call-controls2").hide())}),$(document).on("click","#active_call_add_note_submit",function(e){e.preventDefault();let t=$(this).data("call-sid");if(!t)return createNotify("Warning","Call SID is undefined","warning"),!1;let n=i.active.one(t);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;let l=document.getElementById("active_call_add_note"),c=l.value.trim();return c?!!n.setAddNoteRequestState()&&void a.addNote(n,c,l):(createNotify("Warning","Note value is empty","warning"),!1)}),$(document).on("click","#wg-add-note",function(e){e.preventDefault(),$(".additional-info.add-note").slideDown(200)}),$(document).on("click",".additional-info.add-note .additional-info__close",function(){$(".add-note").slideUp(150)}),$(document).on("click",".call-pane-calling #wg-dialpad",function(){"true"===$(this).attr("data-active")&&$(".dial-popup").slideDown(150)}),$(document).on("click",".dial-popup .additional-info__close",function(){$(".dial-popup").slideUp(150)}),$(document).on("click",".call-pane__info",function(){$(".contact-info").slideDown(150)}),$(document).on("click",".additional-info.contact-info .additional-info__close",function(){$(".contact-info").slideUp(150)}),$(document).on("click","#wg-hold-call",function(e){if(!conferenceBase)return!1;let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let a=i.active.one(t);return null===a?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!a.canHoldUnHold()&&void(a.data.isHold?R(a.data.callSid):_(a.data.callSid))}),$(document).on("click",".list_item_hold",function(e){if(!conferenceBase)return!1;let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let a=i.active.one(t);return null===a?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!a.canHoldUnHold()&&void(a.data.isHold?R(a.data.callSid):_(a.data.callSid))}),$(document).on("click","#cancel-active-call",function(e){hangup($(this).attr("data-call-sid"))}),$(document).on("click","#cancel-outgoing-call",function(e){e.preventDefault();let t=$(this),n=t.attr("data-call-sid");if(!n)return createNotify("Hangup","Please try again after some seconds.","warning"),!1;let l=i.outgoing.one(n);return null===l?(createNotify("Error","Not found Call on Outgoing Queue","error"),!1):!!l.setHangupRequestState()&&void a.hangupOutgoingCall(l)}),$(document).on("click",".btn-history-call-info",function(e){e.preventDefault();let t=$(this).attr("data-call-sid");if(void 0===t)return createNotify("Call Info","Not found Call Sid","error"),!1;a.callLogInfo(t)}),$(document).on("click",".pw-btn-call-info",function(e){e.preventDefault();let t=$(this).attr("data-call-sid");if(void 0===t)return createNotify("Call Info","Not found Call Sid","error"),!1;a.callInfo(t)}),$(document).on("click",".cw-btn-client-info",function(e){e.preventDefault();let t=$(this).attr("data-client-id"),n=$(this).attr("data-is-client");if(void 0===t)return createNotify("Client Info","Not found Client ID","error"),!1;a.clientInfo(t,"true"===n)}),$(document).on("click",".phone-dial-contacts",function(e){e.preventDefault(),function(e){let t=$(e),a=!!t.data("user-id");$(".widget-phone__contact-info-modal").hide(),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active"),insertPhoneNumber({formatted:t.data("phone"),title:a?"":t.data("title"),user_id:t.data("user-id"),phone_to:t.data("phone"),project_id:t.data("project-id"),department_id:t.data("department-id"),client_id:t.data("client-id"),source_type_id:t.data("source-type-id"),lead_id:t.data("lead-id"),case_id:t.data("case-id")})}(this)}),$(document).on("click",".pw-notification-hide",function(e){e.preventDefault();let t=$(this).attr("data-call-sid");b(t)}),$(document).on("click","#incoming-sound-indicator",function(){"1"===$(this).attr("data-status")?o.incoming.muted():o.incoming.unMuted()})},volumeIndicatorsChange:function(e,t){$("#wg-call-microphone .sound-ovf").css("right",-Math.floor(100*e)+"%"),$("#wg-call-volume .sound-ovf").css("right",-Math.floor(100*t)+"%")},updateConnection:function(e){this.connection=e},refreshCallStatus:function(e){"In progress"===e.status?function(e){console.log("active call"),n.remove(e.callSid),i.outgoing.remove(e.callSid),b(e.callSid);let t=i.active.add(e);if(null===t)return o.incoming.refresh(),console.log("Call is already exist in Active Queue"),!1;if(o.incoming.refresh(),c.outgoing.getCallSid()===t.data.callSid&&(c.outgoing.removeCallSid(),c.outgoing.hide()),void 0!==e.conference&&null!==e.conference){l.conference.remove(e.conference.sid);let a=l.conference.add(e.conference);if(null===a)console.log("conference not added");else if(a.getCountParticipants()>2)return c.active.init(t,a),f(),p(),c.queue.refresh(),void c.queue.hide()}c.active.init(t),f(),p(),c.queue.refresh(),c.queue.hide()}(e):"Ringing"===e.status||"Queued"===e.status?2===parseInt(e.typeId)?d(e):1===parseInt(e.typeId)&&u(e):("Completed"===e.status||e.isEnded||5===parseInt(e.cua_status_id))&&m(e.callSid)},panes:c,requestIncomingCall:d,requestOutgoingCall:u,changeStatus:function(t){e.setStatus(t),c.active.isActive()||c.outgoing.isActive()||widgetIcon.update({type:"default",timer:!1,text:null,currentCalls:null,status:1===e.getStatus()})},requestClearMissedCalls:function(){$.ajax({type:"post",data:{},url:t.clearMissedCallsUrl}).done(function(e){v(e.count)}).fail(function(){createNotify("Clear missed calls","Server error","error")})},socket:function(e){"add_missed_call"!==e.command?"update_count_missed_calls"!==e.command?"hold"!==e.command?"unhold"!==e.command?"conferenceUpdate"!==e.command?"addCallToHistory"!==e.command||function(e){if($("#tab-history .simplebar-content .history-tab-today-first-block").length>0)$("#tab-history .simplebar-content .history-tab-today-first-block").prepend(e.call);else{let t='<span class="section-separator">Today</span><ul class="phone-widget__list-item calls-history history-tab-today-first-block">'+e.call+"</ul>";$("#tab-history .simplebar-content").prepend(t),window.historySimpleBar.recalculate()}}(e):function(e){console.log("conference update");let t=null;if(e.conference.participants.forEach(function(e){null===t&&(t=i.active.one(e.callSid))}),null===t)return void console.log("not found call in active queue");let a=l.conference.one(e.conference.sid);if(null!==a){let n=e.conference.participants.length,i=a.getCountParticipants();return i<3&&n<3?(l.conference.remove(e.conference.sid),void(a=l.conference.add(e.conference))):i<3&&n>2?(l.conference.remove(e.conference.sid),a=l.conference.add(e.conference),void c.active.init(t,a)):i>2&&n>2?void l.conference.update(e.conference):i>2&&n<3?(l.conference.remove(e.conference.sid),l.conference.add(e.conference),void c.active.init(t)):void console.log("not found rule for conference update")}(a=l.conference.add(e.conference)).getCountParticipants()>2?c.active.init(t,a):c.active.init(t)}(e):function(e){let t=i.active.one(e);null!==t&&(t.unHold(),c.active.getCallSid()===t.data.callSid&&c.active.isActive()&&(window.phoneWidget.oldWidget.unHold(),r()))}(e.call.sid):function(e){let t=i.active.one(e);null!==t&&(t.hold(),c.active.getCallSid()===t.data.callSid&&c.active.isActive()&&(window.phoneWidget.oldWidget.hold(),r()))}(e.call.sid):v(e.count):function(){let e=$('[data-toggle-tab="tab-history"]').attr("data-missed-calls");e++,$('[data-toggle-tab="tab-history"]').attr("data-missed-calls",e)}()},queues:i,removeIncomingRequest:function(e){let t=n.remove(e);c.queue.refresh(),b(e),o.incoming.refresh(),t&&r()},sendHoldRequest:_,sendUnHoldRequest:R,storage:l,callRequester:a,completeCall:m,updateCurrentCalls:function(t,a){e.setStatus(a),r(),n.reset(),i.outgoing.reset(),i.active.reset(),l.conference.reset(),c.queue.refresh(),s(),window.phoneWidget.notifier.reset(),function(e){if(e.isEmpty)return;let t=!1;e.hold.forEach(function(e){let a=n.add(e);null!==a&&(t=!0,E(a))});let a=null,d=!1;e.incoming.forEach(function(e){let t=n.add(e);null!==t&&(E(t),d=!0,a=t)});let u=!1;e.outgoing.forEach(function(e){i.outgoing.add(e),u=!0});let m=!1;if(e.active.forEach(function(e){i.active.add(e),m=!0}),e.conferences.forEach(function(e){l.conference.add(e)}),f(),c.queue.refresh(),o.incoming.refresh(),t&&!m&&!u&&!d)return f(),c.queue.openAllCalls(),void r();s()}(t)},iconUpdate:r}}();!function(){var e,t,a;$("#call-pane__dial-number").on("keyup",(e=function(){$(".suggested-contacts").removeClass("is_active");let e=$("#contact-list-calls-ajax");if(e.find("input[name=q]").val().length<3)return!1;e.submit()},t=300,a=0,function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,i)},t||0)}));$("#contact-list-calls-ajax").on("beforeSubmit",function(e){e.preventDefault();let t=$(this);return!(t.find("input[name=q]").val().length<3)&&($.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serializeArray(),dataType:"json"}).done(function(e){let t="";e.results.length<1||($.each(e.results,function(e,a){t+=function(e){console.log(e);let t="";3===e.type&&(t='<div class="contact-info-card__status"><i class="far fa-user '+e.user_status_class+' "></i></div>');let a=3===e.type?e.id:"";return'<li class="calls-history__item contact-info-card call-contact-card" data-user-id="'+a+'" data-phone="'+(a?e.title:e.phone)+'" data-title="'+(a?"":e.title)+'"><div class="collapsible-toggler">'+t+'<div class="contact-info-card__details"><div class="contact-info-card__line history-details"><strong class="contact-info-card__name">'+e.name+"</strong></div></div></div></li>"}(a)}),$(".suggested-contacts").html(t).addClass("is_active"),$(".call-pane__dial-clear-all").addClass("is-shown"))}).fail(function(){new PNotify({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})}),!1)}),$(document).on("click","li.call-contact-card",function(){let e=$(this).data("phone"),t=$(this).data("title"),a=$(this).data("user-id");insertPhoneNumber({formatted:e,title:t,user_id:a,phone_to:e}),$(".suggested-contacts").removeClass("is_active")})}();let PhoneWidgetSms=function(){let e="",t="",a={},n={1:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',2:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',3:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',4:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',5:'<span class="pw-msg-item__status pw-msg-item__status--delivered"> <i class="fa fa-check-double"></i> </span>',6:'<span class="pw-msg-item__status pw-msg-item__status--error"> <i class="fa fa-exclamation-circle"></i> </span>',7:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',8:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>'};function i(){return a}function l(e){return void 0===n[e.status]?"":n[e.status]}function c(e){return"web-phone-widget-sms-"+e.id}function o(){let e=$(document).find(".messages-modal__messages-scroll").find($(".simplebar-content-wrapper"))[0];e&&$(e).scrollTop($(e)[0].scrollHeight)}function s(e,t){return"phone-widget-sms-messages-container-"+e.id+"-"+r(e.phone)+"-"+e.type+"-"+r(t.phone)}function r(e){return e.substr(1)}function d(e,t){if(!t)return!1;let a=!1;if(t.find(".messages-modal__msg-list").map(function(){if(e.group===$(this).data("group"))return $(this).append(u(e)),a=!0,!1}),!a){let a='<span class="section-separator">'+e.group+"</span>";a+='<ul class="messages-modal__msg-list" data-group="'+e.group+'">',a+=u(e),a+="</ul>",t.append(a)}}function u(e){let t="";return 1===e.type&&(t=" pw-msg-item--user"),'<li class="messages-modal__msg-item pw-msg-item'+t+'"><div class="pw-msg-item__avatar"><div class="agent-text-avatar"><span>'+e.avatar+'</span></div></div><div class="pw-msg-item__msg-main"><div class="pw-msg-item__data"><span class="pw-msg-item__name">'+e.name+'</span><span class="pw-msg-item__timestamp">'+e.time+'</span><span class="'+c(e)+'">'+l(e)+'</span></div><div class="pw-msg-item__msg-wrap"><p class="pw-msg-item__msg">'+e.text+"</p></div></div></li>"}function m(e,t){let a="."+s(e,t),n=$(document).find(a);return n||!1}return{init:function(n,i,l){e=n,t=i,a=l},getUserPhones:i,showModalSelectNumber:function(e){let t="";$.each(i(),function(a,n){var i;t+='<span class="phone-widget-userPhones btn btn-success" data-contact="'+(i=e,btoa(JSON.stringify(i)))+'" data-user-phone="'+n+'">'+n+"</span>"});let a=$("#modal-df");a.find(".modal-body").html(t),a.find(".modal-title").html("Select your phone number"),a.modal("show")},loadSmses:function(a,n){let i=$(".widget-phone__messages-modal"),l={contactId:a.id,contactPhone:a.phone,contactType:a.type,userPhone:n.phone};$(".phone-widget__tab").addClass("ovf-hidden"),i.html("").show(),i.append('<div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div>'),$.ajax({type:"POST",url:e,data:l,dataType:"json"}).done(function(e){if(i.html(""),!e.success)return i.append(function(e){let t='<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div style="padding: 20px;color:red"><p><strong>Errors:</strong></p>';return $.each(e,function(e,a){$.each(a,function(e,a){t+='<div style="padding: 5px 0 5px 0;">'+a+"</div>"})}),t+="</div>"}(e.errors)),!1;let a=(n=e.contact,l=e.user,'<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div class="modal-messaging__contact-info"><div class="modal-messaging__info-list"><div class="modal-messaging__info-item" style="margin-bottom:0">SMS to <span class="modal-messaging__contact-name">'+n.name+'</span></div><span class="modal-messaging__info-number">'+n.phone+'</span><div class="modal-messaging__info-item" style="margin-bottom:0">From: <span class="modal-messaging__contact-name">'+l.phone+'</span></div></div></div><div class="messages-modal__messages-scroll"><div class="messages-modal__body '+s(e.contact,e.user)+'"></div></div>'+function(e,a){return'<div class="messages-modal__footer"><form id="phone-widget-send-sms-form" action="'+t+'" method="post"><div class="messages-modal__input-group"><input name="text" type="text" class="messages-modal__msg-input" placeholder="Your Message"><input name="contactType" type="hidden" value="'+e.type+'"><input name="contactId" type="hidden" value="'+e.id+'"><input name="contactPhone" type="hidden" value="'+e.phone+'"><input name="userPhone" type="hidden" value="'+a.phone+'"><button class="messages-modal__send-btn"><i class="fa fa-paper-plane"></i></button></div></form></div>'}(e.contact,e.user));var n,l;i.append(a),function(e,t){$.each(e,function(e,a){d(a,t)})}(e.smses,m(e.contact,e.user)),function(){let e=$(document).find(".messages-modal__messages-scroll");new SimpleBar(e[0]),o()}()}).fail(function(e){i.html("");let t="Server Error. Try again later";e.status&&403===e.status&&(t="Access denied"),new PNotify({title:"Get sms",type:"error",text:t,hide:!0})})},addSms:d,decode:function(e){return JSON.parse(atob(e))},sendStart:function(){$(document).find(".messages-modal__msg-input").prop("disabled","disabled"),$(document).find(".messages-modal__send-btn").prop("disabled","disabled").html('<i class="fa fa-spinner fa-spin"></i>')},sendFinish:function(){$(document).find(".messages-modal__msg-input").prop("disabled",!1).val(""),$(document).find(".messages-modal__send-btn").prop("disabled",!1).html('<i class="fa fa-paper-plane"></i>')},getSmsesContainer:m,scrollDown:o,socket:function(e){return"update_status"===e.command?(function(e){let t=$(document).find("."+c(e));t&&t.html(l(e))}(e.sms),!0):"add"===e.command?(d(e.sms,m(e.contact,e.user)),o(),!0):void 0}}}();$(document).on("click",".js-trigger-messages-modal",function(){let e=PhoneWidgetSms.getUserPhones().length;if(e<1)return new PNotify({title:"Get sms messages",type:"error",text:"Not found user phones.",hide:!0}),!1;let t={id:$(this).data("contact-id"),phone:$(this).data("contact-phone"),type:$(this).data("contact-type")};if(e>1)return PhoneWidgetSms.showModalSelectNumber(t),!1;let a={phone:PhoneWidgetSms.getUserPhones()[0]};PhoneWidgetSms.loadSmses(t,a)}),$(document).on("click",".phone-widget-userPhones",function(){$("#modal-df").modal("hide");let e=PhoneWidgetSms.decode($(this).data("contact")),t={phone:$(this).data("user-phone")};PhoneWidgetSms.loadSmses(e,t)}),$(document).on("click",".messages-modal__send-btn",function(e){e.preventDefault();let t=$("#phone-widget-send-sms-form"),a=t.serializeArray();return PhoneWidgetSms.sendStart(),$.ajax({type:t.attr("method"),url:t.attr("action"),data:a,dataType:"json"}).done(function(e){if(PhoneWidgetSms.sendFinish(),!e.success){let t="";return $.each(e.errors,function(e,a){$.each(a,function(e,a){t+=a+"<br>"})}),new PNotify({title:"Send sms",type:"error",text:t,hide:!0}),!1}PhoneWidgetSms.addSms(e.sms,PhoneWidgetSms.getSmsesContainer(e.contact,e.user)),PhoneWidgetSms.scrollDown()}).fail(function(){PhoneWidgetSms.sendFinish(),new PNotify({title:"Send sms",type:"error",text:"Server Error. Try again later",hide:!0})}),!1});let PhoneWidgetContacts=function(){let e="",t="",a="",n=null,i=null,l=!0,c=[];function o(){return a}function s(){return n}function r(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>')}function d(){$($current).find(".wg-history-load").remove()}function u(e,t){return function(e,t){var a="data-selected-contact";$(document).on("change",e,function(){if($(this).is(":checked")){$(".submit-selected-contacts").slideDown(250);var e=$("["+a+'="'+$(this).attr(a)+'"]');$(e).prop("checked",!1),$(this).prop("checked",!0),t.hasOwnProperty("id")&&t.id===parseInt($(this).attr(a))&&(m($(this),a),c.push(t))}else m($(this),a);0===c.length&&$(".submit-selected-contacts").slideUp(150),$(".selection-amount__selected").html(c.length),console.log(c)})}("[data-selected-contact]",e),"1"==window.localStorage.getItem("contactSelectableState")&&e.phones.length>=2?'<li class="actions-list__option actions-list__option--if-selectable"><div class="checkbox"><input type="checkbox" name="checkedContact'+t+'2" id="checkedContact'+t+'2" value="'+e.phones[t]+'" data-selected-contact="'+e.id+'"><label for="checkedContact'+t+'2"></label><label for="checkedContact'+t+'2" data-area-label></label></div></li>':""}function m(e,t){for(var a=0;a<c.length;a++)c[a].id===parseInt($(e).attr(t))&&c.splice(c.indexOf(c[a]),1)}function f(e){let t='<li class="calls-history__item contact-info-card is-collapsible"><div class="collapsible-toggler collapsed" data-toggle="'+function(e){return"1"==window.localStorage.getItem("contactSelectableState")&&e.phones.length<2?"":"collapse"}(e)+'" data-target="#collapse'+e.id+'" aria-expanded="false" aria-controls="collapse'+e.id+'"><div class="contact-info-card__status"><div class="agent-text-avatar"><span>'+e.avatar+'</span></div></div><div class="contact-info-card__details"><div class="contact-info-card__line history-details"><strong class="contact-info-card__name">'+e.name+'</strong></div><div class="contact-info-card__line history-details"><span class="contact-info-card__call-type">'+e.description+"</span></div>"+function(e,t){return"1"==window.localStorage.getItem("contactSelectableState")&&e.phones.length<=1?'<div class="select-contact"><div class="checkbox"><input type="checkbox" name="checkedContact'+e.id+'" id="checkedContact'+e.id+'" value="'+e.phones[0]+'" data-selected-contact="'+e.id+'"><label for="checkedContact'+e.id+'"></label><label for="checkedContact'+e.id+'" data-area-label></label></div></div>':'<a href="#" class="collapsible-arrow"><i class="fas fa-chevron-right"></i></a>'}(e)+'</div></div><div id="collapse'+e.id+'" class="collapse collapsible-container" aria-labelledby="headingOne" data-parent="#contacts-tab"><ul class="contact-options-list"><li class="contact-options-list__option js-toggle-contact-info" data-contact="'+p(e)+'"><i class="fa fa-user"></i>';return e.isInternal&&(t+='<li class="contact-options-list__option dial-to-user contact-dial-to-user" data-contact="'+p(e)+'"> <i class="fa fa-phone"> </i></li>'),t+='</ul><ul class="contact-full-info">',e.phones&&e.phones.forEach(function(a,n){t+=g(a,n,e)}),e.emails&&e.emails.forEach(function(a,n){t+=h(a,n,e)}),t+="</ul></div></li>"}function p(e){return btoa(JSON.stringify(e))}function h(e,t,a){return'<li class="contact-full-info__email"><div class="form-group"><label for="">Email '+(t+1)+'</label><input readonly type="email" class="form-control" value="'+e+'" autocomplete="off"></div><ul class="actions-list"><li class="actions-list__option js-trigger-email-modal" data-contact="'+p(a)+'" data-contact-email="'+e+'"><i class="fa fa-envelope"></i></li></ul></li>'}function g(a,n,i){let l='<li class="contact-full-info__phone"><div class="form-group"><label for="">Phone '+(n+1)+'</label><input readonly type="text" class="form-control" value="'+a+'" autocomplete="off"></div><ul class="actions-list"><li class="actions-list__option actions-list__option--phone js-call-tab-trigger">',c=i.isInternal?i.id:"";return l+='<i class="fa fa-phone phone-dial-contacts" data-user-id="'+c+'" data-phone="'+(c?i.name:a)+'" data-title="'+i.name+'"></i>',l+='</li><li title="'+e+'" class="actions-list__option js-trigger-messages-modal'+t+'" data-contact-id="'+i.id+'" data-contact-phone="'+a+'" data-contact-type="'+i.type+'"><i class="fa fa-comment-alt"></i></li>'+u(i,n)+"</ul></li>"}function v(){$("#list-of-contacts").html('<div style="width:100%;text-align:center;margin-top:20px">No results found</div>')}function _(e){let t="";return $.each(e,function(a,n){if(!a||!n)return;let i='<span class="section-separator">'+a+"</span>";i+='<ul class="phone-widget__list-item calls-history" id="contacts-tab">',$.each(e[a],function(e,t){i+=f(t)}),t+=i+="</ul>"}),t}function R(e){$("#tab-contacts").attr("data-page",e)}return{init:function(n,i,l){e=n,t=i,a=l,window.localStorage.setItem("contactSelectableState",0)},viewContact:function(e){let t='<div class="widget-phone__contact-info-modal widget-modal contact-modal-info"><a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div class="contact-modal-info__user"><div class="agent-text-avatar"><span>'+e.avatar+'</span></div><h3 class="contact-modal-info__name">'+e.name+'</h3></div><div class="contact-modal-info__body"><span class="section-separator">General info</span><ul class="contact-modal-info__contacts contact-full-info"><li><div class="form-group"><label for="">Type</label>',a="person";return e.is_company&&(a="company"),t+='<div class="form-control-wrap" data-type="'+a+'">',t+='<select readonly type="text" class="form-control select-contact-type" autocomplete="off" readonly disabled>',e.is_company?t+='<option value="company" selected="selected">Company</option> <option value="person">Person</option>':t+='<option value="company">Company</option> <option value="person" selected="selected">Person</option>',t+="</select></div></div></li>",e.phones&&e.phones.forEach(function(a,n){t+=g(a,n,e)}),e.emails&&e.emails.forEach(function(a,n){t+=h(a,n,e)}),t+="</ul></div></div>"},decodeContact:function(e){return JSON.parse(atob(e))},delay:function(e,t){var a=0;return function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,i)},t||0)}},requestFullList:function(){r(),$.ajax({type:"post",url:o(),data:{},dataType:"json"}).done(function(e){if(e.results.length<1)return d(),void v();var t;R(e.page),t=e.results,n=t;let a=_(s());d(),$("#list-of-contacts").html("").append(a),i.recalculate()}).fail(function(e){console.log(e),d(),new PNotify({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})})},initLazyLoadFullList:function(e){var t=!1;(i=e).getScrollElement().addEventListener("scroll",function(e){if(l&&e.target.scrollTop+e.target.clientHeight===e.target.scrollHeight&&!t){var a=$("#tab-contacts").attr("data-page");$.ajax({url:o(),type:"post",data:{page:a,uid:userId},dataType:"json",beforeSend:function(){r(),t=!0},success:function(e){var a;R(e.page),(a=e.results)&&$.each(a,function(e,t){e&&t&&(n[e]?$.each(a[e],function(t,a){n[e][n[e].length]=a}):n[e]=t)});let l=_(s());d(),$("#list-of-contacts").html("").append(l),i.recalculate(),e.rows||(t=!1)},complete:function(){d()},error:function(e,t){}})}})},fullListIsEmpty:function(){return!n},loadFullList:function(){if(r(),n){let e=_(n);d(),$("#list-of-contacts").html("").append(e)}else d(),$("#list-of-contacts").html("")},requestSearchList:function(e){r(),$.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serializeArray(),dataType:"json"}).done(function(e){if(e.results.length<1)return d(),void v();let t=_(e.results);d(),$("#list-of-contacts").html("").append(t)}).fail(function(){d(),new PNotify({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})})},setCurrentFullListContainer:function(){return l=!0},setCurrentSearchListContainer:function(){return l=!1}}}();$("#contact-list-ajax").on("beforeSubmit",function(e){e.preventDefault();let t=$(this);return t.find("input[name=q]").val().length<2?(PhoneWidgetContacts.setCurrentFullListContainer(),!1):(PhoneWidgetContacts.setCurrentSearchListContainer(),PhoneWidgetContacts.requestSearchList(t),!1)}),$("#contact-list-ajax-q").on("keyup",PhoneWidgetContacts.delay(function(){let e=$("#contact-list-ajax");if(e.find("input[name=q]").val().length<2)return PhoneWidgetContacts.setCurrentFullListContainer(),PhoneWidgetContacts.loadFullList(),!1;PhoneWidgetContacts.setCurrentSearchListContainer(),e.submit()},300)),$(document).on("click",".js-toggle-contact-info",function(){let e=PhoneWidgetContacts.decodeContact($(this).data("contact")),t=PhoneWidgetContacts.viewContact(e);$(".widget-phone__contact-info-modal").html(t),$(".widget-phone__contact-info-modal").show()}),$(document).on("click",".contact-dial-to-user",function(){let e=PhoneWidgetContacts.decodeContact($(this).data("contact"));insertPhoneNumber({formatted:e.name,title:"",user_id:e.id}),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active")});let PhoneWidgetEmail=function(){let e="",t={};function a(){return t}function n(){$(document).find(".email-modal").find(".wg-history-load").remove()}return{init:function(a,n){e=a,t=n},getUserEmails:a,showModalSelectNumber:function(e,t){let n="";$.each(a(),function(a,i){n+='<span class="phone-widget-userEmails btn btn-success" data-contact-email="'+t+'" data-contact="'+e+'" data-user-email="'+i+'">'+i+"</span>"});let i=$("#modal-df");i.find(".modal-body").html(n),i.find(".modal-title").html("Select your email address"),i.modal("show")},decode:function(e){return JSON.parse(atob(e))},show:function(t,a,n){let i=$(document).find(".email-modal");i.html("");let l='<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a>    <div class="modal-messaging__contact-info">        <div class="modal-messaging__info-list">            <div class="modal-messaging__info-item">Email to <span class="modal-messaging__contact-name">'+t.name+'</span></div>            <span class="modal-messaging__info-number">'+a+'</span>            <div class="modal-messaging__info-item" style="margin-bottom:0">Email From: <span class="modal-messaging__contact-name">'+n.email+'</span></div>        </div>    </div>    <div class="email-modal__messages-scroll">        <div class="email-modal__body"><form id="phone-widget-send-email-form" action="'+e+'" method="post">               <input name="contactType" type="hidden" value="'+t.type+'">               <input name="contactId" type="hidden" value="'+t.id+'">               <input name="contactEmail" type="hidden" value="'+a+'">               <input name="userEmail" type="hidden" value="'+n.email+'">            <div class="email-modal__input-group">                <div class="email-modal__subject-block">                    <div class="email-modal__modal-input-list"> <input type="text" name="subject" class="email-modal__contact-input" placeholder="Subject"> </div>                </div>                <textarea class="email-modal__msg-input" placeholder="Your Message" name="text" cols="30" rows="10"></textarea>            </div>            <button class="email-modal__send-btn"><span>SEND</span><i class="fa fa-paper-plane"></i></button>            </form>        </div>    </div>';i.append(l),i.show(),$(".phone-widget__tab").addClass("ovf-hidden")},send:function(e){let t=e.serializeArray();$(document).find(".email-modal").append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>'),$.ajax({type:e.attr("method"),url:e.attr("action"),data:t,dataType:"json"}).done(function(t){if(n(),!t.success){let e=function(e){let t="";return $.each(e,function(e,a){$.each(a,function(e,a){t+=a+"<br>"})}),t}(t.errors);return new PNotify({title:"Send email",type:"error",text:e,hide:!0}),!1}e.find(".email-modal__contact-input").val(""),e.find(".email-modal__msg-input").val("");let a="Success";t.message&&(a=t.message),new PNotify({title:"Send email",type:"success",text:a,hide:!0})}).fail(function(){n(),new PNotify({title:"Send email",type:"error",text:"Server Error. Try again later",hide:!0})})}}}();$(document).on("click",".js-trigger-email-modal",function(){let e=PhoneWidgetEmail.getUserEmails().length;if(e<1)return new PNotify({title:"Send email",type:"error",text:"Not found user emails.",hide:!0}),!1;if(e>1)return PhoneWidgetEmail.showModalSelectNumber($(this).data("contact"),$(this).data("contact-email")),!1;let t=PhoneWidgetEmail.decode($(this).data("contact")),a=$(this).data("contact-email"),n={email:PhoneWidgetEmail.getUserEmails()[0]};PhoneWidgetEmail.show(t,a,n)}),$(document).on("click",".phone-widget-userEmails",function(){$("#modal-df").modal("hide");let e=PhoneWidgetEmail.decode($(this).data("contact")),t=$(this).data("contact-email"),a={email:$(this).data("user-email")};PhoneWidgetEmail.show(e,t,a)}),$(document).on("click",".email-modal__send-btn",function(e){e.preventDefault();let t=$(document).find("#phone-widget-send-email-form");PhoneWidgetEmail.send(t)});