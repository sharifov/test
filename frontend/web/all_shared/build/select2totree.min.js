!function(e){e.fn.select2ToTree=function(a){var l=e.extend({},a);l.treeData&&function(a,l){function n(e,t){for(var a=e,l=0;l<t.length;l++){var n=t[l];if(!a[n])return"MISSING";a=a[n]}return a}(function s(r,d,o){var p,i;a.labelFld&&a.labelFld.split(".").length>1&&(p=a.labelFld.split(".")),a.valFld&&a.valFld.split(".").length>1&&(i=a.valFld.split("."));for(var u=0;u<r.length;u++){var c=r[u]||{},v=e("<option></option>");p?v.text(n(c,p)):v.text(c[a.labelFld||"text"]),i?v.val(n(c,i)):v.val(c[a.valFld||"id"]),c[a.selFld||"selected"]&&"true"===String(c[a.selFld||"selected"])&&v.prop("selected",c[a.selFld||"selected"]),""===v.val()&&(v.prop("disabled",!0),v.val("autoUniqueVal_"+t++)),v.addClass("l"+d),o&&v.attr("data-pup",o),l.append(v);var f=c[a.incFld||"inc"];f&&f.length>0&&(v.addClass("non-leaf"),s(f,d+1,v.val()))}})(a.dataArr,1,""),a.dftVal&&l.val(a.dftVal)}(l.treeData,this),l._templateResult=l.templateResult,l.templateResult=function(t,a){var n=t.text;"function"==typeof l._templateResult&&(n=l._templateResult(t,a));var s=e("<span class='item-label'></span>").append(n);if(t.element){var r=t.element;if(a.setAttribute("data-val",r.value),r.className&&(a.className+=" "+r.className),r.getAttribute("data-pup")&&a.setAttribute("data-pup",r.getAttribute("data-pup")),e(a).hasClass("non-leaf"))return e.merge(e('<span class="expand-collapse" onmouseup="expColMouseupHandler(event);"></span>'),s)}return s},window.expColMouseupHandler=function(t){var a;a=t.target||t.srcElement,e(a.parentNode).toggleClass("opened"),function t(a){var l=a,n=e(a).parent(".select2-results__options"),s=!0;do{var r=(e(l).attr("data-pup")||"").replace(/'/g,"\\'");if(l=null,r){var d=n.find(".select2-results__option[data-val='"+r+"']");if(d.length>0){if(!d.eq(0).hasClass("opened")){e(a).removeClass("showme"),s=!1;break}l=d[0]}}}while(l);s&&e(a).addClass("showme");var o=(e(a).attr("data-val")||"").replace(/'/g,"\\'");n.find(".select2-results__option[data-pup='"+o+"']").each(function(){t(this)})}(a.parentNode),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1};var n=this.select2(l);function s(t){var a=n.data("select2");e(this).val().trim().length>0?a.$dropdown.addClass("searching-result"):a.$dropdown.removeClass("searching-result")}return n.on("select2:open",function(e){var t=n.data("select2");t.$dropdown.addClass("s2-to-tree"),t.$dropdown.removeClass("searching-result");var a=t.$dropdown.find(".select2-search__field").add(t.$container.find(".select2-search__field"));a.off("input",s),a.on("input",s)}),n};var t=1}(jQuery);