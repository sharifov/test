function toggleClientChatAccess(t){!0===t?($("._cc-box").addClass("is-visible"),$(".fab").addClass("is-visible"),$("#_cc-access-wg").addClass("is-visible")):!1===t?($("._cc-box").removeClass("is-visible"),$(".fab").removeClass("is-visible"),$("#_cc-access-wg").removeClass("is-visible")):($("._cc-box").toggleClass("is-visible"),$(".fab").toggleClass("is-visible"),$("#_cc-access-wg").toggleClass("is-visible")),window.enableTimer()}function checkChatAccessAction(t,e,a,s){$.post(a,{ccuaId:t,accessAction:e},function(t){t.error?(createNotify("Error",t.message,"error"),s()):"function"==typeof refreshClientChatWidget&&t.widgetData&&refreshClientChatWidget(t.widgetData)},"json").fail(function(t){createNotify("Error",t.responseText,"error")})}function refreshClientChatWidget(t){if("object"!=typeof t&&!("data"in t))return console.error("refreshClientChatWidget:: provided param is not object or property data is undefined"),!1;let e=t.data;if(!("command"in e))return console.error("refreshClientChatWidget:: property command is undefined"),!1;switch(e.command){case"accept":window.chat.removeRequest(e.chatId,e.userId,e.chatUserAccessId),"visible"==document.visibilityState&&("chat"===window.name&&"function"==typeof window.refreshChatPage?window.refreshChatPage(e.chatId):window.open(e.url));break;case"skip":case"take":case"deleted":case"accept_transfer":window.chat.removeRequest(e.chatId,e.userId,e.chatUserAccessId);break;case"pending":window.chat.addRequest(e.item);break;case"reset":e.items.length?window.chat.db.addBatch(e.items).then(()=>{window.chat.db.sortData(),window.chat.totalItems=parseInt(e.totalItems)}).then(()=>{window.chat.displayAllRequests(2)}).then(()=>{window.enableTimer(),toggleClientChatAccess(!0)}).then(()=>{console.log(e.widgetEnabled),"undefined"!==e.widgetEnabled&&(e.widgetEnabled?window.chat.widgetEnable():window.chat.widgetDisable())}):window.chat.db.removeAll().then(()=>{window.chat.hasNoRequests()}).then(()=>{console.log(e.widgetEnabled),"undefined"!==e.widgetEnabled&&(e.widgetEnabled?window.chat.widgetEnable():window.chat.widgetDisable())});break;default:console.error("refreshClientChatWidget:: unknown command")}}function refreshDialogToken(t){if("object"!=typeof t&&!("data"in t))return console.error("refreshDialogToken:: provided param is not object or property data is undefined"),!1;let e=t.data;$("#refresh-token-processing").removeClass("active"),$("#manual-refresh-token").removeClass("active"),window.chatAgentToken=e.token,window.initChatDialog({token:e.token})}function openWidget(){$("#_client_chat_access_widget ._cc-box").addClass("is-visible"),$("#_cc-access-wg").addClass("is-visible")}function closeWidget(){$("#_client_chat_access_widget ._cc-box").removeClass("is-visible"),$("#_cc-access-wg").removeClass("is-visible")}function increaseTotalCount(){let t=$("#_cc-access-wg"),e=$("._cc-box-header"),a=parseInt(t.attr("total-items")),s=$("#_circle_wrapper");a<=0&&$("#_client_chat_access_widget ._cc-box-body").html(""),t.attr("total-items",a+1).removeClass("inactive"),$("._cc_total_request_wrapper",t).html(a+1),e.addClass("active"),s.addClass("active")}function decreaseTotalCount(){let t=$("#_cc-access-wg"),e=$("._cc-box-header"),a=$("#_circle_wrapper"),s=parseInt(t.attr("total-items"))-1;t.attr("total-items",s),$("._cc_total_request_wrapper",t).html(s),s<=0&&(t.addClass("inactive"),e.removeClass("active"),a.removeClass("active"),$("#_client_chat_access_widget ._cc-box-body").html("<p>You have no active client conversations requests.</p>"),closeWidget())}!function(t,e){var a=t.ChatApp||{},s=e("#_cc-box-body"),i=e("#_cc-access-wg"),n=e("#_cc-access-icon"),c=e("#_cc_load_requests"),o=e("#_wrap_cc_load_requests"),r=e("._cc-box-header"),d=e("#_circle_wrapper"),h=document.querySelector(".chat-status-switch");function l(t,a,s,l){this.dataLoadUrl=t,this.db=a,this.countAddedItems=0,this.totalItems=0,this.hasNoRequests=function(){i.addClass("inactive"),r.removeClass("active"),d.removeClass("active"),o.removeClass("active"),e("#_client_chat_access_widget ._cc-box-body").html("<p>You have no active client conversations requests.</p>"),this.disableLoadMoreBtn()},this.disableLoadMoreBtn=function(){c.html("All request loaded").prop("disabled",!0).addClass("disabled")},this.refreshLoadMoreBtn=function(){let t="("+(this.totalItems-this.db.data.length)+")";c.html("Load More "+t).prop("disabled",!1).removeClass("disabled")},this.firstRequest=function(t){this.loadData(t).then(()=>{this.displayAllRequests(t+1)}).then(function(){let t=localStorage.getItem("_cc_wg_status"),a=this.db.data.length>0;if("true"===t&&a){toggleClientChatAccess();let t=60;setInterval(function(){e("._cc_request_relative_time").each(function(a,s){let i=+e(s).attr("data-moment")+t;e(s).attr("data-moment",i),e(s).html(moment.duration(-i,"seconds").humanize(!0))})},1e3*t)}}.bind(this)).catch(()=>{this.hasNoRequests()}).finally(()=>{n.removeClass("fa-spinner fa-spin").addClass("fa-comments-o"),i.attr("data-loading",0)})},this.firstRequest(s),this.chatSwitcher=new Switchery(h,{size:"small"}),h.onchange=function(){e.ajax({url:l,type:"post",dataType:"json",data:{chatStatus:h.checked},beforeSend:function(){this.chatSwitcher.disable()}.bind(this),success:function(t){t.error&&createNotify("Error",t.message,"error")}.bind(this),complete:function(){this.chatSwitcher.enable()}.bind(this),error:function(t){createNotify("Error",t.responseText,"error"),this.setSwitchery(!h.checked)}.bind(this)})}.bind(this),this.widgetEnable=function(){this.setSwitchery(!0)},this.widgetDisable=function(){this.setSwitchery(!1)},this.setSwitchery=function(t){(t&&!this.chatSwitcher.isChecked()||!t&&this.chatSwitcher.isChecked())&&this.chatSwitcher.setPosition(!0)}}l.prototype.loadData=function(t){return new Promise(function(a,s){e.ajax({url:this.dataLoadUrl,type:"post",dataType:"json",cache:!1,data:{page:t,countDisplayedRequests:this.db.data.length-this.countAddedItems}}).done(function(t){t.data.length?this.db.addBatch(t.data).then(()=>{this.totalItems=t.totalItems}).then(()=>{a()}):s()}.bind(this)).fail(function(t){createNotify("Error",t.responseText,"error")})}.bind(this))},l.prototype.displayAllRequests=function(t){t&&c.attr("data-page",t),this.db.data.length&&(s.html(""),this.db.data.forEach(t=>{s.append(t.html)}),this.numberItems(),i.attr("total-items",this.db.data.length).removeClass("inactive"),e("._cc_total_request_wrapper",i).html(this.totalItems),r.addClass("active"),d.addClass("active"),o.addClass("active"),this.updateRequestsRelativeTime(),this.refreshLoadMoreBtn()),this.totalItems==this.db.data.length&&this.disableLoadMoreBtn()},l.prototype.numberItems=function(){e("._cc-box-item-wrapper",s).each(function(t,a){e(a).find("._cc_access_item_num").html("#"+(t+1))})},l.prototype.displayOneRequest=function(t){this.db.data.length&&(s.html(""),this.db.data.forEach(t=>{s.append(t.html)}),this.numberItems(),i.attr("total-items",this.db.data.length).removeClass("inactive"),e("._cc_total_request_wrapper",i).html(this.totalItems),r.addClass("active"),d.addClass("active"),o.addClass("active"),this.updateRequestsRelativeTime(),this.refreshLoadMoreBtn()),this.totalItems==this.db.data.length&&this.disableLoadMoreBtn()},l.prototype.updateRequestsRelativeTime=function(){e("._cc_request_relative_time").each(function(t,a){e(a).html(moment.duration(-e(a).data("moment"),"seconds").humanize(!0))})},l.prototype.removeRequest=function(t,a,s){this.db.deleteByRequestId(s).then(()=>{this.totalItems=parseInt(this.totalItems)-1,e("#ccr_"+t+"_"+a).remove(),e("._cc_total_request_wrapper",i).html(this.totalItems),this.numberItems(),this.totalItems!=this.db.data.length&&this.refreshLoadMoreBtn()}).then(()=>{!this.db.data.length&&this.totalItems<=0?this.hasNoRequests():!this.db.data.length&&this.totalItems&&this.firstRequest(1)})},l.prototype.addRequest=function(e){this.db.data.length||s.html(""),this.db.add(e).then(()=>{this.db.sortData(),this.totalItems=parseInt(this.totalItems)+1}).then(()=>{this.displayOneRequest(e)}).then(()=>{t.enableTimer(),this.updateRequestsRelativeTime(),openWidget(),this.countAddedItems+=1})},a.Chat=l,t.ChatApp=a}(window,$),function(t){var e=t.ChatApp||{},a=t.Promise;function s(){this.initData=function(){this.data=[],this.data.keySort=function(t){var e=function(t,e){var a,s=0;for(a in t)if(t.hasOwnProperty(a)){if(s==e)return a;s++}return!1},a=function(t,e,a){return a=null!==a?a:1,t==e?0:t>e?1*a:-1*a},s=function(t){var e,a=0;for(e in t)t.hasOwnProperty(e)&&a++;return a}(t=t||{});if(!s)return this.sort(a);for(var i in t)t[i]="desc"==t[i]||-1==t[i]?-1:"skip"==t[i]||0===t[i]?0:1;return this.sort(function(i,n){for(var c=0,o=0;0===c&&o<s;){var r=e(t,o);if(r){var d=t[r];c=a(i[r],n[r],d),o++}}return c}),this}}.bind(this),this.existInData=function(t,e){if(this.data.length>0)for(i in this.data)if(this.data[i][t]===e)return!0;return!1}.bind(this),this.getKeyByProperty=function(t,e){if(e&&this.data.length>0)for(i in this.data)if(this.data[i][t]==e)return i},this.defaultSort={ccc_priority:"desc",cch_updated_t:"asc"},this.initData()}s.prototype.add=function(t){return new a(function(e,a){this.existInData("ccua_id",t.ccua_id)||this.data.push(t),e()}.bind(this))},s.prototype.addBatch=function(t){return new a(function(e,a){t&&t.forEach(function(t){this.existInData("ccua_id",t.ccua_id)||this.data.push(t)}.bind(this)),e()}.bind(this))},s.prototype.get=function(t){return new a(function(e,a){e(this.data[t])}.bind(this))},s.prototype.getAll=function(){return this.data},s.prototype.sortData=function(){return new a(function(t,e){this.data.keySort(this.defaultSort),t()}.bind(this))},s.prototype.remove=function(t){return new a(function(e,a){delete this.data[t],e()}.bind(this))},s.prototype.removeAll=function(){return new a(function(t,e){this.initData(),t()}.bind(this))},s.prototype.deleteByRequestId=function(t){return new a(function(e,a){let s=this.getKeyByProperty("ccua_id",t);s>=0&&(this.data.splice(s,1),e())}.bind(this))},e.DataStore=s,t.ChatApp=e}(window),$(document).on("click","#_cc-access-wg",function(){var t=$(this).data("loading");new Promise((e,a)=>{toggleClientChatAccess(!t&&null),e()}).then(()=>{localStorage.setItem("_cc_wg_status",$("._cc-box").hasClass("is-visible"))})}),$(document).on("click","._cc-access-action",function(t){t.preventDefault();let e=$(this),a=e.attr("data-ajax-url"),s=e.attr("data-check-access-url"),i=e.attr("data-ccua-id"),n=e.attr("data-access-action"),c=e.closest("._cc-box-item-wrapper").attr("id"),o=e.closest("._cc-action").find("._cc-access-action"),r=e.html();$.ajax({url:a,type:"post",data:{ccuaId:i,accessAction:n},cache:!1,dataType:"json",beforeSend:function(){$(o).prop("disabled","true").addClass("disabled"),e.html('<i class="fa fa-spin fa-spinner"></i>')},success:function(t){t.success?setTimeout(function(){$("#"+c).length&&checkChatAccessAction(i,n,s,function(){o.each(function(t,e){$(e).removeClass("disabled").removeAttr("disabled")}),e.html(r)})},1500):(createNotify(t.notifyTitle,t.notifyMessage,t.notifyType),o.each(function(t,e){$(e).removeClass("disabled").removeAttr("disabled")}),e.html(r))},error:function(t){createNotify("Error",t.responseText,"error"),o.each(function(t,e){$(e).removeClass("disabled").removeAttr("disabled")}),e.html(r)}})});