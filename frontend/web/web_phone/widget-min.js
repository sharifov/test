window.phoneWidget={},window.phoneWidget.storage={},function(){window.phoneWidget.eventDispatcher=new class{constructor(){this.events={}}addListener(t,e){return"function"!=typeof e?(console.error(`The listener callback must be a function, the given type is ${typeof e}`),!1):"string"!=typeof t?(console.error(`The event name must be a string, the given type is ${typeof t}`),!1):(void 0===this.events[t]&&(this.events[t]={listeners:[]}),void this.events[t].listeners.push(e))}removeListener(t,e){if(void 0===this.events[t])return console.error(`This event: ${t} does not exist`),!1;this.events[t].listeners=this.events[t].listeners.filter(t=>t.toString()!==e.toString())}dispatch(t,e){if(void 0===this.events[t])return console.error(`This event: ${t} does not exist`),!1;this.events[t].listeners.forEach(t=>{t(e)})}}}(),window.phoneWidget.events={callUpdate:"callUpdate",conferenceUpdate:"conferenceUpdate"},function(){window.phoneWidget.call={Call:function t(e){this.data=e,this.canTransfer=function(){return conferenceBase?3!==this.data.typeId&&"In progress"===this.data.status&&!this.data.isInternal:"In progress"===this.data.status},this.block=function(){this.data.blocked=!0},this.unBlock=function(){this.data.blocked=!1},this.isBlocked=function(){return!0===this.data.blocked},this.canHoldUnHold=function(){return 3!==this.data.typeId&&"In progress"===this.data.status&&(!this.data.isInternal||this.data.isInternal&&this.data.isConferenceCreator)},this.setHoldRequestState=function(){return!(this.isBlocked()||!this.canHoldUnHold()||(this.data.isHold?(createNotify("Error","Call is already Hold.","error"),1):(this.data.sentHoldUnHoldRequest=!0,this.block(),this.save(),0)))},this.setUnHoldRequestState=function(){return!(this.isBlocked()||!this.canHoldUnHold()||(this.data.isHold?(this.data.sentHoldUnHoldRequest=!0,this.block(),this.save(),0):(createNotify("Error","Call is already UnHold.","error"),1)))},this.unSetHoldUnHoldRequestState=function(){this.data.sentHoldUnHoldRequest=!1,this.unBlock(),this.save()},this.isSentHoldUnHoldRequestState=function(){return!0===this.data.sentHoldUnHoldRequest},this.hold=function(){this.unBlock(),this.data.sentHoldUnHoldRequest=!1,this.data.holdStartTime=Date.now(),this.data.isHold=!0,this.save()},this.unHold=function(){this.unBlock(),this.data.sentHoldUnHoldRequest=!1,this.data.holdStartTime=0,this.data.isHold=!1,this.save()},this.setMuteRequestState=function(){return!this.isBlocked()&&(this.data.isMute?(createNotify("Error","Call is already Mute.","error"),!1):(this.data.sentMuteUnMuteRequest=!0,this.block(),this.save(),!0))},this.setUnMuteRequestState=function(){return!this.isBlocked()&&(this.data.isMute?(this.data.sentMuteUnMuteRequest=!0,this.block(),this.save(),!0):(createNotify("Error","Call is already UnMute.","error"),!1))},this.unSetMuteUnMuteRequestState=function(){this.data.sentMuteUnMuteRequest=!1,this.unBlock(),this.save()},this.isSentMuteUnMuteRequestState=function(){return!0===this.data.sentMuteUnMuteRequest},this.mute=function(){this.unBlock(),this.data.sentMuteUnMuteRequest=!1,this.data.isMute=!0,this.save()},this.unMute=function(){this.unBlock(),this.data.sentMuteUnMuteRequest=!1,this.data.isMute=!1,this.save()},this.setHangupRequestState=function(){return!this.isBlocked()&&(this.data.sentHangupRequest=!0,this.block(),this.save(),!0)},this.unSetHangupRequestState=function(){this.data.sentHangupRequest=!1,this.unBlock(),this.save()},this.isSentHangupRequestState=function(){return!0===this.data.sentHangupRequest},this.setReturnHoldCallRequestState=function(){return!this.isBlocked()&&("Hold"!==this.data.status?(createNotify("Error","Call is not in status Hold.","error"),!1):(this.data.sentReturnHoldCallRequest=!0,this.block(),this.save(),!0))},this.unSetReturnHoldCallRequestState=function(){this.data.sentReturnHoldCallRequest=!1,this.unBlock(),this.save()},this.isSentReturnHoldCallRequestState=function(){return!0===this.data.sentReturnHoldCallRequest},this.setAcceptCallRequestState=function(){return!this.isBlocked()&&(this.data.sentAcceptCallRequest=!0,this.block(),this.save(),!0)},this.unSetAcceptCallRequestState=function(){this.data.sentAcceptCallRequest=!1,this.unBlock(),this.save()},this.isSentAcceptCallRequestState=function(){return!0===this.data.sentAcceptCallRequest},this.setAddNoteRequestState=function(){return this.isBlocked()?(createNotify("Error","Call is blocked. Please wait some seconds.","error"),!1):(this.data.sentAddNoteRequest=!0,this.block(),this.save(),!0)},this.unSetAddNoteRequestState=function(){this.data.sentAddNoteRequest=!1,this.unBlock(),this.save()},this.isSentAddNoteRequestState=function(){return!0===this.data.sentAddNoteRequest},this.setRejectInternalRequest=function(){return this.isBlocked()?(createNotify("Error","Call is blocked. Please wait some seconds.","error"),!1):(this.data.sentRejectInternalRequest=!0,this.block(),this.save(),!0)},this.unSetRejectInternalRequest=function(){this.data.sentRejectInternalRequest=!1,this.unBlock(),this.save()},this.isSentRejectInternalRequest=function(){return!0===this.data.sentRejectInternalRequest},this.getDuration=function(){let t=this.data.duration||0;return this.data.timeQueuePushed?Math.floor((Date.now()-parseInt(this.data.timeQueuePushed))/1e3)+parseInt(t):t},this.getHoldDuration=function(){let t=0;return this.data.holdStartTime&&(t=Math.floor((Date.now()-parseInt(this.data.holdStartTime))/1e3)),t},this.clone=function(){return new t(this.data)},this.save=function(){window.phoneWidget.eventDispatcher.dispatch(this.getEventUpdateName(),{call:this})},this.getEventUpdateName=function(){return window.phoneWidget.events.callUpdate+this.data.callSid}}}}(),function(){function t(e){this.data=e,this.getDuration=function(){let t=this.data.duration||0;return this.data.timeStoragePushed?Math.floor((Date.now()-parseInt(this.data.timeStoragePushed))/1e3)+parseInt(t):t},this.clone=function(){return new t(this.data)}}window.phoneWidget.conference={Conference:function e(a){this.data=a,this.getCountParticipants=function(){return this.data.participants.length},this.getParticipants=function(){let e=[],a=this.data.timeStoragePushed;return this.data.participants.forEach(function(n){n.timeStoragePushed=a,e.push(new t(n))}),e},this.getDuration=function(){let t=this.data.duration||0;return this.data.timeStoragePushed?Math.floor((Date.now()-parseInt(this.data.timeStoragePushed))/1e3)+parseInt(t):t},this.clone=function(){return new e(this.data)},this.getEventUpdateName=function(){return window.phoneWidget.events.conferenceUpdate+this.data.sid},this.save=function(){window.phoneWidget.eventDispatcher.dispatch(this.getEventUpdateName(),{conference:this})}}}}(),function(){window.phoneWidget.requesters={CallRequester:function(){this.settings={holdUrl:"",unHoldUrl:"",acceptCallUrl:"",muteUrl:"",unMuteUrl:"",returnHoldCallUrl:"",ajaxHangupUrl:"",callAddNoteUrl:"",sendDigitUrl:"",prepareCurrentCallsUrl:"",callLogInfoUrl:"",callInfoUrl:"",clientInfoUrl:""},this.init=function(t){Object.assign(this.settings,t)},this.hold=function(t){let e=$(".btn-hold-call");e.html('<i class="fa fa-spinner fa-spin"> </i> <span>On Hold</span>'),e.prop("disabled",!0),$.ajax({type:"post",data:{sid:t.data.callSid},url:this.settings.holdUrl}).done(function(a){a.error&&(createNotify("Hold",a.message,"error"),e.html('<i class="fa fa-pause"> </i> <span>Hold</span>'),e.prop("disabled",!1),t.unSetHoldUnHoldRequestState())}).fail(function(){createNotify("Hold","Server error","error"),e.html('<i class="fa fa-pause"> </i> <span>Hold</span>'),e.prop("disabled",!1),t.unSetHoldUnHoldRequestState()})},this.unHold=function(t){let e=$(".btn-hold-call");e.html('<i class="fa fa-spinner fa-spin"> </i> <span>Resume</span>'),e.prop("disabled",!0),$.ajax({type:"post",data:{sid:t.data.callSid},url:this.settings.unHoldUrl}).done(function(a){a.error&&(createNotify("Resume",a.message,"error"),e.html('<i class="fa fa-play"> </i> <span>Resume</span>'),e.prop("disabled",!1),t.unSetHoldUnHoldRequestState())}).fail(function(){createNotify("Resume","Server error","error"),e.html('<i class="fa fa-play"> </i> <span>Resume</span>'),e.prop("disabled",!1),t.unSetHoldUnHoldRequestState()})},this.accept=function(t){window.phoneWidget.notifier.off(t.data.callSid),PhoneWidgetCall.audio.incoming.off(t.data.callSid),$.ajax({type:"post",url:this.settings.acceptCallUrl,dataType:"json",data:{act:"accept",call_sid:t.data.callSid}}).done(function(e){e.error&&(createNotify("Accept Call",e.message,"error"),t.unSetAcceptCallRequestState(),window.phoneWidget.notifier.on(t.data.callSid),PhoneWidgetCall.audio.incoming.on(t.data.callSid))}).fail(function(){createNotify("Accept Call","Server error","error"),t.unSetAcceptCallRequestState(),window.phoneWidget.notifier.on(t.data.callSid),PhoneWidgetCall.audio.incoming.on(t.data.callSid)})},this.mute=function(t){$.ajax({type:"post",data:{sid:t.data.callSid},url:this.settings.muteUrl}).done(function(e){e.error&&(createNotify("Mute",e.message,"error"),t.unSetMuteUnMuteRequestState())}).fail(function(){createNotify("Mute","Server error","error"),t.unSetMuteUnMuteRequestState()})},this.unMute=function(t){$.ajax({type:"post",data:{sid:t.data.callSid},url:this.settings.unMuteUrl}).done(function(e){e.error&&(createNotify("UnMute",e.message,"error"),t.unSetMuteUnMuteRequestState())}).fail(function(){createNotify("UnMute","Server error","error"),t.unSetMuteUnMuteRequestState()})},this.returnHoldCall=function(t){window.phoneWidget.notifier.off(t.data.callSid),PhoneWidgetCall.audio.incoming.off(t.data.callSid),$.ajax({type:"post",url:this.settings.returnHoldCallUrl,dataType:"json",data:{call_sid:t.data.callSid}}).done(function(e){e.error&&(createNotify("Return Hold Call",e.message,"error"),t.unSetReturnHoldCallRequestState(),window.phoneWidget.notifier.on(t.data.callSid),PhoneWidgetCall.audio.incoming.on(t.data.callSid))}).fail(function(){createNotify("Return Hold Call","Server error","error"),t.unSetReturnHoldCallRequestState(),window.phoneWidget.notifier.on(t.data.callSid),PhoneWidgetCall.audio.incoming.on(t.data.callSid)})},this.hangupOutgoingCall=function(t){$.ajax({type:"post",data:{sid:t.data.callSid},url:this.settings.ajaxHangupUrl}).done(function(e){e.error&&(createNotify("Hangup",e.message,"error"),t.unSetHangupRequestState())}).fail(function(){createNotify("Hangup","Server error","error"),t.unSetHangupRequestState()})},this.addNote=function(t,e,a){$.ajax({type:"post",data:{note:e,callSid:t.data.callSid},url:this.settings.callAddNoteUrl,dataType:"json"}).done(function(e){e.error?createNotify("Add Note",e.message,"error"):(createNotify("Add Note",e.message,"success"),a.value=""),t.unSetAddNoteRequestState()}).fail(function(){createNotify("Add Note","Server error","error"),t.unSetAddNoteRequestState()})},this.sendDigit=function(t,e){$.ajax({type:"post",data:{conference_sid:t,digit:e},url:this.settings.sendDigitUrl,dataType:"json"}).done(function(t){t.error&&createNotify("Send digit",t.message,"error")}).fail(function(){createNotify("Send digit","Server error","error")})},this.acceptInternalCall=function(t,e){$.ajax({type:"post",data:{},url:this.settings.prepareCurrentCallsUrl,dataType:"json"}).done(function(a){a.error?(createNotify("Prepare current call",a.message,"error"),t.unSetAcceptCallRequestState()):e.accept()}).fail(function(){createNotify("Prepare current call","Server error","error"),t.unSetAcceptCallRequestState()})},this.callLogInfo=function(t){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>'),$("#call-box-modal-label").html("Call Info"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{sid:t},url:this.settings.callLogInfoUrl}).done(function(t){$("#call-box-modal .modal-body").html(t)}).fail(function(t,e,a){createNotify("Call info",t.responseText,"error")})},this.callInfo=function(t){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>'),$("#call-box-modal-label").html("Call Info"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{sid:t},url:this.settings.callInfoUrl}).done(function(t){$("#call-box-modal .modal-body").html(t)}).fail(function(t,e,a){createNotify("Call info",t.responseText,"error")})},this.clientInfo=function(t,e){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>');let a=e?"Client details":"Contact info";$("#call-box-modal-label").html(a+" ("+t+")"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{client_id:t},url:this.settings.clientInfoUrl}).done(function(t){$("#call-box-modal .modal-body").html(t)}).fail(function(t,e,n){createNotify(a,t.responseText,"error")})}}}}(),function(){window.phoneWidget.oldWidget=new function(){this.hold=function(){let t=$(".btn-hold-call");t.html('<i class="fa fa-play"> </i> <span>Resume</span>'),t.attr("data-mode","hold"),t.prop("disabled",!1)},this.unHold=function(){let t=$(".btn-hold-call");t.html('<i class="fa fa-pause"> </i> <span>Hold</span>'),t.attr("data-mode","unhold"),t.prop("disabled",!1)}}}();class PhoneWidgetTimer extends React.Component{constructor(t){super(t),this.state={duration:0,timeStart:0}}componentDidMount(){this.startTimer()}componentDidUpdate(t){this.state.timeStart!==this.props.timeStart&&this.startTimer()}componentWillUnmount(){clearInterval(this.timer)}startTimer(){clearInterval(this.timer),this.setState({duration:this.props.duration,timeStart:this.props.timeStart}),this.timer=setInterval(()=>this.setState({duration:this.state.duration+1}),1e3)}formatDuration(t){let e="",a=Math.floor(t/60/60),n=Math.floor(t/60)-60*a,i=t%60;return a>0&&(e=a.toString().padStart(2,"0")+":"),e+=n.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")}render(){return this.props.styleClass&&this.state.duration>3599?React.createElement("span",{className:this.props.styleClass},this.formatDuration(this.state.duration)):this.formatDuration(this.state.duration)}}class CallActionTimer extends React.Component{constructor(t){super(t),this.state={duration:0,timeStart:0}}componentDidMount(){this.startTimer()}componentDidUpdate(t){this.state.timeStart!==this.props.timeStart&&this.startTimer()}componentWillUnmount(){clearInterval(this.timer)}startTimer(){clearInterval(this.timer),this.setState({duration:this.props.duration,timeStart:this.props.timeStart}),this.timer=setInterval(()=>this.setState({duration:this.state.duration+1}),1e3)}formatDuration(t){let e="",a=Math.floor(t/60/60),n=Math.floor(t/60)-60*a,i=t%60;return a>0&&(e=a.toString().padStart(2,"0")+":"),e+=n.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")}render(){return React.createElement(React.Fragment,null,React.createElement("span",{className:"call-in-action__time"},this.formatDuration(this.state.duration)))}}class ActivePane extends React.Component{constructor(t){super(t),this.state={call:t.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let t=this;return function(e){t.setState({call:e.call})}}render(){let t=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:t.data.project,source:t.data.source}),React.createElement(ActiveContactInfo,{call:t}),React.createElement("div",{className:"actions-container"},React.createElement(CallBtns,{call:t}),React.createElement(SoundIndication,null)),React.createElement(ActivePaneControls,{call:t,controls:this.props.controls}))}}function ActiveContactInfo(t){let e=t.call;return React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},3!==e.data.typeId?React.createElement("span",{className:"contact-info-card__label"},e.data.type):"",React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info"},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,e.data.contact.name))),React.createElement("div",{className:"contact-info-card__line history-details"},3!==e.data.typeId?React.createElement("span",{className:"contact-info-card__call-type"},e.data.contact.phone):"")))}function CallBtns(t){let e=t.call,a="call-pane__call-btns";return e.data.isHold?a+=" is-on-hold":a+=" is-on-call",React.createElement("div",{className:a},React.createElement("button",{className:"call-pane__mute",id:"call-pane__mute",disabled:e.data.isListen||e.data.isHold||e.isSentMuteUnMuteRequestState(),"data-call-sid":e.data.callSid,"data-is-muted":e.data.isMute,"data-active":!(e.data.isListen||e.data.isHold)},e.isSentMuteUnMuteRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):e.data.isMute?React.createElement("i",{className:"fas fa-microphone-alt-slash"}," "):React.createElement("i",{className:"fas fa-microphone"}," ")),e.data.isHold?React.createElement(CallingStateBlockHold,{call:e}):React.createElement(CallingStateBlock,{call:e}),React.createElement("button",{className:"call-pane__end-call",id:"cancel-active-call","data-call-sid":e.data.callSid,disabled:e.isSentHangupRequestState()},e.isSentHangupRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))}function CallingStateBlock(t){let e=t.call;return React.createElement("button",{className:e.data.isListen||e.data.isCoach?"call-pane__start-call calling-state-block join":"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},e.data.isListen||e.data.isCoach?React.createElement("i",{className:"fa fa-headphones-alt"}," "):"",React.createElement("span",{className:"call-in-action__text"},e.data.isCoach?"Coaching":e.data.isListen?"Listening":e.data.isBarge?"Barge":"on call"),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:e.getDuration(),timeStart:Date.now(),styleClass:"more"}))))}function CallingStateBlockHold(t){let e=t.call;return React.createElement("button",{className:"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},React.createElement("span",{className:"call-in-action__text"},"on hold"),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:e.getHoldDuration(),timeStart:Date.now(),styleClass:"more"}))))}function SoundIndication(){return React.createElement("div",{className:"sound-indication"},React.createElement("div",{className:"sound-control-wrap",id:"wg-call-volume"},React.createElement("i",{className:"fa fa-volume-down"}," "),React.createElement("div",{className:"sound-controls"},React.createElement("div",{className:"progres-wrap"},React.createElement("div",{className:"sound-progress"}," "),React.createElement("div",{className:"sound-ovf",style:{right:"-100%"}}," ")))),React.createElement("div",{className:"sound-control-wrap",id:"wg-call-microphone"},React.createElement("i",{className:"fa fa-microphone"}," "),React.createElement("div",{className:"sound-controls"},React.createElement("div",{className:"progres-wrap"},React.createElement("div",{className:"sound-progress"}," "),React.createElement("div",{className:"sound-ovf",style:{right:"-30%"}}," ")))))}class IncomingPane extends React.Component{constructor(t){super(t),this.state={call:t.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let t=this;return function(e){t.setState({call:e.call})}}render(){let t=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:t.data.project,source:t.data.source}),React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__label"},t.data.type),React.createElement("div",{className:"credential"},React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info"},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,t.data.contact.name)),React.createElement("div",{className:"contact-info-card__phone"},React.createElement("span",null," ")))),React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__call-type"},t.data.contact.phone)))),React.createElement(IncomingActions,{call:t}))}}function IncomingActions(t){let e=t.call;return e.data.isInternal?React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns"},React.createElement("button",{className:"call-pane__end-call end-internal",id:"hide-incoming-call","data-call-sid":e.data.callSid},React.createElement("i",{className:"fa fa-angle-double-right"}," ")),React.createElement("button",{className:"call-pane__start-call calling-state-block","data-call-sid":e.data.callSid,onClick:()=>acceptInternalCall(e)},e.isSentAcceptCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call","data-call-sid":e.data.callSid,onClick:()=>rejectInternalCall(e)},e.isSentRejectInternalRequest()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))):React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns"},React.createElement("button",{className:"call-pane__start-call calling-state-block",id:"btn-accept-call","data-from-internal":e.data.fromInternal,"data-call-sid":e.data.callSid,disabled:e.isSentAcceptCallRequestState()},e.isSentAcceptCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call",id:"hide-incoming-call","data-call-sid":e.data.callSid},React.createElement("i",{className:"fa fa-angle-double-right"}," "))))}function ActivePaneControls(t){return React.createElement("ul",{className:"in-call-controls"},t.controls.hold.show?React.createElement(ButtonHold,{call:t.call,controls:t.controls}):"",t.controls.transfer.show?React.createElement(ButtonTransfer,{call:t.call,controls:t.controls}):"",React.createElement(ButtonAddPerson,{call:t.call,controls:t.controls}),React.createElement(ButtonDialpad,{call:t.call,controls:t.controls}),React.createElement(ButtonAddNote,{call:t.call,controls:t.controls}))}function ButtonHold(t){return React.createElement("li",{className:"in-call-controls__item","data-mode":t.call.data.isHold?"hold":"unhold",id:"wg-hold-call","data-call-sid":t.call.data.callSid,"data-active":t.controls.hold.active},React.createElement("a",{href:"#",className:"in-call-controls__action"},t.call.isSentHoldUnHoldRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin hold-loader"}," "):t.call.data.isHold?React.createElement("i",{className:"fa fa-play"}," "):React.createElement("i",{className:"fa fa-pause"}," "),React.createElement("span",null,t.call.data.isHold?"Resume":"On Hold")))}function ButtonTransfer(t){return React.createElement("li",{className:"in-call-controls__item wg-transfer-call","data-call-sid":t.call.data.callSid,"data-active":t.controls.transfer.active},React.createElement("a",{href:"#",className:"in-call-controls__action"},React.createElement("i",{className:"fa fa-random"}," "),React.createElement("span",null,"Transfer")))}function ButtonAddPerson(t){return React.createElement("li",{className:"in-call-controls__item",id:"wg-add-person","data-active":t.controls.addPerson.active},React.createElement("a",{href:"#",className:"in-call-controls__action js-add-to-conference","data-toggle-tab":"tab-contacts"},React.createElement("i",{className:"fa fa-plus"}," "),React.createElement("span",null,"Add Person")))}function ButtonDialpad(t){return React.createElement("li",{className:"in-call-controls__item",id:"wg-dialpad","data-active":t.controls.dialpad.active},React.createElement("a",{href:"#",className:"in-call-controls__action js-toggle-dial"},React.createElement("i",{className:"fa fa-th"}," "),React.createElement("span",null,"Dialpad")))}function ButtonAddNote(t){return React.createElement("li",{className:"in-call-controls__item",id:"wg-add-note"},React.createElement("a",{href:"#",className:"in-call-controls__action"},React.createElement("i",{className:"fa fa-newspaper-o"}," "),React.createElement("span",null,"Add Note")))}function CallInfo(t){return React.createElement("div",{className:"calling-from-info"},React.createElement("div",{className:"static-number-indicator"},t.project?React.createElement("span",{className:"static-number-indicator__label"},t.project):"",t.project&&t.source?React.createElement("i",{className:"static-number-indicator__separator"}," "):"",t.source?React.createElement("span",{className:"static-number-indicator__name"},t.source):""))}class ListItem extends React.Component{constructor(t){super(t),this.state={call:t.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let t=this;return function(e){t.setState({call:e.call})}}render(){let t=this.state.call;return React.createElement("li",{className:"call-in-progress__list-item"},React.createElement("div",{className:"call-in-progress__call-item call-list-item","data-call-status":t.data.queue},React.createElement("div",{className:"call-list-item__info"},React.createElement("ul",{className:"call-list-item__info-list call-info-list"},React.createElement("li",{className:"call-info-list__item"},React.createElement("b",{className:"call-info-list__contact-icon"},React.createElement("i",{className:"fa fa-user"}," ")),React.createElement("span",{className:"call-info-list__name"},t.data.contact.name)),t.data.contact.company?React.createElement("li",{className:"call-info-list__item"},React.createElement("span",{className:"call-info-list__company"},t.data.contact.company)):"",2===t.data.typeId||1===t.data.typeId||4===t.data.typeId?React.createElement("li",{className:"call-info-list__item"},React.createElement("span",{className:"call-info-list__number"},t.data.contact.phone)," "):""),React.createElement("div",{className:"call-list-item__info-action call-info-action"},React.createElement("span",{className:"call-info-action__timer"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now()})),"inProgress"===t.data.queue&&3!==t.data.typeId||3===t.data.typeId&&!t.data.isListen&&!t.data.isHold?React.createElement("a",{href:"#",className:"call-info-action__more"},React.createElement("i",{className:"fa fa-ellipsis-h"}," ")):""),React.createElement(ListItemMenu,{call:t})),React.createElement("div",{className:"call-list-item__main-action"},React.createElement("a",{href:"#",className:"call-list-item__main-action-trigger btn-item-call-queue","data-type-action":"inProgress"===t.data.queue?"hangup":"hold"===t.data.queue?"return":t.data.isInternal?"acceptInternal":"accept","data-call-sid":t.data.callSid,"data-from-internal":t.data.fromInternal},t.isSentAcceptCallRequestState()||t.isSentHangupRequestState()||t.isSentReturnHoldCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"phone-icon phone-icon--start fa fa-phone"})," ",React.createElement("i",{className:"phone-icon phone-icon--end fa fa-phone-slash"})," ")))))}}function ListItemMenu(t){let e=t.call;return"inProgress"!==e.data.queue?null:3===e.data.typeId?React.createElement(ListItemMenuJoinCall,{call:e}):e.data.isInternal?e.data.isConferenceCreator?React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(React.Fragment,null,React.createElement(ListItemBtnHold,{call:e}),React.createElement(ListItemBtnMute,{call:e}))):React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnMute,{call:e})):React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnTransfer,{call:e}),conferenceBase?React.createElement(React.Fragment,null,React.createElement(ListItemBtnHold,{call:e}),React.createElement(ListItemBtnMute,{call:e})):"")}function ListItemBtnTransfer(t){return React.createElement("li",{className:"call-item-menu__list-item wg-transfer-call","data-call-sid":t.call.data.callSid},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},React.createElement("i",{className:"fa fa-random"}," ")))}function ListItemBtnHold(t){let e=t.call;return React.createElement("li",{className:"call-item-menu__list-item list_item_hold","data-mode":e.data.isHold?"hold":"unhold","data-call-sid":e.data.callSid},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},e.isSentHoldUnHoldRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):e.data.isHold?React.createElement("i",{className:"fa fa-play"}," "):React.createElement("i",{className:"fa fa-pause"}," ")))}function ListItemBtnMute(t){let e=t.call;return e.data.isHold?null:React.createElement("li",{className:"call-item-menu__list-item list_item_mute","data-call-sid":e.data.callSid,"data-is-muted":e.data.isMute},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},e.isSentMuteUnMuteRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):e.data.isMute?React.createElement("i",{className:"fas fa-microphone-alt-slash"}," "):React.createElement("i",{className:"fas fa-microphone"}," ")))}function ListItemMenuJoinCall(t){let e=t.call;return e.data.isListen?null:React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnMute,{call:e}))}function Groups(t){const e=[];let a=Object.assign({},t);void 0!==a.groups.external&&(e.push(React.createElement(GroupItem,{key:"external",group:{calls:a.groups.external.calls,project:"",department:"External Contacts"}})),delete a.groups.external);void 0!==a.groups.internal&&(e.push(React.createElement(GroupItem,{key:"internal",group:{calls:a.groups.internal.calls,project:"",department:"Internal Contacts"}})),delete a.groups.internal);for(let t in a.groups)"inArray"!==t&&e.push(React.createElement(GroupItem,{key:t,group:a.groups[t]}));return React.createElement("ul",{className:"calls-separator"},e)}function GroupItem(t){return React.createElement("li",{className:"calls-separator__list-item"},React.createElement("div",{className:"static-number-indicator"},t.group.project?React.createElement("span",{className:"static-number-indicator__label"},t.group.project):"",t.group.project&&t.group.department?React.createElement("i",{className:"static-number-indicator__separator"}," "):"",t.group.department?React.createElement("span",{className:"static-number-indicator__name"},t.group.department):""),React.createElement("ul",{className:"call-in-progress"},t.group.calls.map(t=>React.createElement(ListItem,{key:t.data.callSid,call:t}))))}function AllQueues(t){return React.createElement(React.Fragment,null,countProperties(t.active)>0?React.createElement(QueueItem,{groups:t.active,name:"Active Calls",type:"active"}):"",countProperties(t.direct)>0?React.createElement(QueueItem,{groups:t.direct,name:"Direct Line",type:"direct"}):"",countProperties(t.general)>0?React.createElement(QueueItem,{groups:t.general,name:"General Line",type:"general"}):"")}function QueueItem(t){return React.createElement("li",{className:"queue-separator__item","data-queue-type":t.type},t.name?React.createElement("div",{className:"queue-separator__name"},t.name):"",React.createElement(Groups,{groups:t.groups}))}function countProperties(t){let e=0;for(let a in t)t.hasOwnProperty(a)&&++e;return e}class OutgoingPane extends React.Component{constructor(t){super(t),this.state={call:t.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let t=this;return function(e){t.setState({call:e.call})}}render(){let t=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:t.data.project,source:t.data.source}),React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__label"},t.data.type),React.createElement("div",{className:"credential"},React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info"},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,t.data.contact.name)),React.createElement("div",{className:"contact-info-card__phone"},React.createElement("span",null," ")))),React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__call-type"},t.data.contact.phone)))),React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns is-pending"},React.createElement("button",{className:"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},React.createElement("span",{className:"call-in-action__text"},t.data.status),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now()}))),React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call",id:"cancel-outgoing-call","data-call-sid":t.data.callSid,disabled:t.isSentHangupRequestState()},t.isSentHangupRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))))}}function ContactInfo(t){return React.createElement(React.Fragment,null,React.createElement("div",{className:"additional-info__header"},React.createElement("div",{className:"agent-text-avatar"},React.createElement("span",null,t.avatar)),React.createElement(ContactInfoHeader,t),React.createElement("a",{href:"#",className:"additional-info__close"},React.createElement("i",{className:"fas fa-times"}," "))),React.createElement("div",{className:"additional-info__body scrollable-block"},React.createElement("ul",{className:"info-listing incoming-info"},React.createElement("li",null,React.createElement("small",{className:"incoming-info__label"},"Name"),React.createElement("span",{className:"incoming-info__value"},t.name)))))}function ContactInfoHeader(t){return t.canContactDetails||t.canCallInfo?React.createElement(React.Fragment,null,t.canContactDetails&&t.id?React.createElement("a",{href:"#","data-client-id":t.id,"data-is-client":t.isClient,className:"cw-call-contact-info cw-btn-client-info"},React.createElement("span",{className:"additional-info__header-title"},t.isClient?"Client details":"Contact info")):React.createElement("span",{className:"additional-info__header-title"},t.isClient?"Client details":"Contact info"),t.canCallInfo?React.createElement(React.Fragment,null,"  /  ",React.createElement("a",{href:"#","data-call-sid":t.callSid,className:"cw-call-contact-info pw-btn-call-info"},React.createElement("span",{className:"additional-info__header-title"},"Call info"))," "):""):React.createElement("span",{className:"additional-info__header-title"},t.isClient?"Client details":"Contact info")}class ConferencePane extends React.Component{constructor(t){super(t),this.state={call:t.call,conference:t.conference}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler()),window.phoneWidget.eventDispatcher.addListener(this.state.conference.getEventUpdateName(),this.conferenceUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler()),window.phoneWidget.eventDispatcher.removeListener(this.state.conference.getEventUpdateName(),this.conferenceUpdateHandler())}callUpdateHandler(){let t=this;return function(e){t.setState({call:e.call})}}conferenceUpdateHandler(){let t=this;return function(e){t.setState({conference:e.conference})}}render(){let t=this.state.call,e=this.state.conference,a=e.getCountParticipants();return React.createElement(React.Fragment,null,React.createElement("div",{className:"call-details"},React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__participants"},React.createElement("i",{className:"call-details__participants-len"},a)," Participants")),React.createElement("div",{className:"call-details__col"},React.createElement("a",{href:"#",className:"call-details__nav-btn call-details__nav-btn--more"},"Details"))),React.createElement(CallInfo,{project:t.data.project,source:t.data.source}),React.createElement(ParticipantShortList,{conference:e}),React.createElement("div",{className:"actions-container"},React.createElement(CallBtns,{call:t}),React.createElement(SoundIndication,null)),React.createElement(ActivePaneControls,{call:t,controls:this.props.controls}),React.createElement("div",{className:"conference-call-details"},React.createElement("div",{className:"call-details"},React.createElement("div",{className:"call-details__col"},React.createElement("a",{href:"#",className:"call-details__nav-btn call-details__nav-btn--back"},"Back")),React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__participants"},React.createElement("i",{className:"fa fa-users"}," ")," ",a)),React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__time"},React.createElement(PhoneWidgetTimer,{duration:e.getDuration(),timeStart:Date.now()})))),React.createElement(CallInfo,{project:t.data.project,source:t.data.source}),React.createElement(ParticipantList,{conference:e})))}}function ParticipantList(t){let e=t.conference,a=[];for(let t of e.getParticipants())a.push(React.createElement(ParticipantItem,{key:t.data.callSid,participant:t}));return React.createElement("ul",{className:"conference-call__detailed participant-list scrollable-block"},a)}function ParticipantItem(t){let e=t.participant,a="participant-list__item participant";return"coaching"===e.data.type&&(a+=" participant-list__item--coach"),React.createElement("li",{className:a},React.createElement("div",{className:"participant__avatar"},React.createElement("span",null,e.data.avatar)),React.createElement("div",{className:"participant__info"},React.createElement("span",{className:"participant__name"},e.data.name),React.createElement("span",{className:"participant__phone"},e.data.phone),"coaching"===e.data.type?React.createElement("span",{className:"participant__status"},React.createElement("i",{className:"fa fa-headphones-alt"}," ")," coaching"):""),React.createElement("div",{className:"participant__action"},React.createElement("b",{className:"participant__timer"},React.createElement(PhoneWidgetTimer,{duration:e.getDuration(),timeStart:Date.now()}))))}function ParticipantShortList(t){let e=t.conference,a=[],n=e.getCountParticipants();if(n>10){let t=0;for(let n of e.getParticipants())if(a.push(React.createElement(ParticipantShortItem,{key:n.data.callSid,participant:n})),9===++t)break}else for(let t of e.getParticipants())a.push(React.createElement(ParticipantShortItem,{key:t.data.callSid,participant:t}));return React.createElement("div",{className:"conference-call"},React.createElement("ul",{className:"conference-call__list"},a,n>10?React.createElement("li",null,React.createElement("div",{className:"conference-call__collapsed"},React.createElement("span",{className:"conference-call__name"},"and ",React.createElement("i",null,n-9)," more..."))):""))}function ParticipantShortItem(t){let e=t.participant,a="conference-call__thumbnail";return"coaching"===e.data.type&&(a+=" conference-call__thumbnail--coaching"),React.createElement("li",null,React.createElement("div",{className:a},React.createElement("div",{className:"conference-call__avatar"},e.data.avatar),React.createElement("span",{className:"conference-call__name"},e.data.name),"coaching"===e.data.type?React.createElement("i",{className:"conference-call__icon"},React.createElement("i",{className:"fa fa-headphones-alt"}," ")):""))}class AddNote extends React.Component{constructor(t){super(t),this.state={call:t.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let t=this;return function(e){t.setState({call:e.call})}}render(){let t=this.state.call;return React.createElement(React.Fragment,null,React.createElement("div",{className:"additional-info__header"},React.createElement("span",{className:"additional-info__header-title"},"Add Note"),React.createElement("a",{href:"#",className:"additional-info__close"},React.createElement("i",{className:"fas fa-times"}," "))),React.createElement("div",{className:"additional-info__body scrollable-block add-note-block"},React.createElement("textarea",{id:"active_call_add_note",cols:"30",rows:"10",placeholder:"Enter Note...",disabled:t.isSentAddNoteRequestState(),defaultValue:""}),React.createElement("button",{id:"active_call_add_note_submit","data-call-sid":t.data.callSid,disabled:t.isSentAddNoteRequestState()},t.isSentAddNoteRequestState()?React.createElement(React.Fragment,null,React.createElement("i",{className:"fa fa-spinner fa-spin"}," ")," Save"):"Save")))}}class DesktopNotification extends React.Component{constructor(t){super(t)}render(){let t=this.props.notifications.map(t=>React.createElement(NotificationItem,{key:t.key,notification:t,source:"desktop"}));return React.createElement("div",{className:"phone-notifications"},React.createElement("ul",{className:"phone-notifications__list"},t))}}class PhoneWidgetNotification extends React.Component{constructor(t){super(t)}render(){let t="phone-notifications";return this.props.notification.isDeleted||this.props.notification.isNew||this.props.notification.willHide||(t+=" phone-notifications--shown"),"general"===this.props.notification.queue?t+=" phone-notifications--general-calls":"direct"===this.props.notification.queue?t+=" phone-notifications--direct-calls":"active"!==this.props.notification.queue&&"hold"!==this.props.notification.queue||(t+=" phone-notifications--active-calls"),React.createElement("div",{className:t},React.createElement("ul",{className:"phone-notifications__list"},React.createElement(NotificationItem,{key:this.props.notification.key,notification:this.props.notification,source:"phone"})))}}function NotificationItem(t){return t.notification.type===window.phoneWidget.notifier.types.incomingCall?React.createElement(IncomingCallNotificationItem,{notification:t.notification,source:t.source}):null}class IncomingCallNotificationItem extends React.Component{constructor(t){super(t),this.state={notification:t.notification}}componentDidMount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.desktopUpdateHandler())}componentWillUnmount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.desktopUpdateHandler())}phoneUpdateHandler(){let t=this;return function(e){let a=e.call,n=t.state.notification;n.isSentAcceptCallRequestState=a.isSentAcceptCallRequestState(),n.isSentReturnHoldCallRequestState=a.isSentReturnHoldCallRequestState(),t.setState({notification:n})}}desktopUpdateHandler(){let t=this;return function(e){let a=e.call,n=t.state.notification;n.isSentAcceptCallRequestState=a.isSentAcceptCallRequestState(),n.isSentReturnHoldCallRequestState=a.isSentReturnHoldCallRequestState(),t.setState({notification:n})}}render(){let t=this.state.notification,e=t.duration||0;t.timePushed&&(e=Math.floor((Date.now()-parseInt(t.timePushed))/1e3)+parseInt(e));let a="";return t.project&&t.department?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("b",{className:"incoming-notification__project-name"},t.project),React.createElement("i",null,"•"),React.createElement("span",{className:"incoming-notification__position"},t.department)):t.project?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("b",{className:"incoming-notification__project-name"},t.project)):t.department?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("span",{className:"incoming-notification__position"},t.department)):t.isInternal&&(a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("span",{className:"incoming-notification__position"},"Internal"))),React.createElement("li",{className:t.isDeleted||t.isNew||t.willHide?"phone-notifications__item":"phone-notifications__item phone-notifications__item--shown"},React.createElement("div",{className:"incoming-notification"},React.createElement("i",{className:"user-icn"},t.name[0]),React.createElement("div",{className:"incoming-notification__inner"},React.createElement("div",{className:"incoming-notification__info"},React.createElement("div",{className:"incoming-notification__general-info"},React.createElement("b",{className:"incoming-notification__name"},t.name),React.createElement("span",{className:"incoming-notification__phone"},t.phone),a),React.createElement("div",{className:"incoming-notification__timer"},React.createElement("span",null,React.createElement(PhoneWidgetTimer,{duration:e,timeStart:Date.now()})))),React.createElement("div",{className:"incoming-notification__action-list"},React.createElement("div",{className:"incoming-notification__dynamic"},React.createElement("a",{href:"#",className:"incoming-notification__action incoming-notification__action--phone btn-item-call-queue","data-type-action":"hold"===t.queue?"return":t.isInternal?"acceptInternal":"accept","data-call-sid":t.callSid,"data-from-internal":t.fromInternal},t.isSentAcceptCallRequestState||t.isSentReturnHoldCallRequestState?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone"}," "))),"phone"===this.props.source?React.createElement("a",{href:"#","data-call-sid":t.key,className:"incoming-notification__action incoming-notification__action--min pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-alt-down"}," ")):React.createElement("a",{href:"#","data-call-sid":t.key,className:"incoming-notification__action incoming-notification__action--max pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-down"}," "))))))}}var PhoneWidgetContactInfo=function(){let t=$("#contact-info"),e=document.getElementById("contact-info");return{load:function(t){t.avatar=t.name.charAt(0),t.avatar.toUpperCase(),ReactDOM.render(React.createElement(ContactInfo,t),e)},hide:function(){t.hide()}}}(),PhoneWidgetDialpad=function(){let t=$(".dial-popup");return{hide:function(){t.hide()}}}();class PhoneWidgetPaneActiveBtn{constructor(t,e){this.pane=t,this.btn=null,this.id=e}init(){return this.btn=this.pane.find(this.id),this}show(){return this.btn.show(),this}hide(){return this.btn.hide(),this}enable(){return this.btn.attr("data-disabled",!1),this}disable(){return this.btn.attr("data-disabled",!0),this}active(){return this.btn.attr("data-active",!0),this}isActive(){return"true"===this.btn.attr("data-active")}inactive(){return this.btn.attr("data-active",!1),this}}class PhoneWidgetPaneActiveBtnHold extends PhoneWidgetPaneActiveBtn{constructor(t){super(t,"#wg-hold-call")}sendRequest(){this.disable();let t="Resume";return"unhold"===this.btn.attr("data-mode")&&(t="On Hold"),this.btn.children().html('<i class="fa fa-spinner fa-spin"> </i><span>'+t+"</span>"),this}unhold(){return this.btn.attr("data-mode","unhold"),this.btn.children().html('<i class="fa fa-pause"> </i><span>On Hold</span>'),this}hold(){return this.btn.attr("data-mode","hold"),this.btn.children().html('<i class="fa fa-play"> </i><span>Resume</span>'),this}}class PhoneWidgetPaneActiveBtnMute extends PhoneWidgetPaneActiveBtn{constructor(t){super(t,"#call-pane__mute")}sendRequest(){return this.disable(),this.btn.attr("data-is-muted",null),this.btn.html('<i class="fa fa-spinner fa-spin"> </i>'),this}mute(){return this.enable(),this.btn.attr("data-is-muted",!0),this.btn.html('<i class="fas fa-microphone-alt-slash"> </i>'),this}isMute(){return"true"===this.btn.attr("data-is-muted")}unMute(){return this.enable(),this.btn.attr("data-is-muted",!1),this.btn.html('<i class="fas fa-microphone"> </i>'),this}disable(){return this.btn.attr("disabled",!0),this}enable(){return this.btn.attr("disabled",!1),this}}var PhoneWidgetPaneActive=function(){let t=null;let e=$("#call-pane-calling"),a=document.getElementById("call-pane-calling"),n=document.getElementById("add-note"),i=PhoneWidgetContactInfo,l=PhoneWidgetDialpad,c={hold:new PhoneWidgetPaneActiveBtnHold(e),mute:new PhoneWidgetPaneActiveBtnMute(e)},o=!0,s=!0;function r(l,o){var s;null!=o?(e.addClass("call-pane-calling--conference"),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(ConferencePane,{call:l,controls:d(l),conference:o}),a)):(e.removeClass("call-pane-calling--conference"),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(ActivePane,{call:l,controls:d(l)}),a)),ReactDOM.unmountComponentAtNode(n),ReactDOM.render(React.createElement(AddNote,{call:l}),n),$(".dialpad_btn_active").attr("data-conference-sid",l.data.conferenceSid),$("#call-pane__dial-number_active_dialpad").val(""),i.load(l.data.contact),s=l.data.callSid,t=s,c.hold.init(),c.mute.init()}function d(t){let e={hold:{active:!0,show:o},transfer:{active:!0,show:s},addPerson:{active:!1},dialpad:{active:!0}};return 3===t.data.typeId&&(e.hold.active=!1,e.transfer.active=!1,e.addPerson.active=!1,e.dialpad.active=!1),t.data.isInternal&&(e.hold.active=!!t.data.isConferenceCreator,e.transfer.active=!1,e.addPerson.active=!1,e.dialpad.active=!1),conferenceBase||(e.hold.active=!1,e.transfer.active=!0,e.addPerson.active=!1,e.dialpad.active=!1),e}function u(){i.hide(),l.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),e.addClass("is_active"),$('[data-toggle-tab="tab-phone"]').attr("data-call-in-progress",!0)}function m(){$('[data-toggle-tab="tab-phone"]').attr("data-call-in-progress",!1)}return{setup:function(t,e){o=t,s=e},buttons:c,init:function(t,e){r(t,e),u(),PhoneWidgetCall.iconUpdate()},load:r,show:u,hide:function(){e.removeClass("is_active"),m()},isEqual:function(e){return t===e},removeCallSid:function(){t=null},isActive:function(){return e.hasClass("is_active")},removeCallInProgressIndicator:m}}(),PhoneWidgetPaneIncoming=function(){let t=null;let e=$("#call-pane-incoming"),a=document.getElementById("call-pane-incoming"),n=PhoneWidgetContactInfo,i=PhoneWidgetDialpad;function l(e){var i;n.load(e.data.contact),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(IncomingPane,{call:e}),a),i=e.data.callSid,t=i}function c(){n.hide(),i.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),e.addClass("is_active")}function o(t,e){let a="";e?a=t+"+"+e:t>1&&(a=t),widgetIcon.update({type:"incoming",timer:!1,text:null,currentCalls:a,status:"online"})}return{init:function(t,e,a){l(t),c(),o(e,a)},load:l,show:c,hide:function(){ReactDOM.unmountComponentAtNode(a),e.removeClass("is_active")},isEqual:function(e){return t===e},removeCallSid:function(){t=null},isActive:function(){return e.hasClass("is_active")},initWidgetIcon:o}}(),PhoneWidgetPaneOutgoing=function(){let t=null;let e=$("#call-pane-outgoing"),a=document.getElementById("call-pane-outgoing"),n=PhoneWidgetContactInfo,i=PhoneWidgetDialpad;function l(e){var i;n.load(e.data.contact),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(OutgoingPane,{call:e}),a),i=e.data.callSid,t=i}function c(){n.hide(),i.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),e.addClass("is_active")}return{init:function(t){l(t),c(),widgetIcon.update({type:"outgoing",timer:!0,timerStamp:t.getDuration(),text:t.data.status,currentCalls:null,status:"online"})},load:l,show:c,hide:function(){ReactDOM.unmountComponentAtNode(a),e.removeClass("is_active")},isEqual:function(e){return t===e},removeCallSid:function(){t=null},isActive:function(){return e.hasClass("is_active")}}}();function PhoneWidgetPaneQueue(t){let e=t,a=this,n=".call-filter__toggle",i=null;function l(){let t=Object.assign({},e.active.all()),a=Object.assign({},e.hold.all());for(let e in a)void 0===t[e]?t[e]=a[e]:a[e].calls.forEach(function(a){t[e].calls.push(a)});return t}function c(){ReactDOM.render(React.createElement(QueueItem,{groups:l(),type:"active",name:""}),document.getElementById("queue-separator")),i="active"}function o(){ReactDOM.render(React.createElement(QueueItem,{groups:e.direct.all(),type:"direct",name:""}),document.getElementById("queue-separator")),i="direct"}function s(){ReactDOM.render(React.createElement(QueueItem,{groups:e.general.all(),type:"general",name:""}),document.getElementById("queue-separator")),i="general"}function r(){ReactDOM.render(React.createElement(AllQueues,{active:l(),direct:e.direct.all(),general:e.general.all()}),document.getElementById("queue-separator")),i="all"}function d(t){var e=$(".widget-line-overlay__queue-marker");switch(e.removeClass("tab-active"),e.removeClass("tab-direct"),e.removeClass("tab-general"),e.removeClass("tab-all"),$(t).attr("data-call-filter")){case"active":$("[data-queue-marker]").html("Active Calls"),e.addClass("tab-active");break;case"direct":$("[data-queue-marker]").html("Direct Line"),e.addClass("tab-direct");break;case"general":$("[data-queue-marker]").html("General Line"),e.addClass("tab-general");break;case"all":$("[data-queue-marker]").html("Calls Queue")}}$(document).on("click",n,function(t){switch(t.preventDefault(),$(this).attr("data-call-filter")){case"active":c();break;case"direct":o();break;case"general":s()}$(n).removeClass("is-checked"),$(this).addClass("is-checked"),d($(this)),a.show(),$("[data-toggle-tab]").removeClass("is_active")}),$(document).on("click",".widget-line-overlay__show-all-queues",function(t){t.preventDefault(),$(n).addClass("is-checked"),d($(this)),r()}),this.openAllCalls=function(){let t=$(".widget-line-overlay__show-all-queues");$(n).addClass("is-checked"),d(t),$("[data-toggle-tab]").removeClass("is_active"),r(),a.show()},this.refresh=function(){$(".call-filter__toggle--line-active").html(e.hold.count()+e.active.count()),$(".call-filter__toggle--line-direct").html(e.direct.count()),$(".call-filter__toggle--line-general").html(e.general.count()),"active"===i?c():"direct"===i?o():"general"===i?s():"all"===i&&r()},this.show=function(){$(".widget-line-overlay").show()},this.hide=function(){$(".widget-line-overlay").hide(),$(n).removeClass("is-checked")}}function stateTimer(){var t=null;return{start:function(e,a){var n=Math.floor(a%60),i=Math.floor((a-n)/60),l=Math.floor((a-i)/60);t=setInterval(function(){n=Math.floor(a%60),i=Math.floor((a-n)/60%60),l=Math.floor(a/3600),86399===a&&(a=0),parseInt(n)<10&&(n="0"+n),parseInt(i)<10&&(i="0"+i),parseInt(l)<10&&(l="0"+l),a++,$(e).html(l+":"+i+":"+n)},1e3)},clear:function(){clearInterval(t)}}}function formatPhoneNumber(t){let e=(""+t).replace(/\D/g,"").match(/^(1|)?(\d{3})(\d{3})(\d{4})$/);return e?[e[1]?"+1 ":"","(",e[2],") ",e[3],"-",e[4]].join(""):t}function toSelect(t,e,a){var n=$(t);optionClass="dropdown-item";var i="optionselected";function l(t,e){let a='<div class="dropdown">'+t+'<div class="dropdown-menu" >'+function(t){let e=[];return t.length>1&&t.forEach(function(t){e.push('<button class="dropdown-item" type="button" value="'+t.value+'" data-info-project="'+t.project+'" data-info-project-id="'+t.projectId+'"><small class="current-number__phone">'+formatPhoneNumber(t.value)+'</small><span class="current-number__identifier">'+t.project+"</span></button>")}),e}(e).join("")+"</div>";return a+="</div>"}return this.data={value:e.selected.value,project:e.selected.project,projectId:e.selected.projectId},this.primaryData={value:e.primary&&e.primary.value||null,project:e.primary&&e.primary.project||null,projectId:e.primary&&e.primary.projectId||null},this.getData=function(){return this.data},this.setData=function(){return function(t){this.data.value=t.value,this.data.project=t.project,this.data.projectId=t.projectId}.bind(this)},this.setPrimaryData=function(){return function(t){console.log(t),this.primaryData.value=t.value,this.primaryData.project=t.project,this.primaryData.projectId=t.projectId}.bind(this)},this.getPrimaryData=function(){return this.primaryData},this.clearPrimaryData=function(){return function(){return this.primaryData.value=null,this.primaryData.project=null,this.primaryData.projectId=null,this}.bind(this)},function(t){let e=t.options.length;n.append(l(function(t,e,a,n,i){let l="";return i>1&&(l='<i class="fa fa-chevron-down"></i>'),'<button value="'+t+'" data-info-project="'+e+'" data-info-project-id="'+n+'" class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><small class="current-number__phone current-number__selected-nr">'+formatPhoneNumber(t)+'</small><span class="current-number__identifier current-number__selected-project">'+e+"</span>"+l+"</button>"}(t.selected.value,t.selected.project,t.selected.id,t.selected.projectId,e),t.options))}(e),$(n).on(i,$(".dropdown-toggle"),function(t){var e=t.target,i=n.find(".current-number__selected-nr"),l=n.find(".current-number__selected-project");$(e).find(".dropdown-toggle").val(this.data.value),i.text(this.data.value),l.text(this.data.project),"function"==typeof a&&a.call(this)}.bind(this)),$(n).on("click",".dropdown-item",function(){!function(t){this.data.value=t.val(),this.data.project=t.attr("data-info-project"),this.data.projectId=t.attr("data-info-project-id"),$(n).trigger(i)}($(this))}),{getData:this.getData(),setData:this.setData(),setPrimaryData:this.setPrimaryData(),getPrimaryData:this.getPrimaryData(),clearPrimaryData:this.clearPrimaryData()}}function handleWidgetIcon(){var t,e=$(".phone-widget-icon"),a=".widget-icon-inner",n="animate",i=null;function l(t){$(a).removeClass(n);var e,l,c,o,s,r=".widget-icon-inner",d=".phone-widget-icon__time";t.timer&&$(d).html(null),clearInterval(i),$(r).attr("data-wi-status",t.status),$(r).attr("data-wi-type",t.type),$(".phone-widget-icon__ongoing").html(t.currentCalls),$(".phone-widget-icon__text").html(t.text),t.timer?(e=d,l=t.timerStamp,c=Math.floor(l%60),o=Math.floor((l-c)/60),s=Math.floor((l-o)/60),i=setInterval(function(){c=Math.floor(l%60),o=Math.floor((l-c)/60%60),s=Math.floor(l/3600),86399===l&&(l=0),parseInt(c)<10&&(c="0"+c),parseInt(o)<10&&(o="0"+o),parseInt(s)<10&&(s="0"+s),l++,$(e).html(s+":"+o+":"+c)},1e3)):$(d).html(null),t=null,$(a).addClass(n)}return{init:function(){t='<div class="widget-icon-inner" data-wi-type="'+"default"+'" data-wi-status="'+!1+'"><div class="standby-phone"><i class="fa fa-phone-volume icon-phone-answer"></i><div class="phone-widget-icon__state"><span class="phone-widget-icon__ongoing"></span><span class="phone-widget-icon__text"></span><span class="phone-widget-icon__time"></span></div><i class="fa fa-phone icon-phone"></i></div></div>',$(e).append(t)},update:function(t){l(t)}}}function callsFilter(t){return{init:function(){},reset:function(){$(".widget-line-overlay").hide();$(".call-filter__toggle").removeClass("is-checked")}}}function widgetStatus(t,e){let a=e;var n=".status-confirmation",i={status:!!$(t).attr("checked"),shown:!1};function l(){$("#pw_status_name").text("ON")}function c(){$("#pw_status_name").text("OFF")}return $(document).on("click","[data-status-action]",function(e){e.preventDefault(),function(e){if("true"===e.attr("data-status-action")){e.html('<i class="fa fa-spinner fa-spin"></i>');let n=1;i.status&&(n=2),$.ajax({type:"post",data:{type_id:n},url:a}).done(function(e){let a=!0;2===n?(a=!1,c()):l(),$(t).prop("checked",a),i.status=a}).fail(function(){new PNotify({title:"Change status",type:"error",text:"Server error",hide:!0})}).always(function(){e.html('<i class="fa fa-check"></i>'),i.shown&&$(".status-confirmation-tooltip").detach(),i.shown=!1})}else i.shown&&$(".status-confirmation-tooltip").detach(),i.shown=!1}($(this))}),$(document).on("click",t,function(t){var e;t.preventDefault(),i.shown||(i.shown=!0,$(n).append('<div class="status-confirmation-tooltip"><span>Switch to <i class="'+((e=i.status)?"occupied":"online")+'">'+(e?"OFF":"ON")+'</i> ?</span><div class="status-action-group"><a href="#" data-status-action="false">NO</a><a href="#" data-status-action="true"><i class="fa fa-check"></i></a></div></div>'))}),$(document).on("click",".phone-widget",function(t){i.shown&&!$(t.target).closest(".number-toggle").length&&($(".status-confirmation-tooltip").detach(),i.shown=!1)}),{getStatus:function(){switch(i.status){case!0:return 1;case!1:return 2}},setStatus:function(e){1===e?(i.status=!0,l()):(i.status=!1,c()),$(n).html(""),$(".status-confirmation-tooltip").detach(),i.shown=!1,$(t).prop("checked",i.status)}}}!function(){function t(){this.calls=[],this.add=function(t){return null!==this.getIndex(t.callSid)?null:(function(t){t.timeQueuePushed=Date.now(),t.blocked=!1,t.sentHoldUnHoldRequest=!1,t.sentMuteUnMuteRequest=!1,t.sentHangupRequest=!1,t.sentReturnHoldCallRequest=!1,t.sentAcceptCallRequest=!1,t.sentAddNoteRequest=!1,t.sentRejectInternalRequest=!1}(t),t.isHold&&(t.holdStartTime=Date.now()-1e3*parseInt(t.holdDuration)),this.calls.unshift(t),new window.phoneWidget.call.Call(t))},this.remove=function(t){let e=this.getIndex(t);return null!==e&&(this.calls.splice(e,1),!0)},this.getIndex=function(t){let e=null;return this.calls.forEach(function(a,n){if(a.callSid===t)return e=n,!1}),e},this.getLast=function(){let t=null;for(let e in this.calls)"inArray"!==e&&(t=this.calls[e]);return null==t?null:new window.phoneWidget.call.Call(t)},this.getFirst=function(){let t=null;for(let e in this.calls)if("inArray"!==e){t=this.calls[e];break}return null==t?null:new window.phoneWidget.call.Call(t)},this.one=function(t){let e=this.getIndex(t);return null!==e?new window.phoneWidget.call.Call(this.calls[e]):null},this.count=function(){return this.calls.length},this.all=function(){let t=[];return this.calls.forEach(function(e){t.push(new window.phoneWidget.call.Call(e))}),t},this.showAll=function(){this.calls.forEach(function(t){console.log(t)})},this.reset=function(){this.calls=[]}}class e{constructor(t,e){this.queue=t,this.queueName=e}getList(){let t=[],e=this;return this.queue.all().forEach(function(a){a.data.queue===e.queueName&&t.push(a)}),t}one(t){return this.queue.one(t)}all(){let t=this.getList();if(t.length<1)return[];let e=[],a="";return t.forEach(function(t){return t.data.isInternal?(e.internal||(e.internal={calls:[]}),void e.internal.calls.push(t)):t.data.project?(a=t.data.project+t.data.department,e[a]||(e[a]={project:t.data.project,department:t.data.department,calls:[]}),void e[a].calls.push(t)):(e.external||(e.external={calls:[]}),void e.external.calls.push(t))}),e}count(){return this.getList().length}add(t){return this.queue.add(t)}getLast(){return this.queue.getLast()}getFirst(){return this.queue.getFirst()}remove(t){this.queue.remove(t)}reset(){this.queue.reset()}}window.phoneWidget.queue={Queue:t,Direct:class extends e{constructor(t){super(t,"direct")}},Hold:class extends e{constructor(t){super(t,"hold")}},General:class extends e{constructor(t){super(t,"general")}},Active:function(){return new e(new t,"inProgress")}}}(),function(){window.phoneWidget.storage.conference=new function(){this.conferences=[],this.add=function(t){return null!==this.getIndex(t.sid)?null:(function(t){t.timeStoragePushed=Date.now()}(t),this.conferences.unshift(t),new window.phoneWidget.conference.Conference(t))},this.remove=function(t){let e=this.getIndex(t);null!==e&&this.conferences.splice(e,1)},this.getIndex=function(t){let e=null;return this.conferences.forEach(function(a,n){if(a.sid===t)return e=n,!1}),e},this.removeByParticipantCallSid=function(t){let e=this.getIndexByParticipantCallSid(t);null!==e&&this.conferences.splice(e,1)},this.getIndexByParticipantCallSid=function(t){let e=null;return this.conferences.forEach(function(a,n){a.participants.forEach(function(a){a.callSid===t&&(e=n)})}),e},this.one=function(t){let e=this.getIndex(t);return null!==e?new window.phoneWidget.conference.Conference(this.conferences[e]):null},this.update=function(t){this.remove(t.sid);let e=this.add(t);null!==e?e.save():console.log("conference not added to storage")},this.showAll=function(){this.conferences.forEach(function(t){console.log(t)})},this.reset=function(){this.conferences=[]}}}(),function(){function t(){this.notifications=[],this.add=function(t,e,a){return null===this.getIndex(t)&&(a.key=t,a.type=e,a.timePushed=Date.now(),this.notifications.unshift(a),a)},this.remove=function(t){let e=this.getIndex(t);return null!==e&&(this.notifications.splice(e,1),!0)},this.getIndex=function(t){let e=null;return this.notifications.forEach(function(a,n){a.key===t&&(e=n)}),e},this.getLast=function(){let t=null;for(let e in this.notifications)"inArray"!==e&&(t=this.notifications[e]);return null==t?null:t},this.getFirst=function(){let t=null;for(let e in this.notifications)if("inArray"!==e){t=this.notifications[e];break}return null==t?null:t},this.one=function(t){let e=this.getIndex(t);return null!==e?this.notifications[e]:null},this.count=function(){return this.notifications.length},this.all=function(){return this.notifications},this.showAll=function(){this.notifications.forEach(function(t){console.log(t)})},this.reset=function(){this.notifications=[]}}function e(){this.$container=document.getElementById("desktop-phone-notifications"),this.notify=function(t){ReactDOM.render(React.createElement(DesktopNotification,{notifications:t}),this.$container)},this.reset=function(){ReactDOM.unmountComponentAtNode(this.$container),this.$container.innerHTML=""}}function a(){this.$container=document.getElementById("widget-phone-notifications"),this.notificationKey=null,this.notify=function(t){this.notificationKey=t.key,ReactDOM.render(React.createElement(PhoneWidgetNotification,{notification:t}),this.$container)},this.reset=function(){ReactDOM.unmountComponentAtNode(this.$container),this.$container.innerHTML="",this.notificationKey=null},this.isEqual=function(t){return this.notificationKey===t}}window.phoneWidget.notifier=new function(){this.notifications=new t,this.notifiers={desktop:new e,phone:new a},this.isOn=!0,this.offKey=null,this.getVisibleNotifications=function(){let t=[];return this.notifications.all().forEach(function(e){e.isShow&&t.push(e)}),t},this.add=function(t,e,a){if(!1===this.notifications.add(t,e,a))return!1;if(!a.isShow)return!0;a.isNew=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifiers.phone.notify(a),a.isNew=!1;let n=this;return setTimeout(function(){n.notifiers.desktop.notify(n.getVisibleNotifications()),n.notifiers.phone.notify(a)},50),!0},this.addAndShowOnlyDesktop=function(t,e,a){if(!1===this.notifications.add(t,e,a))return!1;if(!a.isShow)return!0;a.isNew=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),a.isNew=!1;let n=this;return setTimeout(function(){n.notifiers.desktop.notify(n.getVisibleNotifications())},50),!0},this.remove=function(t){let e=this.notifications.one(t);if(null===e)return!1;if(!e.isShow)return this.notifications.remove(t),!0;e.isDeleted=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifiers.phone.isEqual(e.key)&&this.notifiers.phone.notify(e),this.notifications.remove(t);let a=this;return setTimeout(function(){let t=a.getVisibleNotifications();a.notifiers.desktop.notify(t),a.notifiers.phone.isEqual(e.key)&&a.notifiers.phone.reset(),0===t.length&&a.notifiers.desktop.reset()},400),!0},this.hide=function(t){let e=this.notifications.one(t);if(null===e)return!1;if(!e.isShow)return!0;e.willHide=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifiers.phone.isEqual(e.key)&&this.notifiers.phone.notify(e),e.willHide=!1,e.isShow=!1;let a=this;return setTimeout(function(){let t=a.getVisibleNotifications();a.notifiers.desktop.notify(t),a.notifiers.phone.isEqual(e.key)&&a.notifiers.phone.reset(),0===t.length&&a.notifiers.desktop.reset()},400),!0},this.refresh=function(){if(!this.isOn)return!1;this.notifications.all().forEach(function(t){t.isShow=!0,t.isNew=!0}),this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifications.all().forEach(function(t){t.isNew=!1});let t=this;return setTimeout(function(){t.notifiers.desktop.notify(t.getVisibleNotifications())},50),this.notifiers.phone.reset(),!0},this.on=function(t){this.isOff()&&this.offKey!==t||(this.isOn=!0)},this.off=function(t){this.isOn=!1,this.offKey=t},this.isOff=function(){return!1===this.isOn},this.reset=function(){this.notifiers.desktop.reset(),this.notifiers.phone.reset()}},window.phoneWidget.notifier.types={incomingCall:"incomingCall"}}(),$(document).ready(function(){var t;window.widgetIcon=new handleWidgetIcon,widgetIcon.init(),$phoneTabAnchor=$("[data-toggle-tab]");var e=!1;$phoneTabAnchor.on("click",function(){if($current="#"+$(this).data("toggle-tab"),$phoneTabAnchor.removeClass("is_active"),$(this).addClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$($current).addClass("is_active"),$(".widget-modal").hide(),$(".collapsible-container").collapse("hide"),p.reset(),"tab-history"===$(this).data("toggle-tab")){e||(e=!0,$.ajax({url:"/call-log/ajax-get-call-history",type:"post",data:{},dataType:"json",beforeSend:function(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>')},success:function(e){$("#tab-history .simplebar-content").append(e.html),t.recalculate(),$("#tab-history").attr("data-page",e.page)},complete:function(t){$($current).find(".wg-history-load").remove()},error:function(t,e){}})),parseInt($(this).attr("data-missed-calls"))>0&&PhoneWidgetCall.requestClearMissedCalls()}"#tab-contacts"===$current&&(PhoneWidgetContacts.fullListIsEmpty(),$(this).hasClass("js-add-to-conference")?(window.localStorage.setItem("contactSelectableState",1),$(".contacts-list").addClass("contacts-list--selection"),$(".selection-amount").show()):(window.localStorage.setItem("contactSelectableState",0),$(".contacts-list").removeClass("contacts-list--selection"),$(".submit-selected-contacts").slideUp(10),$(".selection-amount").hide()),PhoneWidgetContacts.requestFullList())}),$(".phone-widget__tab").each(function(e,a){var n=new SimpleBar(a);n.getContentElement(),"tab-history"===$(a).attr("id")&&(!function(e){var a=!1;e.getScrollElement().addEventListener("scroll",function(e){if(e.target.scrollTop+e.target.clientHeight===e.target.scrollHeight&&!a){var n=$("#tab-history").attr("data-page");$.ajax({url:"/call-log/ajax-get-call-history",type:"post",data:{page:n,uid:userId},dataType:"json",beforeSend:function(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>'),a=!0},success:function(e){$("#tab-history .simplebar-content").append(e.html),t.recalculate(),$("#tab-history").attr("data-page",e.page),e.rows||(a=!1)},complete:function(){$($current).find(".wg-history-load").remove()},error:function(t,e){}})}})}(n),t=n),"tab-contacts"===$(a).attr("id")&&void 0!==PhoneWidgetContacts&&PhoneWidgetContacts.initLazyLoadFullList(n)}),$(".js-toggle-contact-info").on("click",function(){$(".contact-modal-info").show()}),$(".subject-option__add").on("click",function(){if(!$(this).hasClass("added")){switch($(this).data("add-type")){case"cc":$(".email-modal__modal-input-list").append('<input type="text" class="email-modal__contact-input additional-subj" placeholder="CC">');break;case"bcc":$(".email-modal__modal-input-list").append('<input type="text" class="email-modal__contact-input additional-subj" placeholder="BCC">')}$(this).addClass("added")}});var a=$(".scrollable-block"),n=$(".additional-bar__body"),i=$(".contact-modal-info"),l=$(".suggested-contacts"),c=new SimpleBar(l[0]);new SimpleBar(i[0]).getContentElement(),c.getContentElement(),$(n).each(function(t,e){new SimpleBar(e).getContentElement()}),$(".toggle-bar-settings").on("click",function(){$("#bar-settings").slideToggle(150),$("#bar-logs").slideUp(150)}),$(".additional-bar__close").on("click",function(){$(this).parents(".additional-bar").slideUp(150)}),$(".toggle-bar-logs").on("click",function(){$("#bar-logs").slideToggle(150),$("#bar-settings").slideUp(150)}),$(".additional-bar__close").on("click",function(){$(this).parents(".additional-bar").slideUp(150)});var o=$(".tab-trigger.active-tab").attr("href");$(o).show(),$(".tab-trigger").on("click",function(t){t.preventDefault(),$(".tab-trigger").removeClass("active-tab"),$(this).addClass("active-tab"),$(".tabs__item").hide(),$($(this).attr("href")).show()}),$(a).each(function(t,e){new SimpleBar(e).getContentElement()});var s=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;function r(t,e,a){this.context=t,this.status=0,this.freq1=e,this.freq2=a}r.prototype.setup=function(){this.osc1=u.createOscillator(),this.osc2=u.createOscillator(),this.osc1.frequency.value=this.freq1,this.osc2.frequency.value=this.freq2,this.gainNode=this.context.createGain(),this.gainNode.gain.value=.25,this.filter=this.context.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency=8e3,this.osc1.connect(this.gainNode),this.osc2.connect(this.gainNode),this.gainNode.connect(this.filter),this.filter.connect(u.destination)},r.prototype.start=function(){this.setup(),this.osc1.start(0),this.osc2.start(0),this.status=1},r.prototype.stop=function(){this.osc1.stop(0),this.osc2.stop(0),this.status=0};var d={1:{f1:697,f2:1209},2:{f1:697,f2:1336},3:{f1:697,f2:1477},4:{f1:770,f2:1209},5:{f1:770,f2:1336},6:{f1:770,f2:1477},7:{f1:852,f2:1209},8:{f1:852,f2:1336},9:{f1:852,f2:1477},"✱":{f1:941,f2:1209},0:{f1:941,f2:1336},"#":{f1:941,f2:1477},"+":{f1:941,f2:1497}},u=new s,m=new r(u,350,440),f=null,h=null;$(".dialpad_btn_init").on("mousedown touchstart",function(t){t.preventDefault();var e=$(this).val();f=e,h=setInterval(function(){if("0"===f){let t=$(".call-pane__dial-number").val();t&&(t=t.substring(0,t.length-1),t+="+",$(".call-pane__dial-number").val(t))}clearInterval(h)},700);var a=d[e];m.freq1=a.f1,m.freq2=a.f2,0==m.status&&m.start();let n=$(".call-pane__dial-number").val();$(".call-pane__dial-number").val(n+e),$(".call-pane__dial-clear-all").addClass("is-shown"),$(".call-pane__dial-number").focus()}),$(".dialpad_btn_active").on("mousedown touchstart",function(t){t.preventDefault();var e=$(this).val(),a="✱"===e?"*":e;let n=$(this).attr("data-conference-sid"),i=$("#call-pane__dial-number_active_dialpad").val();$("#call-pane__dial-number_active_dialpad").val(i+e),$(".call-pane__dial-clear-all").addClass("is-shown"),$("#call-pane__dial-number_active_dialpad").focus(),PhoneWidgetCall.callRequester.sendDigit(n,a)}),$(window).on("mouseup touchend",function(){void 0!==m&&m.status&&m.stop(),clearInterval(h)}),$(".call_pane_dialpad_clear_number_active_dialpad").on("click",function(t){t.preventDefault(),$("#call-pane__dial-number_active_dialpad").val("")}),$(".call_pane_dialpad_clear_number").on("click",function(t){t.preventDefault(),$("#call-pane__dial-number").val("").attr("readonly",!1).prop("readonly",!1),resetDialNumberData(),$("#call-to-label").text(""),$(".suggested-contacts").removeClass("is_active"),$(".dialpad_btn_init").attr("disabled",!1).removeClass("disabled"),$(".call-pane__correction").attr("disabled",!1)}),$(".call_pane_dialpad_clear_number_disabled").on("click",function(t){t.preventDefault(),$(".call-pane__dial-number").val("").attr("readonly",!0).prop("readonly",!0),$("#call-to-label").text(""),$(".suggested-contacts").removeClass("is_active"),resetDialNumberData()}),$(".call-pane__correction").on("click",function(t){t.preventDefault();var e=$(".call-pane__dial-number").val();$(".call-pane__dial-number").val(e.slice(0,-1)),1===e.length&&$(".suggested-contacts").removeClass("is_active")}),$(".js-edit-mode").on("click",function(t){if(t.preventDefault(),$(this).hasClass("is-editing"))return $(this).removeClass("is-editing"),$(".contact-modal-info").find(".contact-full-info").removeClass("edit-mode"),$(this).find("span").text("Edit"),void $(".contact-modal-info").find(".contact-full-info .form-control").each(function(t,e){$(e).attr("readonly",!0),$(e).attr("disabled",!0)});$(".contact-modal-info").find(".contact-full-info").addClass("edit-mode"),$(this).addClass("is-editing"),$(".contact-modal-info").find(".contact-full-info .form-control").each(function(t,e){$(e).attr("readonly",!1),$(e).attr("disabled",!1)}),$(".is-editing").find("span").text("Save")}),$(".select-contact-type").on("change",function(){$(this).closest(".form-control-wrap").attr("data-type",$(this).val().toLowerCase())}),$(".js-toggle-phone-widget").on("click",function(t){t.preventDefault(),$(".phone-widget").toggleClass("is_active"),$(this).toggleClass("is-mirror")}),$(".phone-widget__close").on("click",function(t){t.preventDefault(),$(".phone-widget").toggleClass("is_active"),$(".js-toggle-phone-widget").toggleClass("is-mirror")}),$(".js-call-tab-trigger").on("click",function(t){t.preventDefault(),$(".widget-modal").hide(),$(".phone-widget__tab").removeClass("is_active"),$("#tab-phone").addClass("is_active"),$("[data-toggle-tab]").removeClass("is_active"),$('[data-toggle-tab="tab-phone"]').addClass("is_active")}),$(document).on("click",".widget-modal__close",function(){$(".widget-modal").hide(),$(".phone-widget__tab").removeClass("ovf-hidden"),$(".collapsible-container").collapse("hide"),$(".subject-option__add").removeClass("added"),$(".additional-subj").remove()});var p=new callsFilter([{project:"ovago",department:"sales",id:1,calls:[{state:"inProgress",length:6001,id:1,contact:{name:"Geff Robertson1",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"hold",length:2201,id:2,contact:{name:"John Doe2",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:3201,id:3,contact:{name:"John Doe6",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"hold",length:6201,id:4,contact:{name:"John Doe7",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]},{project:null,department:"SALES",id:2,calls:[{state:"general",length:5301,id:2,contact:{name:"John Doe4",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"general",length:5301,id:3,contact:{name:"John Doe5",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:5401,id:4,contact:{name:"John Doe8",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:6241,id:1,contact:{name:"Gerrombo Saltison3",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]},{project:"wowfare",department:null,id:2,calls:[{state:"general",length:5301,id:2,contact:{name:"John Doe4",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"general",length:5301,id:3,contact:{name:"John Doe5",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:5401,id:4,contact:{name:"John Doe8",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:6241,id:1,contact:{name:"Gerrombo Saltison3",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]}]);window.historySimpleBar=t}),$(document).on("click",".call-item-menu__close",function(t){t.preventDefault(),$(this).closest(".call-list-item").removeClass("call-list-item--menu")}),$(document).on("click",".call-info-action__more",function(t){t.preventDefault(),$(this).closest(".call-list-item").addClass("call-list-item--menu")}),$(document).on("click",".call-details__nav-btn--more",function(t){t.preventDefault(),$(".conference-call-details").addClass("is_active")}),$(document).on("click",".call-details__nav-btn--back",function(t){t.preventDefault(),$(".conference-call-details").removeClass("is_active")}),function(){window.phoneWidget.audio={Incoming:function(t,e,a,n){this.queues=t,this.notifier=e,this.incomingPane=a,this.outgoingPane=n,this.audio=new Audio("/js/sounds/incoming_call.mp3"),this.audio.volume=.3,this.audio.loop=!0,this.isOn=!0,this.offKey=null,this.play=function(){"visible"!==document.visibilityState?this.stop():this.audio.play()},this.stop=function(){this.audio.pause(),this.audio.currentTime=0},this.muted=function(){this.audio.muted=!0,this.indicatorMuted()},this.unMuted=function(){this.audio.muted=!1,this.indicatorUnMuted()},this.isMuted=function(){return!0===this.audio.muted},this.refresh=function(){this.isOn?this.queues.active.count()>0?this.stop():this.outgoingPane.isActive()?this.stop():this.incomingPane.isActive()?this.play():this.notifier.getVisibleNotifications().length>0?this.play():this.stop():this.stop()},this.indicatorMuted=function(){$("#incoming-sound-indicator").attr("data-status",0).html('<i class="fa fa-volume-off text-danger"> </i>').attr("title","Incoming Call - Volume OFF")},this.indicatorUnMuted=function(){$("#incoming-sound-indicator").attr("data-status",1).html('<i class="fa fa-volume-up text-success"> </i>').attr("title","Incoming Call - Volume ON")},this.on=function(t){this.isOff()&&this.offKey!==t||(this.isOn=!0)},this.off=function(t){this.isOn=!1,this.offKey=t},this.isOff=function(){return!1===this.isOn}}}}();var PhoneWidgetCall=function(){this.connection="";let t=null,e={ajaxCallRedirectGetAgents:"",callStatusUrl:"",ajaxSaveCallUrl:"",clearMissedCallsUrl:""},a=new window.phoneWidget.requesters.CallRequester,n=new window.phoneWidget.queue.Queue,i={wait:n,direct:new window.phoneWidget.queue.Direct(n),hold:new window.phoneWidget.queue.Hold(n),general:new window.phoneWidget.queue.General(n),outgoing:new window.phoneWidget.queue.Queue,active:window.phoneWidget.queue.Active()},l={conference:window.phoneWidget.storage.conference},c={active:PhoneWidgetPaneActive,outgoing:PhoneWidgetPaneOutgoing,incoming:PhoneWidgetPaneIncoming,queue:new PhoneWidgetPaneQueue(i)},o={incoming:new window.phoneWidget.audio.Incoming(i,window.phoneWidget.notifier,c.incoming,c.outgoing)};function s(){PhoneWidgetContactInfo.hide(),PhoneWidgetDialpad.hide(),function(){let t=i.outgoing.getLast();if(null!==t)return c.outgoing.init(t),!0;return!1}()||function(){let t=i.active.getLast();if(null!==t){let e=l.conference.one(t.data.conferenceSid);return null!==e&&e.getCountParticipants()>2?(c.active.init(t,e),!0):(c.active.init(t),!0)}return!1}()||(r(),$("#tab-phone .call-pane-initial").removeClass("is_active"),$("#tab-phone .call-pane").addClass("is_active"))}function r(){let e=i.direct.count()+i.general.count(),a=i.hold.count(),n=i.active.count()+a;if(e<1&&n<1)return void widgetIcon.update({type:"default",timer:!1,text:null,currentCalls:null,status:1===t.getStatus()});let l="";if(e>0&&n>0)l=e+"+"+n;else if(e>0&&n<1)l=e>1?e:"";else if(e<1&&n>0){if(a<1){let e=i.active.getLast();return null===e?void console.log("Not found last active call"):e.data.isHold?void widgetIcon.update({type:"hold",timer:!0,timerStamp:e.getHoldDuration(),text:"on hold",currentCalls:null,status:1===t.getStatus()}):void widgetIcon.update({type:"inProgress",timer:!0,timerStamp:e.getDuration(),text:"on call",currentCalls:null,status:1===t.getStatus()})}l=1===a?"":n}widgetIcon.update({type:"incoming",timer:!1,text:null,currentCalls:l,status:1===t.getStatus()})}function d(t){console.log("incoming call");let e=n.add(t);return null===e?(console.log("Call is already exist in Wait Queue"),!1):"hold"===e.data.queue?(console.log("hold call"),c.queue.refresh(),E(e,!1),!1):(c.queue.refresh(),c.queue.hide(),i.active.count()>0||i.outgoing.count()>0||c.incoming.isActive()?E(e,!0):(w(e,!0),c.incoming.init(e,i.direct.count()+i.general.count(),i.active.count()+i.hold.count())),o.incoming.refresh(),r(),void f())}function u(t){console.log("outgoing call");let e=null;if(t.callSid){if(null===(e=i.outgoing.add(t)))return console.log("Call is already exist in Outgoing Queue"),!1}else e=new window.phoneWidget.call.Call(t);c.outgoing.init(e),f(),h();let a=i.direct.count()+i.general.count(),n=i.active.count()+i.hold.count();(a>0||n>0)&&c.incoming.initWidgetIcon(a,n),o.incoming.refresh()}function m(t){i.active.remove(t),i.outgoing.remove(t),n.remove(t),l.conference.removeByParticipantCallSid(t);let e=y(t);o.incoming.refresh(),window.phoneWidget.notifier.on(t),o.incoming.on(t),c.queue.refresh();let a=!1;c.active.isEqual(t)&&(c.active.removeCallSid(),c.active.removeCallInProgressIndicator(),window.connection="",c.active.isActive()&&(a=!0),i.wait.count()>0&&window.phoneWidget.notifier.refresh()&&(f(),c.queue.openAllCalls(),o.incoming.refresh())),c.outgoing.isEqual(t)&&(c.outgoing.removeCallSid(),c.outgoing.isActive()&&(a=!0)),c.incoming.isEqual(t)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(a=!0)),a||e?s():c.incoming.isActive()&&c.incoming.initWidgetIcon(i.direct.count()+i.general.count(),i.active.count()+i.hold.count()),0===i.active.count()&&0===i.hold.count()&&(i.direct.count()>0||i.general.count()>0)&&o.incoming.refresh()}function f(){$(".phone-widget").addClass("is_active"),$(".js-toggle-phone-widget").removeClass("is-mirror")}function h(){$(".phone-widget__tab").removeClass("is_active"),$("[data-toggle-tab]").removeClass("is_active"),$("#tab-phone").addClass("is_active"),$("[data-toggle-tab]").each(function(t){"tab-phone"===$(this).data("toggle-tab")&&$(this).addClass("is_active")})}function p(t){return!("undefined"==typeof device||null==device||device&&"ready"!==device._status)||(createNotify(t,"Please try again after some seconds. Device is not ready.","warning"),!1)}function g(t,e){if(!p("Accept Call"))return!1;if("false"!==e&&window.connection)window.connection.accept(),$("#tab-phone .call-pane-initial").removeClass("is_active"),$("#tab-phone .call-pane-calling").addClass("is_active"),$("#call-controls2").hide();else{let e=n.one(t);if(null===e)return createNotify("Error","Not found call on Wait Queue","error"),!1;if(!e.setAcceptCallRequestState())return!1;a.accept(e)}}function v(t){$('[data-toggle-tab="tab-history"]').attr("data-missed-calls",t)}function _(t){let e=i.active.one(t);return null===e?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!e.setHoldRequestState()&&void a.hold(e)}function R(t){let e=i.active.one(t);return null===e?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!e.setUnHoldRequestState()&&void a.unHold(e)}function w(t,e){return window.phoneWidget.notifier.addAndShowOnlyDesktop(t.data.callSid,window.phoneWidget.notifier.types.incomingCall,b(t,e))}function E(t,e){return window.phoneWidget.notifier.add(t.data.callSid,window.phoneWidget.notifier.types.incomingCall,b(t,e))}function b(t,e){return{callSid:t.data.callSid,queue:t.data.queue,name:t.data.contact.name,phone:t.data.contact.phone,project:t.data.project,department:t.data.department,duration:t.data.duration,canCallInfo:t.data.contact.canCallInfo,isInternal:t.data.isInternal,fromInternal:t.data.fromInternal,eventName:t.getEventUpdateName(),isShow:e}}function y(t){return window.phoneWidget.notifier.remove(t)}function N(t){let e=window.phoneWidget.notifier.hide(t);return o.incoming.refresh(),e}return{init:function(n){a.init(n),Object.assign(e,n),(t=new widgetStatus(".call-status-switcher",n.updateStatusUrl)).setStatus(n.status),r(),v(n.countMissedCalls),c.active.setup(n.btnHoldShow,n.btnTransferShow),function(){let t=this;$(document).on("click",".queue-separator .list_item_mute",function(t){let e=$(this).attr("data-call-sid");if(!e)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(e);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;if(n.data.isMute){if(!n.setUnMuteRequestState())return!1;a.unMute(n)}else{if(!n.setMuteRequestState())return!1;a.mute(n)}}),$(document).on("click",".call-pane-calling #call-pane__mute",function(e){let n=$(this);if(conferenceBase){let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let e=i.active.one(t);if(null===e)return createNotify("Error","Not found Call on Active Queue","error"),!1;if(e.data.isMute){if(!e.setUnMuteRequestState())return!1;a.unMute(e)}else{if(!e.setMuteRequestState())return!1;a.mute(e)}}else{let e=t.connection,a=$("#btn-mute-microphone");"false"===n.attr("data-is-muted")?e&&(e.mute(!0),e.isMuted()?(c.active.buttons.mute.mute(),a.html('<i class="fa fa-microphone"></i> Unmute').removeClass("btn-success").addClass("btn-warning")):new PNotify({title:"Mute",type:"error",text:"Error",hide:!0})):e&&(e.mute(!1),e.isMuted()?new PNotify({title:"Unmute",type:"error",text:"Error",hide:!0}):(c.active.buttons.mute.unMute(),a.html('<i class="fa fa-microphone"></i> Mute').removeClass("btn-warning").addClass("btn-success")))}})}(),$(document).on("click",".wg-transfer-call",function(t){t.preventDefault();let a=$(this).attr("data-call-sid");if(!a)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(a);return null===n?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!n.canTransfer()&&void function(t){if(void 0===e.ajaxCallRedirectGetAgents)return alert("Ajax call redirect url is not set"),!1;let a=$("#web-phone-redirect-agents-modal");a.modal("show").find(".modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),$("#web-phone-redirect-agents-modal-label").html("Transfer Call"),$.post(e.ajaxCallRedirectGetAgents,{sid:t}).done(function(t){a.find(".modal-body").html(t)})}(n.data.callSid)}),$(document).on("click","#btn-accept-call",function(){let t=$(this);g(t.attr("data-call-sid"),t.attr("data-from-internal"))}),$(document).on("click",".btn-item-call-queue",function(){let t=$(this),e=$(this).attr("data-type-action");if("accept"===e)return g(t.attr("data-call-sid"),t.attr("data-from-internal")),!1;if("acceptInternal"===e){let e=i.direct.one(t.attr("data-call-sid"));return null===e?(createNotify("Accept Internal Call","Not found Call on Direct Incoming Queue","error"),!1):(acceptInternalCall(e),!1)}return"hangup"===e?(hangup(t.attr("data-call-sid")),!1):"return"===e?(function(t){if(!p("Return Hold Call"))return!1;let e=i.hold.one(t);null===e?createNotify("Error","Not found call on Hold Queue","error"):e.setReturnHoldCallRequestState()&&a.returnHoldCall(e)}(t.attr("data-call-sid")),!1):void console.log("Undefined type action")}),$(document).on("click","#reject-incoming-call",function(t){t.preventDefault(),window.connection&&(window.connection.reject(),$.get(e.ajaxSaveCallUrl+"?sid="+window.connection.parameters.CallSid),$("#call-controls2").hide())}),$(document).on("click","#hide-incoming-call",function(t){t.preventDefault();let e=$(this).attr("data-call-sid");if(!e)return createNotify("Error","Not found Call SID","error"),!1;c.incoming.isEqual(e)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(c.incoming.hide(),N(e),s(),i.wait.count()>0&&0===i.active.count()&&0===i.outgoing.count()&&(c.queue.openAllCalls(),o.incoming.refresh())))}),$(document).on("click","#active_call_add_note_submit",function(t){t.preventDefault();let e=$(this).data("call-sid");if(!e)return createNotify("Warning","Call SID is undefined","warning"),!1;let n=i.active.one(e);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;let l=document.getElementById("active_call_add_note"),c=l.value.trim();return c?!!n.setAddNoteRequestState()&&void a.addNote(n,c,l):(createNotify("Warning","Note value is empty","warning"),!1)}),$(document).on("click","#wg-add-note",function(t){t.preventDefault(),$(".additional-info.add-note").slideDown(200)}),$(document).on("click",".additional-info.add-note .additional-info__close",function(){$(".add-note").slideUp(150)}),$(document).on("click",".call-pane-calling #wg-dialpad",function(){"true"===$(this).attr("data-active")&&$(".dial-popup").slideDown(150)}),$(document).on("click",".dial-popup .additional-info__close",function(){$(".dial-popup").slideUp(150)}),$(document).on("click",".call-pane__info",function(){$(".contact-info").slideDown(150)}),$(document).on("click",".additional-info.contact-info .additional-info__close",function(){$(".contact-info").slideUp(150)}),$(document).on("click","#wg-hold-call",function(t){if(!conferenceBase)return!1;let e=$(this).attr("data-call-sid");if(!e)return createNotify("Error","Not found Call SID","error"),!1;let a=i.active.one(e);return null===a?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!a.canHoldUnHold()&&void(a.data.isHold?R(a.data.callSid):_(a.data.callSid))}),$(document).on("click",".list_item_hold",function(t){if(!conferenceBase)return!1;let e=$(this).attr("data-call-sid");if(!e)return createNotify("Error","Not found Call SID","error"),!1;let a=i.active.one(e);return null===a?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!a.canHoldUnHold()&&void(a.data.isHold?R(a.data.callSid):_(a.data.callSid))}),$(document).on("click","#cancel-active-call",function(t){hangup($(this).attr("data-call-sid"))}),$(document).on("click","#cancel-outgoing-call",function(t){t.preventDefault();let e=$(this),n=e.attr("data-call-sid");if(!n)return createNotify("Hangup","Please try again after some seconds.","warning"),!1;let l=i.outgoing.one(n);return null===l?(createNotify("Error","Not found Call on Outgoing Queue","error"),!1):!!l.setHangupRequestState()&&void a.hangupOutgoingCall(l)}),$(document).on("click",".btn-history-call-info",function(t){t.preventDefault();let e=$(this).attr("data-call-sid");if(void 0===e)return createNotify("Call Info","Not found Call Sid","error"),!1;a.callLogInfo(e)}),$(document).on("click",".pw-btn-call-info",function(t){t.preventDefault();let e=$(this).attr("data-call-sid");if(void 0===e)return createNotify("Call Info","Not found Call Sid","error"),!1;a.callInfo(e)}),$(document).on("click",".cw-btn-client-info",function(t){t.preventDefault();let e=$(this).attr("data-client-id"),n=$(this).attr("data-is-client");if(void 0===e)return createNotify("Client Info","Not found Client ID","error"),!1;a.clientInfo(e,"true"===n)}),$(document).on("click",".phone-dial-contacts",function(t){t.preventDefault(),function(t){let e=$(t),a=!!e.data("user-id");$(".widget-phone__contact-info-modal").hide(),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active"),insertPhoneNumber({formatted:e.data("phone"),title:a?"":e.data("title"),user_id:e.data("user-id"),phone_to:e.data("phone"),project_id:e.data("project-id"),department_id:e.data("department-id"),client_id:e.data("client-id"),source_type_id:e.data("source-type-id"),lead_id:e.data("lead-id"),case_id:e.data("case-id")})}(this)}),$(document).on("click",".pw-notification-hide",function(t){t.preventDefault();let e=$(this).attr("data-call-sid");N(e),c.incoming.isEqual(e)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(c.incoming.hide(),s())),o.incoming.refresh(),0!==i.active.count()||0!==i.outgoing.count()||c.incoming.isActive()||c.queue.openAllCalls()}),$(document).on("click","#incoming-sound-indicator",function(){"1"===$(this).attr("data-status")?o.incoming.muted():o.incoming.unMuted()})},volumeIndicatorsChange:function(t,e){$("#wg-call-microphone .sound-ovf").css("right",-Math.floor(100*t)+"%"),$("#wg-call-volume .sound-ovf").css("right",-Math.floor(100*e)+"%")},updateConnection:function(t){this.connection=t},refreshCallStatus:function(t){"In progress"===t.status?function(t){console.log("active call"),n.remove(t.callSid),i.outgoing.remove(t.callSid),y(t.callSid);let e=i.active.add(t);if(null===e)return o.incoming.refresh(),console.log("Call is already exist in Active Queue"),!1;if(o.incoming.refresh(),c.outgoing.isEqual(e.data.callSid)&&(c.outgoing.removeCallSid(),c.outgoing.hide()),void 0!==t.conference&&null!==t.conference){l.conference.remove(t.conference.sid);let a=l.conference.add(t.conference);if(null===a)console.log("conference not added");else if(a.getCountParticipants()>2)return c.active.init(e,a),f(),h(),c.queue.refresh(),void c.queue.hide()}c.active.init(e),f(),h(),c.queue.refresh(),c.queue.hide()}(t):"Ringing"===t.status||"Queued"===t.status?2===parseInt(t.typeId)?d(t):1===parseInt(t.typeId)&&u(t):("Completed"===t.status||t.isEnded||5===parseInt(t.cua_status_id))&&m(t.callSid)},panes:c,requestIncomingCall:d,requestOutgoingCall:u,changeStatus:function(e){t.setStatus(e),c.active.isActive()||c.outgoing.isActive()||widgetIcon.update({type:"default",timer:!1,text:null,currentCalls:null,status:1===t.getStatus()})},requestClearMissedCalls:function(){$.ajax({type:"post",data:{},url:e.clearMissedCallsUrl}).done(function(t){v(t.count)}).fail(function(){createNotify("Clear missed calls","Server error","error")})},socket:function(t){"add_missed_call"!==t.command?"update_count_missed_calls"!==t.command?"hold"!==t.command?"unhold"!==t.command?"conferenceUpdate"!==t.command?"addCallToHistory"!==t.command||function(t){if($("#tab-history .simplebar-content .history-tab-today-first-block").length>0)$("#tab-history .simplebar-content .history-tab-today-first-block").prepend(t.call);else{let e='<span class="section-separator">Today</span><ul class="phone-widget__list-item calls-history history-tab-today-first-block">'+t.call+"</ul>";$("#tab-history .simplebar-content").prepend(e),window.historySimpleBar.recalculate()}}(t):function(t){console.log("conference update");let e=null;if(t.conference.participants.forEach(function(t){null===e&&(e=i.active.one(t.callSid))}),null===e)return void console.log("not found call in active queue");let a=l.conference.one(t.conference.sid);if(null!==a){let n=t.conference.participants.length,i=a.getCountParticipants();return i<3&&n<3?(l.conference.remove(t.conference.sid),void(a=l.conference.add(t.conference))):i<3&&n>2?(l.conference.remove(t.conference.sid),a=l.conference.add(t.conference),void c.active.init(e,a)):i>2&&n>2?void l.conference.update(t.conference):i>2&&n<3?(l.conference.remove(t.conference.sid),l.conference.add(t.conference),void c.active.init(e)):void console.log("not found rule for conference update")}(a=l.conference.add(t.conference)).getCountParticipants()>2?c.active.init(e,a):c.active.init(e)}(t):function(t){let e=i.active.one(t);null!==e&&(e.unHold(),c.active.isEqual(e.data.callSid)&&c.active.isActive()&&(window.phoneWidget.oldWidget.unHold(),r()))}(t.call.sid):function(t){let e=i.active.one(t);null!==e&&(e.hold(),c.active.isEqual(e.data.callSid)&&c.active.isActive()&&(window.phoneWidget.oldWidget.hold(),r()))}(t.call.sid):v(t.count):function(){let t=$('[data-toggle-tab="tab-history"]').attr("data-missed-calls");t++,$('[data-toggle-tab="tab-history"]').attr("data-missed-calls",t)}()},queues:i,removeIncomingRequest:function(t){let e=n.remove(t);c.queue.refresh(),y(t),o.incoming.refresh(),window.phoneWidget.notifier.on(t),o.incoming.on(t),e&&r(),c.incoming.isEqual(t)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(c.incoming.hide(),s()))},sendHoldRequest:_,sendUnHoldRequest:R,storage:l,callRequester:a,completeCall:m,updateCurrentCalls:function(e,a){t.setStatus(a),r(),n.reset(),i.outgoing.reset(),i.active.reset(),l.conference.reset(),c.queue.refresh(),s(),window.phoneWidget.notifier.reset(),function(t){if(t.isEmpty)return;let e=!1;t.hold.forEach(function(t){let a=n.add(t);null!==a&&(e=!0,w(a,!0))});let a=null,d=!1;t.incoming.forEach(function(t){let e=n.add(t);null!==e&&(w(e,!0),d=!0,a=e)});let u=!1;t.outgoing.forEach(function(t){i.outgoing.add(t),u=!0});let m=!1;t.active.forEach(function(t){i.active.add(t),m=!0}),t.conferences.forEach(function(t){l.conference.add(t)}),f(),c.queue.refresh(),"incoming"===t.lastActive&&0===i.active.count()&&0===i.outgoing.count()&&null!==a?(c.incoming.init(a,i.direct.count()+i.general.count(),i.active.count()+i.hold.count()),h(),o.incoming.refresh()):(o.incoming.refresh(),!e||m||u||d?s():(f(),c.queue.openAllCalls(),window.phoneWidget.notifier.refresh(),o.incoming.refresh(),r()))}(e)},iconUpdate:r,audio:o}}();!function(){var t,e,a;$("#call-pane__dial-number").on("keyup",(t=function(){$(".suggested-contacts").removeClass("is_active");let t=$("#contact-list-calls-ajax");if(t.find("input[name=q]").val().length<3)return!1;t.submit()},e=300,a=0,function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(n,i)},e||0)}));$("#contact-list-calls-ajax").on("beforeSubmit",function(t){t.preventDefault();let e=$(this);return!(e.find("input[name=q]").val().length<3)&&($.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serializeArray(),dataType:"json"}).done(function(t){let e="";t.results.length<1||($.each(t.results,function(t,a){e+=function(t){console.log(t);let e="";3===t.type&&(e='<div class="contact-info-card__status"><i class="far fa-user '+t.user_status_class+' "></i></div>');let a=3===t.type?t.id:"";return'<li class="calls-history__item contact-info-card call-contact-card" data-user-id="'+a+'" data-phone="'+(a?t.title:t.phone)+'" data-title="'+(a?"":t.title)+'"><div class="collapsible-toggler">'+e+'<div class="contact-info-card__details"><div class="contact-info-card__line history-details"><strong class="contact-info-card__name">'+t.name+"</strong></div></div></div></li>"}(a)}),$(".suggested-contacts").html(e).addClass("is_active"),$(".call-pane__dial-clear-all").addClass("is-shown"))}).fail(function(){new PNotify({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})}),!1)}),$(document).on("click","li.call-contact-card",function(){let t=$(this).data("phone"),e=$(this).data("title"),a=$(this).data("user-id");insertPhoneNumber({formatted:t,title:e,user_id:a,phone_to:t}),$(".suggested-contacts").removeClass("is_active")})}();let PhoneWidgetSms=function(){let t="",e="",a={},n={1:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',2:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',3:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',4:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',5:'<span class="pw-msg-item__status pw-msg-item__status--delivered"> <i class="fa fa-check-double"></i> </span>',6:'<span class="pw-msg-item__status pw-msg-item__status--error"> <i class="fa fa-exclamation-circle"></i> </span>',7:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',8:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>'};function i(){return a}function l(t){return void 0===n[t.status]?"":n[t.status]}function c(t){return"web-phone-widget-sms-"+t.id}function o(){let t=$(document).find(".messages-modal__messages-scroll").find($(".simplebar-content-wrapper"))[0];t&&$(t).scrollTop($(t)[0].scrollHeight)}function s(t,e){return"phone-widget-sms-messages-container-"+t.id+"-"+r(t.phone)+"-"+t.type+"-"+r(e.phone)}function r(t){return t.substr(1)}function d(t,e){if(!e)return!1;let a=!1;if(e.find(".messages-modal__msg-list").map(function(){if(t.group===$(this).data("group"))return $(this).append(u(t)),a=!0,!1}),!a){let a='<span class="section-separator">'+t.group+"</span>";a+='<ul class="messages-modal__msg-list" data-group="'+t.group+'">',a+=u(t),a+="</ul>",e.append(a)}}function u(t){let e="";return 1===t.type&&(e=" pw-msg-item--user"),'<li class="messages-modal__msg-item pw-msg-item'+e+'"><div class="pw-msg-item__avatar"><div class="agent-text-avatar"><span>'+t.avatar+'</span></div></div><div class="pw-msg-item__msg-main"><div class="pw-msg-item__data"><span class="pw-msg-item__name">'+t.name+'</span><span class="pw-msg-item__timestamp">'+t.time+'</span><span class="'+c(t)+'">'+l(t)+'</span></div><div class="pw-msg-item__msg-wrap"><p class="pw-msg-item__msg">'+t.text+"</p></div></div></li>"}function m(t,e){let a="."+s(t,e),n=$(document).find(a);return n||!1}return{init:function(n,i,l){t=n,e=i,a=l},getUserPhones:i,showModalSelectNumber:function(t){let e="";$.each(i(),function(a,n){var i;e+='<span class="phone-widget-userPhones btn btn-success" style="margin-left: 0;margin-right: 7px" data-contact="'+(i=t,btoa(JSON.stringify(i)))+'" data-user-phone="'+n+'">'+n+"</span>"});let a=$("#modal-df");a.find(".modal-body").html(e),a.find(".modal-title").html("Select your phone number"),a.modal("show")},loadSmses:function(a,n){let i=$(".widget-phone__messages-modal"),l={contactId:a.id,contactPhone:a.phone,contactType:a.type,userPhone:n.phone};$(".phone-widget__tab").addClass("ovf-hidden"),i.html("").show(),i.append('<div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div>'),$.ajax({type:"POST",url:t,data:l,dataType:"json"}).done(function(t){if(i.html(""),!t.success)return i.append(function(t){let e='<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div style="padding: 20px;color:red"><p><strong>Errors:</strong></p>';return $.each(t,function(t,a){$.each(a,function(t,a){e+='<div style="padding: 5px 0 5px 0;">'+a+"</div>"})}),e+="</div>"}(t.errors)),!1;let a=(n=t.contact,l=t.user,'<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div class="modal-messaging__contact-info"><div class="modal-messaging__info-list"><div class="modal-messaging__info-item" style="margin-bottom:0">SMS to <span class="modal-messaging__contact-name">'+n.name+'</span></div><span class="modal-messaging__info-number">'+n.phone+'</span><div class="modal-messaging__info-item" style="margin-bottom:0">From: <span class="modal-messaging__contact-name">'+l.phone+'</span></div></div></div><div class="messages-modal__messages-scroll"><div class="messages-modal__body '+s(t.contact,t.user)+'"></div></div>'+function(t,a){return'<div class="messages-modal__footer"><form id="phone-widget-send-sms-form" action="'+e+'" method="post"><div class="messages-modal__input-group"><input name="text" type="text" class="messages-modal__msg-input" placeholder="Your Message"><input name="contactType" type="hidden" value="'+t.type+'"><input name="contactId" type="hidden" value="'+t.id+'"><input name="contactPhone" type="hidden" value="'+t.phone+'"><input name="userPhone" type="hidden" value="'+a.phone+'"><button class="messages-modal__send-btn"><i class="fa fa-paper-plane"></i></button></div></form></div>'}(t.contact,t.user));var n,l;i.append(a),function(t,e){$.each(t,function(t,a){d(a,e)})}(t.smses,m(t.contact,t.user)),function(){let t=$(document).find(".messages-modal__messages-scroll");new SimpleBar(t[0]),o()}()}).fail(function(t){i.html("");let e="Server Error. Try again later";t.status&&403===t.status&&(e="Access denied"),new PNotify({title:"Get sms",type:"error",text:e,hide:!0})})},addSms:d,decode:function(t){return JSON.parse(atob(t))},sendStart:function(){$(document).find(".messages-modal__msg-input").prop("disabled","disabled"),$(document).find(".messages-modal__send-btn").prop("disabled","disabled").html('<i class="fa fa-spinner fa-spin"></i>')},sendFinish:function(){$(document).find(".messages-modal__msg-input").prop("disabled",!1).val(""),$(document).find(".messages-modal__send-btn").prop("disabled",!1).html('<i class="fa fa-paper-plane"></i>')},getSmsesContainer:m,scrollDown:o,socket:function(t){return"update_status"===t.command?(function(t){let e=$(document).find("."+c(t));e&&e.html(l(t))}(t.sms),!0):"add"===t.command?(d(t.sms,m(t.contact,t.user)),o(),!0):void 0}}}();$(document).on("click",".js-trigger-messages-modal",function(){let t=PhoneWidgetSms.getUserPhones().length;if(t<1)return new PNotify({title:"Get sms messages",type:"error",text:"Not found user phones.",hide:!0}),!1;let e={id:$(this).data("contact-id"),phone:$(this).data("contact-phone"),type:$(this).data("contact-type")};if(t>1)return PhoneWidgetSms.showModalSelectNumber(e),!1;let a={phone:PhoneWidgetSms.getUserPhones()[0]};PhoneWidgetSms.loadSmses(e,a)}),$(document).on("click",".phone-widget-userPhones",function(){$("#modal-df").modal("hide");let t=PhoneWidgetSms.decode($(this).data("contact")),e={phone:$(this).data("user-phone")};PhoneWidgetSms.loadSmses(t,e)}),$(document).on("click",".messages-modal__send-btn",function(t){t.preventDefault();let e=$("#phone-widget-send-sms-form"),a=e.serializeArray();return PhoneWidgetSms.sendStart(),$.ajax({type:e.attr("method"),url:e.attr("action"),data:a,dataType:"json"}).done(function(t){if(PhoneWidgetSms.sendFinish(),!t.success){let e="";return $.each(t.errors,function(t,a){$.each(a,function(t,a){e+=a+"<br>"})}),new PNotify({title:"Send sms",type:"error",text:e,hide:!0}),!1}PhoneWidgetSms.addSms(t.sms,PhoneWidgetSms.getSmsesContainer(t.contact,t.user)),PhoneWidgetSms.scrollDown()}).fail(function(){PhoneWidgetSms.sendFinish(),new PNotify({title:"Send sms",type:"error",text:"Server Error. Try again later",hide:!0})}),!1});let PhoneWidgetContacts=function(){let t="",e="",a="",n=null,i=null,l=!0,c=[];function o(){return a}function s(){return n}function r(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>')}function d(){$($current).find(".wg-history-load").remove()}function u(t,e){return function(t,e){var a="data-selected-contact";$(document).on("change",t,function(){if($(this).is(":checked")){$(".submit-selected-contacts").slideDown(250);var t=$("["+a+'="'+$(this).attr(a)+'"]');$(t).prop("checked",!1),$(this).prop("checked",!0),e.hasOwnProperty("id")&&e.id===parseInt($(this).attr(a))&&(m($(this),a),c.push(e))}else m($(this),a);0===c.length&&$(".submit-selected-contacts").slideUp(150),$(".selection-amount__selected").html(c.length),console.log(c)})}("[data-selected-contact]",t),"1"==window.localStorage.getItem("contactSelectableState")&&t.phones.length>=2?'<li class="actions-list__option actions-list__option--if-selectable"><div class="checkbox"><input type="checkbox" name="checkedContact'+e+'2" id="checkedContact'+e+'2" value="'+t.phones[e]+'" data-selected-contact="'+t.id+'"><label for="checkedContact'+e+'2"></label><label for="checkedContact'+e+'2" data-area-label></label></div></li>':""}function m(t,e){for(var a=0;a<c.length;a++)c[a].id===parseInt($(t).attr(e))&&c.splice(c.indexOf(c[a]),1)}function f(t){let e='<li class="calls-history__item contact-info-card is-collapsible"><div class="collapsible-toggler collapsed" data-toggle="'+function(t){return"1"==window.localStorage.getItem("contactSelectableState")&&t.phones.length<2?"":"collapse"}(t)+'" data-target="#collapse'+t.id+'" aria-expanded="false" aria-controls="collapse'+t.id+'"><div class="contact-info-card__status"><div class="agent-text-avatar"><span>'+t.avatar+'</span></div></div><div class="contact-info-card__details"><div class="contact-info-card__line history-details"><strong class="contact-info-card__name">'+t.name+'</strong></div><div class="contact-info-card__line history-details"><span class="contact-info-card__call-type">'+t.description+"</span></div>"+function(t,e){return"1"==window.localStorage.getItem("contactSelectableState")&&t.phones.length<=1?'<div class="select-contact"><div class="checkbox"><input type="checkbox" name="checkedContact'+t.id+'" id="checkedContact'+t.id+'" value="'+t.phones[0]+'" data-selected-contact="'+t.id+'"><label for="checkedContact'+t.id+'"></label><label for="checkedContact'+t.id+'" data-area-label></label></div></div>':'<a href="#" class="collapsible-arrow"><i class="fas fa-chevron-right"></i></a>'}(t)+'</div></div><div id="collapse'+t.id+'" class="collapse collapsible-container" aria-labelledby="headingOne" data-parent="#contacts-tab"><ul class="contact-options-list"><li class="contact-options-list__option js-toggle-contact-info" data-contact="'+h(t)+'"><i class="fa fa-user"></i>';return t.isInternal&&(e+='<li class="contact-options-list__option dial-to-user contact-dial-to-user" data-contact="'+h(t)+'"> <i class="fa fa-phone"> </i></li>'),e+='</ul><ul class="contact-full-info">',t.phones&&t.phones.forEach(function(a,n){e+=g(a,n,t)}),t.emails&&t.emails.forEach(function(a,n){e+=p(a,n,t)}),e+="</ul></div></li>"}function h(t){return btoa(JSON.stringify(t))}function p(t,e,a){return'<li class="contact-full-info__email"><div class="form-group"><label for="">Email '+(e+1)+'</label><input readonly type="email" class="form-control" value="'+t+'" autocomplete="off"></div><ul class="actions-list"><li class="actions-list__option js-trigger-email-modal" data-contact="'+h(a)+'" data-contact-email="'+t+'"><i class="fa fa-envelope"></i></li></ul></li>'}function g(a,n,i){let l='<li class="contact-full-info__phone"><div class="form-group"><label for="">Phone '+(n+1)+'</label><input readonly type="text" class="form-control" value="'+a+'" autocomplete="off"></div><ul class="actions-list"><li class="actions-list__option actions-list__option--phone js-call-tab-trigger">',c=i.isInternal?i.id:"";return l+='<i class="fa fa-phone phone-dial-contacts" data-user-id="'+c+'" data-phone="'+(c?i.name:a)+'" data-title="'+i.name+'"></i>',l+='</li><li title="'+t+'" class="actions-list__option js-trigger-messages-modal'+e+'" data-contact-id="'+i.id+'" data-contact-phone="'+a+'" data-contact-type="'+i.type+'"><i class="fa fa-comment-alt"></i></li>'+u(i,n)+"</ul></li>"}function v(){$("#list-of-contacts").html('<div style="width:100%;text-align:center;margin-top:20px">No results found</div>')}function _(t){let e="";return $.each(t,function(a,n){if(!a||!n)return;let i='<span class="section-separator">'+a+"</span>";i+='<ul class="phone-widget__list-item calls-history" id="contacts-tab">',$.each(t[a],function(t,e){i+=f(e)}),e+=i+="</ul>"}),e}function R(t){$("#tab-contacts").attr("data-page",t)}return{init:function(n,i,l){t=n,e=i,a=l,window.localStorage.setItem("contactSelectableState",0)},viewContact:function(t){let e='<div class="widget-phone__contact-info-modal widget-modal contact-modal-info"><a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div class="contact-modal-info__user"><div class="agent-text-avatar"><span>'+t.avatar+'</span></div><h3 class="contact-modal-info__name">'+t.name+'</h3></div><div class="contact-modal-info__body"><span class="section-separator">General info</span><ul class="contact-modal-info__contacts contact-full-info"><li><div class="form-group"><label for="">Type</label>',a="person";return t.is_company&&(a="company"),e+='<div class="form-control-wrap" data-type="'+a+'">',e+='<select readonly type="text" class="form-control select-contact-type" autocomplete="off" readonly disabled>',t.is_company?e+='<option value="company" selected="selected">Company</option> <option value="person">Person</option>':e+='<option value="company">Company</option> <option value="person" selected="selected">Person</option>',e+="</select></div></div></li>",t.phones&&t.phones.forEach(function(a,n){e+=g(a,n,t)}),t.emails&&t.emails.forEach(function(a,n){e+=p(a,n,t)}),e+="</ul></div></div>"},decodeContact:function(t){return JSON.parse(atob(t))},delay:function(t,e){var a=0;return function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(n,i)},e||0)}},requestFullList:function(){r(),$.ajax({type:"post",url:o(),data:{},dataType:"json"}).done(function(t){if(t.results.length<1)return d(),void v();var e;R(t.page),e=t.results,n=e;let a=_(s());d(),$("#list-of-contacts").html("").append(a),i.recalculate()}).fail(function(t){console.log(t),d(),new PNotify({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})})},initLazyLoadFullList:function(t){var e=!1;(i=t).getScrollElement().addEventListener("scroll",function(t){if(l&&t.target.scrollTop+t.target.clientHeight===t.target.scrollHeight&&!e){var a=$("#tab-contacts").attr("data-page");$.ajax({url:o(),type:"post",data:{page:a,uid:userId},dataType:"json",beforeSend:function(){r(),e=!0},success:function(t){var a;R(t.page),(a=t.results)&&$.each(a,function(t,e){t&&e&&(n[t]?$.each(a[t],function(e,a){n[t][n[t].length]=a}):n[t]=e)});let l=_(s());d(),$("#list-of-contacts").html("").append(l),i.recalculate(),t.rows||(e=!1)},complete:function(){d()},error:function(t,e){}})}})},fullListIsEmpty:function(){return!n},loadFullList:function(){if(r(),n){let t=_(n);d(),$("#list-of-contacts").html("").append(t)}else d(),$("#list-of-contacts").html("")},requestSearchList:function(t){r(),$.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serializeArray(),dataType:"json"}).done(function(t){if(t.results.length<1)return d(),void v();let e=_(t.results);d(),$("#list-of-contacts").html("").append(e)}).fail(function(){d(),new PNotify({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})})},setCurrentFullListContainer:function(){return l=!0},setCurrentSearchListContainer:function(){return l=!1}}}();$("#contact-list-ajax").on("beforeSubmit",function(t){t.preventDefault();let e=$(this);return e.find("input[name=q]").val().length<2?(PhoneWidgetContacts.setCurrentFullListContainer(),!1):(PhoneWidgetContacts.setCurrentSearchListContainer(),PhoneWidgetContacts.requestSearchList(e),!1)}),$("#contact-list-ajax-q").on("keyup",PhoneWidgetContacts.delay(function(){let t=$("#contact-list-ajax");if(t.find("input[name=q]").val().length<2)return PhoneWidgetContacts.setCurrentFullListContainer(),PhoneWidgetContacts.loadFullList(),!1;PhoneWidgetContacts.setCurrentSearchListContainer(),t.submit()},300)),$(document).on("click",".js-toggle-contact-info",function(){let t=PhoneWidgetContacts.decodeContact($(this).data("contact")),e=PhoneWidgetContacts.viewContact(t);$(".widget-phone__contact-info-modal").html(e),$(".widget-phone__contact-info-modal").show()}),$(document).on("click",".contact-dial-to-user",function(){let t=PhoneWidgetContacts.decodeContact($(this).data("contact"));insertPhoneNumber({formatted:t.name,title:"",user_id:t.id}),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active")});let PhoneWidgetEmail=function(){let t="",e={};function a(){return e}function n(){$(document).find(".email-modal").find(".wg-history-load").remove()}return{init:function(a,n){t=a,e=n},getUserEmails:a,showModalSelectNumber:function(t,e){let n="";$.each(a(),function(a,i){n+='<span class="phone-widget-userEmails btn btn-success" style="margin-left: 0;margin-right: 7px" data-contact-email="'+e+'" data-contact="'+t+'" data-user-email="'+i+'">'+i+"</span>"});let i=$("#modal-df");i.find(".modal-body").html(n),i.find(".modal-title").html("Select your email address"),i.modal("show")},decode:function(t){return JSON.parse(atob(t))},show:function(e,a,n){let i=$(document).find(".email-modal");i.html("");let l='<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a>    <div class="modal-messaging__contact-info">        <div class="modal-messaging__info-list">            <div class="modal-messaging__info-item">Email to <span class="modal-messaging__contact-name">'+e.name+'</span></div>            <span class="modal-messaging__info-number">'+a+'</span>            <div class="modal-messaging__info-item" style="margin-bottom:0">Email From: <span class="modal-messaging__contact-name">'+n.email+'</span></div>        </div>    </div>    <div class="email-modal__messages-scroll">        <div class="email-modal__body"><form id="phone-widget-send-email-form" action="'+t+'" method="post">               <input name="contactType" type="hidden" value="'+e.type+'">               <input name="contactId" type="hidden" value="'+e.id+'">               <input name="contactEmail" type="hidden" value="'+a+'">               <input name="userEmail" type="hidden" value="'+n.email+'">            <div class="email-modal__input-group">                <div class="email-modal__subject-block">                    <div class="email-modal__modal-input-list"> <input type="text" name="subject" class="email-modal__contact-input" placeholder="Subject"> </div>                </div>                <textarea class="email-modal__msg-input" placeholder="Your Message" name="text" cols="30" rows="10"></textarea>            </div>            <button class="email-modal__send-btn"><span>SEND</span><i class="fa fa-paper-plane"></i></button>            </form>        </div>    </div>';i.append(l),i.show(),$(".phone-widget__tab").addClass("ovf-hidden")},send:function(t){let e=t.serializeArray();$(document).find(".email-modal").append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>'),$.ajax({type:t.attr("method"),url:t.attr("action"),data:e,dataType:"json"}).done(function(e){if(n(),!e.success){let t=function(t){let e="";return $.each(t,function(t,a){$.each(a,function(t,a){e+=a+"<br>"})}),e}(e.errors);return new PNotify({title:"Send email",type:"error",text:t,hide:!0}),!1}t.find(".email-modal__contact-input").val(""),t.find(".email-modal__msg-input").val("");let a="Success";e.message&&(a=e.message),new PNotify({title:"Send email",type:"success",text:a,hide:!0})}).fail(function(){n(),new PNotify({title:"Send email",type:"error",text:"Server Error. Try again later",hide:!0})})}}}();$(document).on("click",".js-trigger-email-modal",function(){let t=PhoneWidgetEmail.getUserEmails().length;if(t<1)return new PNotify({title:"Send email",type:"error",text:"Not found user emails.",hide:!0}),!1;if(t>1)return PhoneWidgetEmail.showModalSelectNumber($(this).data("contact"),$(this).data("contact-email")),!1;let e=PhoneWidgetEmail.decode($(this).data("contact")),a=$(this).data("contact-email"),n={email:PhoneWidgetEmail.getUserEmails()[0]};PhoneWidgetEmail.show(e,a,n)}),$(document).on("click",".phone-widget-userEmails",function(){$("#modal-df").modal("hide");let t=PhoneWidgetEmail.decode($(this).data("contact")),e=$(this).data("contact-email"),a={email:$(this).data("user-email")};PhoneWidgetEmail.show(t,e,a)}),$(document).on("click",".email-modal__send-btn",function(t){t.preventDefault();let e=$(document).find("#phone-widget-send-email-form");PhoneWidgetEmail.send(e)});