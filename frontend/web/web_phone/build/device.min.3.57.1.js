!function(e){var t=function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}}()({1:[function(e,t,n){"use strict";t.exports=WebSocket},{}],2:[function(e,t,n){"use strict";t.exports={XMLHttpRequest:XMLHttpRequest}},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./twilio/call");n.Call=r.default;var i=e("./twilio/device");n.Device=i.default;var o=e("./twilio/errors");n.TwilioError=o;var a=e("./twilio/log");n.Logger=a.Logger;var s=e("./twilio/preflight/preflight");n.PreflightTest=s.PreflightTest},{"./twilio/call":6,"./twilio/device":9,"./twilio/errors":12,"./twilio/log":15,"./twilio/preflight/preflight":17}],4:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./deferred"),a=function(){function e(){this._operations=[]}return e.prototype.enqueue=function(e){var t=!!this._operations.length,n=new o.default;return this._operations.push({deferred:n,callback:e}),t||this._processQueue(),n.promise},e.prototype._processQueue=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,a,s;return i(this,function(i){switch(i.label){case 0:if(!this._operations.length)return[3,5];e=this._operations[0],t=e.deferred,n=e.callback,r=void 0,o=void 0,a=void 0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n()];case 2:return r=i.sent(),a=!0,[3,4];case 3:return s=i.sent(),o=s,[3,4];case 4:return this._operations.shift(),a?t.resolve(r):t.reject(o),[3,0];case 5:return[2]}})})},e}();n.AsyncQueue=a},{"./deferred":8}],5:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("events"),a=e("./errors"),s=e("./log"),c=e("./outputdevicecollection"),u=e("./shims/mediadevices"),l=e("./util"),d=e("./shims/mediadeviceinfo"),p={audioinput:"Audio Input",audiooutput:"Audio Output"},f=function(e){function t(t,n,r,i){var o=e.call(this)||this;o.availableInputDevices=new Map,o.availableOutputDevices=new Map,o._audioConstraints=null,o._inputDevice=null,o._inputStream=null,o._isPollingInputVolume=!1,o._log=s.default.getInstance(),o._unknownDeviceIndexes={audioinput:{},audiooutput:{}},o._removeLostInput=function(e){if(!o.inputDevice||o.inputDevice.deviceId!==e.deviceId)return!1;o._replaceStream(null),o._inputDevice=null,o._maybeStopPollingVolume();var t=o.availableInputDevices.get("default")||Array.from(o.availableInputDevices.values())[0];return t&&o.setInputDevice(t.deviceId),!0},o._removeLostOutput=function(e){var t=o.speakerDevices.delete(e),n=o.ringtoneDevices.delete(e);return t||n},o._updateAvailableDevices=function(){return o._mediaDevices?o._mediaDevices.enumerateDevices().then(function(e){o._updateDevices(e.filter(function(e){return"audiooutput"===e.kind}),o.availableOutputDevices,o._removeLostOutput),o._updateDevices(e.filter(function(e){return"audioinput"===e.kind}),o.availableInputDevices,o._removeLostInput);var t=o.availableOutputDevices.get("default")||Array.from(o.availableOutputDevices.values())[0];[o.speakerDevices,o.ringtoneDevices].forEach(function(e){!e.get().size&&o.availableOutputDevices.size&&o.isOutputSelectionSupported&&e.set(t.deviceId).catch(function(e){o._log.warn("Unable to set audio output devices. "+e)})})}):Promise.reject("Enumeration not supported")},i=Object.assign({AudioContext:"undefined"!=typeof AudioContext&&AudioContext,setSinkId:"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId},i),o._getUserMedia=r,o._mediaDevices=i.mediaDevices||u,o._onActiveInputChanged=n;var a=!(!i.AudioContext&&!i.audioContext),l=!(!o._mediaDevices||!o._mediaDevices.enumerateDevices),d="function"==typeof i.setSinkId;return o.isOutputSelectionSupported=l&&d,o.isVolumeSupported=a,i.enabledSounds&&o._addEnabledSounds(i.enabledSounds),o.isVolumeSupported&&(o._audioContext=i.audioContext||i.AudioContext&&new i.AudioContext,o._audioContext&&(o._inputVolumeAnalyser=o._audioContext.createAnalyser(),o._inputVolumeAnalyser.fftSize=32,o._inputVolumeAnalyser.smoothingTimeConstant=.3)),o.ringtoneDevices=new c.default("ringtone",o.availableOutputDevices,t,o.isOutputSelectionSupported),o.speakerDevices=new c.default("speaker",o.availableOutputDevices,t,o.isOutputSelectionSupported),o.addListener("newListener",function(e){"inputVolume"===e&&o._maybeStartPollingVolume()}),o.addListener("removeListener",function(e){"inputVolume"===e&&o._maybeStopPollingVolume()}),o.once("newListener",function(){o.isOutputSelectionSupported||o._log.warn("Warning: This browser does not support audio output selection."),o.isVolumeSupported||o._log.warn("Warning: This browser does not support Twilio's volume indicator feature.")}),l&&o._initializeEnumeration(),o}return i(t,e),Object.defineProperty(t.prototype,"audioConstraints",{get:function(){return this._audioConstraints},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDevice",{get:function(){return this._inputDevice},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputStream",{get:function(){return this._inputStream},enumerable:!0,configurable:!0}),t.prototype._maybeStartPollingVolume=function(){var e=this;if(this.isVolumeSupported&&this._inputStream&&(this._updateVolumeSource(),!this._isPollingInputVolume&&this._inputVolumeAnalyser)){var t=this._inputVolumeAnalyser.frequencyBinCount,n=new Uint8Array(t);this._isPollingInputVolume=!0;var r=function(){if(e._isPollingInputVolume){if(e._inputVolumeAnalyser){e._inputVolumeAnalyser.getByteFrequencyData(n);var t=l.average(n);e.emit("inputVolume",t/255)}requestAnimationFrame(r)}};requestAnimationFrame(r)}},t.prototype._maybeStopPollingVolume=function(){this.isVolumeSupported&&(!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),delete this._inputVolumeSource),this._isPollingInputVolume=!1))},t.prototype._unbind=function(){if(!this._mediaDevices)throw new a.NotSupportedError("Enumeration is not supported");this._mediaDevices.removeEventListener&&(this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices),this._mediaDevices.removeEventListener("deviceinfochange",this._updateAvailableDevices))},t.prototype.setAudioConstraints=function(e){return this._audioConstraints=Object.assign({},e),delete this._audioConstraints.deviceId,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},t.prototype.setInputDevice=function(e){return l.isFirefox()?Promise.reject(new a.NotSupportedError("Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324")):this._setInputDevice(e,!1)},t.prototype.unsetAudioConstraints=function(){return this._audioConstraints=null,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},t.prototype.unsetInputDevice=function(){var e=this;return this.inputDevice?this._onActiveInputChanged(null).then(function(){e._replaceStream(null),e._inputDevice=null,e._maybeStopPollingVolume()}):Promise.resolve()},t.prototype._addEnabledSounds=function(e){var t=this;Object.keys(e).forEach(function(n){t[n]=function(t,n){return void 0!==n&&(e[t]=n),e[t]}.bind(null,n)})},t.prototype._getUnknownDeviceIndex=function(e){var t=e.deviceId,n=e.kind,r=this._unknownDeviceIndexes[n][t];return r||(r=Object.keys(this._unknownDeviceIndexes[n]).length+1,this._unknownDeviceIndexes[n][t]=r),r},t.prototype._initializeEnumeration=function(){var e=this;if(!this._mediaDevices)throw new a.NotSupportedError("Enumeration is not supported");this._mediaDevices.addEventListener&&(this._mediaDevices.addEventListener("devicechange",this._updateAvailableDevices),this._mediaDevices.addEventListener("deviceinfochange",this._updateAvailableDevices)),this._updateAvailableDevices().then(function(){e.isOutputSelectionSupported&&Promise.all([e.speakerDevices.set("default"),e.ringtoneDevices.set("default")]).catch(function(t){e._log.warn("Warning: Unable to set audio output devices. "+t)})})},t.prototype._replaceStream=function(e){this._inputStream&&this._inputStream.getTracks().forEach(function(e){e.stop()}),this._inputStream=e},t.prototype._setInputDevice=function(e,t){var n=this;if("string"!=typeof e)return Promise.reject(new a.InvalidArgumentError("Must specify the device to set"));var r=this.availableInputDevices.get(e);if(!r)return Promise.reject(new a.InvalidArgumentError("Device not found: "+e));if(this._inputDevice&&this._inputDevice.deviceId===e&&this._inputStream){if(!t)return Promise.resolve();this._inputStream.getTracks().forEach(function(e){e.stop()})}var i={audio:Object.assign({deviceId:{exact:e}},this.audioConstraints)};return this._getUserMedia(i).then(function(e){return n._onActiveInputChanged(e).then(function(){n._replaceStream(e),n._inputDevice=r,n._maybeStartPollingVolume()})})},t.prototype._updateDevices=function(e,t,n){var r=this,i=e.map(function(e){return e.deviceId}),o=Array.from(t.values()).map(function(e){return e.deviceId}),a=[],s=l.difference(o,i);s.forEach(function(e){var r=t.get(e);r&&(t.delete(e),n(r)&&a.push(r))});var c=!1;e.forEach(function(e){var n=t.get(e.deviceId),i=r._wrapMediaDeviceInfo(e);n&&n.label===i.label||(t.set(e.deviceId,i),c=!0)}),(c||s.length)&&(null!==this.inputDevice&&"default"===this.inputDevice.deviceId&&(this._log.warn("Calling getUserMedia after device change to ensure that the           tracks of the active device (default) have not gone stale."),this._setInputDevice(this.inputDevice.deviceId,!0)),this.emit("deviceChange",a))},t.prototype._updateVolumeSource=function(){this._inputStream&&this._audioContext&&this._inputVolumeAnalyser&&(this._inputVolumeSource&&this._inputVolumeSource.disconnect(),this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser))},t.prototype._wrapMediaDeviceInfo=function(e){var t={deviceId:e.deviceId,groupId:e.groupId,kind:e.kind,label:e.label};if(!t.label)if("default"===t.deviceId)t.label="Default";else{var n=this._getUnknownDeviceIndex(e);t.label="Unknown "+p[t.kind]+" Device "+n}return new d(t)},t}(o.EventEmitter);f||(f={}),n.default=f},{"./errors":12,"./log":15,"./outputdevicecollection":16,"./shims/mediadeviceinfo":31,"./shims/mediadevices":32,"./util":35,events:48}],6:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var a=e("events"),s=e("./device"),c=e("./errors"),u=e("./log"),l=e("./rtc/icecandidate"),d=e("./statsMonitor"),p=e("./util"),f=e("backoff"),h=e("./constants"),m=e("./rtc").PeerConnection,g=e("./rtc/sdp").getPreferredCodecInfo,v={factor:1.1,initialDelay:1,maxDelay:3e4,randomisationFactor:.5},_=70,y=500,b=160,w=10,S=5e3,C={disconnect:!0,info:{code:31003,message:"Connection with Twilio was interrupted.",twilioError:new c.MediaErrors.ConnectionError}},E={packetsLostFraction:{max:"packet-loss",maxAverage:"packets-lost-fraction"}},k={audioInputLevel:"audio-input-level",audioOutputLevel:"audio-output-level",bytesReceived:"bytes-received",bytesSent:"bytes-sent",jitter:"jitter",mos:"mos",rtt:"rtt"},T={max:"high-",maxAverage:"high-",maxDuration:"constant-",min:"low-",minStandardDeviation:"constant-"},x=function(e){function t(n,r){var i=e.call(this)||this;i.parameters={},i._inputVolumeStreak=0,i._isAnswered=!1,i._isCancelled=!1,i._latestInputVolume=0,i._latestOutputVolume=0,i._log=u.default.getInstance(),i._metricsSamples=[],i._options={MediaHandler:m,offerSdp:null,shouldPlayDisconnect:function(){return!0}},i._outputVolumeStreak=0,i._shouldSendHangup=!0,i._soundcache=new Map,i._status=t.State.Pending,i.toString=function(){return"[Twilio.Call instance]"},i._emitWarning=function(e,t,n,r,o,a){var s=e+"warning"+(o?"-cleared":"-raised");if("constant-audio-input-level"!==t||!i.isMuted()){var c=o?"info":"warning";"constant-audio-output-level"===t&&(c="info");var u={threshold:n};if(r&&(r instanceof Array?u.values=r.map(function(e){return"number"==typeof e?Math.round(100*e)/100:r}):u.value=r),i._publisher.post(c,s,t,{data:u},i),"constant-audio-output-level"!==t){var l=o?"warning-cleared":"warning";i.emit(l,t,a&&!o?a:null)}}},i._onAnswer=function(e){i._isAnswered||(i._setCallSid(e),i._isAnswered=!0,i._maybeTransitionToOpen())},i._onCancel=function(e){var n=e.callsid;i.parameters.CallSid===n&&(i._isCancelled=!0,i._publisher.info("connection","cancel",null,i),i._cleanupEventListeners(),i._mediaHandler.close(),i._status=t.State.Closed,i.emit("cancel"),i._pstream.removeListener("cancel",i._onCancel))},i._onHangup=function(e){if(e.callsid&&(i.parameters.CallSid||i.outboundConnectionId)){if(e.callsid!==i.parameters.CallSid&&e.callsid!==i.outboundConnectionId)return}else if(e.callsid)return;if(i._log.info("Received HANGUP from gateway"),e.error){var t=new c.GeneralErrors.ConnectionError("Error sent from gateway in HANGUP");i._log.error("Received an error from the gateway:",t),i.emit("error",t)}i._shouldSendHangup=!1,i._publisher.info("connection","disconnected-by-remote",null,i),i._disconnect(null,!0),i._cleanupEventListeners()},i._onMediaFailure=function(e){var n=t.MediaFailure,r=n.ConnectionDisconnected,o=n.ConnectionFailed,a=n.IceGatheringFailed,s=n.LowBytes,u=e===o||e===a;if(!p.isChrome(window,window.navigator)&&e===o)return i._mediaHandler.onerror(C);if(i._status!==t.State.Reconnecting){var l=i._mediaHandler.version.pc,d=l&&"disconnected"===l.iceConnectionState,f=i._monitor.hasActiveWarning("bytesSent","min")||i._monitor.hasActiveWarning("bytesReceived","min");if(e===s&&d||e===r&&f||u){var h=new c.MediaErrors.ConnectionError("Media connection failed.");i._log.warn("ICE Connection disconnected."),i._publisher.warn("connection","error",h,i),i._publisher.info("connection","reconnecting",null,i),i._mediaReconnectStartTime=Date.now(),i._status=t.State.Reconnecting,i._mediaReconnectBackoff.reset(),i._mediaReconnectBackoff.backoff(),i.emit("reconnecting",h)}}else if(u){if(Date.now()-i._mediaReconnectStartTime>v.maxDelay)return i._log.info("Exceeded max ICE retries"),i._mediaHandler.onerror(C);try{i._mediaReconnectBackoff.backoff()}catch(e){if(!e.message||"Backoff in progress."!==e.message)throw e}}},i._onMediaReconnected=function(){i._status===t.State.Reconnecting&&(i._log.info("ICE Connection reestablished."),i._publisher.info("connection","reconnected",null,i),i._status=t.State.Open,i.emit("reconnected"))},i._onRinging=function(e){if(i._setCallSid(e),i._status===t.State.Connecting||i._status===t.State.Ringing){var n=!!e.sdp;i._status=t.State.Ringing,i._publisher.info("connection","outgoing-ringing",{hasEarlyMedia:n},i),i.emit("ringing",n)}},i._onRTCSample=function(e){var t=o(o({},e),{inputVolume:i._latestInputVolume,outputVolume:i._latestOutputVolume});i._codec=t.codecName,i._metricsSamples.push(t),i._metricsSamples.length>=w&&i._publishMetrics(),i.emit("sample",e)},i._onTransportClose=function(){i._log.error("Received transportClose from pstream"),i.emit("transportClose")},i._reemitWarning=function(e,t){var n,r=/^audio/.test(e.name)?"audio-level-":"network-quality-",o=T[e.threshold.name];e.name in E?n=E[e.name][e.threshold.name]:e.name in k&&(n=k[e.name]);var a=o+n;i._emitWarning(r,a,e.threshold.value,e.values||e.value,t,e)},i._reemitWarningCleared=function(e){i._reemitWarning(e,!0)},i._isUnifiedPlanDefault=n.isUnifiedPlanDefault,i._soundcache=n.soundcache;var a=r&&r.twimlParams||{};i.customParameters=new Map(Object.entries(a).map(function(e){var t=e[0],n=e[1];return[t,String(n)]})),Object.assign(i._options,r),i._options.callParameters&&(i.parameters=i._options.callParameters),i._direction=i.parameters.CallSid?t.CallDirection.Incoming:t.CallDirection.Outgoing,i._direction===t.CallDirection.Incoming&&i.parameters?i.callerInfo=i.parameters.StirStatus?{isVerified:"TN-Validation-Passed-A"===i.parameters.StirStatus}:null:i.callerInfo=null,i._mediaReconnectBackoff=f.exponential(v),i._mediaReconnectBackoff.on("ready",function(){return i._mediaHandler.iceRestart()}),i.outboundConnectionId="TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});var h=i._publisher=n.publisher;i._direction===t.CallDirection.Incoming?h.info("connection","incoming",null,i):h.info("connection","outgoing",{preflight:i._options.preflight},i);var g=i._monitor=new(i._options.StatsMonitor||d.default);return g.on("sample",i._onRTCSample),g.disableWarnings(),setTimeout(function(){return g.enableWarnings()},S),g.on("warning",function(e,n){"bytesSent"!==e.name&&"bytesReceived"!==e.name||i._onMediaFailure(t.MediaFailure.LowBytes),i._reemitWarning(e,n)}),g.on("warning-cleared",function(e){i._reemitWarningCleared(e)}),i._mediaHandler=new i._options.MediaHandler(n.audioHelper,n.pstream,n.getUserMedia,{codecPreferences:i._options.codecPreferences,dscp:i._options.dscp,forceAggressiveIceNomination:i._options.forceAggressiveIceNomination,isUnifiedPlan:i._isUnifiedPlanDefault,maxAverageBitrate:i._options.maxAverageBitrate,preflight:i._options.preflight}),i.on("volume",function(e,t){i._inputVolumeStreak=i._checkVolume(e,i._inputVolumeStreak,i._latestInputVolume,"input"),i._outputVolumeStreak=i._checkVolume(t,i._outputVolumeStreak,i._latestOutputVolume,"output"),i._latestInputVolume=e,i._latestOutputVolume=t}),i._mediaHandler.onvolume=function(e,t,n,r){g.addVolumes(n/255*32767,r/255*32767),i.emit("volume",e,t)},i._mediaHandler.ondtlstransportstatechange=function(e){var t="failed"===e?"error":"debug";i._publisher.post(t,"dtls-transport-state",e,null,i)},i._mediaHandler.onpcconnectionstatechange=function(e){var t="debug",n=i._mediaHandler.getRTCDtlsTransport();"failed"===e&&(t=n&&"failed"===n.state?"error":"warning"),i._publisher.post(t,"pc-connection-state",e,null,i)},i._mediaHandler.onicecandidate=function(e){var t=new l.IceCandidate(e).toPayload();i._publisher.debug("ice-candidate","ice-candidate",t,i)},i._mediaHandler.onselectedcandidatepairchange=function(e){var t=new l.IceCandidate(e.local).toPayload(),n=new l.IceCandidate(e.remote,!0).toPayload();i._publisher.debug("ice-candidate","selected-ice-candidate-pair",{local_candidate:t,remote_candidate:n},i)},i._mediaHandler.oniceconnectionstatechange=function(e){var t="failed"===e?"error":"debug";i._publisher.post(t,"ice-connection-state",e,null,i)},i._mediaHandler.onicegatheringfailure=function(e){i._publisher.warn("ice-gathering-state",e,null,i),i._onMediaFailure(t.MediaFailure.IceGatheringFailed)},i._mediaHandler.onicegatheringstatechange=function(e){i._publisher.debug("ice-gathering-state",e,null,i)},i._mediaHandler.onsignalingstatechange=function(e){i._publisher.debug("signaling-state",e,null,i)},i._mediaHandler.ondisconnected=function(e){i._log.info(e),i._publisher.warn("network-quality-warning-raised","ice-connectivity-lost",{message:e},i),i.emit("warning","ice-connectivity-lost"),i._onMediaFailure(t.MediaFailure.ConnectionDisconnected)},i._mediaHandler.onfailed=function(e){i._onMediaFailure(t.MediaFailure.ConnectionFailed)},i._mediaHandler.onconnected=function(){i._status===t.State.Reconnecting&&i._onMediaReconnected()},i._mediaHandler.onreconnected=function(e){i._log.info(e),i._publisher.info("network-quality-warning-cleared","ice-connectivity-lost",{message:e},i),i.emit("warning-cleared","ice-connectivity-lost"),i._onMediaReconnected()},i._mediaHandler.onerror=function(e){!0===e.disconnect&&i._disconnect(e.info&&e.info.message);var t=e.info.twilioError||new c.GeneralErrors.UnknownError(e.info.message);i._log.error("Received an error from MediaStream:",e),i.emit("error",t)},i._mediaHandler.onopen=function(){i._status!==t.State.Open&&i._status!==t.State.Reconnecting&&(i._status===t.State.Ringing||i._status===t.State.Connecting?(i.mute(!1),i._maybeTransitionToOpen()):i._mediaHandler.close())},i._mediaHandler.onclose=function(){i._status=t.State.Closed,i._options.shouldPlayDisconnect&&i._options.shouldPlayDisconnect()&&!i._isCancelled&&i._soundcache.get(s.default.SoundName.Disconnect).play(),g.disable(),i._publishMetrics(),i._isCancelled||(console.info("DISCONNECT!!"),i.emit("disconnect",i))},i._pstream=n.pstream,i._pstream.on("cancel",i._onCancel),i._pstream.on("ringing",i._onRinging),i._pstream.on("transportClose",i._onTransportClose),i.on("error",function(e){i._publisher.error("connection","error",{code:e.code,message:e.message},i),i._pstream&&"disconnected"===i._pstream.status&&i._cleanupEventListeners()}),i.on("disconnect",function(){i._cleanupEventListeners()}),i}return i(t,e),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"codec",{get:function(){return this._codec},enumerable:!0,configurable:!0}),t.prototype._setInputTracksFromStream=function(e){return this._mediaHandler.setInputTracksFromStream(e)},t.prototype._setSinkIds=function(e){return this._mediaHandler._setSinkIds(e)},t.prototype.accept=function(e){var n=this;if(this._status===t.State.Pending){var r=(e=e||{}).rtcConfiguration||this._options.rtcConfiguration,i=e.rtcConstraints||this._options.rtcConstraints||{},o=i.audio||{audio:!0};this._status=t.State.Connecting;this._options.beforeAccept&&this._options.beforeAccept(this);var a="function"==typeof this._options.getInputStream&&this._options.getInputStream();(a?this._mediaHandler.setInputTracksFromStream(a):this._mediaHandler.openWithConstraints(o)).then(function(){n._publisher.info("get-user-media","succeeded",{data:{audioConstraints:o}},n),function(){if(n._status!==t.State.Connecting)return n._cleanupEventListeners(),void n._mediaHandler.close();var e=function(e){var r=n._direction===t.CallDirection.Incoming?"accepted-by-local":"accepted-by-remote";n._publisher.info("connection",r,null,n);var i=g(n._mediaHandler.version.getSDP()),o=i.codecName,a=i.codecParams;n._publisher.info("settings","codec",{codec_params:a,selected_codec:o},n),n._monitor.enable(e)},o="function"==typeof n._options.getSinkIds&&n._options.getSinkIds();if(Array.isArray(o)&&n._mediaHandler._setSinkIds(o).catch(function(){}),n._pstream.addListener("hangup",n._onHangup),n._direction===t.CallDirection.Incoming)n._isAnswered=!0,n._mediaHandler.answerIncomingCall(n.parameters.CallSid,n._options.offerSdp,i,r,e);else{var a=Array.from(n.customParameters.entries()).map(function(e){return encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])}).join("&");n._pstream.once("answer",n._onAnswer.bind(n)),n._mediaHandler.makeOutgoingCall(n._pstream.token,a,n.outboundConnectionId,i,r,e)}}()},function(e){var t;31208===e.code||-1!==["PermissionDeniedError","NotAllowedError"].indexOf(e.name)?(t=new c.UserMediaErrors.PermissionDeniedError,n._publisher.error("get-user-media","denied",{data:{audioConstraints:o,error:e}},n)):(t=new c.UserMediaErrors.AcquisitionFailedError,n._publisher.error("get-user-media","failed",{data:{audioConstraints:o,error:e}},n)),n._disconnect(),n.emit("error",t)})}},t.prototype.disconnect=function(){this._disconnect()},t.prototype.getLocalStream=function(){return this._mediaHandler&&this._mediaHandler.stream},t.prototype.getRemoteStream=function(){return this._mediaHandler&&this._mediaHandler._remoteStream},t.prototype.ignore=function(){this._status===t.State.Pending&&(this._status=t.State.Closed,this._mediaHandler.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this))},t.prototype.isMuted=function(){return this._mediaHandler.isMuted},t.prototype.mute=function(e){void 0===e&&(e=!0);var t=this._mediaHandler.isMuted;this._mediaHandler.mute(e);var n=this._mediaHandler.isMuted;t!==n&&(this._publisher.info("connection",n?"muted":"unmuted",null,this),this.emit("mute",n,this))},t.prototype.postFeedback=function(e,n){if(null==e)return this._postFeedbackDeclined();if(!Object.values(t.FeedbackScore).includes(e))throw new c.InvalidArgumentError("Feedback score must be one of: "+Object.values(t.FeedbackScore));if(null!=n&&!Object.values(t.FeedbackIssue).includes(n))throw new c.InvalidArgumentError("Feedback issue must be one of: "+Object.values(t.FeedbackIssue));return this._publisher.info("feedback","received",{issue_name:n,quality_score:e},this,!0)},t.prototype.reject=function(){this._status===t.State.Pending&&(this._pstream.reject(this.parameters.CallSid),this._status=t.State.Closed,this.emit("reject"),this._mediaHandler.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",null,this))},t.prototype.sendDigits=function(e){if(e.match(/[^0-9*#w]/))throw new c.InvalidArgumentError("Illegal character passed into sendDigits");var t=[];e.split("").forEach(function(e){var n="w"!==e?"dtmf"+e:"";"dtmf*"===n&&(n="dtmfs"),"dtmf#"===n&&(n="dtmfh"),t.push(n)}),function e(n,r){var i=t.shift();i&&(r?r.play(i):n.get(i).play()),t.length&&setTimeout(e.bind(null,n),200)}(this._soundcache,this._options.dialtonePlayer);var n=this._mediaHandler.getOrCreateDTMFSender();if(n){if(!("canInsertDTMF"in n)||n.canInsertDTMF)return this._log.info("Sending digits using RTCDTMFSender"),void function e(t){if(t.length){var r=t.shift();r&&r.length&&n.insertDTMF(r,b,_),setTimeout(e.bind(null,t),y)}}(e.split("w"));this._log.info("RTCDTMFSender cannot insert DTMF")}if(this._log.info("Sending digits over PStream"),null!==this._pstream&&"disconnected"!==this._pstream.status)this._pstream.dtmf(this.parameters.CallSid,e);else{var r=new c.GeneralErrors.ConnectionError("Could not send DTMF: Signaling channel is disconnected");this.emit("error",r)}},t.prototype.status=function(){return this._status},t.prototype._checkVolume=function(e,t,n,r){var i=t>=10,o=0;return n===e&&(o=t),o>=10?this._emitWarning("audio-level-","constant-audio-"+r+"-level",10,o,!1):i&&this._emitWarning("audio-level-","constant-audio-"+r+"-level",10,o,!0),o},t.prototype._cleanupEventListeners=function(){var e=this,t=function(){e._pstream&&(e._pstream.removeListener("answer",e._onAnswer),e._pstream.removeListener("cancel",e._onCancel),e._pstream.removeListener("hangup",e._onHangup),e._pstream.removeListener("ringing",e._onRinging),e._pstream.removeListener("transportClose",e._onTransportClose))};t(),setTimeout(t,0)},t.prototype._createMetricPayload=function(){var e={call_sid:this.parameters.CallSid,dscp:!!this._options.dscp,sdk_version:h.RELEASE_VERSION,selected_region:this._options.selectedRegion};return this._options.gateway&&(e.gateway=this._options.gateway),this._options.region&&(e.region=this._options.region),e.direction=this._direction,e},t.prototype._disconnect=function(e,n){if(e="string"==typeof e?e:null,this._status===t.State.Open||this._status===t.State.Connecting||this._status===t.State.Reconnecting||this._status===t.State.Ringing){if(this._log.info("Disconnecting..."),null!==this._pstream&&"disconnected"!==this._pstream.status&&this._shouldSendHangup){var r=this.parameters.CallSid||this.outboundConnectionId;r&&this._pstream.hangup(r,e)}this._cleanupEventListeners(),this._mediaHandler.close(),n||this._publisher.info("connection","disconnected-by-local",null,this)}},t.prototype._maybeTransitionToOpen=function(){this._mediaHandler&&"open"===this._mediaHandler.status&&this._isAnswered&&(this._status=t.State.Open,this.emit("accept",this))},t.prototype._postFeedbackDeclined=function(){return this._publisher.info("feedback","received-none",null,this,!0)},t.prototype._publishMetrics=function(){var e=this;0!==this._metricsSamples.length&&this._publisher.postMetrics("quality-metrics-samples","metrics-sample",this._metricsSamples.splice(0),this._createMetricPayload(),this).catch(function(t){e._log.warn("Unable to post metrics to Insights. Received error:",t)})},t.prototype._setCallSid=function(e){var t=e.callsid;t&&(this.parameters.CallSid=t,this._mediaHandler.callSid=t)},t.toString=function(){return"[Twilio.Call class]"},t}(a.EventEmitter);!function(e){!function(e){e.Closed="closed",e.Connecting="connecting",e.Open="open",e.Pending="pending",e.Reconnecting="reconnecting",e.Ringing="ringing"}(e.State||(e.State={})),function(e){e.AudioLatency="audio-latency",e.ChoppyAudio="choppy-audio",e.DroppedCall="dropped-call",e.Echo="echo",e.NoisyCall="noisy-call",e.OneWayAudio="one-way-audio"}(e.FeedbackIssue||(e.FeedbackIssue={})),function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five"}(e.FeedbackScore||(e.FeedbackScore={})),function(e){e.Incoming="INCOMING",e.Outgoing="OUTGOING"}(e.CallDirection||(e.CallDirection={})),function(e){e.Opus="opus",e.PCMU="pcmu"}(e.Codec||(e.Codec={})),function(e){e.None="none",e.Timeout="timeout"}(e.IceGatheringFailureReason||(e.IceGatheringFailureReason={})),function(e){e.ConnectionDisconnected="ConnectionDisconnected",e.ConnectionFailed="ConnectionFailed",e.IceGatheringFailed="IceGatheringFailed",e.LowBytes="LowBytes"}(e.MediaFailure||(e.MediaFailure={}))}(x||(x={})),n.default=x},{"./constants":7,"./device":9,"./errors":12,"./log":15,"./rtc":23,"./rtc/icecandidate":22,"./rtc/sdp":28,"./statsMonitor":34,"./util":35,backoff:42,events:48}],7:[function(e,t,n){var r="https://sdk.twilio.com/js/client/sounds/releases/1.0.0";t.exports.COWBELL_AUDIO_URL=r+"/cowbell.mp3?cache=2.0.1",t.exports.ECHO_TEST_DURATION=2e4,t.exports.PACKAGE_NAME="@twilio/voice-sdk",t.exports.RELEASE_VERSION="2.0.1",t.exports.SOUNDS_BASE_URL=r,t.exports.USED_ERRORS=["AuthorizationErrors.AccessTokenExpired","AuthorizationErrors.AccessTokenInvalid","AuthorizationErrors.AuthenticationFailed","ClientErrors.BadRequest","GeneralErrors.CallCancelledError","GeneralErrors.ConnectionError","GeneralErrors.TransportError","GeneralErrors.UnknownError","MediaErrors.ClientLocalDescFailed","MediaErrors.ClientRemoteDescFailed","MediaErrors.ConnectionError","SignalingErrors.ConnectionDisconnected","SignalingErrors.ConnectionError","UserMediaErrors.PermissionDeniedError","UserMediaErrors.AcquisitionFailedError"]},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){var e=this;this._promise=new Promise(function(t,n){e._resolve=t,e._reject=n})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),e.prototype.reject=function(e){this._reject(e)},e.prototype.resolve=function(e){this._resolve(e)},e}();n.default=r},{}],9:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("events"),u=e("loglevel"),l=e("./audiohelper"),d=e("./call"),p=e("./dialtonePlayer"),f=e("./errors"),h=e("./log"),m=e("./preflight/preflight"),g=e("./regions"),v=e("./util"),_=e("./constants"),y=e("./eventpublisher"),b=e("./pstream"),w=e("./rtc"),S=e("./rtc/getusermedia"),C=e("./sound"),E=function(e){function t(n,r){var i,o;void 0===r&&(r={});var c=e.call(this)||this;if(c._activeCall=null,c._audio=null,c._callInputStream=null,c._calls=[],c._callSinkIds=["default"],c._chunderURIs=[],c._defaultOptions={allowIncomingWhileBusy:!1,closeProtection:!1,codecPreferences:[d.default.Codec.PCMU,d.default.Codec.Opus],dscp:!0,eventgw:"eventgw.twilio.com",forceAggressiveIceNomination:!1,logLevel:u.levels.ERROR,preflight:!1,sounds:{}},c._edge=null,c._enabledSounds=((i={})[t.SoundName.Disconnect]=!1,i[t.SoundName.Incoming]=!1,i[t.SoundName.Outgoing]=!1,i),c._log=h.default.getInstance(),c._options={},c._publisher=null,c._region=null,c._regTimer=null,c._shouldReRegister=!1,c._soundcache=new Map,c._state=t.State.Unregistered,c._stateEventMapping=((o={})[t.State.Destroyed]=t.EventName.Destroyed,o[t.State.Unregistered]=t.EventName.Unregistered,o[t.State.Registering]=t.EventName.Registering,o[t.State.Registered]=t.EventName.Registered,o),c._stream=null,c._streamConnectedPromise=null,c._createDefaultPayload=function(e){var t={aggressive_nomination:c._options.forceAggressiveIceNomination,browser_extension:c._isBrowserExtension,dscp:!!c._options.dscp,ice_restart_enabled:!0,platform:w.getMediaEngine(),sdk_version:_.RELEASE_VERSION};function n(e,n){n&&(t[e]=n)}if(e){var r=e.parameters.CallSid;n("call_sid",/^TJ/.test(r)?void 0:r),n("temp_call_sid",e.outboundConnectionId),n("audio_codec",e.codec),t.direction=e.direction}return n("gateway",c._stream&&c._stream.gateway),n("region",c._stream&&c._stream.region),t},c._onSignalingClose=function(){c._stream=null,c._streamConnectedPromise=null},c._onSignalingConnected=function(e){var t=g.getRegionShortcode(e.region);c._edge=g.regionToEdge[t]||e.region,c._region=t||e.region,c._shouldReRegister&&c.register()},c._onSignalingError=function(e){if("object"==typeof e){var n=e.error,r=e.callsid;if("object"==typeof n){var i="string"==typeof r&&c._findCall(r)||void 0,o=n.code,a=n.message,s=n.twilioError;"number"==typeof o&&(31201===o?s=new f.AuthorizationErrors.AuthenticationFailed(n):31204===o?s=new f.AuthorizationErrors.AccessTokenInvalid(n):31205===o?(c._stopRegistrationTimer(),s=new f.AuthorizationErrors.AccessTokenExpired(n)):f.hasErrorByCode(o)&&(s=new(f.getErrorByCode(o))(n))),s||(c._log.error("Unknown signaling error: ",n),s=new f.GeneralErrors.UnknownError(a,n)),c._log.info("Received error: ",s),c.emit(t.EventName.Error,s,i)}}},c._onSignalingInvite=function(e){return a(c,void 0,void 0,function(){var n,r,i,o,a,c=this;return s(this,function(s){switch(s.label){case 0:return(n=!!this._activeCall)&&!this._options.allowIncomingWhileBusy?(this._log.info("Device busy; ignoring incoming invite"),[2]):e.callsid&&e.sdp?((r=e.parameters||{}).CallSid=r.CallSid||e.callsid,i=Object.assign({},v.queryToJson(r.Params)),[4,this._makeCall(i,{callParameters:r,offerSdp:e.sdp})]):(this.emit(t.EventName.Error,new f.ClientErrors.BadRequest("Malformed invite from gateway")),[2]);case 1:return o=s.sent(),this._calls.push(o),o.once("accept",function(){c._soundcache.get(t.SoundName.Incoming).stop(),c._publishNetworkChange()}),a=this._enabledSounds.incoming&&!n?function(){return c._soundcache.get(t.SoundName.Incoming).play()}:function(){return Promise.resolve()},this._showIncomingCall(o,a),[2]}})})},c._onSignalingOffline=function(){c._log.info("Stream is offline"),c._edge=null,c._region=null,c._shouldReRegister=c.state!==t.State.Unregistered,c._setState(t.State.Unregistered)},c._onSignalingReady=function(){c._log.info("Stream is ready"),c._setState(t.State.Registered)},c._publishNetworkChange=function(){c._activeCall&&c._networkInformation&&c._publisher.info("network-information","network-change",{connection_type:c._networkInformation.type,downlink:c._networkInformation.downlink,downlinkMax:c._networkInformation.downlinkMax,effective_type:c._networkInformation.effectiveType,rtt:c._networkInformation.rtt},c._activeCall)},c._updateInputStream=function(e){var t=c._activeCall;return t&&!e?Promise.reject(new f.InvalidStateError("Cannot unset input device while a call is in progress.")):(c._callInputStream=e,t?t._setInputTracksFromStream(e):Promise.resolve())},c._updateSinkIds=function(e,t){return("ringtone"===e?c._updateRingtoneSinkIds(t):c._updateSpeakerSinkIds(t)).then(function(){c._publisher.info("audio",e+"-devices-set",{audio_device_ids:t},c._activeCall)},function(n){throw c._publisher.error("audio",e+"-devices-set-failed",{audio_device_ids:t,message:n.message},c._activeCall),n})},c.updateToken(n),v.isLegacyEdge())throw new f.NotSupportedError("Microsoft Edge Legacy (https://support.microsoft.com/en-us/help/4533505/what-is-microsoft-edge-legacy) is deprecated and will not be able to connect to Twilio to make or receive calls after September 1st, 2020. Please see this documentation for a list of supported browsers https://www.twilio.com/docs/voice/client/javascript#supported-browsers");if(!t.isSupported&&r.ignoreBrowserSupport){if(window&&window.location&&"http:"===window.location.protocol)throw new f.NotSupportedError("twilio.js wasn't able to find WebRTC browser support.           This is most likely because this page is served over http rather than https,           which does not support WebRTC in many browsers. Please load this page over https and           try again.");throw new f.NotSupportedError("twilio.js 1.3+ SDKs require WebRTC browser support.         For more information, see <https://www.twilio.com/docs/api/client/twilio-js>.         If you have any questions about this announcement, please contact         Twilio Support at <help@twilio.com>.")}if(window){var l=window,m=l.msBrowser||l.browser||l.chrome;c._isBrowserExtension=!!m&&!!m.runtime&&!!m.runtime.id||!!l.safari&&!!l.safari.extension}if(c._isBrowserExtension&&c._log.info("Running as browser extension."),navigator){var y=navigator;c._networkInformation=y.connection||y.mozConnection||y.webkitConnection}return c._networkInformation&&"function"==typeof c._networkInformation.addEventListener&&c._networkInformation.addEventListener("change",c._publishNetworkChange),t._getOrCreateAudioContext(),t._audioContext&&(t._dialtonePlayer||(t._dialtonePlayer=new p.default(t._audioContext))),void 0===t._isUnifiedPlanDefault&&(t._isUnifiedPlanDefault="undefined"!=typeof window&&"undefined"!=typeof RTCPeerConnection&&"undefined"!=typeof RTCRtpTransceiver&&v.isUnifiedPlanDefault(window,window.navigator,RTCPeerConnection,RTCRtpTransceiver)),c._boundDestroy=c.destroy.bind(c),c._boundConfirmClose=c._confirmClose.bind(c),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("unload",c._boundDestroy),window.addEventListener("pagehide",c._boundDestroy)),c.updateOptions(r),c}return i(t,e),Object.defineProperty(t,"audioContext",{get:function(){return t._audioContext},enumerable:!0,configurable:!0}),Object.defineProperty(t,"extension",{get:function(){var e,t,n="undefined"!=typeof document?document.createElement("audio"):{canPlayType:!1};try{e=n.canPlayType&&!!n.canPlayType("audio/mpeg").replace(/no/,"")}catch(t){e=!1}try{t=n.canPlayType&&!!n.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch(e){t=!1}return t&&!e?"ogg":"mp3"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isSupported",{get:function(){return w.enabled()},enumerable:!0,configurable:!0}),Object.defineProperty(t,"packageName",{get:function(){return _.PACKAGE_NAME},enumerable:!0,configurable:!0}),t.runPreflight=function(e,n){return new m.PreflightTest(e,o({audioContext:t._getOrCreateAudioContext()},n))},t.toString=function(){return"[Twilio.Device class]"},Object.defineProperty(t,"version",{get:function(){return _.RELEASE_VERSION},enumerable:!0,configurable:!0}),t._getOrCreateAudioContext=function(){return t._audioContext||("undefined"!=typeof AudioContext?t._audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(t._audioContext=new webkitAudioContext)),t._audioContext},Object.defineProperty(t.prototype,"audio",{get:function(){return this._audio},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){return void 0===e&&(e={}),a(this,void 0,void 0,function(){var n,r;return s(this,function(i){switch(i.label){case 0:if(this._throwIfDestroyed(),this._activeCall)throw new f.InvalidStateError("A Call is already active");return r=this,[4,this._makeCall(e.params||{},{rtcConfiguration:e.rtcConfiguration})];case 1:return n=r._activeCall=i.sent(),this._calls.splice(0).forEach(function(e){return e.ignore()}),this._soundcache.get(t.SoundName.Incoming).stop(),n.accept({rtcConstraints:e.rtcConstraints}),this._publishNetworkChange(),[2,n]}})})},Object.defineProperty(t.prototype,"calls",{get:function(){return this._calls},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.disconnectAll(),this._stopRegistrationTimer(),this._audio&&this._audio._unbind(),this._destroyStream(),this._destroyPublisher(),this._destroyAudioHelper(),this._networkInformation&&"function"==typeof this._networkInformation.removeEventListener&&this._networkInformation.removeEventListener("change",this._publishNetworkChange),"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("beforeunload",this._boundConfirmClose),window.removeEventListener("unload",this._boundDestroy),window.removeEventListener("pagehide",this._boundDestroy)),this._setState(t.State.Destroyed)},t.prototype.disconnectAll=function(){this._calls.splice(0).forEach(function(e){return e.disconnect()}),this._activeCall&&this._activeCall.disconnect()},Object.defineProperty(t.prototype,"edge",{get:function(){return this._edge},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBusy",{get:function(){return!!this._activeCall},enumerable:!0,configurable:!0}),t.prototype.register=function(){return a(this,void 0,void 0,function(){var e,n=this;return s(this,function(r){switch(r.label){case 0:if(this.state!==t.State.Unregistered)throw new f.InvalidStateError('Attempt to register when device is in state "'+this.state+'". Must be "'+t.State.Unregistered+'".');return this._setState(t.State.Registering),[4,this._streamConnectedPromise||this._setupStream()];case 1:return r.sent(),e=new Promise(function(e){n.once(t.State.Registered,e)}),[4,this._sendPresence(!0)];case 2:return r.sent(),[4,e];case 3:return r.sent(),[2]}})})},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"[Twilio.Device instance]"},t.prototype.unregister=function(){return a(this,void 0,void 0,function(){var e,n;return s(this,function(r){switch(r.label){case 0:if(this.state!==t.State.Registered)throw new f.InvalidStateError('Attempt to unregister when device is in state "'+this.state+'". Must be "'+t.State.Registered+'".');return this._shouldReRegister=!1,[4,this._streamConnectedPromise];case 1:return e=r.sent(),n=new Promise(function(t){e.on("offline",t)}),[4,this._sendPresence(!1)];case 2:return r.sent(),[4,n];case 3:return r.sent(),[2]}})})},t.prototype.updateOptions=function(e){if(void 0===e&&(e={}),this.state===t.State.Destroyed)throw new f.InvalidStateError('Attempt to "updateOptions" when device is in state "'+this.state+'".');this._options=o(o(o({},this._defaultOptions),this._options),e);var n=new Set(this._chunderURIs),r="string"==typeof this._options.chunderw?[this._options.chunderw]:Array.isArray(this._options.chunderw)&&this._options.chunderw,i=this._chunderURIs=(r||g.getChunderURIs(this._options.edge,void 0,this._log.warn.bind(this._log))).map(function(e){return"wss://"+e+"/signal"}),a=n.size!==i.length;if(!a)for(var s=0,c=i;s<c.length;s++){var l=c[s];if(!n.has(l)){a=!0;break}}if(this.isBusy&&a)throw new f.InvalidStateError("Cannot change Edge while on an active Call");this._log.setDefaultLevel("number"==typeof this._options.logLevel?this._options.logLevel:u.levels.ERROR),this._options.dscp&&(this._options.rtcConstraints||(this._options.rtcConstraints={}),this._options.rtcConstraints.optional=[{googDscp:!0}]);for(var d=0,p=Object.keys(t._defaultSounds);d<p.length;d++){var h=p[d],m=t._defaultSounds[h],v=_.SOUNDS_BASE_URL+"/"+m.filename+"."+t.extension+"?cache="+_.RELEASE_VERSION,y=this._options.sounds&&this._options.sounds[h]||v,b=new(this._options.Sound||C)(h,y,{audioContext:this._options.disableAudioContextSounds?null:t.audioContext,maxDuration:m.maxDuration,shouldLoop:m.shouldLoop});this._soundcache.set(h,b)}this._setupAudioHelper(),this._setupPublisher(),a&&this._streamConnectedPromise&&this._setupStream(),"undefined"!=typeof window&&"function"==typeof window.addEventListener&&this._options.closeProtection&&(window.removeEventListener("beforeunload",this._boundConfirmClose),window.addEventListener("beforeunload",this._boundConfirmClose))},t.prototype.updateToken=function(e){if(this.state===t.State.Destroyed)throw new f.InvalidStateError('Attempt to "updateToken" when device is in state "'+this.state+'".');if("string"!=typeof e)throw new f.InvalidArgumentError('Parameter "token" must be of type "string".');this._token=e,this._stream&&this._stream.setToken(this._token),this._publisher&&this._publisher.setToken(this._token)},t.prototype._confirmClose=function(e){if(!this._activeCall)return"";var t=this._options.closeProtection||!1,n="string"!=typeof t?"A call is currently in-progress. Leaving or reloading this page will end the call.":t;return(e||window.event).returnValue=n,n},t.prototype._destroyAudioHelper=function(){this._audio&&(this._audio.removeAllListeners(),this._audio=null)},t.prototype._destroyPublisher=function(){this._publisher&&(this._publisher=null)},t.prototype._destroyStream=function(){this._stream&&(this._stream.destroy(),this._stream=null),this._streamConnectedPromise=null},t.prototype._findCall=function(e){return this._calls.find(function(t){return t.parameters.CallSid===e||t.outboundConnectionId===e})||null},t.prototype._makeCall=function(e,n){return a(this,void 0,void 0,function(){var r,i,o,a=this;return s(this,function(s){switch(s.label){case 0:if(void 0===t._isUnifiedPlanDefault)throw new f.InvalidStateError("Device has not been initialized.");return i={audioHelper:this._audio,getUserMedia:S,isUnifiedPlanDefault:t._isUnifiedPlanDefault},[4,this._streamConnectedPromise||this._setupStream()];case 1:return i.pstream=s.sent(),i.publisher=this._publisher,i.soundcache=this._soundcache,r=i,n=Object.assign({MediaStream:this._options.MediaStream||w.PeerConnection,beforeAccept:function(e){a._activeCall&&a._activeCall!==e&&(a._activeCall.disconnect(),a._removeCall(a._activeCall))},codecPreferences:this._options.codecPreferences,dialtonePlayer:t._dialtonePlayer,dscp:this._options.dscp,forceAggressiveIceNomination:this._options.forceAggressiveIceNomination,getInputStream:function(){return a._options.fileInputStream||a._callInputStream},getSinkIds:function(){return a._callSinkIds},maxAverageBitrate:this._options.maxAverageBitrate,preflight:this._options.preflight,rtcConstraints:this._options.rtcConstraints,shouldPlayDisconnect:function(){return a._enabledSounds.disconnect},twimlParams:e},n),(o=new(this._options.Call||d.default)(r,n)).once("accept",function(){a._removeCall(o),a._activeCall=o,a._audio&&a._audio._maybeStartPollingVolume(),o.direction===d.default.CallDirection.Outgoing&&a._enabledSounds.outgoing&&a._soundcache.get(t.SoundName.Outgoing).play();var e={edge:a._edge||a._region};a._options.edge&&(e.selected_edge=Array.isArray(a._options.edge)?a._options.edge:[a._options.edge]),a._publisher.info("settings","edge",e,o)}),o.addListener("error",function(e){"closed"===o.status()&&a._removeCall(o),a._audio&&a._audio._maybeStopPollingVolume(),a._maybeStopIncomingSound()}),o.once("cancel",function(){a._log.info("Canceled: "+o.parameters.CallSid),a._removeCall(o),a._audio&&a._audio._maybeStopPollingVolume(),a._maybeStopIncomingSound()}),o.once("disconnect",function(){a._audio&&a._audio._maybeStopPollingVolume(),a._removeCall(o)}),o.once("reject",function(){a._log.info("Rejected: "+o.parameters.CallSid),a._audio&&a._audio._maybeStopPollingVolume(),a._removeCall(o),a._maybeStopIncomingSound()}),o.once("transportClose",function(){o.status()===d.default.State.Pending&&(a._audio&&a._audio._maybeStopPollingVolume(),a._removeCall(o),a._maybeStopIncomingSound())}),[2,o]}})})},t.prototype._maybeStopIncomingSound=function(){this._calls.length||this._soundcache.get(t.SoundName.Incoming).stop()},t.prototype._removeCall=function(e){this._activeCall===e&&(this._activeCall=null);for(var t=this._calls.length-1;t>=0;t--)e===this._calls[t]&&this._calls.splice(t,1)},t.prototype._sendPresence=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this._streamConnectedPromise];case 1:return(t=n.sent())?(t.register({audio:e}),e?this._startRegistrationTimer():this._stopRegistrationTimer(),[2]):[2]}})})},t.prototype._setState=function(e){e!==this.state&&(this._state=e,this.emit(this._stateEventMapping[e]))},t.prototype._setupAudioHelper=function(){var e=this;this._audio&&(this._log.info("Found existing audio helper; destroying..."),this._destroyAudioHelper()),this._audio=new(this._options.AudioHelper||l.default)(this._updateSinkIds,this._updateInputStream,S,{audioContext:t.audioContext,enabledSounds:this._enabledSounds}),this._audio.on("deviceChange",function(t){var n=e._activeCall,r=t.map(function(e){return e.deviceId});e._publisher.info("audio","device-change",{lost_active_device_ids:r},n),n&&n._mediaHandler._onInputDevicesChanged()})},t.prototype._setupPublisher=function(){var e=this;return this._publisher&&(this._log.info("Found existing publisher; destroying..."),this._destroyPublisher()),this._publisher=(this._options.Publisher||y)("twilio-js-sdk",this.token,{defaultPayload:this._createDefaultPayload,host:this._options.eventgw,metadata:{app_name:this._options.appName,app_version:this._options.appVersion}}),!1===this._options.publishEvents?this._publisher.disable():this._publisher.on("error",function(t){e._log.warn("Cannot connect to insights.",t)}),this._publisher},t.prototype._setupStream=function(){var e=this;return this._stream&&(this._log.info("Found existing stream; destroying..."),this._destroyStream()),this._log.info("Setting up VSP"),this._stream=(this._options.PStream||b)(this.token,this._chunderURIs,{backoffMaxMs:this._options.backoffMaxMs}),this._stream.addListener("close",this._onSignalingClose),this._stream.addListener("connected",this._onSignalingConnected),this._stream.addListener("error",this._onSignalingError),this._stream.addListener("invite",this._onSignalingInvite),this._stream.addListener("offline",this._onSignalingOffline),this._stream.addListener("ready",this._onSignalingReady),this._streamConnectedPromise=new Promise(function(t){return e._stream.once("connected",function(){t(e._stream)})})},t.prototype._showIncomingCall=function(e,n){var r,i=this;return Promise.race([n(),new Promise(function(e,t){r=setTimeout(function(){t(new Error("Playing incoming ringtone took too long; it might not play. Continuing execution..."))},2e3)})]).catch(function(e){i._log.info(e.message)}).then(function(){clearTimeout(r),i.emit(t.EventName.Incoming,e)})},t.prototype._startRegistrationTimer=function(){var e=this;this._stopRegistrationTimer(),this._regTimer=setTimeout(function(){e._sendPresence(!0)},3e4)},t.prototype._stopRegistrationTimer=function(){this._regTimer&&clearTimeout(this._regTimer)},t.prototype._throwIfDestroyed=function(){if(this.state===t.State.Destroyed)throw new f.InvalidStateError("Device has been destroyed.")},t.prototype._updateRingtoneSinkIds=function(e){return Promise.resolve(this._soundcache.get(t.SoundName.Incoming).setSinkIds(e))},t.prototype._updateSpeakerSinkIds=function(e){Array.from(this._soundcache.entries()).filter(function(e){return e[0]!==t.SoundName.Incoming}).forEach(function(t){return t[1].setSinkIds(e)}),this._callSinkIds=e;var n=this._activeCall;return n?n._setSinkIds(e):Promise.resolve()},t._defaultSounds={disconnect:{filename:"disconnect",maxDuration:3e3},dtmf0:{filename:"dtmf-0",maxDuration:1e3},dtmf1:{filename:"dtmf-1",maxDuration:1e3},dtmf2:{filename:"dtmf-2",maxDuration:1e3},dtmf3:{filename:"dtmf-3",maxDuration:1e3},dtmf4:{filename:"dtmf-4",maxDuration:1e3},dtmf5:{filename:"dtmf-5",maxDuration:1e3},dtmf6:{filename:"dtmf-6",maxDuration:1e3},dtmf7:{filename:"dtmf-7",maxDuration:1e3},dtmf8:{filename:"dtmf-8",maxDuration:1e3},dtmf9:{filename:"dtmf-9",maxDuration:1e3},dtmfh:{filename:"dtmf-hash",maxDuration:1e3},dtmfs:{filename:"dtmf-star",maxDuration:1e3},incoming:{filename:"incoming",shouldLoop:!0},outgoing:{filename:"outgoing",maxDuration:3e3}},t}(c.EventEmitter);!function(e){!function(e){e.Error="error",e.Incoming="incoming",e.Destroyed="destroyed",e.Unregistered="unregistered",e.Registering="registering",e.Registered="registered"}(e.EventName||(e.EventName={})),function(e){e.Destroyed="destroyed",e.Unregistered="unregistered",e.Registering="registering",e.Registered="registered"}(e.State||(e.State={})),function(e){e.Incoming="incoming",e.Outgoing="outgoing",e.Disconnect="disconnect",e.Dtmf0="dtmf0",e.Dtmf1="dtmf1",e.Dtmf2="dtmf2",e.Dtmf3="dtmf3",e.Dtmf4="dtmf4",e.Dtmf5="dtmf5",e.Dtmf6="dtmf6",e.Dtmf7="dtmf7",e.Dtmf8="dtmf8",e.Dtmf9="dtmf9",e.DtmfS="dtmfs",e.DtmfH="dtmfh"}(e.SoundName||(e.SoundName={}))}(E||(E={})),n.default=E},{"./audiohelper":5,"./call":6,"./constants":7,"./dialtonePlayer":10,"./errors":12,"./eventpublisher":14,"./log":15,"./preflight/preflight":17,"./pstream":18,"./regions":19,"./rtc":23,"./rtc/getusermedia":21,"./sound":33,"./util":35,events:48,loglevel:49}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./errors"),i={dtmf0:[1360,960],dtmf1:[1230,720],dtmf2:[1360,720],dtmf3:[1480,720],dtmf4:[1230,790],dtmf5:[1360,790],dtmf6:[1480,790],dtmf7:[1230,870],dtmf8:[1360,870],dtmf9:[1480,870],dtmfh:[1480,960],dtmfs:[1230,960]},o=function(){function e(e){var t=this;this._context=e,this._gainNodes=[],this._gainNodes=[this._context.createGain(),this._context.createGain()],this._gainNodes.forEach(function(e){e.connect(t._context.destination),e.gain.value=.1,t._gainNodes.push(e)})}return e.prototype.cleanup=function(){this._gainNodes.forEach(function(e){e.disconnect()})},e.prototype.play=function(e){var t=this,n=i[e];if(!n)throw new r.InvalidArgumentError("Invalid DTMF sound name");[this._context.createOscillator(),this._context.createOscillator()].forEach(function(e,r){e.type="sine",e.frequency.value=n[r],e.connect(t._gainNodes[r]),e.start(),e.stop(t._context.currentTime+.1),e.addEventListener("ended",function(){return e.disconnect()})})},e}();n.default=o},{"./errors":12}],11:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a,s,c,u,l,d=e("./twilioError");n.TwilioError=d.default,function(e){var t=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=20101,i.description="Invalid access token",i.explanation="Twilio was unable to validate your Access Token",i.name="AccessTokenInvalid",i.solutions=[],Object.setPrototypeOf(i,e.AccessTokenInvalid.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.AccessTokenInvalid=t;var n=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=20104,i.description="Access token expired or expiration date invalid",i.explanation="The Access Token provided to the Twilio API has expired, the expiration time specified in the token was invalid, or the expiration time specified was too far in the future",i.name="AccessTokenExpired",i.solutions=[],Object.setPrototypeOf(i,e.AccessTokenExpired.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.AccessTokenExpired=n;var r=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=20151,i.description="Authentication Failed",i.explanation="The Authentication with the provided JWT failed",i.name="AuthenticationFailed",i.solutions=[],Object.setPrototypeOf(i,e.AuthenticationFailed.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.AuthenticationFailed=r}(o=n.AuthorizationErrors||(n.AuthorizationErrors={})),function(e){var t=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=31400,i.description="Bad Request (HTTP/SIP)",i.explanation="The request could not be understood due to malformed syntax.",i.name="BadRequest",i.solutions=[],Object.setPrototypeOf(i,e.BadRequest.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.BadRequest=t}(a=n.ClientErrors||(n.ClientErrors={})),function(e){var t=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=31e3,i.description="Unknown Error",i.explanation="An unknown error has occurred. See error details for more information.",i.name="UnknownError",i.solutions=[],Object.setPrototypeOf(i,e.UnknownError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.UnknownError=t;var n=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=31005,i.description="Connection error",i.explanation="A connection error occurred during the call",i.name="ConnectionError",i.solutions=[],Object.setPrototypeOf(i,e.ConnectionError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.ConnectionError=n;var r=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=["The incoming call was cancelled because it was not answered in time or it was accepted/rejected by another application instance registered with the same identity."],i.code=31008,i.description="Call cancelled",i.explanation="Unable to answer because the call has ended",i.name="CallCancelledError",i.solutions=[],Object.setPrototypeOf(i,e.CallCancelledError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.CallCancelledError=r;var o=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=31009,i.description="Transport error",i.explanation="No transport available to send or receive messages",i.name="TransportError",i.solutions=[],Object.setPrototypeOf(i,e.TransportError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.TransportError=o}(s=n.GeneralErrors||(n.GeneralErrors={})),function(e){var t=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=["The user denied the getUserMedia request.","The browser denied the getUserMedia request."],i.code=31401,i.description="UserMedia Permission Denied Error",i.explanation="The browser or end-user denied permissions to user media. Therefore we were unable to acquire input audio.",i.name="PermissionDeniedError",i.solutions=["The user should accept the request next time prompted. If the browser saved the deny, the user should change that permission in their browser.","The user should to verify that the browser has permission to access the microphone at this address."],Object.setPrototypeOf(i,e.PermissionDeniedError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.PermissionDeniedError=t;var n=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=["NotFoundError - The deviceID specified was not found.","The getUserMedia constraints were overconstrained and no devices matched."],i.code=31402,i.description="UserMedia Acquisition Failed Error",i.explanation="The browser and end-user allowed permissions, however getting the media failed. Usually this is due to bad constraints, but can sometimes fail due to browser, OS or hardware issues.",i.name="AcquisitionFailedError",i.solutions=["Ensure the deviceID being specified exists.","Try acquiring media with fewer constraints."],Object.setPrototypeOf(i,e.AcquisitionFailedError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.AcquisitionFailedError=n}(c=n.UserMediaErrors||(n.UserMediaErrors={})),function(e){var t=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=[],i.code=53e3,i.description="Signaling connection error",i.explanation="Raised whenever a signaling connection error occurs that is not covered by a more specific error code.",i.name="ConnectionError",i.solutions=[],Object.setPrototypeOf(i,e.ConnectionError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.ConnectionError=t;var n=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=["The device running your application lost its Internet connection."],i.code=53001,i.description="Signaling connection disconnected",i.explanation="Raised whenever the signaling connection is unexpectedly disconnected.",i.name="ConnectionDisconnected",i.solutions=["Ensure the device running your application has access to a stable Internet connection."],Object.setPrototypeOf(i,e.ConnectionDisconnected.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.ConnectionDisconnected=n}(u=n.SignalingErrors||(n.SignalingErrors={})),function(e){var t=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=["The Client may not be using a supported WebRTC implementation.","The Client may not have the necessary resources to create or apply a new media description."],i.code=53400,i.description="Client is unable to create or apply a local media description",i.explanation="Raised whenever a Client is unable to create or apply a local media description.",i.name="ClientLocalDescFailed",i.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(i,e.ClientLocalDescFailed.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.ClientLocalDescFailed=t;var n=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=["The Client may not be using a supported WebRTC implementation.","The Client may be connecting peer-to-peer with another Participant that is not using a supported WebRTC implementation.","The Client may not have the necessary resources to apply a new media description."],i.code=53402,i.description="Client is unable to apply a remote media description",i.explanation="Raised whenever the Client receives a remote media description but is unable to apply it.",i.name="ClientRemoteDescFailed",i.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(i,e.ClientRemoteDescFailed.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.ClientRemoteDescFailed=n;var r=function(t){function n(n,r){var i=t.call(this,n,r)||this;i.causes=["The Client was unable to establish a media connection.","A media connection which was active failed liveliness checks."],i.code=53405,i.description="Media connection failed",i.explanation="Raised by the Client or Server whenever a media connection fails.",i.name="ConnectionError",i.solutions=["If the problem persists, try connecting to another region.","Check your Client's network connectivity.","If you've provided custom ICE Servers then ensure that the URLs and credentials are valid."],Object.setPrototypeOf(i,e.ConnectionError.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(n,t),n}(d.default);e.ConnectionError=r}(l=n.MediaErrors||(n.MediaErrors={})),n.errorsByCode=new Map([[20101,o.AccessTokenInvalid],[20104,o.AccessTokenExpired],[20151,o.AuthenticationFailed],[31400,a.BadRequest],[31e3,s.UnknownError],[31005,s.ConnectionError],[31008,s.CallCancelledError],[31009,s.TransportError],[31401,c.PermissionDeniedError],[31402,c.AcquisitionFailedError],[53e3,u.ConnectionError],[53001,u.ConnectionDisconnected],[53400,l.ClientLocalDescFailed],[53402,l.ClientRemoteDescFailed],[53405,l.ConnectionError]]),Object.freeze(n.errorsByCode)},{"./twilioError":13}],12:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("./generated");n.AuthorizationErrors=o.AuthorizationErrors,n.ClientErrors=o.ClientErrors,n.GeneralErrors=o.GeneralErrors,n.MediaErrors=o.MediaErrors,n.SignalingErrors=o.SignalingErrors,n.TwilioError=o.TwilioError,n.UserMediaErrors=o.UserMediaErrors;var a=function(e){function t(t){var n=e.call(this,t)||this;return n.name="InvalidArgumentError",n}return i(t,e),t}(Error);n.InvalidArgumentError=a;var s=function(e){function t(t){var n=e.call(this,t)||this;return n.name="InvalidStateError",n}return i(t,e),t}(Error);n.InvalidStateError=s;var c=function(e){function t(t){var n=e.call(this,t)||this;return n.name="NotSupportedError",n}return i(t,e),t}(Error);n.NotSupportedError=c,n.getErrorByCode=function(e){var t=o.errorsByCode.get(e);if(!t)throw new a("Error code "+e+" not found");return t},n.hasErrorByCode=function(e){return o.errorsByCode.has(e)}},{"./generated":11}],13:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(n,r){var i=e.call(this)||this;Object.setPrototypeOf(i,t.prototype);var o="string"==typeof n?n:i.explanation,a="object"==typeof n?n:r;return i.message=i.name+" ("+i.code+"): "+o,i.originalError=a,i}return i(t,e),t}(Error);n.default=o},{}],14:[function(e,t,n){"use strict";var r=e("events").EventEmitter,i=e("./request");function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);var r=(n=Object.assign({defaultPayload:function(){return{}},host:"eventgw.twilio.com"},n)).defaultPayload;"function"!=typeof r&&(r=function(){return Object.assign({},n.defaultPayload)});var a=!0,s=Object.assign({app_name:void 0,app_version:void 0},n.metadata);Object.defineProperties(this,{_defaultPayload:{value:r},_isEnabled:{get:function(){return a},set:function(e){a=e}},_host:{value:n.host},_request:{value:n.request||i,writable:!0},_token:{value:t,writable:!0},isEnabled:{enumerable:!0,get:function(){return a}},metadata:{enumerable:!0,get:function(){return s}},productName:{enumerable:!0,value:e},token:{enumerable:!0,get:function(){return this._token}}})}function a(e){return{timestamp:new Date(e.timestamp).toISOString(),total_packets_received:e.totals.packetsReceived,total_packets_lost:e.totals.packetsLost,total_packets_sent:e.totals.packetsSent,total_bytes_received:e.totals.bytesReceived,total_bytes_sent:e.totals.bytesSent,packets_received:e.packetsReceived,packets_lost:e.packetsLost,packets_lost_fraction:e.packetsLostFraction&&Math.round(100*e.packetsLostFraction)/100,bytes_received:e.bytesReceived,bytes_sent:e.bytesSent,audio_codec:e.codecName,audio_level_in:e.audioInputLevel,audio_level_out:e.audioOutputLevel,call_volume_input:e.inputVolume,call_volume_output:e.outputVolume,jitter:e.jitter,rtt:e.rtt,mos:e.mos&&Math.round(100*e.mos)/100}}e("util").inherits(o,r),o.prototype._post=function(e,t,n,r,i,o,a){var s=this;if(!this.isEnabled&&!a)return Promise.resolve();if(!(o&&(o.parameters&&o.parameters.CallSid||o.outboundConnectionId)))return Promise.resolve();var c={publisher:this.productName,group:n,name:r,timestamp:(new Date).toISOString(),level:t.toUpperCase(),payload_type:"application/json",private:!1,payload:i&&i.forEach?i.slice(0):Object.assign(this._defaultPayload(o),i)};this.metadata&&(c.publisher_metadata=this.metadata);var u={url:"https://"+this._host+"/v4/"+e,body:c,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token}},l=this;return new Promise(function(e,t){l._request.post(u,function(n){n?(s.emit("error",n),t(n)):e()})})},o.prototype.post=function(e,t,n,r,i,o){return this._post("EndpointEvents",e,t,n,r,i,o)},o.prototype.debug=function(e,t,n,r){return this.post("debug",e,t,n,r)},o.prototype.info=function(e,t,n,r){return this.post("info",e,t,n,r)},o.prototype.warn=function(e,t,n,r){return this.post("warning",e,t,n,r)},o.prototype.error=function(e,t,n,r){return this.post("error",e,t,n,r)},o.prototype.postMetrics=function(e,t,n,r,i){var o=this;return new Promise(function(s){var c=n.map(a).map(function(e){return Object.assign(e,r)});s(o._post("EndpointMetrics","info",e,t,c,i))})},o.prototype.setToken=function(e){this._token=e},o.prototype.enable=function(){this._isEnabled=!0},o.prototype.disable=function(){this._isEnabled=!1},t.exports=o},{"./request":20,events:48,util:60}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("loglevel"),i=e("./constants"),o=function(){function e(e){this._log=(e&&e.LogLevelModule?e.LogLevelModule:r).getLogger(i.PACKAGE_NAME)}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).debug.apply(e,t)},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).error.apply(e,t)},e.prototype.getLogLevelInstance=function(){return this._log},e.prototype.info=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).info.apply(e,t)},e.prototype.setDefaultLevel=function(e){this._log.setDefaultLevel(e)},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).warn.apply(e,t)},e.levels=r.levels,e}();n.Logger=o.getInstance().getLogLevelInstance(),n.default=o},{"./constants":7,loglevel:49}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./constants"),i=e("./errors"),o=r.SOUNDS_BASE_URL+"/outgoing.mp3",a=function(){function e(e,t,n,r){this._name=e,this._availableDevices=t,this._beforeChange=n,this._isSupported=r,this._activeDevices=new Set}return e.prototype.delete=function(e){var t=!!this._activeDevices.delete(e),n=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&n&&this._activeDevices.add(n);var r=Array.from(this._activeDevices.values()).map(function(e){return e.deviceId});return this._beforeChange(this._name,r),!!t},e.prototype.get=function(){return this._activeDevices},e.prototype.set=function(e){var t=this;if(!this._isSupported)return Promise.reject(new i.NotSupportedError("This browser does not support audio output selection"));var n=Array.isArray(e)?e:[e];if(!n.length)return Promise.reject(new i.InvalidArgumentError("Must specify at least one device to set"));var r=[],o=n.map(function(e){var n=t._availableDevices.get(e);return n||r.push(e),n});return r.length?Promise.reject(new i.InvalidArgumentError("Devices not found: "+r.join(", "))):new Promise(function(e){e(t._beforeChange(t._name,n))}).then(function(){t._activeDevices.clear(),o.forEach(t._activeDevices.add,t._activeDevices)})},e.prototype.test=function(e){return void 0===e&&(e=o),this._isSupported?this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map(function(t){var n;return new Promise(function(t){(n=new Audio(e)).oncanplay=t}).then(function(){return n.setSinkId(t.deviceId).then(function(){return n.play()})})})):Promise.reject(new i.InvalidStateError("No active output devices to test")):Promise.reject(new i.NotSupportedError("This browser does not support audio output selection"))},e}();n.default=a},{"./constants":7,"./errors":12}],17:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("events"),u=e("../call"),l=e("../device"),d=e("../errors"),p=e("../rtc/stats"),f=e("../constants"),h=f.COWBELL_AUDIO_URL,m=f.ECHO_TEST_DURATION,g=function(e){function t(n,r){var i=e.call(this)||this;return i._hasInsightsErrored=!1,i._networkTiming={},i._options={codecPreferences:[u.default.Codec.PCMU,u.default.Codec.Opus],edge:"roaming",fakeMicInput:!1,logLevel:"error",signalingTimeoutMs:1e4},i._status=t.Status.Connecting,Object.assign(i._options,r),i._samples=[],i._warnings=[],i._startTime=Date.now(),i._initDevice(n,o(o({},i._options),{fileInputStream:i._options.fakeMicInput?i._getStreamFromFile():void 0})),i}return i(t,e),t.prototype.stop=function(){var e=this,t=new d.GeneralErrors.CallCancelledError;this._device?(this._device.once(l.default.EventName.Unregistered,function(){return e._onFailed(t)}),this._device.destroy()):this._onFailed(t)},t.prototype._emitWarning=function(e,n,r){var i={name:e,description:n};r&&(i.rtcWarning=r),this._warnings.push(i),this.emit(t.Events.Warning,i)},t.prototype._getCallQuality=function(e){return e>4.2?t.CallQuality.Excellent:e>=4.1&&e<=4.2?t.CallQuality.Great:e>=3.7&&e<=4?t.CallQuality.Good:e>=3.1&&e<=3.6?t.CallQuality.Fair:t.CallQuality.Degraded},t.prototype._getReport=function(){var e=this._getRTCStats(),t={start:this._startTime};this._endTime&&(t.end=this._endTime,t.duration=this._endTime-this._startTime);var n={callSid:this._callSid,edge:this._edge,iceCandidateStats:this._rtcIceCandidateStatsReport.iceCandidateStats,networkTiming:this._networkTiming,samples:this._samples,selectedEdge:this._options.edge,stats:e,testTiming:t,totals:this._getRTCSampleTotals(),warnings:this._warnings},r=this._rtcIceCandidateStatsReport.selectedIceCandidatePairStats;return r&&(n.selectedIceCandidatePairStats=r,n.isTurnRequired="relay"===r.localCandidate.candidateType||"relay"===r.remoteCandidate.candidateType),e&&(n.callQuality=this._getCallQuality(e.mos.average)),n},t.prototype._getRTCSampleTotals=function(){if(this._latestSample)return o({},this._latestSample.totals)},t.prototype._getRTCStats=function(){var e=this._samples.findIndex(function(e){return"number"==typeof e.mos&&e.mos>0}),t=e>=0?this._samples.slice(e):[];if(t&&t.length)return["jitter","mos","rtt"].reduce(function(e,n){var r,i=t.map(function(e){return e[n]});return o(o({},e),((r={})[n]={average:Number((i.reduce(function(e,t){return e+t})/i.length).toPrecision(5)),max:Math.max.apply(Math,i),min:Math.min.apply(Math,i)},r))},{})},t.prototype._getStreamFromFile=function(){var e=this._options.audioContext;if(!e)throw new d.NotSupportedError("Cannot fake input audio stream: AudioContext is not supported by this browser.");var t=new Audio(h);t.addEventListener("canplaythrough",function(){return t.play()}),"function"==typeof t.setAttribute&&t.setAttribute("crossorigin","anonymous");var n=e.createMediaElementSource(t),r=e.createMediaStreamDestination();return n.connect(r),r.stream},t.prototype._initDevice=function(e,t){var n=this;try{this._device=new(t.deviceFactory||l.default)(e,{codecPreferences:t.codecPreferences,edge:t.edge,fileInputStream:t.fileInputStream,logLevel:t.logLevel,preflight:!0}),this._device.once(l.default.EventName.Registered,function(){n._onDeviceRegistered()}),this._device.once(l.default.EventName.Error,function(e){n._onDeviceError(e)}),this._device.register()}catch(e){return void setTimeout(function(){n._onFailed(e)})}this._signalingTimeoutTimer=setTimeout(function(){n._onDeviceError(new d.SignalingErrors.ConnectionError("WebSocket Connection Timeout"))},t.signalingTimeoutMs)},t.prototype._onDeviceError=function(e){this._device.destroy(),this._onFailed(e)},t.prototype._onDeviceRegistered=function(){return a(this,void 0,void 0,function(){var e,t,n=this;return s(this,function(r){switch(r.label){case 0:return clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),e=this,[4,this._device.connect({rtcConfiguration:this._options.rtcConfiguration})];case 1:return e._call=r.sent(),this._networkTiming.signaling={start:Date.now()},this._setupCallHandlers(this._call),this._edge=this._device.edge||void 0,this._options.fakeMicInput&&(this._echoTimer=setTimeout(function(){return n._device.disconnectAll()},m),(t=this._device.audio)&&(t.disconnect(!1),t.outgoing(!1))),this._call.once("disconnect",function(){n._device.once(l.default.EventName.Unregistered,function(){return n._onUnregistered()}),n._device.destroy()}),this._call._publisher.on("error",function(){n._hasInsightsErrored||n._emitWarning("insights-connection-error","Received an error when attempting to connect to Insights gateway"),n._hasInsightsErrored=!0}),[2]}})})},t.prototype._onFailed=function(e){clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),this._releaseHandlers(),this._endTime=Date.now(),this._status=t.Status.Failed,this.emit(t.Events.Failed,e)},t.prototype._onUnregistered=function(){var e=this;setTimeout(function(){e._status!==t.Status.Failed&&(clearTimeout(e._echoTimer),clearTimeout(e._signalingTimeoutTimer),e._releaseHandlers(),e._endTime=Date.now(),e._status=t.Status.Completed,e._report=e._getReport(),e.emit(t.Events.Completed,e._report))},10)},t.prototype._releaseHandlers=function(){[this._device,this._call].forEach(function(e){e&&e.eventNames().forEach(function(t){return e.removeAllListeners(t)})})},t.prototype._setupCallHandlers=function(e){var n=this;this._options.fakeMicInput&&e.once("volume",function(){e._mediaHandler.outputs.forEach(function(e){return e.audio.muted=!0})}),e.on("warning",function(e,t){n._emitWarning(e,"Received an RTCWarning. See .rtcWarning for the RTCWarning",t)}),e.once("accept",function(){n._callSid=e._mediaHandler.callSid,n._status=t.Status.Connected,n.emit(t.Events.Connected)}),e.on("sample",function(r){return a(n,void 0,void 0,function(){var n;return s(this,function(i){switch(i.label){case 0:return this._latestSample?[3,2]:(n=this,[4,(this._options.getRTCIceCandidateStatsReport||p.getRTCIceCandidateStatsReport)(e._mediaHandler.version.pc)]);case 1:n._rtcIceCandidateStatsReport=i.sent(),i.label=2;case 2:return this._latestSample=r,this._samples.push(r),this.emit(t.Events.Sample,r),[2]}})})}),[{reportLabel:"peerConnection",type:"pcconnection"},{reportLabel:"ice",type:"iceconnection"},{reportLabel:"dtls",type:"dtlstransport"},{reportLabel:"signaling",type:"signaling"}].forEach(function(t){var r=t.type,i=t.reportLabel,o="on"+r+"statechange",a=e._mediaHandler[o];e._mediaHandler[o]=function(e){var t=n._networkTiming[i]=n._networkTiming[i]||{start:0};"connecting"===e||"checking"===e?t.start=Date.now():"connected"!==e&&"stable"!==e||t.duration||(t.end=Date.now(),t.duration=t.end-t.start),a(e)}})},Object.defineProperty(t.prototype,"callSid",{get:function(){return this._callSid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this._endTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latestSample",{get:function(){return this._latestSample},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),t}(c.EventEmitter);n.PreflightTest=g,function(e){!function(e){e.Excellent="excellent",e.Great="great",e.Good="good",e.Fair="fair",e.Degraded="degraded"}(e.CallQuality||(e.CallQuality={})),function(e){e.Completed="completed",e.Connected="connected",e.Failed="failed",e.Sample="sample",e.Warning="warning"}(e.Events||(e.Events={})),function(e){e.Connecting="connecting",e.Connected="connected",e.Completed="completed",e.Failed="failed"}(e.Status||(e.Status={}))}(g=n.PreflightTest||(n.PreflightTest={})),n.PreflightTest=g},{"../call":6,"../constants":7,"../device":9,"../errors":12,"../rtc/stats":29,events:48}],18:[function(e,t,n){"use strict";var r=e("./constants"),i=e("events").EventEmitter,o=e("./log").default,a=e("util"),s=e("./wstransport").default,c=e("./errors"),u=c.GeneralErrors,l=c.SignalingErrors;function d(e,t,n){if(!(this instanceof d))return new d(e,t,n);var r={TransportFactory:s};for(var i in n=n||{},r)i in n||(n[i]=r[i]);this.options=n,this.token=e||"",this.status="disconnected",this.gateway=null,this.region=null,this._messageQueue=[],this._uris=t,this._handleTransportClose=this._handleTransportClose.bind(this),this._handleTransportError=this._handleTransportError.bind(this),this._handleTransportMessage=this._handleTransportMessage.bind(this),this._handleTransportOpen=this._handleTransportOpen.bind(this),this._log=o.getInstance(),this.on("error",function(){});var a=this;return this.addListener("ready",function(){a.status="ready"}),this.addListener("offline",function(){a.status="offline"}),this.addListener("close",function(){a._log.info('Received "close" from server. Destroying PStream...'),a._destroy()}),this.transport=new this.options.TransportFactory(this._uris,{backoffMaxMs:this.options.backoffMaxMs}),Object.defineProperties(this,{uri:{enumerable:!0,get:function(){return this.transport.uri}}}),this.transport.on("close",this._handleTransportClose),this.transport.on("error",this._handleTransportError),this.transport.on("message",this._handleTransportMessage),this.transport.on("open",this._handleTransportOpen),this.transport.open(),this}a.inherits(d,i),d.prototype._handleTransportClose=function(){this.emit("transportClose"),"disconnected"!==this.status&&("offline"!==this.status&&this.emit("offline",this),this.status="disconnected")},d.prototype._handleTransportError=function(e){e?this.emit("error",void 0!==e.code?{error:e}:e):this.emit("error",{error:{code:31e3,message:"Websocket closed without a provided reason",twilioError:new l.ConnectionDisconnected}})},d.prototype._handleTransportMessage=function(e){if(e&&e.data&&"string"==typeof e.data){var t=JSON.parse(e.data),n=t.type,r=t.payload,i=void 0===r?{}:r;this.gateway=i.gateway||this.gateway,this.region=i.region||this.region,"error"===n&&i.error&&(i.error.twilioError=new l.ConnectionError),this.emit(n,i)}},d.prototype._handleTransportOpen=function(){var e=this;this.status="connected",this.setToken(this.token),this._messageQueue.splice(0,this._messageQueue.length).forEach(function(t){return e._publish.apply(e,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))})},d.toString=function(){return"[Twilio.PStream class]"},d.prototype.toString=function(){return"[Twilio.PStream instance]"},d.prototype.setToken=function(e){this._log.info("Setting token and publishing listen"),this.token=e;var t,n,i={token:e,browserinfo:(t="undefined"!=typeof navigator?navigator:{},n={p:"browser",v:r.RELEASE_VERSION,browser:{userAgent:t.userAgent||"unknown",platform:t.platform||"unknown"},plugin:"rtc"},n)};this._publish("listen",i)},d.prototype.register=function(e){var t={media:e};this._publish("register",t,!0)},d.prototype.invite=function(e,t,n,r){var i={callsid:t,sdp:e,preflight:!!n,twilio:r?{params:r}:{}};this._publish("invite",i,!0)},d.prototype.answer=function(e,t){this._publish("answer",{sdp:e,callsid:t},!0)},d.prototype.dtmf=function(e,t){this._publish("dtmf",{callsid:e,dtmf:t},!0)},d.prototype.hangup=function(e,t){var n=t?{callsid:e,message:t}:{callsid:e};this._publish("hangup",n,!0)},d.prototype.reject=function(e){this._publish("reject",{callsid:e},!0)},d.prototype.reinvite=function(e,t){this._publish("reinvite",{sdp:e,callsid:t},!1)},d.prototype._destroy=function(){this.transport.removeListener("close",this._handleTransportClose),this.transport.removeListener("error",this._handleTransportError),this.transport.removeListener("message",this._handleTransportMessage),this.transport.removeListener("open",this._handleTransportOpen),this.transport.close(),this.emit("offline",this)},d.prototype.destroy=function(){return this._log.info("PStream.destroy() called..."),this._destroy(),this},d.prototype.publish=function(e,t){return this._publish(e,t,!0)},d.prototype._publish=function(e,t,n){var r=JSON.stringify({type:e,version:"1.5",payload:t});!!this.transport.send(r)||(this.emit("error",{error:{code:31009,message:"No transport available to send or receive messages",twilioError:new u.TransportError}}),n&&this._messageQueue.push([e,t,!0]))},t.exports=d},{"./constants":7,"./errors":12,"./log":15,"./wstransport":36,events:48,util:60}],19:[function(e,t,n){"use strict";var r,i,o,a;Object.defineProperty(n,"__esModule",{value:!0});var s,c,u,l=e("./errors");!function(e){e.Au="au",e.Br="br",e.Ie="ie",e.Jp="jp",e.Sg="sg",e.UsOr="us-or",e.UsVa="us-va"}(s=n.DeprecatedRegion||(n.DeprecatedRegion={})),function(e){e.Sydney="sydney",e.SaoPaulo="sao-paulo",e.Dublin="dublin",e.Frankfurt="frankfurt",e.Tokyo="tokyo",e.Singapore="singapore",e.Ashburn="ashburn",e.Umatilla="umatilla",e.Roaming="roaming",e.AshburnIx="ashburn-ix",e.SanJoseIx="san-jose-ix",e.LondonIx="london-ix",e.FrankfurtIx="frankfurt-ix",e.SingaporeIx="singapore-ix",e.SydneyIx="sydney-ix",e.TokyoIx="tokyo-ix"}(c=n.Edge||(n.Edge={})),function(e){e.Au1="au1",e.Au1Ix="au1-ix",e.Br1="br1",e.De1="de1",e.De1Ix="de1-ix",e.Gll="gll",e.Ie1="ie1",e.Ie1Ix="ie1-ix",e.Ie1Tnx="ie1-tnx",e.Jp1="jp1",e.Jp1Ix="jp1-ix",e.Sg1="sg1",e.Sg1Ix="sg1-ix",e.Sg1Tnx="sg1-tnx",e.Us1="us1",e.Us1Ix="us1-ix",e.Us1Tnx="us1-tnx",e.Us2="us2",e.Us2Ix="us2-ix",e.Us2Tnx="us2-tnx"}(u=n.Region||(n.Region={})),n.deprecatedRegions=((r={})[s.Au]=u.Au1,r[s.Br]=u.Br1,r[s.Ie]=u.Ie1,r[s.Jp]=u.Jp1,r[s.Sg]=u.Sg1,r[s.UsOr]=u.Us1,r[s.UsVa]=u.Us1,r),n.regionShortcodes={ASIAPAC_SINGAPORE:u.Sg1,ASIAPAC_SYDNEY:u.Au1,ASIAPAC_TOKYO:u.Jp1,EU_FRANKFURT:u.De1,EU_IRELAND:u.Ie1,SOUTH_AMERICA_SAO_PAULO:u.Br1,US_EAST_VIRGINIA:u.Us1,US_WEST_OREGON:u.Us2};(i={})[u.Au1]="chunderw-vpc-gll-au1.twilio.com",i[u.Au1Ix]="chunderw-vpc-gll-au1-ix.twilio.com",i[u.Br1]="chunderw-vpc-gll-br1.twilio.com",i[u.De1]="chunderw-vpc-gll-de1.twilio.com",i[u.De1Ix]="chunderw-vpc-gll-de1-ix.twilio.com",i[u.Gll]="chunderw-vpc-gll.twilio.com",i[u.Ie1]="chunderw-vpc-gll-ie1.twilio.com",i[u.Ie1Ix]="chunderw-vpc-gll-ie1-ix.twilio.com",i[u.Ie1Tnx]="chunderw-vpc-gll-ie1-tnx.twilio.com",i[u.Jp1]="chunderw-vpc-gll-jp1.twilio.com",i[u.Jp1Ix]="chunderw-vpc-gll-jp1-ix.twilio.com",i[u.Sg1]="chunderw-vpc-gll-sg1.twilio.com",i[u.Sg1Ix]="chunderw-vpc-gll-sg1-ix.twilio.com",i[u.Sg1Tnx]="chunderw-vpc-gll-sg1-tnx.twilio.com",i[u.Us1]="chunderw-vpc-gll-us1.twilio.com",i[u.Us1Ix]="chunderw-vpc-gll-us1-ix.twilio.com",i[u.Us1Tnx]="chunderw-vpc-gll-us1-tnx.twilio.com",i[u.Us2]="chunderw-vpc-gll-us2.twilio.com",i[u.Us2Ix]="chunderw-vpc-gll-us2-ix.twilio.com",i[u.Us2Tnx]="chunderw-vpc-gll-us2-tnx.twilio.com";function d(e){return e===n.defaultRegion?n.defaultChunderRegionURI:"chunderw-vpc-gll-"+e+".twilio.com"}n.edgeToRegion=((o={})[c.Sydney]=u.Au1,o[c.SaoPaulo]=u.Br1,o[c.Dublin]=u.Ie1,o[c.Frankfurt]=u.De1,o[c.Tokyo]=u.Jp1,o[c.Singapore]=u.Sg1,o[c.Ashburn]=u.Us1,o[c.Umatilla]=u.Us2,o[c.Roaming]=u.Gll,o[c.AshburnIx]=u.Us1Ix,o[c.SanJoseIx]=u.Us2Ix,o[c.LondonIx]=u.Ie1Ix,o[c.FrankfurtIx]=u.De1Ix,o[c.SingaporeIx]=u.Sg1Ix,o[c.SydneyIx]=u.Au1Ix,o[c.TokyoIx]=u.Jp1Ix,o),n.regionToEdge=((a={})[u.Au1]=c.Sydney,a[u.Br1]=c.SaoPaulo,a[u.Ie1]=c.Dublin,a[u.De1]=c.Frankfurt,a[u.Jp1]=c.Tokyo,a[u.Sg1]=c.Singapore,a[u.Us1]=c.Ashburn,a[u.Us2]=c.Umatilla,a[u.Gll]=c.Roaming,a[u.Us1Ix]=c.AshburnIx,a[u.Us2Ix]=c.SanJoseIx,a[u.Ie1Ix]=c.LondonIx,a[u.De1Ix]=c.FrankfurtIx,a[u.Sg1Ix]=c.SingaporeIx,a[u.Au1Ix]=c.SydneyIx,a[u.Jp1Ix]=c.TokyoIx,a[u.Us1Tnx]=c.AshburnIx,a[u.Us2Tnx]=c.AshburnIx,a[u.Ie1Tnx]=c.LondonIx,a[u.Sg1Tnx]=c.SingaporeIx,a),n.defaultRegion="gll",n.defaultEdge=c.Roaming,n.defaultChunderRegionURI="chunderw-vpc-gll.twilio.com",n.getChunderURIs=function(e,t,r){if(t&&"string"!=typeof t)throw new l.InvalidArgumentError("If `region` is provided, it must be of type `string`.");if(e&&"string"!=typeof e&&!Array.isArray(e))throw new l.InvalidArgumentError("If `edge` is provided, it must be of type `string` or an array of strings.");var i,o=[];if(t&&e)throw new l.InvalidArgumentError("You cannot specify `region` when `edge` is specified in`Twilio.Device.Options`.");if(t){var a=t;if(o.push("Regions are deprecated in favor of edges. Please see this page for documentation: https://www.twilio.com/docs/voice/client/edges."),Object.values(s).includes(a)&&(a=n.deprecatedRegions[a]),Object.values(u).includes(a)){var p=n.regionToEdge[a];o.push('Region "'+a+'" is deprecated, please use `edge` "'+p+'".')}i=[d(a)]}else if(e){var f=Object.values(c);i=(Array.isArray(e)?e:[e]).map(function(e){return f.includes(e)?d(n.edgeToRegion[e]):"voice-js."+e+".twilio.com"})}else i=[n.defaultChunderRegionURI];return r&&o.length&&setTimeout(function(){return r(o.join("\n"))}),i},n.getRegionShortcode=function(e){return n.regionShortcodes[e]||null}},{"./errors":12}],20:[function(e,t,n){"use strict";var r=e("xmlhttprequest").XMLHttpRequest;var i=function(e,t,n){var i={};i.XMLHttpRequest=i.XMLHttpRequest||r;var o=new i.XMLHttpRequest;for(var a in o.open(e,t.url,!0),o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&o.status<300?n(null,o.responseText):n(new Error(o.responseText)))},t.headers)o.setRequestHeader(a,t.headers[a]);o.send(JSON.stringify(t.body))};i.get=function(e,t){return new this("GET",e,t)},i.post=function(e,t){return new this("POST",e,t)},t.exports=i},{xmlhttprequest:2}],21:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("../errors").NotSupportedError,o=e("../util");t.exports=function(e,t){return(t=t||{}).util=t.util||o,t.navigator=t.navigator||("undefined"!=typeof navigator?navigator:null),new Promise(function(n,o){if(!t.navigator)throw new i("getUserMedia is not supported");switch("function"){case r(t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia):return n(t.navigator.mediaDevices.getUserMedia(e));case r(t.navigator.webkitGetUserMedia):return t.navigator.webkitGetUserMedia(e,n,o);case r(t.navigator.mozGetUserMedia):return t.navigator.mozGetUserMedia(e,n,o);case r(t.navigator.getUserMedia):return t.navigator.getUserMedia(e,n,o);default:throw new i("getUserMedia is not supported")}}).catch(function(e){throw t.util.isFirefox()&&"NotReadableError"===e.name?new i("Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.\nRelated Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"):e})}},{"../errors":12,"../util":35}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){var n;void 0===t&&(t=!1),this.deleted=!1;var r=e.candidate.split("network-cost ");r[1]&&(n=parseInt(r[1],10)),this.candidateType=e.type,this.ip=e.ip||e.address,this.isRemote=t,this.networkCost=n,this.port=e.port,this.priority=e.priority,this.protocol=e.protocol,this.relatedAddress=e.relatedAddress,this.relatedPort=e.relatedPort,this.tcpType=e.tcpType,this.transportId=e.sdpMid}return e.prototype.toPayload=function(){return{candidate_type:this.candidateType,deleted:this.deleted,ip:this.ip,is_remote:this.isRemote,"network-cost":this.networkCost,port:this.port,priority:this.priority,protocol:this.protocol,related_address:this.relatedAddress,related_port:this.relatedPort,tcp_type:this.tcpType,transport_id:this.transportId}},e}();n.IceCandidate=r},{}],23:[function(e,t,n){"use strict";var r=e("./peerconnection"),i=e("./rtcpc").test;t.exports={enabled:function(){return i()},getMediaEngine:function(){return"undefined"!=typeof RTCIceGatherer?"ORTC":"WebRTC"},PeerConnection:r}},{"./peerconnection":26,"./rtcpc":27}],24:[function(e,t,n){var r=32767,i="undefined"!=typeof window?window.RTCStatsReport:void 0;function o(e){if(!(this instanceof o))return new o(e);var t=this;Object.defineProperties(this,{size:{enumerable:!0,get:function(){return t._map.size}},_map:{value:e}}),this[Symbol.iterator]=e[Symbol.iterator]}function a(e){return{type:"transport",id:e.id,timestamp:Date.parse(e.timestamp),bytesSent:void 0,bytesReceived:void 0,rtcpTransportStatsId:void 0,dtlsState:void 0,selectedCandidatePairId:e.stat("selectedCandidatePairId"),localCertificateId:e.stat("localCertificateId"),remoteCertificateId:e.stat("remoteCertificateId")}}function s(e,t){return{id:e.id,timestamp:Date.parse(e.timestamp),ssrc:e.stat("ssrc"),associateStatsId:void 0,isRemote:void 0,mediaType:e.stat("mediaType"),trackId:"track-"+e.id,transportId:e.stat("transportId"),codecId:"codec-"+e.id,firCount:t?d(e,"googFirsSent"):void 0,pliCount:d(e,t?"googPlisSent":"googPlisReceived"),nackCount:d(e,t?"googNacksSent":"googNacksReceived"),sliCount:void 0,qpSum:d(e,"qpSum")}}function c(e,t){return{type:t?"remote-candidate":"local-candidate",id:e.id,timestamp:Date.parse(e.timestamp),transportId:void 0,isRemote:t,ip:e.stat("ipAddress"),port:d(e,"portNumber"),protocol:e.stat("transport"),candidateType:l(e.stat("candidateType")),priority:p(e,"priority"),url:void 0,relayProtocol:void 0,deleted:void 0}}function u(e){return isNaN(e)||""===e?void 0:parseInt(e,10)/1e3}function l(e){switch(e){case"peerreflexive":return"prflx";case"serverreflexive":return"srflx";case"host":case"relay":default:return e}}function d(e,t){var n=e.stat(t);return h(e,t)?parseInt(n,10):void 0}function p(e,t){var n=e.stat(t);return h(e,t)?parseFloat(n):void 0}function f(e,t){var n=e.stat(t);return h(e,t)?"true"===n||!0===n:void 0}function h(e,t){var n=e.stat(t);return void 0!==n&&""!==n}i&&(o.prototype=Object.create(i.prototype),o.prototype.constructor=o),["entries","forEach","get","has","keys","values"].forEach(function(e){o.prototype[e]=function(){for(var t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return(t=this._map)[e].apply(t,n)}}),o.fromArray=function(e){return new o(e.reduce(function(e,t){return e.set(t.id,t),e},new Map))},o.fromRTCStatsResponse=function(e){var t,n=new Map,i=e.result().reduce(function(e,i){var o=i.id;switch(i.type){case"googCertificate":e.set(o,function(e){return{type:"certificate",id:e.id,timestamp:Date.parse(e.timestamp),fingerprint:e.stat("googFingerprint"),fingerprintAlgorithm:e.stat("googFingerprintAlgorithm"),base64Certificate:e.stat("googDerBase64"),issuerCertificateId:e.stat("googIssuerId")}}(i));break;case"datachannel":e.set(o,function(e){return{type:"data-channel",id:e.id,timestamp:Date.parse(e.timestamp),label:e.stat("label"),protocol:e.stat("protocol"),datachannelid:e.stat("datachannelid"),transportId:e.stat("transportId"),state:e.stat("state"),messagesSent:void 0,bytesSent:void 0,messagesReceived:void 0,bytesReceived:void 0}}(i));break;case"googCandidatePair":f(i,"googActiveConnection")&&(t=o),e.set(o,function(e){return{type:"candidate-pair",id:e.id,timestamp:Date.parse(e.timestamp),transportId:e.stat("googChannelId"),localCandidateId:e.stat("localCandidateId"),remoteCandidateId:e.stat("remoteCandidateId"),state:void 0,priority:void 0,nominated:void 0,writable:f(e,"googWritable"),readable:void 0,bytesSent:d(e,"bytesSent"),bytesReceived:d(e,"bytesReceived"),lastPacketSentTimestamp:void 0,lastPacketReceivedTimestamp:void 0,totalRoundTripTime:void 0,currentRoundTripTime:u(e.stat("googRtt")),availableOutgoingBitrate:void 0,availableIncomingBitrate:void 0,requestsReceived:d(e,"requestsReceived"),requestsSent:d(e,"requestsSent"),responsesReceived:d(e,"responsesReceived"),responsesSent:d(e,"responsesSent"),retransmissionsReceived:void 0,retransmissionsSent:void 0,consentRequestsSent:d(e,"consentRequestsSent")}}(i));break;case"localcandidate":e.set(o,c(i,!1));break;case"remotecandidate":e.set(o,c(i,!0));break;case"ssrc":h(i,"packetsReceived")?e.set("rtp-"+o,function(e){var t=s(e,!0);return Object.assign(t,{type:"inbound-rtp",packetsReceived:d(e,"packetsReceived"),bytesReceived:d(e,"bytesReceived"),packetsLost:d(e,"packetsLost"),jitter:u(e.stat("googJitterReceived")),fractionLost:void 0,roundTripTime:u(e.stat("googRtt")),packetsDiscarded:void 0,packetsRepaired:void 0,burstPacketsLost:void 0,burstPacketsDiscarded:void 0,burstLossCount:void 0,burstDiscardCount:void 0,burstLossRate:void 0,burstDiscardRate:void 0,gapLossRate:void 0,gapDiscardRate:void 0,framesDecoded:d(e,"framesDecoded")}),t}(i)):e.set("rtp-"+o,function(e){var t=s(e,!1);return Object.assign(t,{type:"outbound-rtp",remoteTimestamp:void 0,packetsSent:d(e,"packetsSent"),bytesSent:d(e,"bytesSent"),targetBitrate:void 0,framesEncoded:d(e,"framesEncoded")}),t}(i)),e.set("track-"+o,function(e){return{type:"track",id:e.id,timestamp:Date.parse(e.timestamp),trackIdentifier:e.stat("googTrackId"),remoteSource:void 0,ended:void 0,kind:e.stat("mediaType"),detached:void 0,ssrcIds:void 0,frameWidth:h(e,"googFrameWidthReceived")?d(e,"googFrameWidthReceived"):d(e,"googFrameWidthSent"),frameHeight:h(e,"googFrameHeightReceived")?d(e,"googFrameHeightReceived"):d(e,"googFrameHeightSent"),framesPerSecond:void 0,framesSent:d(e,"framesEncoded"),framesReceived:void 0,framesDecoded:d(e,"framesDecoded"),framesDropped:void 0,framesCorrupted:void 0,partialFramesLost:void 0,fullFramesLost:void 0,audioLevel:h(e,"audioOutputLevel")?d(e,"audioOutputLevel")/r:(d(e,"audioInputLevel")||0)/r,echoReturnLoss:p(e,"googEchoCancellationReturnLoss"),echoReturnLossEnhancement:p(e,"googEchoCancellationReturnLossEnhancement")}}(i)),e.set("codec-"+o,function(e){return{type:"codec",id:e.id,timestamp:Date.parse(e.timestamp),payloadType:void 0,mimeType:e.stat("mediaType")+"/"+e.stat("googCodecName"),clockRate:void 0,channels:void 0,sdpFmtpLine:void 0,implementation:void 0}}(i));break;case"googComponent":var l=a(i);n.set(l.selectedCandidatePairId,o),e.set(o,a(i))}return e},new Map);if(t){var l=n.get(t);l&&(i.get(l).dtlsState="connected")}return new o(i)},t.exports=o},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=94.768;function i(e,t,n){if("number"!=typeof e||"number"!=typeof t||"number"!=typeof n||!o(e)||!o(t)||!o(n))return null;var i=e+2*t+10,a=0;switch(!0){case i<160:a=r-i/40;break;case i<1e3:a=r-(i-120)/10}switch(!0){case n<=a/2.5:a=Math.max(a-2.5*n,6.52);break;default:a=0}return 1+.035*a+7e-6*a*(a-60)*(100-a)}function o(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)&&e>=0}n.calculate=i,n.isNonNegativeNumber=o,n.default={calculate:i,isNonNegativeNumber:o}},{}],26:[function(e,t,n){"use strict";var r=e("../errors"),i=r.InvalidArgumentError,o=r.MediaErrors,a=r.NotSupportedError,s=r.SignalingErrors,c=e("../log").default,u=e("../util"),l=e("./rtcpc"),d=e("./sdp").setIceAggressiveNomination,p="new";function f(e,t,n,r){if(!e||!t||!n)throw new i("Audiohelper, pstream and getUserMedia are required arguments");if(!(this instanceof f))return new f(e,t,n,r);function o(){}this.onopen=o,this.onerror=o,this.onclose=o,this.ondisconnected=o,this.onfailed=o,this.onconnected=o,this.onreconnected=o,this.onsignalingstatechange=o,this.ondtlstransportstatechange=o,this.onicegatheringfailure=o,this.onicegatheringstatechange=o,this.oniceconnectionstatechange=o,this.onpcconnectionstatechange=o,this.onicecandidate=o,this.onselectedcandidatepairchange=o,this.onvolume=o,this.version=null,this.pstream=t,this.stream=null,this.sinkIds=new Set(["default"]),this.outputs=new Map,this.status="connecting",this.callSid=null,this.isMuted=!1,this.getUserMedia=n;var a="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);return this._isSinkSupported=!!a&&"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId,this._audioContext=a&&e._audioContext,this._hasIceCandidates=!1,this._hasIceGatheringFailures=!1,this._iceGatheringTimeoutId=null,this._masterAudio=null,this._masterAudioDeviceId=null,this._mediaStreamSource=null,this._dtmfSender=null,this._dtmfSenderUnsupported=!1,this._callEvents=[],this._nextTimeToPublish=Date.now(),this._onAnswerOrRinging=o,this._onHangup=o,this._remoteStream=null,this._shouldManageStream=!0,this._iceState=p,this._isUnifiedPlan=r.isUnifiedPlan,this.options=r=r||{},this.navigator=r.navigator||("undefined"!=typeof navigator?navigator:null),this.util=r.util||u,this.codecPreferences=r.codecPreferences,this._log=c.getInstance(),this}function h(e,t){"function"==typeof e.addTrack?t.getAudioTracks().forEach(function(n){e.addTrack(n,t)}):e.addStream(t)}function m(e){var t="undefined"!=typeof MediaStream?new MediaStream:new webkitMediaStream;return e.getAudioTracks().forEach(t.addTrack,t),t}function g(e,t){if(void 0!==e.srcObject)e.srcObject=t;else if(void 0!==e.mozSrcObject)e.mozSrcObject=t;else{if(void 0===e.src)return!1;var n=e.options.window||window;e.src=(n.URL||n.webkitURL).createObjectURL(t)}return!0}f.prototype.uri=function(){return this._uri},f.prototype.openWithConstraints=function(e){return this.getUserMedia({audio:e}).then(this._setInputTracksFromStream.bind(this,!1))},f.prototype.setInputTracksFromStream=function(e){var t=this;return this._setInputTracksFromStream(!0,e).then(function(){t._shouldManageStream=!1})},f.prototype._createAnalyser=function(e,t){t=Object.assign({fftSize:32,smoothingTimeConstant:.3},t);var n=e.createAnalyser();for(var r in t)n[r]=t[r];return n},f.prototype._setVolumeHandler=function(e){this.onvolume=e},f.prototype._startPollingVolume=function(){if(this._audioContext&&this.stream&&this._remoteStream){var e=this._audioContext,t=(this._inputAnalyser=this._createAnalyser(e)).frequencyBinCount,n=new Uint8Array(t);this._inputAnalyser2=this._createAnalyser(e,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0});var r=(this._outputAnalyser=this._createAnalyser(e)).frequencyBinCount,i=new Uint8Array(r);this._outputAnalyser2=this._createAnalyser(e,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0}),this._updateInputStreamSource(this.stream),this._updateOutputStreamSource(this._remoteStream);var o=this;setTimeout(function e(){if(o._audioContext){if("closed"===o.status)return o._inputAnalyser.disconnect(),o._outputAnalyser.disconnect(),o._inputAnalyser2.disconnect(),void o._outputAnalyser2.disconnect();o._inputAnalyser.getByteFrequencyData(n);var t=o.util.average(n);o._inputAnalyser2.getByteFrequencyData(n);var r=o.util.average(n);o._outputAnalyser.getByteFrequencyData(i);var a=o.util.average(i);o._outputAnalyser2.getByteFrequencyData(i);var s=o.util.average(i);o.onvolume(t/255,a/255,r,s),setTimeout(e,50)}},50)}},f.prototype._stopStream=function(e){this._shouldManageStream&&("function"==typeof MediaStreamTrack.prototype.stop?("function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks).forEach(function(e){e.stop()}):e.stop())},f.prototype._updateInputStreamSource=function(e){this._inputStreamSource&&this._inputStreamSource.disconnect(),this._inputStreamSource=this._audioContext.createMediaStreamSource(e),this._inputStreamSource.connect(this._inputAnalyser),this._inputStreamSource.connect(this._inputAnalyser2)},f.prototype._updateOutputStreamSource=function(e){this._outputStreamSource&&this._outputStreamSource.disconnect(),this._outputStreamSource=this._audioContext.createMediaStreamSource(e),this._outputStreamSource.connect(this._outputAnalyser),this._outputStreamSource.connect(this._outputAnalyser2)},f.prototype._setInputTracksFromStream=function(e,t){return this._isUnifiedPlan?this._setInputTracksForUnifiedPlan(e,t):this._setInputTracksForPlanB(e,t)},f.prototype._setInputTracksForPlanB=function(e,t){var n=this;if(!t)return Promise.reject(new i("Can not set input stream to null while in a call"));if(!t.getAudioTracks().length)return Promise.reject(new i("Supplied input stream has no audio tracks"));var r,o,a=this.stream;return a?(this._stopStream(a),r=this.version.pc,o=a,"function"==typeof r.removeTrack?r.getSenders().forEach(function(e){r.removeTrack(e)}):r.removeStream(o),a.getAudioTracks().forEach(a.removeTrack,a),t.getAudioTracks().forEach(a.addTrack,a),h(this.version.pc,t),this._updateInputStreamSource(this.stream)):this.stream=e?m(t):t,this.mute(this.isMuted),this.version?new Promise(function(e,t){n.version.createOffer(n.options.maxAverageBitrate,n.codecPreferences,{audio:!0},function(){n.version.processAnswer(n.codecPreferences,n._answerSdp,function(){e(n.stream)},t)},t)}):Promise.resolve(this.stream)},f.prototype._setInputTracksForUnifiedPlan=function(e,t){var n=this;if(!t)return Promise.reject(new i("Can not set input stream to null while in a call"));if(!t.getAudioTracks().length)return Promise.reject(new i("Supplied input stream has no audio tracks"));var r=this.stream,o=function(){return n.mute(n.isMuted),Promise.resolve(n.stream)};return r?(this._shouldManageStream&&this._stopStream(r),this._sender||(this._sender=this.version.pc.getSenders()[0]),this._sender.replaceTrack(t.getAudioTracks()[0]).then(function(){return n._updateInputStreamSource(t),o()})):(this.stream=e?m(t):t,o())},f.prototype._onInputDevicesChanged=function(){this.stream&&(this.stream.getAudioTracks().every(function(e){return"ended"===e.readyState})&&this._shouldManageStream&&this.openWithConstraints(!0))},f.prototype._onIceGatheringFailure=function(e){this._hasIceGatheringFailures=!0,this.onicegatheringfailure(e)},f.prototype._onMediaConnectionStateChange=function(e){var t=this._iceState;if(t!==e&&("connected"===e||"disconnected"===e||"failed"===e)){this._iceState=e;var n=void 0;switch(e){case"connected":"disconnected"===t||"failed"===t?(n="ICE liveliness check succeeded. Connection with Twilio restored",this._log.info(n),this.onreconnected(n)):(n="Media connection established.",this._log.info(n),this.onconnected(n)),this._stopIceGatheringTimeout(),this._hasIceGatheringFailures=!1;break;case"disconnected":n="ICE liveliness check failed. May be having trouble connecting to Twilio",this._log.info(n),this.ondisconnected(n);break;case"failed":n="Connection with Twilio was interrupted.",this._log.info(n),this.onfailed(n)}}},f.prototype._setSinkIds=function(e){return this._isSinkSupported?(this.sinkIds=new Set(e.forEach?e:[e]),this.version?this._updateAudioOutputs():Promise.resolve()):Promise.reject(new a("Audio output selection is not supported by this browser"))},f.prototype._startIceGatheringTimeout=function(){var e=this;this._stopIceGatheringTimeout(),this._iceGatheringTimeoutId=setTimeout(function(){e._onIceGatheringFailure("timeout")},15e3)},f.prototype._stopIceGatheringTimeout=function(){clearInterval(this._iceGatheringTimeoutId)},f.prototype._updateAudioOutputs=function(){var e=Array.from(this.sinkIds).filter(function(e){return!this.outputs.has(e)},this),t=Array.from(this.outputs.keys()).filter(function(e){return!this.sinkIds.has(e)},this),n=this,r=e.map(this._createAudioOutput,this);return Promise.all(r).then(function(){return Promise.all(t.map(n._removeAudioOutput,n))})},f.prototype._createAudio=function(e){return new Audio(e)},f.prototype._createAudioOutput=function(e){var t=this._audioContext.createMediaStreamDestination();this._mediaStreamSource.connect(t);var n=this._createAudio();g(n,t.stream);var r=this;return n.setSinkId(e).then(function(){return n.play()}).then(function(){r.outputs.set(e,{audio:n,dest:t})})},f.prototype._removeAudioOutputs=function(){return this._masterAudio&&void 0!==this._masterAudioDeviceId&&(this._disableOutput(this,this._masterAudioDeviceId),this.outputs.delete(this._masterAudioDeviceId),this._masterAudioDeviceId=null,this._masterAudio.paused||this._masterAudio.pause(),void 0!==this._masterAudio.srcObject?this._masterAudio.srcObject=null:this._masterAudio.src="",this._masterAudio=null),Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)},f.prototype._disableOutput=function(e,t){var n=e.outputs.get(t);n&&(n.audio&&(n.audio.pause(),n.audio.src=""),n.dest&&n.dest.disconnect())},f.prototype._reassignMasterOutput=function(e,t){var n=e.outputs.get(t);e.outputs.delete(t);var r=this,i=Array.from(e.outputs.keys())[0]||"default";return n.audio.setSinkId(i).then(function(){r._disableOutput(e,i),e.outputs.set(i,n),e._masterAudioDeviceId=i}).catch(function(){e.outputs.set(t,n),r._log.info("Could not reassign master output. Attempted to roll back.")})},f.prototype._removeAudioOutput=function(e){return this._masterAudioDeviceId===e?this._reassignMasterOutput(this,e):(this._disableOutput(this,e),this.outputs.delete(e),Promise.resolve())},f.prototype._onAddTrack=function(e,t){var n=e._masterAudio=this._createAudio();g(n,t),n.play();var r=Array.from(e.outputs.keys())[0]||"default";e._masterAudioDeviceId=r,e.outputs.set(r,{audio:n}),e._mediaStreamSource=e._audioContext.createMediaStreamSource(t),e.pcStream=t,e._updateAudioOutputs()},f.prototype._fallbackOnAddTrack=function(e,t){var n=document&&document.createElement("audio");n.autoplay=!0,g(n,t)||e._log.info("Error attaching stream to element."),e.outputs.set("default",{audio:n})},f.prototype._setEncodingParameters=function(e){if(e&&this._sender&&"function"==typeof this._sender.getParameters&&"function"==typeof this._sender.setParameters){var t=this._sender.getParameters();(t.priority||t.encodings&&t.encodings.length)&&(t.priority="high",t.encodings&&t.encodings.length&&t.encodings.forEach(function(e){e.priority="high",e.networkPriority="high"}),this._sender.setParameters(t))}},f.prototype._setupPeerConnection=function(e,t){var n=this,r=this,i=new(this.options.rtcpcFactory||l);i.create(e,t),h(i.pc,this.stream);var o="ontrack"in i.pc?"ontrack":"onaddstream";return i.pc[o]=function(e){var t=r._remoteStream=e.stream||e.streams[0];"function"==typeof i.pc.getSenders&&(n._sender=i.pc.getSenders()[0]),r._isSinkSupported?r._onAddTrack(r,t):r._fallbackOnAddTrack(r,t),r._startPollingVolume()},i},f.prototype._maybeSetIceAggressiveNomination=function(e){return this.options.forceAggressiveIceNomination?d(e):e},f.prototype._setupChannel=function(){var e=this,t=this.version.pc;this.version.pc.onopen=function(){e.status="open",e.onopen()},this.version.pc.onstatechange=function(){e.version.pc&&"stable"===e.version.pc.readyState&&(e.status="open",e.onopen())},this.version.pc.onsignalingstatechange=function(){var n=t.signalingState;e._log.info('signalingState is "'+n+'"'),e.version.pc&&"stable"===e.version.pc.signalingState&&(e.status="open",e.onopen()),e.onsignalingstatechange(t.signalingState)},t.onconnectionstatechange=function(){e._log.info('pc.connectionState is "'+t.connectionState+'"'),e.onpcconnectionstatechange(t.connectionState),e._onMediaConnectionStateChange(t.connectionState)},t.onicecandidate=function(t){var n=t.candidate;n&&(e._hasIceCandidates=!0,e.onicecandidate(n),e._setupRTCIceTransportListener()),e._log.info("ICE Candidate: "+JSON.stringify(n))},t.onicegatheringstatechange=function(){var n=t.iceGatheringState;"gathering"===n?e._startIceGatheringTimeout():"complete"===n&&(e._stopIceGatheringTimeout(),e._hasIceCandidates||e._onIceGatheringFailure("none"),e._hasIceCandidates&&e._hasIceGatheringFailures&&e._startIceGatheringTimeout()),e._log.info('pc.iceGatheringState is "'+t.iceGatheringState+'"'),e.onicegatheringstatechange(n)},t.oniceconnectionstatechange=function(){e._log.info('pc.iceConnectionState is "'+t.iceConnectionState+'"'),e.oniceconnectionstatechange(t.iceConnectionState),e._onMediaConnectionStateChange(t.iceConnectionState)}},f.prototype._initializeMediaStream=function(e,t){return"open"!==this.status&&("disconnected"===this.pstream.status?(this.onerror({info:{code:31e3,message:"Cannot establish connection. Client is disconnected",twilioError:new s.ConnectionDisconnected}}),this.close(),!1):(this.version=this._setupPeerConnection(e,t),this._setupChannel(),!0))},f.prototype._removeReconnectionListeners=function(){this.pstream&&(this.pstream.removeListener("answer",this._onAnswerOrRinging),this.pstream.removeListener("hangup",this._onHangup))},f.prototype._setupRTCDtlsTransportListener=function(){var e=this,t=this.getRTCDtlsTransport();if(t&&!t.onstatechange){var n=function(){e._log.info('dtlsTransportState is "'+t.state+'"'),e.ondtlstransportstatechange(t.state)};n(),t.onstatechange=n}},f.prototype._setupRTCIceTransportListener=function(){var e=this,t=this._getRTCIceTransport();t&&!t.onselectedcandidatepairchange&&(t.onselectedcandidatepairchange=function(){return e.onselectedcandidatepairchange(t.getSelectedCandidatePair())})},f.prototype.iceRestart=function(){var e=this;this._log.info("Attempting to restart ICE..."),this._hasIceCandidates=!1,this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{iceRestart:!0}).then(function(){e._removeReconnectionListeners(),e._onAnswerOrRinging=function(t){if(e._removeReconnectionListeners(),t.sdp&&"have-local-offer"===e.version.pc.signalingState){var n=e._maybeSetIceAggressiveNomination(t.sdp);e._answerSdp=n,"closed"!==e.status&&e.version.processAnswer(e.codecPreferences,n,null,function(t){var n=t&&t.message?t.message:t;e._log.info("Failed to process answer during ICE Restart. Error: "+n)})}else{var r="Invalid state or param during ICE Restart:hasSdp:"+!!t.sdp+", signalingState:"+e.version.pc.signalingState;e._log.info(r)}},e._onHangup=function(){e._log.info("Received hangup during ICE Restart"),e._removeReconnectionListeners()},e.pstream.on("answer",e._onAnswerOrRinging),e.pstream.on("hangup",e._onHangup),e.pstream.reinvite(e.version.getSDP(),e.callSid)}).catch(function(t){var n=t&&t.message?t.message:t;e._log.info("Failed to createOffer during ICE Restart. Error: "+n),e.onfailed(n)})},f.prototype.makeOutgoingCall=function(e,t,n,r,i,a){var s=this;if(this._initializeMediaStream(r,i)){var c=this;this.callSid=n,this._onAnswerOrRinging=function(e){if(e.sdp){var t=s._maybeSetIceAggressiveNomination(e.sdp);c._answerSdp=t,"closed"!==c.status&&c.version.processAnswer(s.codecPreferences,t,u,l),c.pstream.removeListener("answer",c._onAnswerOrRinging),c.pstream.removeListener("ringing",c._onAnswerOrRinging)}},this.pstream.on("answer",this._onAnswerOrRinging),this.pstream.on("ringing",this._onAnswerOrRinging),this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{audio:!0},function(){"closed"!==c.status&&(c.pstream.invite(c.version.getSDP(),c.callSid,c.options.preflight,t),c._setupRTCDtlsTransportListener())},function(e){var t=e.message||e;c.onerror({info:{code:31e3,message:"Error creating the offer: "+t,twilioError:new o.ClientLocalDescFailed}})})}function u(){c.options&&c._setEncodingParameters(c.options.dscp),a(c.version.pc)}function l(e){var t=e.message||e;c.onerror({info:{code:31e3,message:"Error processing answer: "+t,twilioError:new o.ClientRemoteDescFailed}})}},f.prototype.answerIncomingCall=function(e,t,n,r,i){if(this._initializeMediaStream(n,r)){t=this._maybeSetIceAggressiveNomination(t),this._answerSdp=t.replace(/^a=setup:actpass$/gm,"a=setup:passive"),this.callSid=e;var a=this;this.version.processSDP(this.options.maxAverageBitrate,this.codecPreferences,t,{audio:!0},function(){"closed"!==a.status&&(a.pstream.answer(a.version.getSDP(),e),a.options&&a._setEncodingParameters(a.options.dscp),i(a.version.pc),a._setupRTCDtlsTransportListener())},function(e){var t=e.message||e;a.onerror({info:{code:31e3,message:"Error creating the answer: "+t,twilioError:new o.ClientRemoteDescFailed}})})}},f.prototype.close=function(){this.version&&this.version.pc&&("closed"!==this.version.pc.signalingState&&this.version.pc.close(),this.version.pc=null),this.stream&&(this.mute(!1),this._stopStream(this.stream)),this.stream=null,this._removeReconnectionListeners(),this._stopIceGatheringTimeout(),Promise.all(this._removeAudioOutputs()).catch(function(){}),this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._inputAnalyser&&this._inputAnalyser.disconnect(),this._outputAnalyser&&this._outputAnalyser.disconnect(),this._inputAnalyser2&&this._inputAnalyser2.disconnect(),this._outputAnalyser2&&this._outputAnalyser2.disconnect(),this.status="closed",this.onclose()},f.prototype.reject=function(e){this.callSid=e},f.prototype.ignore=function(e){this.callSid=e},f.prototype.mute=function(e){(this.isMuted=e,this.stream)&&(this._sender&&this._sender.track?this._sender.track.enabled=!e:("function"==typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks).forEach(function(t){t.enabled=!e}))},f.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var e=this,t=this.version.pc;if(!t)return this._log.info("No RTCPeerConnection available to call createDTMFSender on"),null;if("function"==typeof t.getSenders&&("function"==typeof RTCDTMFSender||"function"==typeof RTCDtmfSender)){var n=t.getSenders().find(function(e){return e.dtmf});if(n)return this._log.info("Using RTCRtpSender#dtmf"),this._dtmfSender=n.dtmf,this._dtmfSender}if("function"==typeof t.createDTMFSender&&"function"==typeof t.getLocalStreams){var r=t.getLocalStreams().map(function(t){var n=e._getAudioTracks(t);return n&&n[0]})[0];return r?(this._log.info("Creating RTCDTMFSender"),this._dtmfSender=t.createDTMFSender(r),this._dtmfSender):(this._log.info("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),null)}return this._log.info("RTCPeerConnection does not support RTCDTMFSender"),this._dtmfSenderUnsupported=!0,null},f.prototype.getRTCDtlsTransport=function(){var e=this.version&&this.version.pc&&"function"==typeof this.version.pc.getSenders&&this.version.pc.getSenders()[0];return e&&e.transport||null},f.prototype._canStopMediaStreamTrack=function(){return"function"==typeof MediaStreamTrack.prototype.stop},f.prototype._getAudioTracks=function(e){return"function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks},f.prototype._getRTCIceTransport=function(){var e=this.getRTCDtlsTransport();return e&&e.iceTransport||null},f.protocol=l.test()?new l:null,f.enabled=l.test(),t.exports=f},{"../errors":12,"../log":15,"../util":35,"./rtcpc":27,"./sdp":28}],27:[function(e,t,n){(function(n){(function(){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("rtcpeerconnection-shim"),o=e("../log").default,a=e("./sdp"),s=a.setCodecPreferences,c=a.setMaxAverageBitrate,u=e("../util");function l(){"undefined"!=typeof window?u.isLegacyEdge()?this.RTCPeerConnection=new i("undefined"!=typeof window?window:n):"function"==typeof window.RTCPeerConnection?this.RTCPeerConnection=window.RTCPeerConnection:"function"==typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=webkitRTCPeerConnection:"function"==typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log.info("No RTCPeerConnection implementation available"):this.log.info("No RTCPeerConnection implementation available. The window object was not found.")}function d(e,t,n){return function(){var r=Array.prototype.slice.call(arguments);return new Promise(function(n){n(e.apply(t,r))}).catch(function(){return new Promise(function(i,o){e.apply(t,n?[i,o].concat(r):r.concat([i,o]))})})}}function p(e,t){return d(e,t,!0)}function f(e,t){return d(e,t,!1)}l.prototype.create=function(e,t){this.log=o.getInstance(),this.pc=new this.RTCPeerConnection(t,e)},l.prototype.createModernConstraints=function(e){if(void 0===e)return null;var t=Object.assign({},e);return"undefined"==typeof webkitRTCPeerConnection||u.isLegacyEdge()?(void 0!==e.audio&&(t.offerToReceiveAudio=e.audio),void 0!==e.video&&(t.offerToReceiveVideo=e.video)):(t.mandatory={},void 0!==e.audio&&(t.mandatory.OfferToReceiveAudio=e.audio),void 0!==e.video&&(t.mandatory.OfferToReceiveVideo=e.video)),delete t.audio,delete t.video,t},l.prototype.createOffer=function(e,t,n,r,i){var o=this;return n=this.createModernConstraints(n),p(this.pc.createOffer,this.pc)(n).then(function(n){if(!o.pc)return Promise.resolve();var r=c(n.sdp,e);return f(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({type:"offer",sdp:s(r,t)}))}).then(r,i)},l.prototype.createAnswer=function(e,t,n,r,i){var o=this;return n=this.createModernConstraints(n),p(this.pc.createAnswer,this.pc)(n).then(function(n){if(!o.pc)return Promise.resolve();var r=c(n.sdp,e);return f(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({type:"answer",sdp:s(r,t)}))}).then(r,i)},l.prototype.processSDP=function(e,t,n,r,i,o){var a=this;n=s(n,t);var c=new RTCSessionDescription({sdp:n,type:"offer"});return f(this.pc.setRemoteDescription,this.pc)(c).then(function(){a.createAnswer(e,t,r,i,o)})},l.prototype.getSDP=function(){return this.pc.localDescription.sdp},l.prototype.processAnswer=function(e,t,n,r){return this.pc?(t=s(t,e),f(this.pc.setRemoteDescription,this.pc)(new RTCSessionDescription({sdp:t,type:"answer"})).then(n,r)):Promise.resolve()},l.test=function(){if("object"===("undefined"==typeof navigator?"undefined":r(navigator))){var e=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(u.isLegacyEdge(navigator))return!1;if(e&&"function"==typeof window.RTCPeerConnection)return!0;if(e&&"function"==typeof window.webkitRTCPeerConnection)return!0;if(e&&"function"==typeof window.mozRTCPeerConnection){try{if("function"!=typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(e){return!1}return!0}if("undefined"!=typeof RTCIceGatherer)return!0}return!1},t.exports=l}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../log":15,"../util":35,"./sdp":28,"rtcpeerconnection-shim":56}],28:[function(e,t,n){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("../util"),o={0:"PCMU",8:"PCMA"},a=111,s=51e4,c=6e3;t.exports={getPreferredCodecInfo:function(e){var t=/a=rtpmap:(\d+) (\S+)/m.exec(e)||[null,"",""],n=r(t,3),i=n[1],o=n[2],a=new RegExp("a=fmtp:"+i+" (\\S+)","m").exec(e)||[null,""];return{codecName:o,codecParams:r(a,2)[1]}},setCodecPreferences:function(e,t){var n=function(e,t,n){return e.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map(function(e){return"m="+e}).filter(function(e){var r=new RegExp("m="+(t||".*"),"gm"),i=new RegExp("a="+(n||".*"),"gm");return r.test(e)&&i.test(e)})}(e);return[e.split("\r\nm=")[0]].concat(n.map(function(e){if(!/^m=(audio|video)/.test(e))return e;var n=e.match(/^m=(audio|video)/)[1],r=function(e){return Array.from((t=e,function(e){var t=e.split("\r\n")[0].match(/([0-9]+)/g);return t?t.slice(1).map(function(e){return parseInt(e,10)}):[]}(t).reduce(function(e,n){var r=new RegExp("a=rtpmap:"+n+" ([^/]+)"),i=t.match(r),a=i?i[1].toLowerCase():o[n]?o[n].toLowerCase():"";return e.set(n,a)},new Map))).reduce(function(e,t){var n=t[0],r=t[1],i=e.get(r)||[];return e.set(r,i.concat(n))},new Map);var t}(e),a=function(e,t){t=t.map(function(e){return e.toLowerCase()});var n=i.flatMap(t,function(t){return e.get(t)||[]}),r=i.difference(Array.from(e.keys()),t),o=i.flatMap(r,function(t){return e.get(t)});return n.concat(o)}(r,t),s=function(e,t){var n=t.split("\r\n"),r=n[0],i=n.slice(1);return[r=r.replace(/([0-9]+\s?)+$/,e.join(" "))].concat(i).join("\r\n")}(a,e),c=r.get("pcma")||[],u=r.get("pcmu")||[];return("audio"===n?new Set(c.concat(u)):new Set).has(a[0])?s.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):s})).join("\r\n")},setIceAggressiveNomination:function(e){return i.isChrome(window,window.navigator)?e.split("\n").filter(function(e){return-1===e.indexOf("a=ice-lite")}).join("\n"):e},setMaxAverageBitrate:function(e,t){if("number"!=typeof t||t<c||t>s)return e;var n=/a=rtpmap:(\d+) opus/m.exec(e),r=n&&n.length?n[1]:a,i=new RegExp("a=fmtp:"+r);return e.split("\n").map(function(e){return i.test(e)?e+";maxaveragebitrate="+t:e}).join("\n")}}},{"../util":35}],29:[function(e,t,n){var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r},i=e("../errors"),o=i.NotSupportedError,a=i.InvalidArgumentError,s=e("./mockrtcstatsreport"),c="PeerConnection is null",u="WebRTC statistics are unsupported";function l(e){if(!e)return Promise.reject(new a(c));if("function"!=typeof e.getStats)return Promise.reject(new o(u));var t;try{t=e.getStats()}catch(n){t=new Promise(function(t){return e.getStats(t)}).then(s.fromRTCStatsResponse)}return t}function d(){}function p(e){var t,n=null,r=new d;Array.from(e.values()).forEach(function(i){if(!i.isRemote){var o=i.type.replace("-","");if(t=t||i.timestamp,i.remoteId){var a=e.get(i.remoteId);a&&a.roundTripTime&&(r.rtt=1e3*a.roundTripTime)}switch(o){case"inboundrtp":r.timestamp=r.timestamp||i.timestamp,r.jitter=1e3*i.jitter,r.packetsLost=i.packetsLost,r.packetsReceived=i.packetsReceived,r.bytesReceived=i.bytesReceived;break;case"outboundrtp":if(r.timestamp=i.timestamp,r.packetsSent=i.packetsSent,r.bytesSent=i.bytesSent,i.codecId){var s=e.get(i.codecId);r.codecName=s?s.mimeType&&s.mimeType.match(/(.*\/)?(.*)/)[2]:i.codecId}break;case"transport":n=i.id}}}),r.timestamp||(r.timestamp=t);var i=e.get(n);if(!i)return r;var o=e.get(i.selectedCandidatePairId);if(!o)return r;var a=e.get(o.localCandidateId),s=e.get(o.remoteCandidateId);return r.rtt||(r.rtt=o&&1e3*o.currentRoundTripTime),Object.assign(r,{localAddress:a&&a.ip,remoteAddress:s&&s.ip}),r}t.exports={getRTCStats:function(e,t){return t=Object.assign({createRTCSample:p},t),l(e).then(t.createRTCSample)},getRTCIceCandidateStatsReport:function(e){return l(e).then(function(e){var t,n=Array.from(e.values()).reduce(function(e,t){switch(["candidatePairs","localCandidates","remoteCandidates"].forEach(function(t){e[t]||(e[t]=[])}),t.type){case"candidate-pair":e.candidatePairs.push(t);break;case"local-candidate":e.localCandidates.push(t);break;case"remote-candidate":e.remoteCandidates.push(t);break;case"transport":t.selectedCandidatePairId&&(e.transport=t)}return e},{}),i=n.candidatePairs,o=n.localCandidates,a=n.remoteCandidates,s=n.transport,c=i.find(function(e){return e.selected||s&&e.id===s.selectedCandidatePairId});return c&&(t={localCandidate:o.find(function(e){return e.id===c.localCandidateId}),remoteCandidate:a.find(function(e){return e.id===c.remoteCandidateId})}),{iceCandidateStats:r(o,a),selectedIceCandidatePairStats:t}})}}},{"../errors":12,"./mockrtcstatsreport":24}],30:[function(e,t,n){var r=e("events").EventEmitter;function i(){Object.defineProperties(this,{_eventEmitter:{value:new r},_handlers:{value:{}}})}i.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},i.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,arguments)},i.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,arguments)},i.prototype._defineEventHandler=function(e){var t=this;Object.defineProperty(this,"on"+e,{get:function(){return t._handlers[e]},set:function(n){var r=t._handlers[e];!r||"function"!=typeof n&&null!=n||(t._handlers[e]=null,t.removeEventListener(e,r)),"function"==typeof n&&(t._handlers[e]=n,t.addEventListener(e,n))}})},t.exports=i},{events:48}],31:[function(e,t,n){"use strict";t.exports=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{deviceId:{get:function(){return t.deviceId}},groupId:{get:function(){return t.groupId}},kind:{get:function(){return t.kind}},label:{get:function(){return t.label}}})}},{}],32:[function(e,t,n){var r=e("./eventtarget"),i=e("util").inherits,o=500,a="undefined"!=typeof navigator&&navigator.mediaDevices;function s(){r.call(this),this._defineEventHandler("devicechange"),this._defineEventHandler("deviceinfochange");var e=[];Object.defineProperties(this,{_deviceChangeIsNative:{value:c(this,"devicechange")},_deviceInfoChangeIsNative:{value:c(this,"deviceinfochange")},_knownDevices:{value:e},_pollInterval:{value:null,writable:!0}}),"function"==typeof a.enumerateDevices&&a.enumerateDevices().then(function(t){t.sort(u).forEach([].push,e)}),this._eventEmitter.on("newListener",function(e){"devicechange"!==e&&"deviceinfochange"!==e||(this._pollInterval=this._pollInterval||setInterval(function(e){a.enumerateDevices().then(function(t){var n=e._knownDevices,r=n.slice();[].splice.apply(n,[0,n.length].concat(t.sort(u))),!e._deviceChangeIsNative&&function(e,t){return e.length!==t.length||(n="deviceId",r=e,i=t,r.some(function(e,t){return e[n]!==i[t][n]}));var n,r,i}(n,r)&&e.dispatchEvent(new Event("devicechange")),!e._deviceInfoChangeIsNative&&function(e,t){var n=t.reduce(function(e,t){return e.set(t.deviceId,t.label||null)},new Map);return e.some(function(e){var t=n.get(e.deviceId);return void 0!==t&&t!==e.label})}(n,r)&&e.dispatchEvent(new Event("deviceinfochange"))})}.bind(null,this),o))}.bind(this)),this._eventEmitter.on("removeListener",function(){var e;!this._pollInterval||(e=this,["devicechange","deviceinfochange"].reduce(function(t,n){return t+e._eventEmitter.listenerCount(n)},0)>0)||(clearInterval(this._pollInterval),this._pollInterval=null)}.bind(this))}function c(e,t){var n="on"+t;function r(t){e.dispatchEvent(t)}return n in a&&("addEventListener"in a?a.addEventListener(t,r):a[n]=r,!0)}function u(e,t){return e.deviceId<t.deviceId}i(s,r),a&&"function"==typeof a.enumerateDevices&&(s.prototype.enumerateDevices=function(){return a.enumerateDevices.apply(a,arguments)}),s.prototype.getUserMedia=function(){return a.getUserMedia.apply(a,arguments)},t.exports=a?new s:null},{"./eventtarget":30,util:60}],33:[function(e,t,n){"use strict";var r=e("./asyncQueue").AsyncQueue,i=e("@twilio/audioplayer"),o=e("./errors").InvalidArgumentError;function a(e,t,n){if(!(this instanceof a))return new a(e,t,n);if(!e||!t)throw new o("name and url are required arguments");(n=Object.assign({AudioFactory:"undefined"!=typeof Audio?Audio:null,maxDuration:0,shouldLoop:!1},n)).AudioPlayer=n.audioContext?i.bind(i,n.audioContext):n.AudioFactory,Object.defineProperties(this,{_activeEls:{value:new Map},_Audio:{value:n.AudioPlayer},_isSinkSupported:{value:null!==n.AudioFactory&&"function"==typeof n.AudioFactory.prototype.setSinkId},_maxDuration:{value:n.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_operations:{value:new r},_playPromise:{value:null,writable:!0},_shouldLoop:{value:n.shouldLoop},_sinkIds:{value:["default"]},isPlaying:{enumerable:!0,get:function(){return!!this._playPromise}},name:{enumerable:!0,value:e},url:{enumerable:!0,value:t}}),this._Audio&&this._play(!0,!1)}function s(e){e&&(e.pause(),e.src="",e.srcObject=null,e.load())}a.prototype._playAudioElement=function(e,t,n){var r=this,i=this._activeEls.get(e);if(!i)throw new o('sinkId: "'+e+"\" doesn't have an audio element");return i.muted=!!t,i.loop=!!n,i.play().then(function(){return i}).catch(function(t){throw s(i),r._activeEls.delete(e),t})},a.prototype._play=function(e,t){this.isPlaying&&this._stop(),this._maxDuration>0&&(this._maxDurationTimeout=setTimeout(this._stop.bind(this),this._maxDuration)),t="boolean"==typeof t?t:this._shouldLoop;var n=this;return this._playPromise=Promise.all(this._sinkIds.map(function(r){if(!n._Audio)return Promise.resolve();var i=n._activeEls.get(r);return i?n._playAudioElement(r,e,t):("function"==typeof(i=new n._Audio(n.url)).setAttribute&&i.setAttribute("crossorigin","anonymous"),new Promise(function(e){i.addEventListener("canplaythrough",e)}).then(function(){return(n._isSinkSupported?i.setSinkId(r):Promise.resolve()).then(function(){return n._activeEls.set(r,i),n._playPromise?n._playAudioElement(r,e,t):Promise.resolve()})}))}))},a.prototype._stop=function(){var e=this;this._activeEls.forEach(function(t,n){e._sinkIds.includes(n)?(t.pause(),t.currentTime=0):(s(t),e._activeEls.delete(n))}),clearTimeout(this._maxDurationTimeout),this._playPromise=null,this._maxDurationTimeout=null},a.prototype.setSinkIds=function(e){this._isSinkSupported&&(e=e.forEach?e:[e],[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(e)))},a.prototype.stop=function(){var e=this;this._operations.enqueue(function(){return e._stop(),Promise.resolve()})},a.prototype.play=function(){var e=this;return this._operations.enqueue(function(){return e._play()})},t.exports=a},{"./asyncQueue":4,"./errors":12,"@twilio/audioplayer":40}],34:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(n,"__esModule",{value:!0});var s=e("events"),c=e("./errors"),u=e("./rtc/mos"),l=e("./util"),d=e("./rtc/stats").getRTCStats,p=5,f={audioInputLevel:{minStandardDeviation:327.67,sampleCount:10},audioOutputLevel:{minStandardDeviation:327.67,sampleCount:10},bytesReceived:{clearCount:2,min:1,raiseCount:3,sampleCount:3},bytesSent:{clearCount:2,min:1,raiseCount:3,sampleCount:3},jitter:{max:30},mos:{min:3},packetsLostFraction:[{max:1},{clearValue:1,maxAverage:3,sampleCount:7}],rtt:{max:400}};var h=function(e){function t(t){var n=e.call(this)||this;n._activeWarnings=new Map,n._currentStreaks=new Map,n._inputVolumes=[],n._outputVolumes=[],n._sampleBuffer=[],n._supplementalSampleBuffers={audioInputLevel:[],audioOutputLevel:[]},n._warningsEnabled=!0,t=t||{},n._getRTCStats=t.getRTCStats||d,n._mos=t.Mos||u.default,n._peerConnection=t.peerConnection,n._thresholds=o(o({},f),t.thresholds);var r=Object.values(n._thresholds).map(function(e){return e.sampleCount}).filter(function(e){return!!e});return n._maxSampleCount=Math.max.apply(Math,a([p],r)),n._peerConnection&&n.enable(n._peerConnection),n}return i(t,e),t.prototype.addVolumes=function(e,t){this._inputVolumes.push(e),this._outputVolumes.push(t)},t.prototype.disable=function(){return clearInterval(this._sampleInterval),delete this._sampleInterval,this},t.prototype.disableWarnings=function(){return this._warningsEnabled&&this._activeWarnings.clear(),this._warningsEnabled=!1,this},t.prototype.enable=function(e){if(e){if(this._peerConnection&&e!==this._peerConnection)throw new c.InvalidArgumentError("Attempted to replace an existing PeerConnection in StatsMonitor.enable");this._peerConnection=e}if(!this._peerConnection)throw new c.InvalidArgumentError("Can not enable StatsMonitor without a PeerConnection");return this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),1e3),this},t.prototype.enableWarnings=function(){return this._warningsEnabled=!0,this},t.prototype.hasActiveWarning=function(e,t){var n=e+":"+t;return!!this._activeWarnings.get(n)},t.prototype._addSample=function(e){var t=this._sampleBuffer;t.push(e),t.length>this._maxSampleCount&&t.splice(0,t.length-this._maxSampleCount)},t.prototype._clearWarning=function(e,t,n){var r=e+":"+t,i=this._activeWarnings.get(r);!i||Date.now()-i.timeRaised<5e3||(this._activeWarnings.delete(r),this.emit("warning-cleared",o(o({},n),{name:e,threshold:{name:t,value:this._thresholds[e][t]}})))},t.prototype._createSample=function(e,t){var n=t&&t.totals.bytesSent||0,r=t&&t.totals.bytesReceived||0,i=t&&t.totals.packetsSent||0,o=t&&t.totals.packetsReceived||0,a=t&&t.totals.packetsLost||0,s=e.bytesSent-n,c=e.bytesReceived-r,u=e.packetsSent-i,d=e.packetsReceived-o,p=e.packetsLost-a,f=d+p,h=f>0?p/f*100:0,m=e.packetsReceived+e.packetsLost,g=m>0?e.packetsLost/m*100:100,v="number"!=typeof e.rtt&&t?t.rtt:e.rtt,_=this._inputVolumes.splice(0);this._supplementalSampleBuffers.audioInputLevel.push(_);var y=this._outputVolumes.splice(0);return this._supplementalSampleBuffers.audioOutputLevel.push(y),{audioInputLevel:Math.round(l.average(_)),audioOutputLevel:Math.round(l.average(y)),bytesReceived:c,bytesSent:s,codecName:e.codecName,jitter:e.jitter,mos:this._mos.calculate(v,e.jitter,t&&h),packetsLost:p,packetsLostFraction:h,packetsReceived:d,packetsSent:u,rtt:v,timestamp:e.timestamp,totals:{bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,packetsLost:e.packetsLost,packetsLostFraction:g,packetsReceived:e.packetsReceived,packetsSent:e.packetsSent}}},t.prototype._fetchSample=function(){var e=this;this._getSample().then(function(t){e._addSample(t),e._raiseWarnings(),e.emit("sample",t)}).catch(function(t){e.disable(),e.emit("error",t)})},t.prototype._getSample=function(){var e=this;return this._getRTCStats(this._peerConnection).then(function(t){var n=null;return e._sampleBuffer.length&&(n=e._sampleBuffer[e._sampleBuffer.length-1]),e._createSample(t,n)})},t.prototype._raiseWarning=function(e,t,n){var r=e+":"+t;if(!this._activeWarnings.has(r)){this._activeWarnings.set(r,{timeRaised:Date.now()});var i,a=this._thresholds[e];if(Array.isArray(a)){var s=a.find(function(e){return t in e});s&&(i=s[t])}else i=this._thresholds[e][t];this.emit("warning",o(o({},n),{name:e,threshold:{name:t,value:i}}))}},t.prototype._raiseWarnings=function(){var e=this;this._warningsEnabled&&Object.keys(this._thresholds).forEach(function(t){return e._raiseWarningsForStat(t)})},t.prototype._raiseWarningsForStat=function(e){var t=this;(Array.isArray(this._thresholds[e])?this._thresholds[e]:[this._thresholds[e]]).forEach(function(n){var r=t._sampleBuffer,i=n.clearCount||0,o=n.raiseCount||3,s=n.sampleCount||t._maxSampleCount,c=r.slice(-s),u=c.map(function(t){return t[e]});if(!u.some(function(e){return null==e})){var d;if("number"==typeof n.max&&((d=function(e,t){return t.reduce(function(t,n){return t+(n>e?1:0)},0)}(n.max,u))>=o?t._raiseWarning(e,"max",{values:u,samples:c}):d<=i&&t._clearWarning(e,"max",{values:u,samples:c})),"number"==typeof n.min&&((d=function(e,t){return t.reduce(function(t,n){return t+(n<e?1:0)},0)}(n.min,u))>=o?t._raiseWarning(e,"min",{values:u,samples:c}):d<=i&&t._clearWarning(e,"min",{values:u,samples:c})),"number"==typeof n.maxDuration&&r.length>1){var p=(c=r.slice(-2))[0][e],f=c[1][e],h=t._currentStreaks.get(e)||0,m=p===f?h+1:0;t._currentStreaks.set(e,m),m>=n.maxDuration?t._raiseWarning(e,"maxDuration",{value:m}):0===m&&t._clearWarning(e,"maxDuration",{value:h})}if("number"==typeof n.minStandardDeviation){var g=t._supplementalSampleBuffers[e];if(!g||g.length<n.sampleCount)return;g.length>n.sampleCount&&g.splice(0,g.length-n.sampleCount);var v=function(e){if(e.length<=0)return null;var t=e.reduce(function(e,t){return e+t},0)/e.length,n=e.map(function(e){return Math.pow(e-t,2)});return Math.sqrt(n.reduce(function(e,t){return e+t},0)/n.length)}(function(e){return e.reduce(function(e,t){return a(e,t)},[])}(g.slice(-s)));if("number"!=typeof v)return;v<n.minStandardDeviation?t._raiseWarning(e,"minStandardDeviation",{value:v}):t._clearWarning(e,"minStandardDeviation",{value:v})}[["maxAverage",function(e,t){return e>t}],["minAverage",function(e,t){return e<t}]].forEach(function(r){var i=r[0],o=r[1];if("number"==typeof n[i]&&u.length>=s){var a=l.average(u);o(a,n[i])?t._raiseWarning(e,i,{values:u,samples:c}):o(a,n.clearValue||n[i])||t._clearWarning(e,i,{values:u,samples:c})}})}})},t}(s.EventEmitter);n.default=h},{"./errors":12,"./rtc/mos":25,"./rtc/stats":29,"./util":35,events:48}],35:[function(e,t,n){(function(e){(function(){function t(e){if(!(this instanceof t))return new t(e);this.message=e}function r(e){return!!e.userAgent.match("Electron")}function i(e,t){var n=!!t.userAgent.match("CriOS"),i=!!t.userAgent.match("HeadlessChrome"),o=void 0!==e.chrome&&"Google Inc."===t.vendor&&-1===t.userAgent.indexOf("OPR")&&-1===t.userAgent.indexOf("Edge");return n||r(t)||o||i}function o(t){return!!(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/firefox|fxios/i.test(t.userAgent)}function a(e){return!!e.vendor&&-1!==e.vendor.indexOf("Apple")&&e.userAgent&&-1===e.userAgent.indexOf("CriOS")&&-1===e.userAgent.indexOf("FxiOS")}t.prototype.toString=function(){return"Twilio.Exception: "+this.message},n.Exception=t,n.average=function(e){return e&&e.length?e.reduce(function(e,t){return e+t})/e.length:0},n.difference=function(e,t,n){n=n||function(e){return e};var r=new Set(t.map(n));return e.filter(function(e){return!r.has(n(e))})},n.isElectron=r,n.isChrome=i,n.isFirefox=o,n.isLegacyEdge=function(t){return!!(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/edge\/\d+/i.test(t.userAgent)},n.isSafari=a,n.isUnifiedPlanDefault=function(e,t,n,r){if(void 0===e||void 0===t||void 0===n||void 0===r||void 0===n.prototype||void 0===r.prototype)return!1;if(i(e,t)&&n.prototype.addTransceiver){var s=new n,c=!0;try{s.addTransceiver("audio")}catch(e){c=!1}return s.close(),c}return!!o(t)||!!a(t)&&"currentDirection"in r.prototype},n.queryToJson=function(e){return e?e.split("&").reduce(function(e,t){var n=t.split("="),r=n[0],i=decodeURIComponent((n[1]||"").replace(/\+/g,"%20"));return r&&(e[r]=i),e},{}):""},n.flatMap=function(e,t){var n=e instanceof Map||e instanceof Set?Array.from(e.values()):e;return t=t||function(e){return e},n.reduce(function(e,n){var r=t(n);return e.concat(r)},[])}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],36:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a=e("events"),s=e("ws"),c=e("./errors"),u=e("./log"),l=e("backoff"),d=5e3;!function(e){e.Connecting="connecting",e.Closed="closed",e.Open="open"}(o=n.WSTransportState||(n.WSTransportState={}));var p=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;r.state=o.Closed,r._log=u.default.getInstance(),r._shouldFallback=!1,r._uriIndex=0,r._moveUriIndex=function(){r._uriIndex++,r._uriIndex>=r._uris.length&&(r._uriIndex=0)},r._onSocketClose=function(e){if(r._log.info("Received websocket close event code: "+e.code+". Reason: "+e.reason),1006===e.code||1015===e.code){r.emit("error",{code:31005,message:e.reason||"Websocket connection to Twilio's signaling servers were unexpectedly ended. If this is happening consistently, there may be an issue resolving the hostname provided. If a region or an edge is being specified in Device setup, ensure it is valid.",twilioError:new c.SignalingErrors.ConnectionError});var t=r.state===o.Open||r._previousState===o.Open;!r._shouldFallback&&t||r._moveUriIndex(),r._shouldFallback=!0}r._closeSocket()},r._onSocketError=function(e){r._log.info("WebSocket received error: "+e.message),r.emit("error",{code:31e3,message:e.message||"WSTransport socket error",twilioError:new c.SignalingErrors.ConnectionDisconnected})},r._onSocketMessage=function(e){r._setHeartbeatTimeout(),r._socket&&"\n"===e.data?r._socket.send("\n"):r.emit("message",e)},r._onSocketOpen=function(){r._log.info("WebSocket opened successfully."),r._timeOpened=Date.now(),r._shouldFallback=!1,r._setState(o.Open),clearTimeout(r._connectTimeout),r._setHeartbeatTimeout(),r.emit("open")},r._connectTimeoutMs=n.connectTimeoutMs||d;var i=100;t&&t.length>1&&(i=Math.floor(4001*Math.random())+1e3);var a={factor:2,initialDelay:i,maxDelay:"number"==typeof n.backoffMaxMs?Math.max(n.backoffMaxMs,3e3):2e4,randomisationFactor:.4};return r._log.info("Initializing transport backoff using config: ",a),r._backoff=l.exponential(a),r._uris=t,r._WebSocket=n.WebSocket||s,r._backoff.on("backoff",function(e,t){r.state!==o.Closed&&r._log.info("Will attempt to reconnect WebSocket in "+t+"ms")}),r._backoff.on("ready",function(e){r.state!==o.Closed&&r._connect(e+1)}),r}return i(t,e),t.prototype.close=function(){this._log.info("WSTransport.close() called..."),this._close()},t.prototype.open=function(){this._log.info("WSTransport.open() called..."),!this._socket||this._socket.readyState!==s.CONNECTING&&this._socket.readyState!==s.OPEN?this._connect():this._log.info("WebSocket already open.")},t.prototype.send=function(e){if(!this._socket||this._socket.readyState!==s.OPEN)return!1;try{this._socket.send(e)}catch(e){return this._log.info("Error while sending message:",e.message),this._closeSocket(),!1}return!0},t.prototype._close=function(){this._setState(o.Closed),this._closeSocket()},t.prototype._closeSocket=function(){clearTimeout(this._connectTimeout),clearTimeout(this._heartbeatTimeout),this._log.info("Closing and cleaning up WebSocket..."),this._socket?(this._socket.removeEventListener("close",this._onSocketClose),this._socket.removeEventListener("error",this._onSocketError),this._socket.removeEventListener("message",this._onSocketMessage),this._socket.removeEventListener("open",this._onSocketOpen),this._socket.readyState!==s.CONNECTING&&this._socket.readyState!==s.OPEN||this._socket.close(),this._timeOpened&&Date.now()-this._timeOpened>1e4&&this._backoff.reset(),this._backoff.backoff(),delete this._socket,this.emit("close")):this._log.info("No WebSocket to clean up.")},t.prototype._connect=function(e){var t=this;e?this._log.info("Attempting to reconnect (retry #"+e+")..."):this._log.info("Attempting to connect..."),this._closeSocket(),this._setState(o.Connecting);var n=null;try{n=new this._WebSocket(this._uris[this._uriIndex])}catch(e){return this._log.info("Could not connect to endpoint:",e.message),this._close(),void this.emit("error",{code:31e3,message:e.message||"Could not connect to "+this._uris[this._uriIndex],twilioError:new c.SignalingErrors.ConnectionDisconnected})}delete this._timeOpened,this._connectTimeout=setTimeout(function(){t._log.info("WebSocket connection attempt timed out."),t._moveUriIndex(),t._closeSocket()},this._connectTimeoutMs),n.addEventListener("close",this._onSocketClose),n.addEventListener("error",this._onSocketError),n.addEventListener("message",this._onSocketMessage),n.addEventListener("open",this._onSocketOpen),this._socket=n},t.prototype._setHeartbeatTimeout=function(){var e=this;clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=setTimeout(function(){e._log.info("No messages received in 15 seconds. Reconnecting..."),e._shouldFallback=!0,e._closeSocket()},15e3)},t.prototype._setState=function(e){this._previousState=this.state,this.state=e},Object.defineProperty(t.prototype,"uri",{get:function(){return this._uris[this._uriIndex]},enumerable:!0,configurable:!0}),t}(a.EventEmitter);n.default=p},{"./errors":12,"./log":15,backoff:42,events:48,ws:1}],37:[function(e,t,n){"use strict";var r,i=e("babel-runtime/regenerator"),o=(r=i)&&r.__esModule?r:{default:r},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var s=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Deferred"),u=e("./EventTarget"),l=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._audioNode=null,i._pendingPlayDeferreds=[],i._loop=!1,i._src="",i._sinkId="default","string"!=typeof n&&(r=n),i._audioContext=e,i._audioElement=new(r.AudioFactory||Audio),i._bufferPromise=i._createPlayDeferred().promise,i._destination=i._audioContext.destination,i._gainNode=i._audioContext.createGain(),i._gainNode.connect(i._destination),i._XMLHttpRequest=r.XMLHttpRequestFactory||XMLHttpRequest,i.addEventListener("canplaythrough",function(){i._resolvePlayDeferreds()}),"string"==typeof n&&(i.src=n),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),a(t,[{key:"load",value:function(){this._load(this._src)}},{key:"pause",value:function(){this.paused||(this._audioElement.pause(),this._audioNode.stop(),this._audioNode.disconnect(this._gainNode),this._audioNode=null,this._rejectPlayDeferreds(new Error("The play() request was interrupted by a call to pause().")))}},{key:"play",value:function(){return s(this,void 0,void 0,o.default.mark(function e(){var t,n=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.paused){e.next=6;break}return e.next=3,this._bufferPromise;case 3:if(this.paused){e.next=5;break}return e.abrupt("return");case 5:throw new Error("The play() request was interrupted by a call to pause().");case 6:return this._audioNode=this._audioContext.createBufferSource(),this._audioNode.loop=this.loop,this._audioNode.addEventListener("ended",function(){n._audioNode&&n._audioNode.loop||n.dispatchEvent("ended")}),e.next=11,this._bufferPromise;case 11:if(t=e.sent,!this.paused){e.next=14;break}throw new Error("The play() request was interrupted by a call to pause().");case 14:if(this._audioNode.buffer=t,this._audioNode.connect(this._gainNode),this._audioNode.start(),!this._audioElement.srcObject){e.next=19;break}return e.abrupt("return",this._audioElement.play());case 19:case"end":return e.stop()}},e,this)}))}},{key:"setSinkId",value:function(e){return s(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof this._audioElement.setSinkId){t.next=2;break}throw new Error("This browser does not support setSinkId.");case 2:if(e!==this.sinkId){t.next=4;break}return t.abrupt("return");case 4:if("default"!==e){t.next=11;break}return this.paused||this._gainNode.disconnect(this._destination),this._audioElement.srcObject=null,this._destination=this._audioContext.destination,this._gainNode.connect(this._destination),this._sinkId=e,t.abrupt("return");case 11:return t.next=13,this._audioElement.setSinkId(e);case 13:if(!this._audioElement.srcObject){t.next=15;break}return t.abrupt("return");case 15:this._gainNode.disconnect(this._audioContext.destination),this._destination=this._audioContext.createMediaStreamDestination(),this._audioElement.srcObject=this._destination.stream,this._sinkId=e,this._gainNode.connect(this._destination);case 20:case"end":return t.stop()}},t,this)}))}},{key:"_createPlayDeferred",value:function(){var e=new c.default;return this._pendingPlayDeferreds.push(e),e}},{key:"_load",value:function(e){var t=this;this._src&&this._src!==e&&this.pause(),this._src=e,this._bufferPromise=new Promise(function(n,r){return s(t,void 0,void 0,o.default.mark(function t(){var r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",this._createPlayDeferred().promise);case 2:return t.next=4,d(this._audioContext,this._XMLHttpRequest,e);case 4:r=t.sent,this.dispatchEvent("canplaythrough"),n(r);case 7:case"end":return t.stop()}},t,this)}))})}},{key:"_rejectPlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(t){return(0,t.reject)(e)})}},{key:"_resolvePlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(t){return(0,t.resolve)(e)})}},{key:"destination",get:function(){return this._destination}},{key:"loop",get:function(){return this._loop},set:function(e){if(!e&&this.loop&&!this.paused){var t=this;this._audioNode.addEventListener("ended",function e(){t._audioNode.removeEventListener("ended",e),t.pause()})}this._loop=e}},{key:"muted",get:function(){return 0===this._gainNode.gain.value},set:function(e){this._gainNode.gain.value=e?0:1}},{key:"paused",get:function(){return null===this._audioNode}},{key:"src",get:function(){return this._src},set:function(e){this._load(e)}},{key:"srcObject",get:function(){return this._audioElement.srcObject},set:function(e){this._audioElement.srcObject=e}},{key:"sinkId",get:function(){return this._sinkId}}]),t}();function d(e,t,n){return s(this,void 0,void 0,o.default.mark(function r(){var i,a;return o.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(i=new t).open("GET",n,!0),i.responseType="arraybuffer",r.next=5,new Promise(function(e){i.addEventListener("load",e),i.send()});case 5:return a=r.sent,r.prev=6,r.abrupt("return",e.decodeAudioData(a.target.response));case 10:return r.prev=10,r.t0=r.catch(6),r.abrupt("return",new Promise(function(t){e.decodeAudioData(a.target.response,t)}));case 13:case"end":return r.stop()}},r,this,[[6,10]])}))}n.default=l},{"./Deferred":38,"./EventTarget":39,"babel-runtime/regenerator":41}],38:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return r(e,[{key:"reject",get:function(){return this._reject}},{key:"resolve",get:function(){return this._resolve}}]),e}();n.default=i},{}],39:[function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("events"),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventEmitter=new i.EventEmitter}return r(e,[{key:"addEventListener",value:function(e,t){return this._eventEmitter.addListener(e,t)}},{key:"dispatchEvent",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=this._eventEmitter).emit.apply(t,[e].concat(r))}},{key:"removeEventListener",value:function(e,t){return this._eventEmitter.removeListener(e,t)}}]),e}();n.default=o},{events:48}],40:[function(e,t,n){"use strict";var r=e("./AudioPlayer");t.exports=r.default},{"./AudioPlayer":37}],41:[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":54}],42:[function(e,t,n){var r=e("./lib/backoff"),i=e("./lib/strategy/exponential"),o=e("./lib/strategy/fibonacci"),a=e("./lib/function_call.js");t.exports.Backoff=r,t.exports.FunctionCall=a,t.exports.FibonacciStrategy=o,t.exports.ExponentialStrategy=i,t.exports.fibonacci=function(e){return new r(new o(e))},t.exports.exponential=function(e){return new r(new i(e))},t.exports.call=function(e,t,n){var r=Array.prototype.slice.call(arguments);return e=r[0],t=r.slice(1,r.length-1),n=r[r.length-1],new a(e,t,n)}},{"./lib/backoff":43,"./lib/function_call.js":44,"./lib/strategy/exponential":45,"./lib/strategy/fibonacci":46}],43:[function(e,t,n){var r=e("events"),i=e("precond");function o(e){r.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}e("util").inherits(o,r.EventEmitter),o.prototype.failAfter=function(e){i.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},o.prototype.backoff=function(e){i.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},o.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},o.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=o},{events:48,precond:50,util:60}],44:[function(e,t,n){var r=e("events"),i=e("precond"),o=e("util"),a=e("./backoff"),s=e("./strategy/fibonacci");function c(e,t,n){r.EventEmitter.call(this),i.checkIsFunction(e,"Expected fn to be a function."),i.checkIsArray(t,"Expected args to be an array."),i.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=c.DEFAULT_RETRY_PREDICATE_,this.state_=c.State_.PENDING}o.inherits(c,r.EventEmitter),c.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},c.DEFAULT_RETRY_PREDICATE_=function(e){return!0},c.prototype.isPending=function(){return this.state_==c.State_.PENDING},c.prototype.isRunning=function(){return this.state_==c.State_.RUNNING},c.prototype.isCompleted=function(){return this.state_==c.State_.COMPLETED},c.prototype.isAborted=function(){return this.state_==c.State_.ABORTED},c.prototype.setStrategy=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},c.prototype.retryIf=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},c.prototype.getLastResult=function(){return this.lastResult_.concat()},c.prototype.getNumRetries=function(){return this.numRetries_},c.prototype.failAfter=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},c.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=c.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},c.prototype.start=function(e){i.checkState(!this.isAborted(),"FunctionCall is aborted."),i.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new s;this.backoff_=e?e(t):new a(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=c.State_.RUNNING,this.doCall_(!1)},c.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);r.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},c.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},c.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,r.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=c.State_.COMPLETED,this.doCallback_())}},c.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},t.exports=c},{"./backoff":43,"./strategy/fibonacci":46,events:48,precond:50,util:60}],45:[function(e,t,n){var r=e("util"),i=e("precond"),o=e("./strategy");function a(e){o.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=a.DEFAULT_FACTOR,e&&void 0!==e.factor&&(i.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}r.inherits(a,o),a.DEFAULT_FACTOR=2,a.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},a.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=a},{"./strategy":47,precond:50,util:60}],46:[function(e,t,n){var r=e("util"),i=e("./strategy");function o(e){i.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}r.inherits(o,i),o.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=o},{"./strategy":47,util:60}],47:[function(e,t,n){e("events"),e("util");function r(e){return null!=e}function i(e){if(r((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(r(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(r(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}i.prototype.getMaxDelay=function(){return this.maxDelay_},i.prototype.getInitialDelay=function(){return this.initialDelay_},i.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},i.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},i.prototype.reset=function(){this.reset_()},i.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=i},{events:48,util:60}],48:[function(e,t,n){var r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function a(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0;var s,c=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),s=0===u.x}catch(e){s=!1}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,i){var o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),s=a[t]):(a=e._events=r(null),e._eventsCount=0),s){if("function"==typeof s?s=a[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),!s.warned&&(o=l(e))&&o>0&&s.length>o){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else s=a[t]=n,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=o.call(p,r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length):[]}function m(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}s?Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');c=e}}):a.defaultMaxListeners=c,a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){var t,n,r,i,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(n=a[e]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=g(e,r),o=0;o<r;++o)i[o].call(n)}(n,u,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=g(e,i),a=0;a<i;++a)o[a].call(n,r)}(n,u,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=g(e,o),s=0;s<o;++s)a[s].call(n,r,i)}(n,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=g(e,a),c=0;c<a;++c)s[c].call(n,r,i,o)}(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=g(e,i),a=0;a<i;++a)o[a].apply(n,r)}(n,u,this,i)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,o,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=r(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,o=a;break}if(o<0)return this;0===o?n.shift():function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,n,o;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=r(null):delete n[e]),this;if(0===arguments.length){var a,s=i(n);for(o=0;o<s.length;++o)"removeListener"!==(a=s[o])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],49:[function(e,t,n){!function(e,n){"use strict";"function"==typeof define&&define.amd?define(n):"object"==typeof t&&t.exports?t.exports=n():e.log=n()}(this,function(){"use strict";var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function s(r,s,c){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?o:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}(r)||function(e,n,r){return function(){typeof console!==t&&(a.call(this,n,r),this[e].apply(this,arguments))}}.apply(this,arguments)}function c(e,n,i){var o,c=this,u="loglevel";function l(){var e;if(typeof window!==t){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}e&&(u+=":"+e),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=i||s,c.getLevel=function(){return o},c.setLevel=function(n,i){if("string"==typeof n&&void 0!==c.levels[n.toUpperCase()]&&(n=c.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),a.call(c,n,e),typeof console===t&&n<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){l()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var d=l();null==d&&(d=null==n?"WARN":n),c.setLevel(d,!1)}var u=new c,l={};u.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new c(e,u.getLevel(),u.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=d),u},u.getLoggers=function(){return l},u})},{}],50:[function(e,t,n){t.exports=e("./lib/checks")},{"./lib/checks":51}],51:[function(e,t,n){var r=e("util"),i=t.exports=e("./errors");function o(e,t,n,i){n=n||"";var o=new e(r.format.apply(this,[n].concat(i)));throw Error.captureStackTrace(o,t),o}function a(e,t,n){o(i.IllegalArgumentError,e,t,n)}function s(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function c(e){return function(t,n){var r=s(t);if(r==e)return t;a(arguments.callee,n||'Expected "'+e+'" but got "'+r+'".',Array.prototype.slice.call(arguments,2))}}t.exports.checkArgument=function(e,t){e||a(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){e||function(e,t,n){o(i.IllegalStateError,e,t,n)}(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;a(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;a(arguments.callee,t||'Expected value to be defined and not null but got "'+s(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=c("string"),t.exports.checkIsArray=c("array"),t.exports.checkIsNumber=c("number"),t.exports.checkIsBoolean=c("boolean"),t.exports.checkIsFunction=c("function"),t.exports.checkIsObject=c("object")},{"./errors":52,util:60}],52:[function(e,t,n){var r=e("util");function i(e){Error.call(this,e),this.message=e}function o(e){Error.call(this,e),this.message=e}r.inherits(i,Error),i.prototype.name="IllegalArgumentError",r.inherits(o,Error),o.prototype.name="IllegalStateError",t.exports.IllegalStateError=o,t.exports.IllegalArgumentError=i},{util:60}],53:[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var u,l=[],d=!1,p=-1;function f(){d&&u&&(d=!1,u.length?l=u.concat(l):p=-1,l.length&&h())}function h(){if(!d){var e=c(f);d=!0;for(var t=l.length;t;){for(u=l,l=[];++p<t;)u&&u[p].run();p=-1,t=l.length}u=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new m(e,t)),1!==l.length||d||c(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],54:[function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},{"./runtime":55}],55:[function(e,t,n){!function(e){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u="object"==typeof t,l=e.regeneratorRuntime;if(l)u&&(t.exports=l);else{(l=e.regeneratorRuntime=u?t.exports:{}).wrap=b;var d="suspendedStart",p="suspendedYield",f="executing",h="completed",m={},g={};g[a]=function(){return this};var v=Object.getPrototypeOf,_=v&&v(v(R([])));_&&_!==r&&i.call(_,a)&&(g=_);var y=E.prototype=S.prototype=Object.create(g);C.prototype=y.constructor=E,E.constructor=C,E[c]=C.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===C||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(y),e},l.awrap=function(e){return{__await:e}},k(T.prototype),T.prototype[s]=function(){return this},l.AsyncIterator=T,l.async=function(e,t,n,r){var i=new T(b(e,t,n,r));return l.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},k(y),y[c]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},l.values=R,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function b(e,t,n,r){var i=t&&t.prototype instanceof S?t:S,o=Object.create(i.prototype),a=new D(r||[]);return o._invoke=function(e,t,n){var r=d;return function(i,o){if(r===f)throw new Error("Generator is already running");if(r===h){if("throw"===i)throw o;return A()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=w(e,t,n);if("normal"===c.type){if(r=n.done?h:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=h,n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function S(){}function C(){}function E(){}function k(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(e){var t;this._invoke=function(n,r){function o(){return new Promise(function(t,o){!function t(n,r,o,a){var s=w(e[n],e,r);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},a)}a(s.arg)}(n,r,t,o)})}return t=t?t.then(o,o):o()}}function x(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,x(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=w(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},{}],56:[function(e,t,n){"use strict";var r=e("sdp");function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var l=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},l.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},l.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},l.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},l.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},l.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},l.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1;var u=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(u)),a.candidate.candidate=u}var l=r.getMediaSections(i.localDescription.sdp);l[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i.localDescription.sdp=r.getDescription(i.localDescription.sdp)+l.join("");var d=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},l.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,l=a.dtlsTransport,d=a.localCapabilities,p=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!a.isDatachannel){var f=r.getIceParameters(e,n),h=r.getDtlsParameters(e,n);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,f,s?"controlling":"controlled"),"new"===l.state&&l.start(h));var m=o(d,p);i._transceive(a,m.codecs.length>0,!1)}})}return i.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var l={};o.remoteStreams.forEach(function(e){l[e.id]=e});var d=[],p=r.splitSections(i.sdp),f=p.shift(),h=r.matchPrefix(f,"a=ice-lite").length>0,m=r.matchPrefix(f,"a=group:BUNDLE ").length>0;o.usingBundle=m;var g=r.matchPrefix(f,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,p.forEach(function(a,c){var u=r.splitLines(a),p=r.getKind(a),g=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,v=u[0].substr(2).split(" ")[2],_=r.getDirection(a,f),y=r.parseMsid(a),b=r.getMid(a)||r.generateIdentifier();if("application"!==p||"DTLS/SCTP"!==v){var w,S,C,E,k,T,x,I,P,D,R,A=r.parseRtpParameters(a);g||(D=r.getIceParameters(a,f),(R=r.getDtlsParameters(a,f)).role="client"),x=r.parseRtpEncodingParameters(a);var O=r.parseRtcpParameters(a),L=r.matchPrefix(a,"a=end-of-candidates",f).length>0,M=r.matchPrefix(a,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!g&&m&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(S=(w=o.transceivers[c]).iceGatherer,C=w.iceTransport,E=w.dtlsTransport,k=w.rtpReceiver,T=w.sendEncodingParameters,I=w.localCapabilities,o.transceivers[c].recvEncodingParameters=x,o.transceivers[c].remoteCapabilities=A,o.transceivers[c].rtcpParameters=O,M.length&&"new"===C.state&&(!h&&!L||m&&0!==c?M.forEach(function(e){s(w.iceTransport,e)}):C.setRemoteCandidates(M)),m&&0!==c||("new"===C.state&&C.start(S,D,"controlling"),"new"===E.state&&E.start(R)),o._transceive(w,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!k||"sendrecv"!==_&&"sendonly"!==_?delete w.rtpReceiver:(P=k.track,y?(l[y.stream]||(l[y.stream]=new e.MediaStream),n(P,l[y.stream]),d.push([P,k,l[y.stream]])):(l.default||(l.default=new e.MediaStream),n(P,l.default),d.push([P,k,l.default]))));else{(w=o.transceivers[c]||o._createTransceiver(p)).mid=b,w.iceGatherer||(w.iceGatherer=o._createIceGatherer(c,m)),M.length&&"new"===w.iceTransport.state&&(!L||m&&0!==c?M.forEach(function(e){s(w.iceTransport,e)}):w.iceTransport.setRemoteCandidates(M)),I=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(I.codecs=I.codecs.filter(function(e){return"rtx"!==e.name})),T=w.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,N=!1;if("sendrecv"===_||"sendonly"===_){if(N=!w.rtpReceiver,k=w.rtpReceiver||new e.RTCRtpReceiver(w.dtlsTransport,p),N)P=k.track,y&&"-"===y.stream||(y?(l[y.stream]||(l[y.stream]=new e.MediaStream,Object.defineProperty(l[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(P,"id",{get:function(){return y.track}}),j=l[y.stream]):(l.default||(l.default=new e.MediaStream),j=l.default)),j&&(n(P,j),w.associatedRemoteMediaStreams.push(j)),d.push([P,k,j])}else w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(t){var n,r,i=t.getTracks().find(function(e){return e.id===w.rtpReceiver.track.id});i&&(n=i,(r=t).removeTrack(n),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))}),w.associatedRemoteMediaStreams=[]);w.localCapabilities=I,w.remoteCapabilities=A,w.rtpReceiver=k,w.rtcpParameters=O,w.sendEncodingParameters=T,w.recvEncodingParameters=x,o._transceive(o.transceivers[c],!1,N)}}else o.transceivers[c]={mid:b,isDatachannel:!0}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o.remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(l).forEach(function(t){var n=l[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",r)})}d.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(o,t,r,[n])})}}),d.forEach(function(e){e[2]||u(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},l.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,a=n.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=l}),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},l.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=r.getMediaSections(n.remoteDescription.sdp).length;n.transceivers.forEach(function(e,r){if(!(r+1>s))if(e.isDatachannel)a+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n";else{var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},l.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!n.remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){a=u;break}var l=n.transceivers[a];if(!l)return o(c("OperationError","Can not add ICE candidate"));if(l.isDatachannel)return i();var d=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===a||a>0&&l.iceTransport!==n.transceivers[0].iceTransport)&&!s(l.iceTransport,d))return o(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=r.getMediaSections(n.remoteDescription.sdp))[a]+="a="+(d.type?p:"end-of-candidates")+"\r\n",n.remoteDescription.sdp=t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].isDatachannel||(n.transceivers[f].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n.remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",n.remoteDescription.sdp=r.getDescription(n.remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);i()})},l.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});return new Promise(function(t){var n=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){var r;e[t].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[t]).type]||r.type,n.set(t,e[t])})}),t(n)})})};var d=["createOffer","createAnswer"];return d.forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),l}},{sdp:57}],57:[function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=l})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=r)},{}],58:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],59:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],60:[function(e,t,n){(function(t,r){(function(){var i=/%[sdj%]/g;n.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,a=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),c=r[n];n<o;c=r[++n])m(c)||!b(c)?a+=" "+c:a+=" "+s(c);return a},n.deprecate=function(e,i){if(_(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,a={};function s(e,t){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&n._extend(r,t),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,e,r.depth)}function c(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function u(e,t){return e}function l(e,t,r){if(e.customInspect&&t&&C(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return v(i)||(i=l(e,i,r)),i}var o=function(e,t){if(_(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(g(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,t);if(o)return o;var a=Object.keys(t),s=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),S(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return d(t);if(0===a.length){if(C(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(y(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return d(t)}var u,b="",E=!1,k=["{","}"];(f(t)&&(E=!0,k=["[","]"]),C(t))&&(b=" [Function"+(t.name?": "+t.name:"")+"]");return y(t)&&(b=" "+RegExp.prototype.toString.call(t)),w(t)&&(b=" "+Date.prototype.toUTCString.call(t)),S(t)&&(b=" "+d(t)),0!==a.length||E&&0!=t.length?r<0?y(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=E?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)x(t,String(a))?o.push(p(e,t,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))}),o}(e,t,r,s,a):a.map(function(n){return p(e,t,r,s,n,E)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,b,k)):k[0]+b+k[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),x(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(c.value)<0?(s=m(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),_(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function f(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function _(e){return void 0===e}function y(e){return b(e)&&"[object RegExp]"===E(e)}function b(e){return"object"==typeof e&&null!==e}function w(e){return b(e)&&"[object Date]"===E(e)}function S(e){return b(e)&&("[object Error]"===E(e)||e instanceof Error)}function C(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(_(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=t.pid;a[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else a[e]=function(){};return a[e]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=f,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=function(e){return null==e},n.isNumber=g,n.isString=v,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=_,n.isRegExp=y,n.isObject=b,n.isDate=w,n.isError=S,n.isFunction=C,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":59,_process:53,inherits:58}]},{},[3])(3);if("function"==typeof define&&define.amd)define([],function(){return t});else{var n=e.Twilio=e.Twilio||{};n.Call=n.Call||t.Call,n.Device=n.Device||t.Device,n.PStream=n.PStream||t.PStream,n.PreflightTest=n.PreflightTest||t.PreflightTest,n.Logger=n.Logger||t.Logger}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this),function(e,t){"use strict";"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.log=t()}(this,function(){"use strict";var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function s(r,s,c){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?o:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}(r)||function(e,n,r){return function(){typeof console!==t&&(a.call(this,n,r),this[e].apply(this,arguments))}}.apply(this,arguments)}function c(e,n,i){var o,c=this;n=null==n?"WARN":n;var u="loglevel";function l(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"==typeof e&&(u=void 0),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=i||s,c.getLevel=function(){return o},c.setLevel=function(n,i){if("string"==typeof n&&void 0!==c.levels[n.toUpperCase()]&&(n=c.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),a.call(c,n,e),typeof console===t&&n<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){n=e,l()||c.setLevel(e,!1)},c.resetLevel=function(){c.setLevel(n,!1),function(){if(typeof window!==t&&u){try{return void window.localStorage.removeItem(u)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var d=l();null==d&&(d=n),c.setLevel(d,!1)}var u=new c,l={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new c(e,u.getLevel(),u.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=d),u},u.getLoggers=function(){return l},u.default=u,u}),function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var n={exports:{}};t(n,n.exports),e.remote=n.exports}}(this,function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=window;if(!r)throw new Error("Plugin for browser usage only");var i=void 0;function o(e){try{return JSON.stringify(e)}catch(e){if(!i)try{var t={};t.a=t,JSON.stringify(t)}catch(e){i=e.message}if(e.message===i)return"[Circular]";throw e}}function a(e){var t="",n=0;return e.length>1&&"string"==typeof e[0]&&(t=(t=e[0].replace(/(%?)(%([sdjo]))/g,function(t,r,i,a){if(!r){var s=e[n+=1],c="";switch(a){case"s":c+=s;break;case"d":c+=+s;break;case"j":c=o(s);break;case"o":var u=o(s);"{"!==u[0]&&"["!==u[0]&&(u="<"+u+">"),c=function(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}(s)+u}return c}return t})).replace(/%{2,2}/g,"%"),n+=1),e.length>n&&(t&&(t+=" "),t+=e.slice(n).join(" ")),t}var s=Object.prototype.hasOwnProperty;function c(){try{throw new Error}catch(e){return e.stack}}function u(e){var t=this,n=[],r=[];this.length=function(){return n.length},this.sent=function(){return r.length},this.push=function(t){n.push(t),n.length>e&&n.shift()},this.send=function(){return r.length||(r=n,n=[]),r},this.confirm=function(){r=[],t.content=""},this.fail=function(){var i=1+n.length+r.length-e;i>0&&(r.splice(0,i),n=r.concat(n),t.confirm())}}var l=!!c(),d=void 0,p=void 0,f=void 0;function h(e){return"["+e.timestamp+"] "+e.level.label.toUpperCase()+(e.logger?" ("+e.logger+")":"")+": "+e.message+(e.stacktrace?"\n"+e.stacktrace:"")}function m(){throw new Error("You can't set token for a not appled plugin")}var g=r.remote,v={url:"/logger",method:"POST",headers:{},token:"",onUnauthorized:function(){},timeout:0,interval:1e3,level:"trace",backoff:{multiplier:2,jitter:.1,limit:3e4},capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:h},_={noConflict:function(){return r.remote===_&&(r.remote=g),_},plain:h,json:function(e){return e.level=e.level.label,e},apply:function(e,t){if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(d)throw new Error("You can assign a plugin only one time");if(!r.XMLHttpRequest)return e;d=e;var i=function e(){for(var t={},r=0;r<arguments.length;r+=1){var i=Object(arguments[r]);for(var o in i)s.call(i,o)&&(t[o]="object"!==n(i[o])||Array.isArray(i[o])?i[o]:e(t[o],i[o]))}return t}(v,t);i.capacity=i.capacity||500;var o=i.backoff,h="object"===(void 0===o?"undefined":n(o))?function(e){var t=e*o.multiplier;return t>o.limit&&(t=o.limit),t+=t*o.jitter*Math.random()}:o,m=i.interval,g=void 0,y=void 0,b=!1,w=!1,S=new u(i.capacity);function C(){if(!w&&!b&&void 0!==i.token){if(!S.sent()){if(!S.length())return;var e=S.send();S.content=y?'{"logs":['+e.join(",")+"]}":e.join("\n")}b=!0;var t=new r.XMLHttpRequest;t.open(i.method,i.url,!0),t.setRequestHeader("Content-Type",g),i.token&&t.setRequestHeader("Authorization","Bearer "+i.token);var n=i.headers;for(var o in n)if(s.call(n,o)){var a=n[o];a&&t.setRequestHeader(o,a)}var c=void 0;i.timeout&&(c=r.setTimeout(function(){b=!1,t.abort(),u()},i.timeout)),t.onreadystatechange=function(){if(4===t.readyState)if(b=!1,r.clearTimeout(c),200===t.status)m=i.interval,S.confirm(),u(!0);else{if(401===t.status){var e=i.token;i.token=void 0,i.onUnauthorized(e)}u()}},t.send(S.content)}function u(e){e||(m=h(m||1),S.fail()),w=!0,r.setTimeout(function(){w=!1,C()},m)}}return p=e.methodFactory,f=function(e,t,n){var r=p(e,t,n),o=l&&i.stacktrace.levels.some(function(t){return t===e}),s=d.levels[e.toUpperCase()],u=s>=d.levels[i.level.toUpperCase()];return function(){for(var t=arguments.length,l=Array(t),p=0;p<t;p++)l[p]=arguments[p];if(u){var f=i.timestamp(),h=o?c():"";if(h){var m=h.split("\n");m.splice(0,i.stacktrace.excess+3);var v=i.stacktrace.depth;if(v&&m.length!==v+1)h=m.splice(0,v).join("\n"),m.length&&(h+="\n    and "+m.length+" more");else h=m.join("\n")}var _=i.format({message:a(l),level:{label:e,value:s},logger:n||"",timestamp:f,stacktrace:h});void 0===y&&(g=(y="string"!=typeof _)?"application/json":"text/plain");var b="";if(y)try{b+=JSON.stringify(_)}catch(e){return r.apply(void 0,l),void d.getLogger("logger").error(e)}else b+=_;S.push(b),C()}r.apply(void 0,l)}},e.methodFactory=f,e.setLevel(e.getLevel()),_.setToken=function(e){i.token=e,C()},e},disable:function(){if(!d)throw new Error("You can't disable a not appled plugin");if(f!==d.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");d.methodFactory=p,d.setLevel(d.getLevel()),d=void 0,_.setToken=m},setToken:m};t.default=_,e.exports=t.default}),function(){let e=null,t="";window.twilioLogger=Twilio.Logger,twilioLogger.setLevel("ERROR"),twilioLogger.getLogger=function(){};const n=document.getElementById("speaker-devices"),r=document.getElementById("microphone-devices");n.addEventListener("change",function(){const t=Array.from(n.children).filter(e=>e.selected).map(e=>e.getAttribute("data-id"));e.audio.speakerDevices.set(t)});const i=()=>{if(r.innerHTML="",e.audio.availableInputDevices.size<1)return twilioLogger.error("%j",window.twilioLoggerCreateError({name:"Update input device",message:"Not found Microphone device"})),PhoneWidget.addLogError("Not found Microphone device"),void PhoneWidget.getDeviceState().microphoneError();let t=!1;e.audio.availableInputDevices.forEach(e=>{const n=document.createElement("option");n.label=e.label,n.value=e.deviceId,n.innerText=e.label,!1===t&&(n.setAttribute("selected","selected"),t=!0),r.appendChild(n)}),PhoneWidget.getDeviceState().microphoneSelected()},o=()=>{let t=e.audio.speakerDevices.get();n.innerHTML="",e.audio.availableOutputDevices.forEach(function(e,r){let i=0===t.size&&"default"===r;t.forEach(function(e){e.deviceId===r&&(i=!0)});let o=document.createElement("option");o.label=e.label,o.setAttribute("data-id",r),i&&o.setAttribute("selected","selected"),n.appendChild(o)})},a=()=>{PhoneWidget.addLog("Update Twilio Access Token..."),$.getJSON(t).then(function(t){PhoneWidget.addLogSuccess("Got a Twilio Access token."),t.data.token===e.token?PhoneWidget.addLogSuccess("Device Twilio Access token is equal of new token."):e.updateToken(t.data.token),setTimeout(async()=>a(),1e3*t.data.refreshTime)}).catch(function(e){PhoneWidget.addLogError("Get Twilio Access token error. Reload page!"),e.url=t,e.message||(e.message=e.responseText||"Twilio token update"),twilioLogger.error("%j",e)})},s=t=>{PhoneWidget.incomingSoundOff(),t.on("accept",e=>{window.phoneWidget.device.activeCallSid=e.parameters.CallSid,PhoneWidget.removeTwilioInternalIncomingConnection(),PhoneWidget.freeDialButton(),PhoneWidget.setActiveCall(e),PhoneWidget.incomingSoundOff(),PhoneWidget.soundConnect(),e.on("volume",function(e,t){PhoneWidget.volumeIndicatorsChange(e,t)})}),t.on("cancel",()=>{PhoneWidget.freeDialButton(),PhoneWidget.removeTwilioInternalIncomingConnection(),PhoneWidget.incomingSoundOff()}),t.on("disconnect",t=>{try{e.audio.unsetInputDevice()}catch(e){console.log(e)}PhoneWidget.freeDialButton(),PhoneWidget.removeTwilioInternalIncomingConnection(),PhoneWidget.soundDisconnect(),PhoneWidget.incomingSoundOff(),window.sendCommandUpdatePhoneWidgetCurrentCalls(t.parameters.CallSid,window.userId,window.generalLinePriorityIsEnabled)}),t.on("error",e=>{createNotify("Call error","More info in logs panel","error"),twilioLogger.error("%j",e),PhoneWidget.addLog(e)});let n=null,i=null,o=null;if(t.customParameters.forEach(function(e,t){"autoAccept"===t&&"false"===e?n=!1:"isInternal"===t&&"true"===e?i=!0:"requestCall"===t&&(o=e)}),!1===n){if(!0===i&&null!==o){let e=JSON.parse(atob(o),function(e,t){return"false"!==t&&("true"===t||t)});e.callSid=t.parameters.CallSid,PhoneWidget.setTwilioInternalIncomingConnection(t),PhoneWidget.refreshCallStatus(e)}}else navigator.userAgent.toLowerCase().indexOf("firefox")>-1?t.accept():e.audio.setInputDevice(r.value).then(()=>{t.accept()}).catch(e=>{let t=window.twilioLoggerCreateError(e,"Microphone error");twilioLogger.error("%j",t),PhoneWidget.addLog(e),createNotify("Accept incoming connection",e.message,"error")})},c=()=>{PhoneWidget.addLogSuccess("Twilio Device Registering.")},u=()=>{PhoneWidget.getDeviceState().speakerUnknown(),PhoneWidget.getDeviceState().microphoneUnknown(),PhoneWidget.getDeviceState().twilioRegistered(),l(),e.audio.removeListener("deviceChange",i),e.audio.addListener("deviceChange",i),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{i(),e.getTracks().forEach(e=>e.stop())}).catch(e=>{let t=window.twilioLoggerCreateError(e,"Microphone error");twilioLogger.error("%j",t),PhoneWidget.addLog(e),PhoneWidget.getDeviceState().microphoneError()}),e.removeListener("incoming",s),e.addListener("incoming",s)},l=()=>{!e.audio.isOutputSelectionSupported||e.audio.speakerDevices.get().size>0?PhoneWidget.getDeviceState().speakerSelected():PhoneWidget.getDeviceState().speakerError()},d=(e,t)=>{twilioLogger.error("%j",e),PhoneWidget.addLog(e),PhoneWidget.freeDialButton(),PhoneWidget.incomingSoundOff()},p=()=>{PhoneWidget.getDeviceState().resetDevices("Twilio Device unregistered"),PhoneWidget.incomingSoundOff()};window.twilioLoggerCreateError=((e,t)=>({name:e.name||t,code:e.code,message:e.message||t,description:e.description||t,comment:e.comment||t,explanation:e.explanation||t,causes:e.causes,solutions:e.solutions,originalError:e.originalError}));const f=()=>PhoneWidget.getDeviceState().phoneDisconnected("Phone connection is closed");window.phoneWidget.device.initialize={Init:function(n,r,s){if(t="/phone/get-token?deviceId="+n,PhoneWidget.getDeviceState().phoneConnected(n,r),window.removeEventListener("beforeunload",f),window.addEventListener("beforeunload",f),null!==e)return"registered"!==e.state?(PhoneWidget.getDeviceState().twilioUnknown(),void PhoneWidget.addLogError("Refresh page!")):(PhoneWidget.getDeviceState().twilioRegistered(),l(),i(),void a());s&&remote.apply(twilioLogger,{url:"/voip/log",interval:1e4,stacktrace:{levels:["error"],depth:10,excess:0},format:e=>({deviceId:PhoneWidget.getDeviceState().getDeviceId(),level:e.level.value,message:e.message,timestamp:e.timestamp,stacktrace:e.stacktrace}),timestamp:function(){let e=new Date,t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2),r=e.getFullYear(),i=("0"+e.getHours()).slice(-2),o=("0"+e.getMinutes()).slice(-2),a=("0"+e.getSeconds()).slice(-2);return r+"-"+n+"-"+t+" "+i+":"+o+":"+a}}),PhoneWidget.addLog("Requesting Twilio Access Token..."),$.getJSON(t).then(function(t){var n;PhoneWidget.addLog("Got a Twilio Access token."),n={token:t.data.token,refreshTime:t.data.refreshTime},PhoneWidget.addLog("Init Twilio Device..."),e=new Twilio.Device(n.token,{closeProtection:!0,codecPreferences:["opus","pcmu"]}),setTimeout(async()=>a(),1e3*n.refreshTime),e.on("registering",c),e.on("registered",u),e.on("unregistered",p),e.on("error",d),e.audio.on("deviceChange",o),e.audio.isOutputSelectionSupported?$("#output-selection").show():($(document).find(".phone-widget__additional-bar .tabs__nav.tab-nav .wp-tab-device").hide(),$(document).find(".phone-widget__additional-bar .wp-devices-tab-log").addClass("active-tab"),$(document).find(".phone-widget__additional-bar #tab-device").hide(),$(document).find(".phone-widget__additional-bar #tab-logs").show()),e.register()}).catch(function(e){PhoneWidget.addLogError("Get Twilio Access token error. Reload page!"),console.error(e)})}}}();