window.phoneWidget={},window.phoneWidget.initParams={},window.phoneWidget.device={},window.phoneWidget.device.activeCallSid=null,window.phoneWidget.device.state={},window.phoneWidget.device.state.initialize={},window.phoneWidget.device.initialize={},window.phoneWidget.storage={},window.phoneWidget.emptyFunc=function(e){},window.phoneDeviceRemoteLogsEnabled=!1,function(){window.phoneWidget.eventDispatcher=new class{constructor(){this.events={}}addListener(e,t){return"function"!=typeof t?(console.error(`The listener callback must be a function, the given type is ${typeof t}`),!1):"string"!=typeof e?(console.error(`The event name must be a string, the given type is ${typeof e}`),!1):(void 0===this.events[e]&&(this.events[e]={listeners:[]}),void this.events[e].listeners.push(t))}removeListener(e,t){if(void 0===this.events[e])return console.error(`This event: ${e} does not exist`),!1;this.events[e].listeners=this.events[e].listeners.filter(e=>e.toString()!==t.toString())}dispatch(e,t){if(void 0===this.events[e])return!1;this.events[e].listeners.forEach(e=>{e(t)})}}}(),window.phoneWidget.events={callUpdate:"callUpdate",conferenceUpdate:"conferenceUpdate",priorityQueueAccepted:"priorityQueueAccepted",priorityQueueCounterChanged:"priorityQueueCounterChanged"},function(){window.phoneWidget.call={Call:function e(t){this.data=t,this.canTransfer=function(){return 3!==this.data.typeId&&"In progress"===this.data.status&&!this.data.isInternal&&!this.data.isHold},this.block=function(){this.data.blocked=!0},this.unBlock=function(){this.data.blocked=!1},this.isBlocked=function(){return!0===this.data.blocked},this.canHoldUnHold=function(){return 3!==this.data.typeId&&"In progress"===this.data.status&&(!this.data.isInternal||this.data.isInternal&&this.data.isConferenceCreator)},this.setHoldRequestState=function(){return!(this.isBlocked()||!this.canHoldUnHold()||(this.data.isHold?(createNotify("Error","Call is already Hold.","error"),1):(this.data.sentHoldUnHoldRequest=!0,this.block(),this.save(),0)))},this.setUnHoldRequestState=function(){return!(this.isBlocked()||!this.canHoldUnHold()||(this.data.isHold?(this.data.sentHoldUnHoldRequest=!0,this.block(),this.save(),0):(createNotify("Error","Call is already UnHold.","error"),1)))},this.unSetHoldUnHoldRequestState=function(){this.data.sentHoldUnHoldRequest=!1,this.unBlock(),this.save()},this.isSentHoldUnHoldRequestState=function(){return!0===this.data.sentHoldUnHoldRequest},this.hold=function(){this.unBlock(),this.data.sentHoldUnHoldRequest=!1,this.data.holdStartTime=Date.now(),this.data.isHold=!0,this.save()},this.unHold=function(){this.unBlock(),this.data.sentHoldUnHoldRequest=!1,this.data.holdStartTime=0,this.data.isHold=!1,this.save()},this.setMuteRequestState=function(){return!this.isBlocked()&&(this.data.isMute?(createNotify("Error","Call is already Mute.","error"),!1):(this.data.sentMuteUnMuteRequest=!0,this.block(),this.save(),!0))},this.setUnMuteRequestState=function(){return!this.isBlocked()&&(this.data.isMute?(this.data.sentMuteUnMuteRequest=!0,this.block(),this.save(),!0):(createNotify("Error","Call is already UnMute.","error"),!1))},this.unSetMuteUnMuteRequestState=function(){this.data.sentMuteUnMuteRequest=!1,this.unBlock(),this.save()},this.isSentMuteUnMuteRequestState=function(){return!0===this.data.sentMuteUnMuteRequest},this.mute=function(){this.unBlock(),this.data.sentMuteUnMuteRequest=!1,this.data.isMute=!0,this.save()},this.unMute=function(){this.unBlock(),this.data.sentMuteUnMuteRequest=!1,this.data.isMute=!1,this.save()},this.setHangupRequestState=function(){return!this.isBlocked()&&(this.data.sentHangupRequest=!0,this.block(),this.save(),!0)},this.unSetHangupRequestState=function(){this.data.sentHangupRequest=!1,this.unBlock(),this.save()},this.isSentHangupRequestState=function(){return!0===this.data.sentHangupRequest},this.setReturnHoldCallRequestState=function(){return!this.isBlocked()&&("Hold"!==this.data.status?(createNotify("Error","Call is not in status Hold.","error"),!1):(this.data.sentReturnHoldCallRequest=!0,this.block(),this.save(),!0))},this.unSetReturnHoldCallRequestState=function(){this.data.sentReturnHoldCallRequest=!1,this.unBlock(),this.save()},this.isSentReturnHoldCallRequestState=function(){return!0===this.data.sentReturnHoldCallRequest},this.setAcceptCallRequestState=function(){return!this.isBlocked()&&(this.data.sentAcceptCallRequest=!0,this.block(),this.save(),!0)},this.unSetAcceptCallRequestState=function(){this.data.sentAcceptCallRequest=!1,this.unBlock(),this.save()},this.isSentAcceptCallRequestState=function(){return!0===this.data.sentAcceptCallRequest},this.setAddNoteRequestState=function(){return this.isBlocked()?(createNotify("Error","Call is blocked. Please wait some seconds.","error"),!1):(this.data.sentAddNoteRequest=!0,this.block(),this.save(),!0)},this.unSetAddNoteRequestState=function(){this.data.sentAddNoteRequest=!1,this.unBlock(),this.save()},this.isSentAddNoteRequestState=function(){return!0===this.data.sentAddNoteRequest},this.setRejectInternalRequest=function(){return this.isBlocked()?(createNotify("Error","Call is blocked. Please wait some seconds.","error"),!1):(this.data.sentRejectInternalRequest=!0,this.block(),this.save(),!0)},this.unSetRejectInternalRequest=function(){this.data.sentRejectInternalRequest=!1,this.unBlock(),this.save()},this.isSentRejectInternalRequest=function(){return!0===this.data.sentRejectInternalRequest},this.getDuration=function(){let e=this.data.duration||0;return this.data.timeQueuePushed?Math.floor((Date.now()-parseInt(this.data.timeQueuePushed))/1e3)+parseInt(e):e},this.getHoldDuration=function(){let e=0;return this.data.holdStartTime&&(e=Math.floor((Date.now()-parseInt(this.data.holdStartTime))/1e3)),e},this.clone=function(){return new e(this.data)},this.setRecordingDisableRequestState=function(){return!this.isBlocked()&&(this.data.recordingDisabled?(createNotify("Error","Recording already OFF.","error"),!1):(this.data.sentRecordingRequest=!0,this.block(),this.save(),!0))},this.setRecordingEnableRequestState=function(){return!this.isBlocked()&&(this.data.recordingDisabled?(this.data.sentRecordingRequest=!0,this.block(),this.save(),!0):(createNotify("Error","Recording already ON.","error"),!1))},this.unSetRecordingRequestState=function(){this.data.sentRecordingRequest=!1,this.unBlock(),this.save()},this.isSentRecordingRequestState=function(){return!0===this.data.sentRecordingRequest},this.recordingDisable=function(){this.unBlock(),this.data.sentRecordingRequest=!1,this.data.recordingDisabled=!0,this.save()},this.recordingEnable=function(){this.unBlock(),this.data.sentRecordingRequest=!1,this.data.recordingDisabled=!1,this.save()},this.setReconnectRequestState=function(){return!this.isBlocked()&&(this.data.sentReconnectRequest=!0,this.block(),this.save(),!0)},this.unSetReconnectRequestState=function(){this.data.sentReconnectRequest=!1,this.unBlock(),this.save()},this.isSentReconnectRequestState=function(){return!0===this.data.sentReconnectRequest},this.connectionError=function(){this.data.connectionError=!0,this.save()},this.save=function(){window.phoneWidget.eventDispatcher.dispatch(this.getEventUpdateName(),{call:this})},this.getEventUpdateName=function(){return window.phoneWidget.events.callUpdate+this.data.callSid}}}}(),function(){function e(t){this.data=t,this.getDuration=function(){let e=this.data.duration||0;return this.data.timeStoragePushed?Math.floor((Date.now()-parseInt(this.data.timeStoragePushed))/1e3)+parseInt(e):e},this.clone=function(){return new e(this.data)}}window.phoneWidget.conference={Conference:function t(a){this.data=a,this.getCountParticipants=function(){return this.data.participants.length},this.getParticipants=function(){let t=[],a=this.data.timeStoragePushed;return this.data.participants.forEach(function(n){n.timeStoragePushed=a,t.push(new e(n))}),t},this.getDuration=function(){let e=this.data.duration||0;return this.data.timeStoragePushed?Math.floor((Date.now()-parseInt(this.data.timeStoragePushed))/1e3)+parseInt(e):e},this.clone=function(){return new t(this.data)},this.getEventUpdateName=function(){return window.phoneWidget.events.conferenceUpdate+this.data.sid},this.save=function(){window.phoneWidget.eventDispatcher.dispatch(this.getEventUpdateName(),{conference:this})}}}}(),function(){window.phoneWidget.requesters={CallRequester:function(){this.settings={holdUrl:"",unHoldUrl:"",acceptCallUrl:"",muteUrl:"",unMuteUrl:"",returnHoldCallUrl:"",ajaxHangupUrl:"",callAddNoteUrl:"",sendDigitUrl:"",prepareCurrentCallsUrl:"",callLogInfoUrl:"",callInfoUrl:"",clientInfoUrl:"",recordingEnableUrl:"",recordingDisableUrl:"",acceptPriorityCallUrl:"",acceptWarmTransferCallUrl:"",addPhoneBlackListUrl:"",reconnectUrl:"",ajaxCallTransferUrl:"",ajaxWarmTransferToUserUrl:"",ajaxCallRedirectUrl:"",ajaxJoinToConferenceUrl:"",csrf_param:"",csrf_token:"",ajaxGetPhoneListIdUrl:"",createCallUrl:""},this.init=function(e){Object.assign(this.settings,e)},this.hold=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.holdUrl}).done(function(t){t.error&&(createNotify("Hold",t.message,"error"),e.unSetHoldUnHoldRequestState())}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Hold",i,"error"),e.unSetHoldUnHoldRequestState()})},this.unHold=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.unHoldUrl}).done(function(t){t.error&&(createNotify("Resume",t.message,"error"),e.unSetHoldUnHoldRequestState())}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Resume",i,"error"),e.unSetHoldUnHoldRequestState()})},this.accept=function(e,t){window.phoneWidget.notifier.off(e.data.callSid),PhoneWidget.audio.incoming.off(e.data.callSid),$.ajax({type:"post",url:this.settings.acceptCallUrl,dataType:"json",data:{act:"accept",call_sid:e.data.callSid,deviceId:t}}).done(function(t){t.error&&(createNotify("Accept Call",t.message,"error"),e.unSetAcceptCallRequestState(),window.phoneWidget.notifier.on(e.data.callSid),PhoneWidget.audio.incoming.on(e.data.callSid))}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Accept Call",i,"error"),e.unSetAcceptCallRequestState(),window.phoneWidget.notifier.on(e.data.callSid),PhoneWidget.audio.incoming.on(e.data.callSid)})},this.acceptWarmTransfer=function(e,t){window.phoneWidget.notifier.off(e.data.callSid),PhoneWidget.audio.incoming.off(e.data.callSid),$.ajax({type:"post",url:this.settings.acceptWarmTransferCallUrl,dataType:"json",data:{call_sid:e.data.callSid,deviceId:t}}).done(function(t){t.error&&(createNotify("Accept Call",t.message,"error"),e.unSetAcceptCallRequestState(),window.phoneWidget.notifier.on(e.data.callSid),PhoneWidget.audio.incoming.on(e.data.callSid))}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Accept Call",i,"error"),e.unSetAcceptCallRequestState(),window.phoneWidget.notifier.on(e.data.callSid),PhoneWidget.audio.incoming.on(e.data.callSid)})},this.mute=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.muteUrl}).done(function(t){t.error&&(createNotify("Mute",t.message,"error"),e.unSetMuteUnMuteRequestState())}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Mute",i,"error"),e.unSetMuteUnMuteRequestState()})},this.unMute=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.unMuteUrl}).done(function(t){t.error&&(createNotify("UnMute",t.message,"error"),e.unSetMuteUnMuteRequestState())}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("UnMute",i,"error"),e.unSetMuteUnMuteRequestState()})},this.returnHoldCall=function(e,t){window.phoneWidget.notifier.off(e.data.callSid),PhoneWidget.audio.incoming.off(e.data.callSid),$.ajax({type:"post",url:this.settings.returnHoldCallUrl,dataType:"json",data:{call_sid:e.data.callSid,deviceId:t}}).done(function(t){t.error&&(createNotify("Return Hold Call",t.message,"error"),e.unSetReturnHoldCallRequestState(),window.phoneWidget.notifier.on(e.data.callSid),PhoneWidget.audio.incoming.on(e.data.callSid))}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Return Hold Call",i,"error"),e.unSetReturnHoldCallRequestState(),window.phoneWidget.notifier.on(e.data.callSid),PhoneWidget.audio.incoming.on(e.data.callSid)})},this.hangupOutgoingCall=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.ajaxHangupUrl}).done(function(t){t.error&&(createNotify("Hangup",t.message,"error"),e.unSetHangupRequestState())}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Hangup",i,"error"),e.unSetHangupRequestState()})},this.hangup=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.ajaxHangupUrl}).done(function(t){t.error&&(createNotify("Hangup",t.message,"error"),e.unSetHangupRequestState()),void 0!==t.result&&void 0!==t.result.status&&"completed"===t.result.status&&PhoneWidget.completeCall(e.data.callSid)}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Hangup",i,"error"),e.unSetHangupRequestState()})},this.addNote=function(e,t,a){$.ajax({type:"post",data:{note:t,callSid:e.data.callSid},url:this.settings.callAddNoteUrl,dataType:"json"}).done(function(t){t.error?createNotify("Add Note",t.message,"error"):(createNotify("Add Note",t.message,"success"),a.value=""),e.unSetAddNoteRequestState()}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Add Note",i,"error"),e.unSetAddNoteRequestState()})},this.sendDigit=function(e,t){$.ajax({type:"post",data:{conference_sid:e,digit:t},url:this.settings.sendDigitUrl,dataType:"json"}).done(function(e){e.error&&createNotify("Send digit",e.message,"error")}).fail(function(e,t,a){var n=e.responseText?e.responseText:e.statusText?e.statusText:"Server error";createNotify("Send digit",n,"error")})},this.acceptInternalCall=function(e,t){$.ajax({type:"post",data:{},url:this.settings.prepareCurrentCallsUrl,dataType:"json"}).done(function(a){a.error?(createNotify("Prepare current call",a.message,"error"),e.unSetAcceptCallRequestState()):t.accept()}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Prepare current call",i,"error"),e.unSetAcceptCallRequestState()})},this.callLogInfo=function(e){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>'),$("#call-box-modal-label").html("Call Info"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{sid:e},url:this.settings.callLogInfoUrl}).done(function(e){$("#call-box-modal .modal-body").html(e)}).fail(function(e,t,a){var n=e.responseText?e.responseText:e.statusText?e.statusText:"Server error";createNotify("Call info",n,"error")})},this.callInfo=function(e){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>'),$("#call-box-modal-label").html("Call Info"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{sid:e},url:this.settings.callInfoUrl}).done(function(e){$("#call-box-modal .modal-body").html(e)}).fail(function(e,t,a){var n=e.responseText?e.responseText:e.statusText?e.statusText:"Server error";createNotify("Call info",n,"error")})},this.addPhoneBlackList=function(e){if(confirm("Confirm adding "+e+" number to blacklist")){let t=$(".btn-add-in-blacklist").html();$.ajax({url:this.settings.addPhoneBlackListUrl,type:"post",data:{phone:e},dataType:"json",beforeSend:function(){$(".btn-add-in-blacklist").html('<i class="fa fa-spin fa-spinner"></i>').prop("disabled",!0)},success:function(t){t.error?createNotify("Error",t.message,"error"):(t.notifier&&createNotify("Success","Phone number: "+e+" added to blacklist","success"),$('.btn-add-in-blacklist[data-phone="'+e+'"]').remove())},error:function(e){createNotify("Error",e.responseText,"error")},complete:function(){$(".btn-add-in-blacklist").html(t).prop("disabled",!1)}})}},this.clientInfo=function(e,t,a){$("#call-box-modal .modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"> </i> Loading ...</div>');let n=a?"Client details":"Contact info";$("#call-box-modal-label").html(n+" ("+e+")"),$("#call-box-modal").modal(),$.ajax({type:"post",data:{client_id:e,callSid:t},url:this.settings.clientInfoUrl}).done(function(e){$("#call-box-modal .modal-body").html(e)}).fail(function(e,t,a){var i=e.responseText?e.responseText:e.statusText?e.statusText:"Server error";createNotify(n,i,"error")})},this.recordingEnable=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.recordingEnableUrl}).done(function(t){t.error&&(createNotify("Recording enable",t.message,"error"),e.unSetRecordingRequestState())}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Recording enable",i,"error"),e.unSetRecordingRequestState()})},this.recordingDisable=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.recordingDisableUrl}).done(function(t){t.error&&(createNotify("Recording disable",t.message,"error"),e.unSetRecordingRequestState())}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Recording disable",i,"error"),e.unSetRecordingRequestState()})},this.acceptPriorityCall=function(e,t){PhoneWidget.queues.priority.accept(),window.phoneWidget.notifier.off(e),PhoneWidget.audio.incoming.off(e),$.ajax({type:"post",url:this.settings.acceptPriorityCallUrl,dataType:"json",data:{act:"accept",deviceId:t}}).done(function(t){t.error&&createNotify("Accept Call",t.message,"error"),t.isRedialCall?t.redialError?createNotify("Accept Call",t.redialError,"error"):(window.phoneWidget.notifier.notifiers.phone.reset(),PhoneWidget.panes.queue.hide(),PhoneWidget.openCallTab()):PhoneWidget.audio.incoming.on(e),PhoneWidget.queues.priority.unAccept(),window.phoneWidget.notifier.on(e)}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Accept Call",i,"error"),PhoneWidget.queues.priority.unAccept(),window.phoneWidget.notifier.on(e),PhoneWidget.audio.incoming.on(e)})},this.reconnect=function(e){$.ajax({type:"post",data:{sid:e.data.callSid},url:this.settings.reconnectUrl}).done(function(t){if(t.error)return e.unSetReconnectRequestState(),void createNotify("Reconnect",t.message,"error");PhoneWidget.openHoldCallPanel()}).fail(function(t,a,n){var i=t.responseText?t.responseText:t.statusText?t.statusText:"Server error";createNotify("Reconnect",i,"error"),e.unSetReconnectRequestState()})},this.transfer=function(e,t,a,n){$.ajax({type:"post",data:{sid:e,id:t,type:a},url:this.settings.ajaxCallTransferUrl,success:function(e){e.error&&alert(e.message),n.modal("hide").find(".modal-body").html("")},error:function(e){console.error(e),n.modal("hide").find(".modal-body").html("")}})},this.warmTransferToUser=function(e,t,a){$.ajax({type:"post",data:{callSid:e,userId:t},url:this.settings.ajaxWarmTransferToUserUrl,success:function(e){e.error&&alert(e.message),a.modal("hide").find(".modal-body").html("")},error:function(e){console.error(e),a.modal("hide").find(".modal-body").html("")}})},this.transferNumber=function(e,t,a,n,i){$.ajax({type:"post",data:{sid:e,type:t,from:a,to:n},url:this.settings.ajaxCallRedirectUrl,success:function(e){e.error&&alert(e.message),i.modal("hide").find(".modal-body").html("")},error:function(e){console.error(e),i.modal("hide").find(".modal-body").html("")}})},this.joinConference=function(e,t,a,n){let i={call_sid:a,source_type_id:t,deviceId:n};i[this.settings.csrf_param]=this.settings.csrf_token,$.ajax({type:"post",data:i,url:this.settings.ajaxJoinToConferenceUrl}).done(function(t){t.error&&createNotifyByObject({title:e,type:"error",text:t.message,hide:!0})}).fail(function(t){createNotifyByObject({title:e,type:"error",text:"Server error",hide:!0}),console.error(t)})},this.webCallLeadRedial=function(e,t,a,n,i,o){$.post(this.settings.ajaxGetPhoneListIdUrl,{phone:e},function(c){if(c.error){var s="Error. Try again later";c.message&&(s=c.message),createNotifyByObject({title:"Make call",type:"error",text:s,hide:!0})}else{let s={params:{To:t,FromAgentPhone:e,c_project_id:a,lead_id:n,c_type:i,c_user_id:window.userId,c_source_type_id:o,is_conference_call:1,user_identity:window.userIdentity,phone_list_id:c.phone_list_id}};window.TwilioDevice&&(console.log("Calling "+s.params.To+"..."),connection=window.TwilioDevice.connect(s))}},"json")},this.createCall=function(e){$.ajax({type:"post",data:e,url:this.settings.createCallUrl}).done(function(e){if(e.error)return PhoneWidget.freeDialButton(),createNotify("Create Call",e.message,"error"),void(!0===e.is_on_call&&PhoneWidget.updateCurrentCalls(e.phone_widget_data.calls,e.phone_widget_data.userStatus))}).fail(function(){createNotify("Create Call","Server error","error"),PhoneWidget.freeDialButton()})}}}}();class PhoneWidgetTimer extends React.Component{constructor(e){super(e),this.state={duration:0,timeStart:0}}componentDidMount(){this.startTimer()}componentDidUpdate(e){this.state.timeStart!==this.props.timeStart&&this.startTimer()}componentWillUnmount(){clearInterval(this.timer)}startTimer(){clearInterval(this.timer),this.setState({duration:this.props.duration,timeStart:this.props.timeStart}),this.timer=setInterval(()=>this.setState({duration:this.state.duration+1}),1e3)}formatDuration(e){let t="",a=Math.floor(e/60/60),n=Math.floor(e/60)-60*a,i=e%60;return a>0&&(t=a.toString().padStart(2,"0")+":"),t+=n.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")}render(){return this.props.styleClass&&this.state.duration>3599?React.createElement("span",{className:this.props.styleClass},this.formatDuration(this.state.duration)):this.formatDuration(this.state.duration)}}class CallActionTimer extends React.Component{constructor(e){super(e),this.state={duration:0,timeStart:0}}componentDidMount(){this.startTimer()}componentDidUpdate(e){this.state.timeStart!==this.props.timeStart&&this.startTimer()}componentWillUnmount(){clearInterval(this.timer)}startTimer(){clearInterval(this.timer),this.setState({duration:this.props.duration,timeStart:this.props.timeStart}),this.timer=setInterval(()=>this.setState({duration:this.state.duration+1}),1e3)}formatDuration(e){let t="",a=Math.floor(e/60/60),n=Math.floor(e/60)-60*a,i=e%60;return a>0&&(t=a.toString().padStart(2,"0")+":"),t+=n.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")}render(){return React.createElement(React.Fragment,null,React.createElement("span",{className:"call-in-action__time"},this.formatDuration(this.state.duration)))}}class ActivePane extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("ActivePane.callUpdateHandler"),e.setState({call:t.call})}}render(){let e=this.state.call,t=this.props.controls;return e.data.connectionError&&(t.reconnect.active=!0),React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement(ActiveContactInfo,{call:e}),React.createElement("div",{className:"actions-container"},React.createElement(CallBtns,{call:e}),React.createElement(SoundIndication,null),React.createElement(RecordIndicator,{call:e,canRecordingDisabled:this.props.controls.canRecordingDisabled}),React.createElement(AddInBlacklist,{call:e,canAddBlackList:this.props.controls.canAddBlackList})),React.createElement(ActivePaneControls,{call:e,controls:t}))}}function ActiveContactInfo(e){let t=e.call;return React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},3!==t.data.typeId?React.createElement("span",{className:"contact-info-card__label"},t.data.type):"",React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info","data-call-id":t.data.id},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,t.data.contact.name))),React.createElement("div",{className:"contact-info-card__line history-details"},3!==t.data.typeId?React.createElement("span",{className:"contact-info-card__call-type"},t.data.contact.phone):"")))}function CallBtns(e){let t=e.call,a="call-pane__call-btns";return t.data.isHold?a+=" is-on-hold":a+=" is-on-call",React.createElement("div",{className:a},React.createElement("button",{className:"call-pane__mute",id:"call-pane__mute",disabled:t.data.isListen||t.data.isHold||t.isSentMuteUnMuteRequestState(),"data-call-sid":t.data.callSid,"data-is-muted":t.data.isMute,"data-active":!(t.data.isListen||t.data.isHold)},t.isSentMuteUnMuteRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):t.data.isMute?React.createElement("i",{className:"fas fa-microphone-alt-slash"}," "):React.createElement("i",{className:"fas fa-microphone"}," ")),t.data.isHold?React.createElement(CallingStateBlockHold,{call:t}):React.createElement(CallingStateBlock,{call:t}),React.createElement("button",{className:"call-pane__end-call",id:"cancel-active-call","data-call-sid":t.data.callSid,disabled:t.isSentHangupRequestState()},t.isSentHangupRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))}function CallingStateBlock(e){let t=e.call;return React.createElement("button",{className:t.data.isListen||t.data.isCoach?"call-pane__start-call calling-state-block join":"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},t.data.isListen||t.data.isCoach?React.createElement("i",{className:"fa fa-headphones-alt"}," "):"",React.createElement("span",{className:"call-in-action__text"},t.data.isCoach?"Coaching":t.data.isListen?"Listening":t.data.isBarge?"Barge":"on call"),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now(),styleClass:"more"}))))}function CallingStateBlockHold(e){let t=e.call;return React.createElement("button",{className:"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},React.createElement("span",{className:"call-in-action__text"},"on hold"),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:t.getHoldDuration(),timeStart:Date.now(),styleClass:"more"}))))}function SoundIndication(){return React.createElement("div",{className:"sound-indication"},React.createElement("div",{className:"sound-control-wrap",id:"wg-call-volume"},React.createElement("i",{className:"fa fa-volume-down"}," "),React.createElement("div",{className:"sound-controls"},React.createElement("div",{className:"progres-wrap"},React.createElement("div",{className:"sound-progress"}," "),React.createElement("div",{className:"sound-ovf",style:{right:"-100%"}}," ")))),React.createElement("div",{className:"sound-control-wrap",id:"wg-call-microphone"},React.createElement("i",{className:"fa fa-microphone"}," "),React.createElement("div",{className:"sound-controls"},React.createElement("div",{className:"progres-wrap"},React.createElement("div",{className:"sound-progress"}," "),React.createElement("div",{className:"sound-ovf",style:{right:"-30%"}}," ")))))}function RecordIndicator(e){let t=e.call,a={color:"#dc3545"},n="ON",i="OFF";t.data.recordingDisabled&&(a={color:"#ccc"},n="OFF",i="ON");let o="fa fa-record-vinyl";t.isSentRecordingRequestState()&&(o="fa fa-spinner fa-spin");let c=e.canRecordingDisabled&&!t.data.isJoin&&!t.data.recordingDisabled&&!(t.data.isInternal&&"Incoming"===t.data.type);return c&&(a.cursor="pointer"),React.createElement("div",{className:"sound-indication"},React.createElement("div",{className:"sound-control-wrap"},c?React.createElement("i",{className:o,style:a,id:"wg-call-record","data-call-sid":t.data.callSid,title:i}," "):React.createElement("i",{className:o,style:a}," "),React.createElement("div",{style:{marginLeft:"10px",color:"#fff"}}," Record ",n)))}function AddInBlacklist(e){let t=e.call;return e.canAddBlackList?t.data.contact.isPhoneInBlackList?"":React.createElement("div",{className:"sound-indication"},React.createElement("div",{className:"sound-control-wrap"},React.createElement("small",{className:"contact-info-card__call-info btn-add-in-blacklist","data-phone":t.data.contact.phone},React.createElement("i",{className:"fas fa-ban text-danger"}),React.createElement("span",{style:{marginLeft:"10px",color:"#fff"}}," Add in block list")))):""}class IncomingPane extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("IncomingPane.callUpdateHandler"),e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__label"},e.data.type),React.createElement("div",{className:"credential"},React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info","data-call-id":e.data.id},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,e.data.contact.name)),React.createElement("div",{className:"contact-info-card__phone"},React.createElement("span",null," ")))),React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__call-type"},e.data.contact.phone)))),React.createElement(IncomingActions,{call:e}))}}function IncomingActions(e){let t=e.call;return t.data.isInternal?React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns"},React.createElement("button",{className:"call-pane__end-call end-internal",id:"hide-incoming-call","data-call-sid":t.data.callSid},React.createElement("i",{className:"fa fa-angle-double-right"}," ")),React.createElement("button",{className:"call-pane__start-call calling-state-block","data-call-sid":t.data.callSid,onClick:()=>PhoneWidget.acceptInternalCall(t)},t.isSentAcceptCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call","data-call-sid":t.data.callSid,onClick:()=>PhoneWidget.rejectInternalCall(t)},t.isSentRejectInternalRequest()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))):React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns"},React.createElement("button",{className:"call-pane__start-call calling-state-block",id:"btn-accept-call","data-type-action":t.data.isWarmTransfer?"acceptWarmTransfer":"accept","data-from-internal":t.data.fromInternal,"data-call-sid":t.data.callSid,disabled:t.isSentAcceptCallRequestState()},t.isSentAcceptCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call",id:"hide-incoming-call","data-call-sid":t.data.callSid},React.createElement("i",{className:"fa fa-angle-double-right"}," "))))}function AntiSpamElement(e){let t=e.call;if("callAntiSpamData"in t.data&&"type"in t.data.callAntiSpamData){let e="Spam",a={color:"#ffffff",border:"1px solid #ff0000",padding:"5px",position:"relative",top:"-20px"};return 0===t.data.callAntiSpamData.type&&(e="Trust",a.border="1px solid #37ff00"),React.createElement("div",{className:"d-flex justify-content-center align-items-center"},React.createElement("span",{style:a},e," Rate: ",parseInt(100*t.data.callAntiSpamData.rate)," %"))}return""}class AcceptedPane extends React.Component{constructor(e){super(e),this.state={call:e.call}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:e.project,source:e.source}),React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__label"},e.type),React.createElement("div",{className:"credential"},React.createElement("div",{className:"contact-info-card__phone"}," "))),React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__call-type"},e.phone)))))}}function ActivePaneControls(e){return React.createElement("ul",{className:"in-call-controls"},e.controls.hold.show?React.createElement(ButtonHold,{call:e.call,controls:e.controls}):"",e.controls.transfer.show?React.createElement(ButtonTransfer,{call:e.call,controls:e.controls}):"",React.createElement(ButtonAddPerson,{call:e.call,controls:e.controls}),React.createElement(ButtonDialpad,{call:e.call,controls:e.controls}),React.createElement(ButtonAddNote,{call:e.call,controls:e.controls}),React.createElement(ButtonReconnect,{call:e.call,controls:e.controls}))}function ButtonHold(e){return React.createElement("li",{className:"in-call-controls__item","data-mode":e.call.data.isHold?"hold":"unhold",id:"wg-hold-call","data-call-sid":e.call.data.callSid,"data-active":e.controls.hold.active},React.createElement("a",{href:"#",className:"in-call-controls__action"},e.call.isSentHoldUnHoldRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin hold-loader"}," "):e.call.data.isHold?React.createElement("i",{className:"fa fa-play"}," "):React.createElement("i",{className:"fa fa-pause"}," "),React.createElement("span",null,e.call.data.isHold?"Resume":"On Hold")))}function ButtonTransfer(e){return React.createElement("li",{className:"in-call-controls__item wg-transfer-call","data-call-sid":e.call.data.callSid,"data-active":!e.call.data.isHold&&e.controls.transfer.active},React.createElement("a",{href:"#",className:"in-call-controls__action"},React.createElement("i",{className:"fa fa-random"}," "),React.createElement("span",null,"Transfer")))}function ButtonAddPerson(e){return React.createElement("li",{className:"in-call-controls__item",id:"wg-add-person","data-active":e.controls.addPerson.active},React.createElement("a",{href:"#",className:"in-call-controls__action js-add-to-conference","data-toggle-tab":"tab-contacts"},React.createElement("i",{className:"fa fa-plus"}," "),React.createElement("span",null,"Add Person")))}function ButtonDialpad(e){return React.createElement("li",{className:"in-call-controls__item",id:"wg-dialpad","data-active":e.controls.dialpad.active},React.createElement("a",{href:"#",className:"in-call-controls__action js-toggle-dial"},React.createElement("i",{className:"fa fa-th"}," "),React.createElement("span",null,"Dialpad")))}function ButtonAddNote(e){return React.createElement("li",{className:"in-call-controls__item",id:"wg-add-note"},React.createElement("a",{href:"#",className:"in-call-controls__action"},React.createElement("i",{className:"fa fa-newspaper-o"}," "),React.createElement("span",null,"Add Note")))}function ButtonReconnect(e){return React.createElement("li",{className:"in-call-controls__item",id:"wg-reconnect-call","data-call-sid":e.call.data.callSid,"data-active":e.controls.reconnect.active},React.createElement("a",{href:"#",className:"in-call-controls__action"},e.call.isSentReconnectRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin hold-loader"}," "):React.createElement("i",{className:"fa fa-refresh"}," "),React.createElement("span",null,"Reconnect")))}function CallInfo(e){return React.createElement("div",{className:"calling-from-info"},React.createElement("div",{className:"static-number-indicator"},e.project?React.createElement("span",{className:"static-number-indicator__label"},e.project):"",e.project&&e.source?React.createElement("i",{className:"static-number-indicator__separator"}," "):"",e.source?React.createElement("span",{className:"static-number-indicator__name"},e.source):""))}class ListItem extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("ListItem.callUpdateHandler"),e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement("li",{className:"call-in-progress__list-item"},React.createElement("div",{className:"call-in-progress__call-item call-list-item","data-call-status":e.data.queue},React.createElement("div",{className:"call-list-item__info"},React.createElement("ul",{className:"call-list-item__info-list call-info-list"},React.createElement("li",{className:"call-info-list__item"},React.createElement("b",{className:"call-info-list__contact-icon"},React.createElement("i",{className:"fa fa-user"}," ")),React.createElement("span",{className:"call-info-list__name"},e.data.contact.name)),e.data.contact.company?React.createElement("li",{className:"call-info-list__item"},React.createElement("span",{className:"call-info-list__company"},e.data.contact.company)):"",2===e.data.typeId||1===e.data.typeId||4===e.data.typeId?React.createElement("li",{className:"call-info-list__item"},React.createElement("span",{className:"call-info-list__number"},e.data.contact.phone)," "):""),React.createElement("div",{className:"call-list-item__info-action call-info-action"},React.createElement("span",{className:"call-info-action__timer"},React.createElement(PhoneWidgetTimer,{duration:e.getDuration(),timeStart:Date.now()})),"inProgress"===e.data.queue&&3!==e.data.typeId||3===e.data.typeId&&!e.data.isListen&&!e.data.isHold?React.createElement("a",{href:"#",className:"call-info-action__more"},React.createElement("i",{className:"fa fa-ellipsis-h"}," ")):""),React.createElement(ListItemMenu,{call:e})),React.createElement("div",{className:"call-list-item__main-action"},React.createElement("a",{href:"#",className:"call-list-item__main-action-trigger btn-item-call-queue","data-type-action":getItemActionName(e),"data-call-sid":e.data.callSid,"data-from-internal":e.data.fromInternal},e.isSentAcceptCallRequestState()||e.isSentHangupRequestState()||e.isSentReturnHoldCallRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"phone-icon phone-icon--start fa fa-phone"})," ",React.createElement("i",{className:"phone-icon phone-icon--end fa fa-phone-slash"})," ")))))}}function getItemActionName(e){return"inProgress"===e.data.queue?"hangup":"hold"===e.data.queue?"return":e.data.isInternal?"acceptInternal":e.data.isWarmTransfer?"acceptWarmTransfer":"accept"}function ListItemMenu(e){let t=e.call;return"inProgress"!==t.data.queue?null:3===t.data.typeId?React.createElement(ListItemMenuJoinCall,{call:t}):t.data.isInternal?t.data.isConferenceCreator?React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(React.Fragment,null,React.createElement(ListItemBtnHold,{call:t}),React.createElement(ListItemBtnMute,{call:t}))):React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnMute,{call:t})):React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),t.data.isHold?"":React.createElement(ListItemBtnTransfer,{call:t}),React.createElement(React.Fragment,null,React.createElement(ListItemBtnHold,{call:t}),React.createElement(ListItemBtnMute,{call:t})))}function ListItemBtnTransfer(e){return React.createElement("li",{className:"call-item-menu__list-item wg-transfer-call","data-call-sid":e.call.data.callSid},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},React.createElement("i",{className:"fa fa-random"}," ")))}function ListItemBtnHold(e){let t=e.call;return React.createElement("li",{className:"call-item-menu__list-item list_item_hold","data-mode":t.data.isHold?"hold":"unhold","data-call-sid":t.data.callSid},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},t.isSentHoldUnHoldRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):t.data.isHold?React.createElement("i",{className:"fa fa-play"}," "):React.createElement("i",{className:"fa fa-pause"}," ")))}function ListItemBtnMute(e){let t=e.call;return t.data.isHold?null:React.createElement("li",{className:"call-item-menu__list-item list_item_mute","data-call-sid":t.data.callSid,"data-is-muted":t.data.isMute},React.createElement("a",{href:"#",className:"call-item-menu__transfer"},t.isSentMuteUnMuteRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):t.data.isMute?React.createElement("i",{className:"fas fa-microphone-alt-slash"}," "):React.createElement("i",{className:"fas fa-microphone"}," ")))}function ListItemMenuJoinCall(e){let t=e.call;return t.data.isListen?null:React.createElement("ul",{className:"call-list-item__menu call-item-menu"},React.createElement("li",{className:"call-item-menu__list-item"},React.createElement("a",{href:"#",className:"call-item-menu__close"},React.createElement("i",{className:"fa fa-chevron-right"}," "))),React.createElement(ListItemBtnMute,{call:t}))}class PriorityItem extends React.Component{constructor(e){super(e),this.state={isSentAcceptCallRequestState:!1,count:e.count}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(window.phoneWidget.events.priorityQueueAccepted,this.priorityQueueAcceptedHandler()),window.phoneWidget.eventDispatcher.addListener(window.phoneWidget.events.priorityQueueCounterChanged,this.priorityQueueCounterChangedHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(window.phoneWidget.events.priorityQueueAccepted,this.priorityQueueAcceptedHandler()),window.phoneWidget.eventDispatcher.removeListener(window.phoneWidget.events.priorityQueueCounterChanged,this.priorityQueueCounterChangedHandler())}priorityQueueAcceptedHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("PriorityItem.callUpdateHandler"),e.setState({isSentAcceptCallRequestState:t.isSentAcceptCallRequestState})}}priorityQueueCounterChangedHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("PriorityItem.priorityQueueCounterChangedHandler"),e.setState({count:t.count})}}render(){return React.createElement("ul",{className:"call-in-progress",style:{marginBottom:"15px"}},React.createElement("li",{className:"call-in-progress__list-item"},React.createElement("div",{className:"call-in-progress__call-item call-list-item"},React.createElement("div",{className:"call-list-item__info"},React.createElement("ul",{className:"call-list-item__info-list call-info-list"},React.createElement("li",{className:"call-info-list__item"},React.createElement("span",{className:"call-info-list__number"},"General line call (",this.state.count,")")," "))),React.createElement("div",{className:"call-list-item__main-action"},React.createElement("a",{href:"#",className:"call-list-item__main-action-trigger btn-item-call-priority"},this.state.isSentAcceptCallRequestState?React.createElement("i",{className:"fa fa-spinner fa-spin"}):React.createElement(React.Fragment,null,React.createElement("i",{className:"phone-icon phone-icon--start fa fa-phone"})," ",React.createElement("i",{className:"phone-icon phone-icon--end fa fa-phone-slash"})," "))))))}}function Groups(e){const t=[];let a=Object.assign({},e);void 0!==a.groups.external&&(t.push(React.createElement(GroupItem,{key:"external",group:{calls:a.groups.external.calls,project:"",department:"External Contacts"}})),delete a.groups.external);void 0!==a.groups.internal&&(t.push(React.createElement(GroupItem,{key:"internal",group:{calls:a.groups.internal.calls,project:"",department:"Internal Contacts"}})),delete a.groups.internal);for(let e in a.groups)"inArray"!==e&&t.push(React.createElement(GroupItem,{key:e,group:a.groups[e]}));return React.createElement("ul",{className:"calls-separator"},t)}function GroupItem(e){return React.createElement("li",{className:"calls-separator__list-item"},React.createElement("div",{className:"static-number-indicator"},e.group.project?React.createElement("span",{className:"static-number-indicator__label"},e.group.project):"",e.group.project&&e.group.department?React.createElement("i",{className:"static-number-indicator__separator"}," "):"",e.group.department?React.createElement("span",{className:"static-number-indicator__name"},e.group.department):""),React.createElement("ul",{className:"call-in-progress"},e.group.calls.map(e=>React.createElement(ListItem,{key:e.data.callSid,call:e}))))}function AllQueues(e){return React.createElement(React.Fragment,null,countProperties(e.active)>0?React.createElement(QueueItem,{groups:e.active,name:"Active Calls",type:"active"}):"",countProperties(e.direct)>0?React.createElement(QueueItem,{groups:e.direct,name:"Direct Line",type:"direct"}):"",countProperties(e.general)>0||e.countPriority>0?React.createElement(QueueItem,{groups:e.general,name:"General Line",type:"general",countPriority:e.countPriority}):"")}function QueueItem(e){return React.createElement("li",{className:"queue-separator__item","data-queue-type":e.type},e.name?React.createElement("div",{className:"queue-separator__name"},e.name):"",e.countPriority>0?React.createElement(PriorityItem,{count:e.countPriority}):"",React.createElement(Groups,{groups:e.groups}))}function countProperties(e){let t=0;for(let a in e)e.hasOwnProperty(a)&&++t;return t}class OutgoingPane extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("OutgoingPane.callUpdateHandler"),e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement("div",{className:"contact-info-card"},React.createElement("div",{className:"contact-info-card__details"},React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__label"},e.data.type),React.createElement("div",{className:"credential"},React.createElement("div",{className:"contact-info-card__name"},React.createElement("button",{className:"call-pane__info","data-call-id":e.data.id},React.createElement("i",{className:"user-icon fa fa-user"}," "),React.createElement("i",{className:"info-icon fa fa-info"}," ")),React.createElement("strong",null,e.data.contact.name)),React.createElement("div",{className:"contact-info-card__phone"},React.createElement("span",null," ")))),React.createElement("div",{className:"contact-info-card__line history-details"},React.createElement("span",{className:"contact-info-card__call-type"},e.data.contact.phone)))),React.createElement("div",{className:"actions-container"},React.createElement("div",{className:"call-pane__call-btns is-pending"},React.createElement("button",{className:"call-pane__start-call calling-state-block"},React.createElement("div",{className:"call-in-action"},React.createElement("span",{className:"call-in-action__text"},e.data.status),React.createElement("span",{className:"call-in-action__time"},React.createElement(PhoneWidgetTimer,{duration:e.getDuration(),timeStart:Date.now()}))),React.createElement("i",{className:"fas fa-phone"}," ")),React.createElement("button",{className:"call-pane__end-call",id:"cancel-outgoing-call","data-call-sid":e.data.callSid,disabled:e.isSentHangupRequestState()},e.isSentHangupRequestState()?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone-slash"}," ")))))}}function ContactInfo(e){return React.createElement(React.Fragment,null,React.createElement("div",{className:"additional-info__header"},React.createElement("div",{className:"agent-text-avatar"},React.createElement("span",null,e.avatar)),React.createElement(ContactInfoHeader,e),React.createElement("a",{href:"#",className:"additional-info__close"},React.createElement("i",{className:"fas fa-times"}," "))),React.createElement("div",{className:"additional-info__body scrollable-block"},React.createElement("ul",{className:"info-listing incoming-info"},React.createElement("li",null,React.createElement("small",{className:"incoming-info__label"},"Name"),React.createElement("span",{className:"incoming-info__value"},e.name)),React.createElement("li",null,React.createElement("div",{className:"d-flex align-items-center justify-content-between"},React.createElement("small",{className:"incoming-info__label",title:"Active Leads / All Leads"},"Leads (","countActiveLeads"in e?e.countActiveLeads:0," / ","countAllLeads"in e?e.countAllLeads:0,")"),React.createElement(CreateLeadButton,e)),e.leads.map((e,t)=>React.createElement("div",{className:"d-flex align-items-center justify-content-between",style:{marginTop:"3px"},key:e.id},React.createElement("span",{dangerouslySetInnerHTML:{__html:e.formatHtml}})," ",React.createElement("span",{dangerouslySetInnerHTML:{__html:e.status}}))),e.canContactDetails&&e.id?React.createElement("a",{href:"#","data-client-id":e.id,"data-is-client":e.isClient,"data-call-sid":e.callSid,className:"cw-call-contact-info cw-btn-client-info"},React.createElement("span",{className:"incoming-info__label"},"more...")):""))))}function ContactInfoHeader(e){return e.canContactDetails||e.canCallInfo?React.createElement(React.Fragment,null,e.canContactDetails&&e.id?React.createElement("a",{href:"#","data-client-id":e.id,"data-is-client":e.isClient,"data-call-sid":e.callSid,className:"cw-call-contact-info cw-btn-client-info"},React.createElement("span",{className:"additional-info__header-title"},e.isClient?"Client details":"Contact info")):React.createElement("span",{className:"additional-info__header-title"},e.isClient?"Client details":"Contact info"),e.canCallInfo?React.createElement(React.Fragment,null," / ",React.createElement("a",{href:"#","data-call-sid":e.callSid,className:"cw-call-contact-info pw-btn-call-info"},React.createElement("span",{className:"additional-info__header-title"},"Call info"))," "):""):React.createElement("span",{className:"additional-info__header-title"},e.isClient?"Client details":"Contact info")}function CreateLeadButton(e){return e.canCreateLead?React.createElement("a",{href:"#","data-call-sid":e.callSid,className:"cw-call-contact-info cw-btn-create-lead"},React.createElement("small",{className:"incoming-info__label"},"Create Lead")):""}class ConferencePane extends React.Component{constructor(e){super(e),this.state={call:e.call,conference:e.conference}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler()),window.phoneWidget.eventDispatcher.addListener(this.state.conference.getEventUpdateName(),this.conferenceUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler()),window.phoneWidget.eventDispatcher.removeListener(this.state.conference.getEventUpdateName(),this.conferenceUpdateHandler())}callUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("ConferencePane.callUpdateHandler"),e.setState({call:t.call})}}conferenceUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("ConferencePane.conferenceUpdateHandler"),e.setState({conference:t.conference})}}render(){let e=this.state.call,t=this.state.conference,a=t.getCountParticipants(),n=this.props.controls;return e.data.connectionError&&(n.reconnect.active=!0),React.createElement(React.Fragment,null,React.createElement("div",{className:"call-details"},React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__participants"},React.createElement("i",{className:"call-details__participants-len"},a)," Participants")),React.createElement("div",{className:"call-details__col"},React.createElement("a",{href:"#",className:"call-details__nav-btn call-details__nav-btn--more"},"Details"))),React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement(ParticipantShortList,{conference:t}),React.createElement("div",{className:"actions-container"},React.createElement(CallBtns,{call:e}),React.createElement(SoundIndication,null),React.createElement(RecordIndicator,{call:e,canRecordingDisabled:n.canRecordingDisabled})),React.createElement(ActivePaneControls,{call:e,controls:n}),React.createElement("div",{className:"conference-call-details"},React.createElement("div",{className:"call-details"},React.createElement("div",{className:"call-details__col"},React.createElement("a",{href:"#",className:"call-details__nav-btn call-details__nav-btn--back"},"Back")),React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__participants"},React.createElement("i",{className:"fa fa-users"}," ")," ",a)),React.createElement("div",{className:"call-details__col"},React.createElement("span",{className:"call-details__time"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now()})))),React.createElement(CallInfo,{project:e.data.project,source:e.data.source}),React.createElement(ParticipantList,{conference:t})))}}function ParticipantList(e){let t=e.conference,a=[];for(let e of t.getParticipants())a.push(React.createElement(ParticipantItem,{key:e.data.callSid,participant:e}));return React.createElement("ul",{className:"conference-call__detailed participant-list scrollable-block"},a)}function ParticipantItem(e){let t=e.participant,a="participant-list__item participant";return"coaching"===t.data.type&&(a+=" participant-list__item--coach"),React.createElement("li",{className:a},React.createElement("div",{className:"participant__avatar"},React.createElement("span",null,t.data.avatar)),React.createElement("div",{className:"participant__info"},React.createElement("span",{className:"participant__name"},t.data.name),React.createElement("span",{className:"participant__phone"},t.data.phone),"coaching"===t.data.type?React.createElement("span",{className:"participant__status"},React.createElement("i",{className:"fa fa-headphones-alt"}," ")," coaching"):""),React.createElement("div",{className:"participant__action"},React.createElement("b",{className:"participant__timer"},React.createElement(PhoneWidgetTimer,{duration:t.getDuration(),timeStart:Date.now()}))))}function ParticipantShortList(e){let t=e.conference,a=[],n=t.getCountParticipants();if(n>10){let e=0;for(let n of t.getParticipants())if(a.push(React.createElement(ParticipantShortItem,{key:n.data.callSid,participant:n})),9===++e)break}else for(let e of t.getParticipants())a.push(React.createElement(ParticipantShortItem,{key:e.data.callSid,participant:e}));return React.createElement("div",{className:"conference-call"},React.createElement("ul",{className:"conference-call__list"},a,n>10?React.createElement("li",null,React.createElement("div",{className:"conference-call__collapsed"},React.createElement("span",{className:"conference-call__name"},"and ",React.createElement("i",null,n-9)," more..."))):""))}function ParticipantShortItem(e){let t=e.participant,a="conference-call__thumbnail";return"coaching"===t.data.type&&(a+=" conference-call__thumbnail--coaching"),React.createElement("li",null,React.createElement("div",{className:a},React.createElement("div",{className:"conference-call__avatar"},t.data.avatar),React.createElement("span",{className:"conference-call__name"},t.data.name),"coaching"===t.data.type?React.createElement("i",{className:"conference-call__icon"},React.createElement("i",{className:"fa fa-headphones-alt"}," ")):""))}class AddNote extends React.Component{constructor(e){super(e),this.state={call:e.call}}componentDidMount(){window.phoneWidget.eventDispatcher.addListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}componentWillUnmount(){window.phoneWidget.eventDispatcher.removeListener(this.state.call.getEventUpdateName(),this.callUpdateHandler())}callUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("AddNote.callUpdateHandler"),e.setState({call:t.call})}}render(){let e=this.state.call;return React.createElement(React.Fragment,null,React.createElement("div",{className:"additional-info__header"},React.createElement("span",{className:"additional-info__header-title"},"Add Note"),React.createElement("a",{href:"#",className:"additional-info__close"},React.createElement("i",{className:"fas fa-times"}," "))),React.createElement("div",{className:"additional-info__body scrollable-block add-note-block"},React.createElement("textarea",{id:"active_call_add_note",cols:"30",rows:"10",placeholder:"Enter Note...",disabled:e.isSentAddNoteRequestState(),defaultValue:""}),React.createElement("button",{id:"active_call_add_note_submit","data-call-sid":e.data.callSid,disabled:e.isSentAddNoteRequestState()},e.isSentAddNoteRequestState()?React.createElement(React.Fragment,null,React.createElement("i",{className:"fa fa-spinner fa-spin"}," ")," Save"):"Save")))}}class DesktopNotification extends React.Component{constructor(e){super(e)}render(){let e=this.props.notifications.map(e=>React.createElement(NotificationItem,{key:e.key,notification:e,source:"desktop"}));return React.createElement("div",{className:"phone-notifications"},React.createElement("ul",{className:"phone-notifications__list"},e))}}class PhoneWidgetNotification extends React.Component{constructor(e){super(e)}render(){let e="phone-notifications";return this.props.notification.isDeleted||this.props.notification.isNew||this.props.notification.willHide||(e+=" phone-notifications--shown"),"general"===this.props.notification.queue?e+=" phone-notifications--general-calls":"direct"===this.props.notification.queue?e+=" phone-notifications--direct-calls":"active"!==this.props.notification.queue&&"hold"!==this.props.notification.queue||(e+=" phone-notifications--active-calls"),React.createElement("div",{className:e},React.createElement("ul",{className:"phone-notifications__list"},React.createElement(NotificationItem,{key:this.props.notification.key,notification:this.props.notification,source:"phone"})))}}function NotificationItem(e){return e.notification.type===window.phoneWidget.notifier.types.incomingCall?React.createElement(IncomingCallNotificationItem,{notification:e.notification,source:e.source}):e.notification.type===window.phoneWidget.notifier.types.priorityCall?React.createElement(PriorityCallNotificationItem,{notification:e.notification,source:e.source}):null}class PriorityCallNotificationItem extends React.Component{constructor(e){super(e),this.state={notification:e.notification}}componentDidMount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.desktopUpdateHandler())}componentWillUnmount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.desktopUpdateHandler())}phoneUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("PriorityCallNotificationItem.phoneUpdateHandler");let a=e.state.notification;a.isSentAcceptCallRequestState=t.isSentAcceptCallRequestState,e.setState({notification:a})}}desktopUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("PriorityCallNotificationItem.desktopUpdateHandler");let a=e.state.notification;a.isSentAcceptCallRequestState=t.isSentAcceptCallRequestState,e.setState({notification:a})}}render(){let e=this.state.notification,t=React.createElement("div",{className:"incoming-notification__project"},React.createElement("b",{className:"incoming-notification__position",style:{fontSize:"14px"}},"General line call "));return React.createElement("li",{className:e.isDeleted||e.isNew||e.willHide?"phone-notifications__item":"phone-notifications__item phone-notifications__item--shown"},React.createElement("div",{className:"incoming-notification"},React.createElement("div",{className:"incoming-notification__inner"},React.createElement("div",{className:"incoming-notification__info"},React.createElement("div",{className:"incoming-notification__general-info"},React.createElement("b",{className:"incoming-notification__name"},""),t,React.createElement("span",{className:"incoming-notification__phone"},""))),React.createElement("div",{className:"incoming-notification__action-list"},React.createElement("div",{className:"incoming-notification__dynamic"},React.createElement("a",{href:"#",className:"incoming-notification__action incoming-notification__action--phone btn-item-call-priority"},e.isSentAcceptCallRequestState?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone"}," "))),"phone"===this.props.source?React.createElement("a",{href:"#","data-key":e.key,className:"incoming-notification__action incoming-notification__action--min pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-alt-down"}," ")):React.createElement("a",{href:"#","data-key":e.key,className:"incoming-notification__action incoming-notification__action--max pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-down"}," "))))))}}class IncomingCallNotificationItem extends React.Component{constructor(e){super(e),this.state={notification:e.notification}}componentDidMount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.addListener(this.state.notification.eventName,this.desktopUpdateHandler())}componentWillUnmount(){"phone"===this.props.source?window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.phoneUpdateHandler()):window.phoneWidget.eventDispatcher.removeListener(this.state.notification.eventName,this.desktopUpdateHandler())}phoneUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("IncomingCallNotificationItem.phoneUpdateHandler");let a=t.call,n=e.state.notification;n.isSentAcceptCallRequestState=a.isSentAcceptCallRequestState(),n.isSentReturnHoldCallRequestState=a.isSentReturnHoldCallRequestState(),e.setState({notification:n})}}desktopUpdateHandler(){let e=this;return function(t){window.phoneWidget.emptyFunc("IncomingCallNotificationItem.desktopUpdateHandler");let a=t.call,n=e.state.notification;n.isSentAcceptCallRequestState=a.isSentAcceptCallRequestState(),n.isSentReturnHoldCallRequestState=a.isSentReturnHoldCallRequestState(),e.setState({notification:n})}}render(){let e=this.state.notification,t=e.duration||0;e.timePushed&&(t=Math.floor((Date.now()-parseInt(e.timePushed))/1e3)+parseInt(t));let a="";return e.project&&e.department?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("b",{className:"incoming-notification__project-name"},e.project),React.createElement("i",null,""),React.createElement("span",{className:"incoming-notification__position"},e.department)):e.project?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("b",{className:"incoming-notification__project-name"},e.project)):e.department?a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("span",{className:"incoming-notification__position"},e.department)):e.isInternal&&(a=React.createElement("div",{className:"incoming-notification__project"},React.createElement("span",{className:"incoming-notification__position"},"Internal"))),React.createElement("li",{className:e.isDeleted||e.isNew||e.willHide?"phone-notifications__item":"phone-notifications__item phone-notifications__item--shown"},React.createElement("div",{className:"incoming-notification"},React.createElement("i",{className:"user-icn"},e.name[0]),React.createElement("div",{className:"incoming-notification__inner"},React.createElement("div",{className:"incoming-notification__info"},React.createElement("div",{className:"incoming-notification__general-info"},React.createElement("b",{className:"incoming-notification__name"},e.name),React.createElement("span",{className:"incoming-notification__phone"},e.phone),a),React.createElement("div",{className:"incoming-notification__timer"},React.createElement("span",null,React.createElement(PhoneWidgetTimer,{duration:t,timeStart:Date.now()})))),React.createElement("div",{className:"incoming-notification__action-list"},React.createElement("div",{className:"incoming-notification__dynamic"},React.createElement("a",{href:"#",className:"incoming-notification__action incoming-notification__action--phone btn-item-call-queue","data-type-action":"hold"===e.queue?"return":e.isInternal?"acceptInternal":e.isWarmTransfer?"acceptWarmTransfer":"accept","data-call-sid":e.callSid,"data-from-internal":e.fromInternal},e.isSentAcceptCallRequestState||e.isSentReturnHoldCallRequestState?React.createElement("i",{className:"fa fa-spinner fa-spin"}," "):React.createElement("i",{className:"fa fa-phone"}," "))),"phone"===this.props.source?React.createElement("a",{href:"#","data-key":e.key,className:"incoming-notification__action incoming-notification__action--min pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-alt-down"}," ")):React.createElement("a",{href:"#","data-key":e.key,className:"incoming-notification__action incoming-notification__action--max pw-notification-hide"},React.createElement("i",{className:"fa fa-long-arrow-down"}," "))))))}}var PhoneWidgetContactInfo=function(){let e=$("#contact-info"),t=document.getElementById("contact-info");return{load:function(e){e.avatar=e.name.charAt(0),e.avatar.toUpperCase(),ReactDOM.render(React.createElement(ContactInfo,e),t)},hide:function(){e.hide()}}}(),PhoneWidgetDialpad=function(){let e=$(".dial-popup");return{hide:function(){e.hide()}}}();class PhoneWidgetPaneActiveBtn{constructor(e,t){this.pane=e,this.btn=null,this.id=t}init(){return this.btn=this.pane.find(this.id),this}show(){return this.btn.show(),this}hide(){return this.btn.hide(),this}enable(){return this.btn.attr("data-disabled",!1),this}disable(){return this.btn.attr("data-disabled",!0),this}active(){return this.btn.attr("data-active",!0),this}isActive(){return"true"===this.btn.attr("data-active")}inactive(){return this.btn.attr("data-active",!1),this}}class PhoneWidgetPaneActiveBtnHold extends PhoneWidgetPaneActiveBtn{constructor(e){super(e,"#wg-hold-call")}sendRequest(){this.disable();let e="Resume";return"unhold"===this.btn.attr("data-mode")&&(e="On Hold"),this.btn.children().html('<i class="fa fa-spinner fa-spin"> </i><span>'+e+"</span>"),this}unhold(){return this.btn.attr("data-mode","unhold"),this.btn.children().html('<i class="fa fa-pause"> </i><span>On Hold</span>'),this}hold(){return this.btn.attr("data-mode","hold"),this.btn.children().html('<i class="fa fa-play"> </i><span>Resume</span>'),this}}class PhoneWidgetPaneActiveBtnMute extends PhoneWidgetPaneActiveBtn{constructor(e){super(e,"#call-pane__mute")}sendRequest(){return this.disable(),this.btn.attr("data-is-muted",null),this.btn.html('<i class="fa fa-spinner fa-spin"> </i>'),this}mute(){return this.enable(),this.btn.attr("data-is-muted",!0),this.btn.html('<i class="fas fa-microphone-alt-slash"> </i>'),this}isMute(){return"true"===this.btn.attr("data-is-muted")}unMute(){return this.enable(),this.btn.attr("data-is-muted",!1),this.btn.html('<i class="fas fa-microphone"> </i>'),this}disable(){return this.btn.attr("disabled",!0),this}enable(){return this.btn.attr("disabled",!1),this}}var PhoneWidgetPaneActive=function(){let e=null;let t=$("#call-pane-calling"),a=document.getElementById("call-pane-calling"),n=document.getElementById("add-note"),i=PhoneWidgetContactInfo,o=PhoneWidgetDialpad,c={hold:new PhoneWidgetPaneActiveBtnHold(t),mute:new PhoneWidgetPaneActiveBtnMute(t)},s=!0,l=!0,r=!0,d=!1,u=!1;function h(i,o){var s;null!=o?(t.addClass("call-pane-calling--conference"),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(ConferencePane,{call:i,controls:m(i),conference:o}),a)):(t.removeClass("call-pane-calling--conference"),ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(ActivePane,{call:i,controls:m(i)}),a)),ReactDOM.unmountComponentAtNode(n),ReactDOM.render(React.createElement(AddNote,{call:i}),n),$(".dialpad_btn_active").attr("data-conference-sid",i.data.conferenceSid),$("#call-pane__dial-number_active_dialpad").val(""),s=i.data.callSid,e=s,c.hold.init(),c.mute.init()}function m(e){let t={hold:{active:!0,show:l},transfer:{active:!0,show:r},addPerson:{active:!1},dialpad:{active:!0},canRecordingDisabled:d,canAddBlackList:u,reconnect:{active:!0,show:s}};return 3===e.data.typeId&&(t.hold.active=!1,t.transfer.active=!1,t.addPerson.active=!1,t.dialpad.active=!1),e.data.isInternal&&(t.hold.active=!!e.data.isConferenceCreator,t.transfer.active=!1,t.addPerson.active=!1,t.dialpad.active=!1,t.reconnect.active=!1),t}function f(){i.hide(),o.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),t.addClass("is_active"),$('[data-toggle-tab="tab-phone"]').attr("data-call-in-progress",!0)}function p(){$('[data-toggle-tab="tab-phone"]').attr("data-call-in-progress",!1)}return{setup:function(e,t,a,n,i){l=e,r=t,d=a,u=n,s=i},buttons:c,init:function(e,t){h(e,t),f(),PhoneWidget.iconUpdate()},load:h,show:f,hide:function(){t.removeClass("is_active"),p()},isEqual:function(t){return e===t},removeCallSid:function(){e=null},isActive:function(){return t.hasClass("is_active")},removeCallInProgressIndicator:p}}(),PhoneWidgetPaneAccepted=function(){let e=null;let t=$("#call-pane-accepted"),a=document.getElementById("call-pane-accepted"),n=PhoneWidgetContactInfo,i=PhoneWidgetDialpad;function o(t){var n;ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(AcceptedPane,{call:t}),a),n=t.callSid,e=n}function c(){n.hide(),i.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),t.addClass("is_active")}return{init:function(e){o(e),c()},load:o,show:c,hide:function(){ReactDOM.unmountComponentAtNode(a),t.removeClass("is_active")},isEqual:function(t){return e===t},removeCallSid:function(){e=null},isActive:function(){return t.hasClass("is_active")}}}(),PhoneWidgetPaneIncoming=function(){let e=null;let t=$("#call-pane-incoming"),a=document.getElementById("call-pane-incoming"),n=PhoneWidgetContactInfo,i=PhoneWidgetDialpad;function o(t){var n;ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(IncomingPane,{call:t}),a),n=t.data.callSid,e=n}function c(){n.hide(),i.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),t.addClass("is_active")}function s(e,t){let a="";t?a=e+"+"+t:e>1&&(a=e),widgetIcon.update({type:"incoming",timer:!1,text:null,currentCalls:a,status:"online"})}return{init:function(e,t,a){o(e),c(),s(t,a)},load:o,show:c,hide:function(){ReactDOM.unmountComponentAtNode(a),t.removeClass("is_active")},isEqual:function(t){return e===t},removeCallSid:function(){e=null},isActive:function(){return t.hasClass("is_active")},initWidgetIcon:s}}(),PhoneWidgetPaneOutgoing=function(){let e=null;let t=$("#call-pane-outgoing"),a=document.getElementById("call-pane-outgoing"),n=PhoneWidgetContactInfo,i=PhoneWidgetDialpad;function o(t){var n;ReactDOM.unmountComponentAtNode(a),ReactDOM.render(React.createElement(OutgoingPane,{call:t}),a),n=t.data.callSid,e=n}function c(){n.hide(),i.hide(),$("#tab-phone .call-pane-initial").removeClass("is_active"),t.addClass("is_active")}return{init:function(e){o(e),c(),widgetIcon.update({type:"outgoing",timer:!0,timerStamp:e.getDuration(),text:e.data.status,currentCalls:null,status:"online"})},load:o,show:c,hide:function(){ReactDOM.unmountComponentAtNode(a),t.removeClass("is_active")},isEqual:function(t){return e===t},removeCallSid:function(){e=null},isActive:function(){return t.hasClass("is_active")}}}();function PhoneWidgetPaneQueue(e){let t=e,a=this,n=".call-filter__toggle",i=null;function o(){let e=Object.assign({},t.active.all()),a=Object.assign({},t.hold.all());for(let t in a)void 0===e[t]?e[t]=a[t]:a[t].calls.forEach(function(a){e[t].calls.push(a)});return e}function c(){ReactDOM.render(React.createElement(QueueItem,{groups:o(),type:"active",name:""}),document.getElementById("queue-separator")),i="active"}function s(){ReactDOM.render(React.createElement(QueueItem,{groups:t.direct.all(),type:"direct",name:""}),document.getElementById("queue-separator")),i="direct"}function l(){let e=PhoneWidget.queues.priority.count();ReactDOM.render(React.createElement(QueueItem,{groups:t.general.all(),type:"general",name:"",countPriority:e}),document.getElementById("queue-separator")),i="general"}function r(){let e=PhoneWidget.queues.priority.count();ReactDOM.render(React.createElement(AllQueues,{active:o(),direct:t.direct.all(),general:t.general.all(),countPriority:e}),document.getElementById("queue-separator")),i="all"}function d(e){var t=$(".widget-line-overlay__queue-marker");switch(t.removeClass("tab-active"),t.removeClass("tab-direct"),t.removeClass("tab-general"),t.removeClass("tab-all"),$(e).attr("data-call-filter")){case"active":$("[data-queue-marker]").html("Active Calls"),t.addClass("tab-active");break;case"direct":$("[data-queue-marker]").html("Direct Line"),t.addClass("tab-direct");break;case"general":$("[data-queue-marker]").html("General Line"),t.addClass("tab-general");break;case"all":$("[data-queue-marker]").html("Calls Queue")}}$(document).on("click",n,function(e){switch(e.preventDefault(),$(this).attr("data-call-filter")){case"active":c();break;case"direct":s();break;case"general":l()}$(n).removeClass("is-checked"),$(this).addClass("is-checked"),d($(this)),a.show(),$("[data-toggle-tab]").removeClass("is_active")}),$(document).on("click",".widget-line-overlay__show-all-queues",function(e){e.preventDefault(),$(n).addClass("is-checked"),d($(this)),r()}),this.openAllCalls=function(){let e=$(".widget-line-overlay__show-all-queues");$(n).addClass("is-checked"),d(e),$("[data-toggle-tab]").removeClass("is_active"),r(),a.show()},this.refresh=function(){$(".call-filter__toggle--line-active").html(t.hold.count()+t.active.count()),$(".call-filter__toggle--line-direct").html(t.direct.count()),$(".call-filter__toggle--line-general").html(t.general.count()+t.priority.count()),"active"===i?c():"direct"===i?s():"general"===i?l():"all"===i&&r()},this.show=function(){$(".widget-line-overlay").show()},this.hide=function(){$(".widget-line-overlay").hide(),$(n).removeClass("is-checked")}}function stateTimer(){var e=null;return{start:function(t,a){var n=Math.floor(a%60),i=Math.floor((a-n)/60),o=Math.floor((a-i)/60);e=setInterval(function(){n=Math.floor(a%60),i=Math.floor((a-n)/60%60),o=Math.floor(a/3600),86399===a&&(a=0),parseInt(n)<10&&(n="0"+n),parseInt(i)<10&&(i="0"+i),parseInt(o)<10&&(o="0"+o),a++,$(t).html(o+":"+i+":"+n)},1e3)},clear:function(){clearInterval(e)}}}function formatPhoneNumber(e){let t=(""+e).replace(/\D/g,"").match(/^(1|)?(\d{3})(\d{3})(\d{4})$/);return t?[t[1]?"+1 ":"","(",t[2],") ",t[3],"-",t[4]].join(""):e}function toSelect(e,t,a){var n=$(e);optionClass="dropdown-item";var i="optionselected";function o(e,t){let a='<div class="dropdown">'+e+'<div class="dropdown-menu" >'+function(e){let t=[];return e.length>1&&e.forEach(function(e){t.push('<button class="dropdown-item" type="button" value="'+e.value+'" data-info-project="'+e.project+'" data-info-project-id="'+e.projectId+'"><small class="current-number__phone">'+formatPhoneNumber(e.value)+'</small><span class="current-number__identifier" title="'+e.project+'">'+e.project+"</span></button>")}),t}(t).join("")+"</div>";return a+="</div>"}return this.data={value:t.selected.value,project:t.selected.project,projectId:t.selected.projectId},this.getData=function(){return this.data},this.setData=function(){return function(e){this.data.value=e.value,this.data.project=e.project,this.data.projectId=e.projectId}.bind(this)},function(e){let t=e.options.length;n.append(o(function(e,t,a,n,i){let o="";return i>1&&(o='<i class="fa fa-chevron-down"></i>'),'<button value="'+e+'" data-info-project="'+t+'" data-info-project-id="'+n+'" class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><small class="current-number__phone current-number__selected-nr">'+formatPhoneNumber(e)+'</small><span class="current-number__identifier current-number__selected-project" title="'+t+'">'+t+"</span>"+o+"</button>"}(e.selected.value,e.selected.project,e.selected.id,e.selected.projectId,t),e.options))}(t),$(n).on(i,$(".dropdown-toggle"),function(e){var t=e.target,i=n.find(".current-number__selected-nr"),o=n.find(".current-number__selected-project");$(t).find(".dropdown-toggle").val(this.data.value),i.text(this.data.value),o.text(this.data.project),o.attr("title",this.data.project),"function"==typeof a&&a.call(this)}.bind(this)),$(n).on("click",".dropdown-item",function(){!function(e){this.data.value=e.val(),this.data.project=e.attr("data-info-project"),this.data.projectId=e.attr("data-info-project-id"),$(n).trigger(i)}($(this))}),{getData:this.getData(),setData:this.setData()}}function handleWidgetIcon(){let e="default",t=!1;var a,n=$(".phone-widget-icon"),i=".widget-icon-inner",o="animate",c=null;function s(a){$(i).removeClass(o);var n,s,l,r,d,u=".widget-icon-inner",h=".phone-widget-icon__time";a.timer&&$(h).html(null),clearInterval(c),a.type&&(e=a.type),t&&$(u).attr("data-wi-type",a.type),$(u).attr("data-wi-status",a.status),$(".phone-widget-icon__ongoing").html(a.currentCalls),$(".phone-widget-icon__text").html(a.text),a.timer?(n=h,s=a.timerStamp,l=Math.floor(s%60),r=Math.floor((s-l)/60),d=Math.floor((s-r)/60),c=setInterval(function(){l=Math.floor(s%60),r=Math.floor((s-l)/60%60),d=Math.floor(s/3600),86399===s&&(s=0),parseInt(l)<10&&(l="0"+l),parseInt(r)<10&&(r="0"+r),parseInt(d)<10&&(d="0"+d),s++,$(n).html(d+":"+r+":"+l)},1e3)):$(h).html(null),a=null,$(i).addClass(o)}return{connect:function(){t=!0,$(i).attr("data-wi-type",e),$(".standby-phone__disabled-text").html("")},disconnect:function(){t=!1,$(i).attr("data-wi-type","disabled"),$(".standby-phone__disabled-text").html("DISCONNECTED")},init:function(){var t;a='<div class="widget-icon-inner" data-wi-type="'+(t="disabled")+'" data-wi-status="'+!1+'"><div class="standby-phone"><i class="fa fa-exclamation-triangle phone-widget-icon__warning"></i><i class="fa fa-phone-volume icon-phone-answer"></i><div class="phone-widget-icon__state"><span class="phone-widget-icon__ongoing"></span><span class="phone-widget-icon__text"></span><span class="phone-widget-icon__time"></span></div><i class="fa fa-phone icon-phone"></i><div class="standby-phone__disabled-overlay"><i class="fas fa-phone-slash standby-phone__disabled-icn"></i><span class="standby-phone__disabled-text"></span></div></div></div>',$(n).append(a),e=t},update:function(e){s(e)}}}function callsFilter(e){return{init:function(){},reset:function(){$(".widget-line-overlay").hide();$(".call-filter__toggle").removeClass("is-checked")}}}function widgetStatus(e,t){let a=t;var n=".status-confirmation",i={status:!!$(e).attr("checked"),shown:!1};function o(){$("#pw_status_name").text("ON")}function c(){$("#pw_status_name").text("OFF")}return $(document).on("click","[data-status-action]",function(t){t.preventDefault(),function(t){if("true"===t.attr("data-status-action")){t.html('<i class="fa fa-spinner fa-spin"></i>');let n=1;i.status&&(n=2),$.ajax({type:"post",data:{type_id:n},url:a}).done(function(t){let a=!0;2===n?(a=!1,c()):o(),$(e).prop("checked",a),i.status=a}).fail(function(){createNotifyByObject({title:"Change status",type:"error",text:"Server error",hide:!0})}).always(function(){t.html('<i class="fa fa-check"></i>'),i.shown&&$(".status-confirmation-tooltip").detach(),i.shown=!1})}else i.shown&&$(".status-confirmation-tooltip").detach(),i.shown=!1}($(this))}),$(document).on("click",e,function(e){var t;e.preventDefault(),i.shown||(i.shown=!0,$(n).append('<div class="status-confirmation-tooltip"><span>Switch to <i class="'+((t=i.status)?"occupied":"online")+'">'+(t?"OFF":"ON")+'</i> ?</span><div class="status-action-group"><a href="#" data-status-action="false">NO</a><a href="#" data-status-action="true"><i class="fa fa-check"></i></a></div></div>'))}),$(document).on("click",".phone-widget",function(e){i.shown&&!$(e.target).closest(".number-toggle").length&&($(".status-confirmation-tooltip").detach(),i.shown=!1)}),{getStatus:function(){switch(i.status){case!0:return 1;case!1:return 2}},setStatus:function(t){1===t?(i.status=!0,o()):(i.status=!1,c()),$(n).html(""),$(".status-confirmation-tooltip").detach(),i.shown=!1,$(e).prop("checked",i.status)}}}!function(){function e(){this.calls=[],this.add=function(e){return null!==this.getIndex(e.callSid)?null:(function(e){e.timeQueuePushed=Date.now(),e.blocked=!1,e.sentHoldUnHoldRequest=!1,e.sentMuteUnMuteRequest=!1,e.sentHangupRequest=!1,e.sentReturnHoldCallRequest=!1,e.sentAcceptCallRequest=!1,e.sentAddNoteRequest=!1,e.sentRejectInternalRequest=!1,e.sentRecordingRequest=!1,e.sentReconnectRequest=!1,e.connectionError=!1}(e),e.isHold&&(e.holdStartTime=Date.now()-1e3*parseInt(e.holdDuration)),this.calls.unshift(e),new window.phoneWidget.call.Call(e))},this.remove=function(e){let t=this.getIndex(e);return null!==t&&(this.calls.splice(t,1),!0)},this.getIndex=function(e){let t=null;return this.calls.forEach(function(a,n){if(a.callSid===e)return t=n,!1}),t},this.getLast=function(){if(0===this.count())return null;let e=null;for(let t in this.calls)"inArray"!==t&&(e=this.calls[t]);return null==e?null:new window.phoneWidget.call.Call(e)},this.getFirst=function(){if(0===this.count())return null;let e=null;for(let t in this.calls)if("inArray"!==t){e=this.calls[t];break}return null==e?null:new window.phoneWidget.call.Call(e)},this.one=function(e){let t=this.getIndex(e);return null!==t?new window.phoneWidget.call.Call(this.calls[t]):null},this.count=function(){return this.calls.length},this.all=function(){let e=[];return this.calls.forEach(function(t){e.push(new window.phoneWidget.call.Call(t))}),e},this.showAll=function(){this.calls.forEach(function(e){console.log(e)})},this.reset=function(){this.calls=[]}}class t{constructor(e,t){this.queue=e,this.queueName=t}getList(){let e=[],t=this;return this.queue.all().forEach(function(a){a.data.queue===t.queueName&&e.push(a)}),e}one(e){return this.queue.one(e)}all(){let e=this.getList();if(e.length<1)return[];let t=[],a="";return e.forEach(function(e){return e.data.isInternal?(t.internal||(t.internal={calls:[]}),void t.internal.calls.push(e)):e.data.project?(a=e.data.project+e.data.department,t[a]||(t[a]={project:e.data.project,department:e.data.department,calls:[]}),void t[a].calls.push(e)):(t.external||(t.external={calls:[]}),void t.external.calls.push(e))}),t}count(){return this.getList().length}add(e){return this.queue.add(e)}getLast(){return this.queue.getLast()}getFirst(){return this.queue.getFirst()}remove(e){this.queue.remove(e)}reset(){this.queue.reset()}}function a(e,t,a){return{project:e,department:t,count:a}}window.phoneWidget.queue={Queue:e,Direct:class extends t{constructor(e){super(e,"direct")}},Hold:class extends t{constructor(e){super(e,"hold")}},General:class extends t{constructor(e){super(e,"general")}},Active:function(){return new t(new e,"inProgress")},Priority:function(){this.items=[],this.accepted=!1,this.reset=function(){this.items=[],this.counterChanged()},this.remove=function(e,t){let a=this.findByCondition(e,t);if(0===a.count){if(null===a.index)return;return this.items.splice(a.index,1),void this.counterChanged()}this.items[a.index].count--,this.items[a.index].count<1&&this.items.splice(a.index,1),this.counterChanged()},this.add=function(e,t){this.addMany(e,t,1)},this.addMany=function(e,t,n){let i=this.findByCondition(e,t);if(0===i.count)return this.items.push(new a(e,t,n)),void this.counterChanged();this.items[i.index].count+=n,this.counterChanged()},this.findByCondition=function(e,t){let a=null;return this.items.forEach(function(n,i){n.project===e&&n.department===t&&(a=i)}),null===a?{count:0,index:null}:{count:this.items[a].count,index:a}},this.count=function(){let e=0;return this.items.forEach(function(t){e+=t.count}),e},this.accept=function(){this.accepted=!0,window.phoneWidget.eventDispatcher.dispatch(window.phoneWidget.events.priorityQueueAccepted,{isSentAcceptCallRequestState:!0})},this.unAccept=function(){this.accepted=!1,window.phoneWidget.eventDispatcher.dispatch(window.phoneWidget.events.priorityQueueAccepted,{isSentAcceptCallRequestState:!1})},this.isAccepted=function(){return!0===this.accepted},this.counterChanged=function(){window.phoneWidget.eventDispatcher.dispatch(window.phoneWidget.events.priorityQueueCounterChanged,{count:this.count()})}}}}(),function(){window.phoneWidget.storage.conference=new function(){this.conferences=[],this.add=function(e){return null!==this.getIndex(e.sid)?null:(function(e){e.timeStoragePushed=Date.now()}(e),this.conferences.unshift(e),new window.phoneWidget.conference.Conference(e))},this.remove=function(e){let t=this.getIndex(e);null!==t&&this.conferences.splice(t,1)},this.getIndex=function(e){let t=null;return this.conferences.forEach(function(a,n){if(a.sid===e)return t=n,!1}),t},this.removeByParticipantCallSid=function(e){let t=this.getIndexByParticipantCallSid(e);null!==t&&this.conferences.splice(t,1)},this.getIndexByParticipantCallSid=function(e){let t=null;return this.conferences.forEach(function(a,n){a.participants.forEach(function(a){a.callSid===e&&(t=n)})}),t},this.one=function(e){let t=this.getIndex(e);return null!==t?new window.phoneWidget.conference.Conference(this.conferences[t]):null},this.update=function(e){this.remove(e.sid);let t=this.add(e);null!==t?t.save():console.log("conference not added to storage")},this.showAll=function(){this.conferences.forEach(function(e){console.log(e)})},this.reset=function(){this.conferences=[]}}}(),function(){function e(){this.notifications=[],this.add=function(e,t,a){return null===this.getIndex(e)&&(a.key=e,a.type=t,a.timePushed=Date.now(),this.notifications.unshift(a),a)},this.remove=function(e){let t=this.getIndex(e);return null!==t&&(this.notifications.splice(t,1),!0)},this.getIndex=function(e){let t=null;return this.notifications.forEach(function(a,n){a.key===e&&(t=n)}),t},this.getLast=function(){let e=null;for(let t in this.notifications)"inArray"!==t&&(e=this.notifications[t]);return null==e?null:e},this.getFirst=function(){let e=null;for(let t in this.notifications)if("inArray"!==t){e=this.notifications[t];break}return null==e?null:e},this.one=function(e){let t=this.getIndex(e);return null!==t?this.notifications[t]:null},this.count=function(){return this.notifications.length},this.all=function(){return this.notifications},this.showAll=function(){this.notifications.forEach(function(e){console.log(e)})},this.reset=function(){this.notifications=[]}}function t(){this.$container=document.getElementById("desktop-phone-notifications"),this.notify=function(e){this.containerIsEmpty()||ReactDOM.render(React.createElement(DesktopNotification,{notifications:e}),this.$container)},this.reset=function(){this.containerIsEmpty()||(ReactDOM.unmountComponentAtNode(this.$container),this.$container.innerHTML="")},this.containerIsEmpty=function(){return null===this.$container}}function a(){this.$container=document.getElementById("widget-phone-notifications"),this.notificationKey=null,this.notify=function(e){this.containerIsEmpty()||(this.notificationKey=e.key,ReactDOM.render(React.createElement(PhoneWidgetNotification,{notification:e}),this.$container))},this.reset=function(){this.containerIsEmpty()||(ReactDOM.unmountComponentAtNode(this.$container),this.$container.innerHTML="",this.notificationKey=null)},this.isEqual=function(e){return this.notificationKey===e},this.containerIsEmpty=function(){return null===this.$container}}window.phoneWidget.notifier=new function(){this.notifications=new e,this.notifiers={desktop:new t,phone:new a},this.isOn=!0,this.offKey=null,this.minimize=function(){let e=this;this.notifications.all().forEach(function(t){e.hide(t.key)})},this.getVisibleNotifications=function(){let e=[];return this.notifications.all().forEach(function(t){t.isShow&&e.push(t)}),e},this.add=function(e,t,a){if(!1===this.notifications.add(e,t,a))return!1;if(!a.isShow)return!0;a.isNew=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifiers.phone.notify(a),a.isNew=!1;let n=this;return setTimeout(function(){n.notifiers.desktop.notify(n.getVisibleNotifications()),n.notifiers.phone.notify(a)},50),!0},this.addAndShowOnlyDesktop=function(e,t,a){if(!1===this.notifications.add(e,t,a))return!1;if(!a.isShow)return!0;a.isNew=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),a.isNew=!1;let n=this;return setTimeout(function(){n.notifiers.desktop.notify(n.getVisibleNotifications())},50),!0},this.remove=function(e){let t=this.notifications.one(e);if(null===t)return!1;if(!t.isShow)return this.notifications.remove(e),!0;t.isDeleted=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifiers.phone.isEqual(t.key)&&this.notifiers.phone.notify(t),this.notifications.remove(e);let a=this;return setTimeout(function(){let e=a.getVisibleNotifications();a.notifiers.desktop.notify(e),a.notifiers.phone.isEqual(t.key)&&a.notifiers.phone.reset(),0===e.length&&a.notifiers.desktop.reset()},400),!0},this.hide=function(e){let t=this.notifications.one(e);if(null===t)return!1;if(!t.isShow)return!0;t.willHide=!0,this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifiers.phone.isEqual(t.key)&&this.notifiers.phone.notify(t),t.willHide=!1,t.isShow=!1;let a=this;return setTimeout(function(){let e=a.getVisibleNotifications();a.notifiers.desktop.notify(e),a.notifiers.phone.isEqual(t.key)&&a.notifiers.phone.reset(),0===e.length&&a.notifiers.desktop.reset()},400),!0},this.refresh=function(){if(!this.isOn)return!1;this.notifications.all().forEach(function(e){e.isShow=!0,e.isNew=!0}),this.notifiers.desktop.notify(this.getVisibleNotifications()),this.notifications.all().forEach(function(e){e.isNew=!1});let e=this;return setTimeout(function(){e.notifiers.desktop.notify(e.getVisibleNotifications())},50),this.notifiers.phone.reset(),!0},this.on=function(e){this.isOff()&&this.offKey!==e||(this.isOn=!0)},this.off=function(e){this.isOn=!1,this.offKey=e},this.isOff=function(){return!1===this.isOn},this.reset=function(){this.notifiers.desktop.reset(),this.notifiers.phone.reset()}},window.phoneWidget.notifier.types={incomingCall:"incomingCall",priorityCall:"priorityCall"},window.phoneWidget.notifier.keys={priorityCall:"priorityCall"}}(),$(document).ready(function(){var e;window.widgetIcon=new handleWidgetIcon,widgetIcon.init(),$phoneTabAnchor=$("[data-toggle-tab]"),window.tabHistoryLoaded=!1,$phoneTabAnchor.on("click",function(){if($current="#"+$(this).data("toggle-tab"),$phoneTabAnchor.removeClass("is_active"),$(this).addClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$($current).addClass("is_active"),$(".widget-modal").hide(),$(".collapsible-container").collapse("hide"),f.reset(),"tab-history"===$(this).data("toggle-tab")){window.tabHistoryLoaded||(window.tabHistoryLoaded=!0,$.ajax({url:"/call-log/ajax-get-call-history",type:"post",data:{},dataType:"json",beforeSend:function(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>')},success:function(t){$("#tab-history .simplebar-content").append(t.html),e.recalculate(),$("#tab-history").attr("data-page",t.page)},complete:function(e){$($current).find(".wg-history-load").remove()},error:function(e,t){}})),parseInt($(this).attr("data-missed-calls"))>0&&PhoneWidget.requestClearMissedCalls()}"#tab-contacts"===$current&&(PhoneWidgetContacts.fullListIsEmpty(),$(this).hasClass("js-add-to-conference")?(window.localStorage.setItem("contactSelectableState",1),$(".contacts-list").addClass("contacts-list--selection"),$(".selection-amount").show()):(window.localStorage.setItem("contactSelectableState",0),$(".contacts-list").removeClass("contacts-list--selection"),$(".submit-selected-contacts").slideUp(10),$(".selection-amount").hide()),PhoneWidgetContacts.requestFullList())}),$(".phone-widget__tab").each(function(t,a){var n=new SimpleBar(a);n.getContentElement(),"tab-history"===$(a).attr("id")&&(!function(t){var a=!1;t.getScrollElement().addEventListener("scroll",function(t){if(t.target.scrollTop+t.target.clientHeight===t.target.scrollHeight&&!a){var n=$("#tab-history").attr("data-page");$.ajax({url:"/call-log/ajax-get-call-history",type:"post",data:{page:n},dataType:"json",beforeSend:function(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>'),a=!0},success:function(t){$("#tab-history .simplebar-content").append(t.html),e.recalculate(),$("#tab-history").attr("data-page",t.page),t.rows||(a=!1)},complete:function(){$($current).find(".wg-history-load").remove()},error:function(e,t){}})}})}(n),e=n),"tab-contacts"===$(a).attr("id")&&void 0!==PhoneWidgetContacts&&PhoneWidgetContacts.initLazyLoadFullList(n)}),$(".js-toggle-contact-info").on("click",function(){$(".contact-modal-info").show()}),$(".subject-option__add").on("click",function(){if(!$(this).hasClass("added")){switch($(this).data("add-type")){case"cc":$(".email-modal__modal-input-list").append('<input type="text" class="email-modal__contact-input additional-subj" placeholder="CC">');break;case"bcc":$(".email-modal__modal-input-list").append('<input type="text" class="email-modal__contact-input additional-subj" placeholder="BCC">')}$(this).addClass("added")}});var t=$(".scrollable-block"),a=$(".additional-bar__body"),n=$(".contact-modal-info"),i=$(".suggested-contacts"),o=new SimpleBar(i[0]);new SimpleBar(n[0]).getContentElement(),o.getContentElement(),$(a).each(function(e,t){new SimpleBar(t).getContentElement()}),$(".toggle-bar-settings").on("click",function(){$("#bar-settings").slideToggle(150),$("#bar-logs").slideUp(150)}),$(".additional-bar__close").on("click",function(){$(this).parents(".additional-bar").slideUp(150)}),$(".toggle-bar-logs").on("click",function(){$("#bar-logs").slideToggle(150),$("#bar-settings").slideUp(150)}),$(".additional-bar__close").on("click",function(){$(this).parents(".additional-bar").slideUp(150)});var c=$(".tab-trigger.active-tab").attr("href");$(c).show(),$(".tab-trigger").on("click",function(e){e.preventDefault(),$(".tab-trigger").removeClass("active-tab"),$(this).addClass("active-tab"),$(".tabs__item").hide(),$($(this).attr("href")).show()}),$(t).each(function(e,t){new SimpleBar(t).getContentElement()});var s=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;function l(e,t,a){this.context=e,this.status=0,this.freq1=t,this.freq2=a}l.prototype.setup=function(){this.osc1=d.createOscillator(),this.osc2=d.createOscillator(),this.osc1.frequency.value=this.freq1,this.osc2.frequency.value=this.freq2,this.gainNode=this.context.createGain(),this.gainNode.gain.value=.25,this.filter=this.context.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency=8e3,this.osc1.connect(this.gainNode),this.osc2.connect(this.gainNode),this.gainNode.connect(this.filter),this.filter.connect(d.destination)},l.prototype.start=function(){this.setup(),this.osc1.start(0),this.osc2.start(0),this.status=1},l.prototype.stop=function(){this.osc1.stop(0),this.osc2.stop(0),this.status=0};var r={1:{f1:697,f2:1209},2:{f1:697,f2:1336},3:{f1:697,f2:1477},4:{f1:770,f2:1209},5:{f1:770,f2:1336},6:{f1:770,f2:1477},7:{f1:852,f2:1209},8:{f1:852,f2:1336},9:{f1:852,f2:1477},"":{f1:941,f2:1209},0:{f1:941,f2:1336},"#":{f1:941,f2:1477},"+":{f1:941,f2:1497}},d=new s,u=new l(d,350,440),h=null,m=null;$(".dialpad_btn_init").on("mousedown touchstart",function(e){e.preventDefault();var t=$(this).val();h=t,m=setInterval(function(){if("0"===h){let e=$(".call-pane__dial-number").val();e&&(e=e.substring(0,e.length-1),e+="+",$(".call-pane__dial-number").val(e))}clearInterval(m)},700);var a=r[t];u.freq1=a.f1,u.freq2=a.f2,0==u.status&&u.start();let n=$(".call-pane__dial-number").val();$(".call-pane__dial-number").val(n+t),$(".call-pane__dial-clear-all").addClass("is-shown"),$(".call-pane__dial-number").focus()}),$(".dialpad_btn_active").on("mousedown touchstart",function(e){e.preventDefault();var t=$(this).val(),a=""===t?"*":t;let n=$(this).attr("data-conference-sid"),i=$("#call-pane__dial-number_active_dialpad").val();$("#call-pane__dial-number_active_dialpad").val(i+t),$(".call-pane__dial-clear-all").addClass("is-shown"),$("#call-pane__dial-number_active_dialpad").focus(),PhoneWidget.callRequester.sendDigit(n,a)}),$(window).on("mouseup touchend",function(){void 0!==u&&u.status&&u.stop(),clearInterval(m)}),$(".call_pane_dialpad_clear_number_active_dialpad").on("click",function(e){e.preventDefault(),$("#call-pane__dial-number_active_dialpad").val("")}),$(".call_pane_dialpad_clear_number").on("click",function(e){e.preventDefault(),$("#call-pane__dial-number").val("").attr("readonly",!1).prop("readonly",!1),PhoneWidget.resetDialNumberData(),$("#call-to-label").text(""),$(".suggested-contacts").removeClass("is_active"),$(".dialpad_btn_init").attr("disabled",!1).removeClass("disabled"),$(".call-pane__correction").attr("disabled",!1)}),$(".call_pane_dialpad_clear_number_disabled").on("click",function(e){e.preventDefault(),$(".call-pane__dial-number").val("").attr("readonly",!0).prop("readonly",!0),$("#call-to-label").text(""),$(".suggested-contacts").removeClass("is_active"),PhoneWidget.resetDialNumberData()}),$(".call-pane__correction").on("click",function(e){e.preventDefault();var t=$(".call-pane__dial-number").val();$(".call-pane__dial-number").val(t.slice(0,-1)),1===t.length&&$(".suggested-contacts").removeClass("is_active")}),$(".js-edit-mode").on("click",function(e){if(e.preventDefault(),$(this).hasClass("is-editing"))return $(this).removeClass("is-editing"),$(".contact-modal-info").find(".contact-full-info").removeClass("edit-mode"),$(this).find("span").text("Edit"),void $(".contact-modal-info").find(".contact-full-info .form-control").each(function(e,t){$(t).attr("readonly",!0),$(t).attr("disabled",!0)});$(".contact-modal-info").find(".contact-full-info").addClass("edit-mode"),$(this).addClass("is-editing"),$(".contact-modal-info").find(".contact-full-info .form-control").each(function(e,t){$(t).attr("readonly",!1),$(t).attr("disabled",!1)}),$(".is-editing").find("span").text("Save")}),$(".select-contact-type").on("change",function(){$(this).closest(".form-control-wrap").attr("data-type",$(this).val().toLowerCase())}),$(".js-toggle-phone-widget").on("click",function(e){e.preventDefault(),$(".phone-widget").toggleClass("is_active"),$(this).toggleClass("is-mirror")}),$(".phone-widget__close").on("click",function(e){e.preventDefault(),$(".phone-widget").toggleClass("is_active"),$(".js-toggle-phone-widget").toggleClass("is-mirror")}),$(".js-call-tab-trigger").on("click",function(e){e.preventDefault(),$(".widget-modal").hide(),$(".phone-widget__tab").removeClass("is_active"),$("#tab-phone").addClass("is_active"),$("[data-toggle-tab]").removeClass("is_active"),$('[data-toggle-tab="tab-phone"]').addClass("is_active")}),$(document).on("click",".widget-modal__close",function(){$(".widget-modal").hide(),$(".phone-widget__tab").removeClass("ovf-hidden"),$(".collapsible-container").collapse("hide"),$(".subject-option__add").removeClass("added"),$(".additional-subj").remove()});var f=new callsFilter([{project:"ovago",department:"sales",id:1,calls:[{state:"inProgress",length:6001,id:1,contact:{name:"Geff Robertson1",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"hold",length:2201,id:2,contact:{name:"John Doe2",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:3201,id:3,contact:{name:"John Doe6",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"hold",length:6201,id:4,contact:{name:"John Doe7",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]},{project:null,department:"SALES",id:2,calls:[{state:"general",length:5301,id:2,contact:{name:"John Doe4",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"general",length:5301,id:3,contact:{name:"John Doe5",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:5401,id:4,contact:{name:"John Doe8",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:6241,id:1,contact:{name:"Gerrombo Saltison3",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]},{project:"wowfare",department:null,id:2,calls:[{state:"general",length:5301,id:2,contact:{name:"John Doe4",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"general",length:5301,id:3,contact:{name:"John Doe5",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:5401,id:4,contact:{name:"John Doe8",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}},{state:"direct",length:6241,id:1,contact:{name:"Gerrombo Saltison3",company:'LLC "DREAM TRAVEL"',number:"+123 321 234 432"}}]}]);window.historySimpleBar=e}),$(document).on("click",".call-item-menu__close",function(e){e.preventDefault(),$(this).closest(".call-list-item").removeClass("call-list-item--menu")}),$(document).on("click",".call-info-action__more",function(e){e.preventDefault(),$(this).closest(".call-list-item").addClass("call-list-item--menu")}),$(document).on("click",".call-details__nav-btn--more",function(e){e.preventDefault(),$(".conference-call-details").addClass("is_active")}),$(document).on("click",".call-details__nav-btn--back",function(e){e.preventDefault(),$(".conference-call-details").removeClass("is_active")}),function(){const e={audioDevices:"audio_devices",audioDevicesIsMuted:"audio_devices_is_muted",audioDevicesActiveChanged:"audio_devices_active_changed"};function t(){this.isActive=function(e){let t=this.load();return parseInt(t.activeDeviceId)===parseInt(e)},this.remove=function(e){let t=this.load();if(0===t.devices.length)return;let a=t.devices.findIndex(t=>t===e);a<0||(t.devices.splice(a,1),this.save(t))},this.add=function(e,t){let a=this.load();a.devices=t.map(e=>parseInt(e)),a.devices.includes(e)||a.devices.push(e),this.save(a)},this.load=function(){let t=localStorage.getItem(e.audioDevices);return t?JSON.parse(t):{devices:[],activeDeviceId:null}},this.save=function(t){let a=t.activeDeviceId;t.activeDeviceId=Math.min(...t.devices),localStorage.setItem(e.audioDevices,JSON.stringify(t)),a!==t.activeDeviceId&&localStorage.setItem(e.audioDevicesActiveChanged,"0"===localStorage.getItem(e.audioDevicesActiveChanged)?"1":"0"),PhoneWidget.audio.incoming.refresh()}}function a(a,n,i,o,c){this.queues=a,this.notifier=n,this.incomingPane=i,this.outgoingPane=o,this.devices=new t,this.audio=new Audio("/js/sounds/incoming_call.mp3"),this.audio.volume=.3,this.audio.loop=!0,this.isOn=!0,this.offKey=null,this.addDevice=function(e,t){this.devices.add(e,t)},this.removeDevice=function(e){this.devices.remove(e)},this.play=function(){this.audio.play()},this.stop=function(){this.audio.pause(),this.audio.currentTime=0},this.muted=function(t){this.audio.muted=!0,this.indicatorMuted(),t||localStorage.setItem(e.audioDevicesIsMuted,"1")},this.unMuted=function(t){this.audio.muted=!1,this.indicatorUnMuted(),t||localStorage.setItem(e.audioDevicesIsMuted,"0")},this.isMuted=function(){return!0===this.audio.muted},this.refresh=function(){this.devices.isActive(PhoneWidget.getDeviceState().getDeviceId())&&this.isOn?this.queues.active.count()>0?this.stop():this.outgoingPane.isActive()?this.stop():this.incomingPane.isActive()?this.play():this.notifier.getVisibleNotifications().length>0?this.play():this.stop():this.stop()},this.indicatorMuted=function(){$("#incoming-sound-indicator").attr("data-status",0).html('<i class="fa fa-volume-off text-danger"> </i>').attr("title","Incoming Call - Volume OFF")},this.indicatorUnMuted=function(){$("#incoming-sound-indicator").attr("data-status",1).html('<i class="fa fa-volume-up text-success"> </i>').attr("title","Incoming Call - Volume ON")},this.on=function(e){this.isOff()&&this.offKey!==e||(this.isOn=!0)},this.off=function(e){this.isOn=!1,this.offKey=e},this.isOff=function(){return!1===this.isOn},c&&this.muted(!0)}window.addEventListener("storage",function(t){if(t.key===e.audioDevicesIsMuted){if("1"===t.newValue)return void PhoneWidget.audio.incoming.muted(!0);PhoneWidget.audio.incoming.unMuted(!0)}}),window.addEventListener("storage",function(t){t.key===e.audioDevicesActiveChanged&&PhoneWidget.audio.incoming.refresh()}),window.phoneWidget.audio={Incoming:function(t,n,i,o){return new a(t,n,i,o,"1"===localStorage.getItem(e.audioDevicesIsMuted))}}}(),function(){window.phoneWidget.logger={Logger:function(){function e(){const e=new Date;return`${("0"+e.getDate()).slice(-2)}/${("0"+(e.getMonth()+1)).slice(-2)}/${e.getFullYear()}`+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}this.block=$(".logs-block"),this.success=function(e){this.add(e,"#4e9e22")},this.error=function(e){this.add(e,"#f41b1b")},this.add=function(t,a){if("string"==typeof t){let n="";return n=a?'<p style="color: '+a+'">&gt;&nbsp;'+t+"</p>":"<p>&gt;&nbsp;"+t+"</p>",n+='<p style="font-size: 9px">'+e()+"</p>",void this.block.prepend(n)}this.addError(t)},this.clear=function(){this.block.html("")},this.addError=function(t){let a='<p style="font-size: 11px; font-weight: bold; color: #f41b1b">&gt;&nbsp;An error has occurred</p>';a+='<p style="font-size: 9px">'+e()+"</p>",t.code&&(a+="<p>code: "+t.code+"</p>"),t.name&&(a+="<p>name: "+t.name+"</p>"),t.message&&(a+="<p>message: "+t.message+"</p>"),t.description&&(a+="<p>description: "+t.description+"</p>"),t.comment&&(a+="<p>comment: "+t.comment+"</p>"),t.explanation&&(a+="<p>explanation: "+t.explanation+"</p>"),t.causes&&(a+='<p style="color: #761c19; font-weight: bold">causes: </p>',t.causes.forEach(function(e,t){a+="<p>"+(t+1)+": "+e+"</p>"})),t.solutions&&(a+='<p style="color: #2e6da4; font-weight: bold">solutions: </p>',t.solutions.forEach(function(e,t){a+="<p>"+(t+1)+": "+e+"</p>"})),this.block.prepend(a)}},DummyLogger:function(){this.success=function(e){},this.error=function(e){},this.add=function(e,t){},this.clear=function(){},this.addError=function(e){}}}}(),function(){const e={connected:"Connected",disconnected:"Disconnected"};function t(t){this.status=e.disconnected,this.storage=t,this.isReady=function(){return this.status===e.connected},this.connected=function(){this.status=e.connected,this.storage.phoneConnected()},this.disconnected=function(){this.status=e.disconnected,this.storage.phoneDisconnected()},this.reset=function(){this.disconnected()}}const a={unknown:"Unknown",registered:"Registered",error:"Error"};function n(e){this.status=a.unknown,this.storage=e,this.isReady=function(){return this.status===a.registered},this.unknown=function(){this.status=a.unknown,this.storage.twilioUnknown()},this.registered=function(){this.status=a.registered,this.storage.twilioRegistered()},this.error=function(){this.status=a.error,this.storage.twilioError()},this.reset=function(){this.unknown()}}const i={unknown:"Unknown",selected:"Selected",error:"Error"};function o(e){this.status=i.unknown,this.storage=e,this.isReady=function(){return this.status===i.selected},this.unknown=function(){this.status=i.unknown,this.storage.speakerUnknown()},this.selected=function(){this.status=i.selected,this.storage.speakerSelected()},this.error=function(){this.status=i.error,this.storage.speakerError()},this.reset=function(){this.unknown()}}const c={unknown:"Unknown",selected:"Selected",error:"Error"};function s(e){this.status=c.unknown,this.storage=e,this.isReady=function(){return this.status===c.selected},this.unknown=function(){this.status=c.unknown,this.storage.microphoneUnknown()},this.selected=function(){this.status=c.selected,this.storage.microphoneSelected()},this.error=function(){this.status=c.error,this.storage.microphoneError()},this.reset=function(){this.unknown()}}const l={phoneDisconnected:"Phone disconnected",twilioError:"Twilio error",speakerError:"Speaker error",microphoneError:"Microphone error"};function r(){this.icon=".phone-widget-icon__warning",this.heading=".phone-widget-heading__warning",this.warnings=[],this.ready=function(){this.warnings=[],this.refresh()},this.notReady=function(e){this.warnings.includes(e)||this.warnings.push(e||""),this.refresh()},this.refresh=function(){if(0===this.warnings.length)return $(this.icon).removeClass("phone-widget-icon__warning-show"),$(this.heading).css("display","none"),$(this.heading).attr("data-content",""),void $(this.heading).popover("hide");$(this.icon).addClass("phone-widget-icon__warning-show"),$(this.heading).css("display","block"),$(this.heading).popover("dispose");let e="";e=this.warnings.includes(l.phoneDisconnected)?l.phoneDisconnected:this.warnings.includes(l.twilioError)?l.twilioError:this.warnings.join("<br>"),$(this.heading).popover({content:e,html:!0})},this.remove=function(e){const t=this.warnings.indexOf(e);t>-1&&(this.warnings.splice(t,1),this.refresh())}}function d(){this.isPhoneConnected=!1,this.isTwilioRegistered=!1,this.phone=$(".tab-device-status"),this.twilio=$(".tab-device-status-twilio"),this.speaker=$(".tab-device-status-speaker"),this.microphone=$(".tab-device-status-microphone"),this.phoneConnected=function(){this.isPhoneConnected=!0,this.phone.html('Phone: <span style="color: #00a35b">Connected'),this.twilioStatusShow()},this.phoneDisconnected=function(){this.isPhoneConnected=!1,this.phone.html('Phone: <span style="color: #761c19">Disconnected'),this.twilioStatusHide()},this.twilioStatusShow=function(){this.twilio.css("display","inline"),this.isTwilioRegistered&&(this.microphoneStatusShow(),this.speakerStatusShow())},this.twilioStatusHide=function(){this.twilio.css("display","none"),this.microphoneStatusHide(),this.speakerStatusHide()},this.twilioUnknown=function(){this.isTwilioRegistered=!1,this.twilio.html('Twilio: <span style="color: #000">Unknown'),this.microphoneStatusHide(),this.speakerStatusHide()},this.twilioRegistered=function(){this.isTwilioRegistered=!0,this.twilio.html('Twilio: <span style="color: #00a35b">Registered'),this.isPhoneConnected&&this.twilioStatusShow()},this.twilioError=function(){this.isTwilioRegistered=!1,this.twilio.html('Twilio: <span style="color: #761c19">Error'),this.microphoneStatusHide(),this.speakerStatusHide()},this.speakerStatusShow=function(){this.speaker.css("display","inline")},this.speakerStatusHide=function(){this.speaker.css("display","none")},this.speakerUnknown=function(){this.speaker.html('Speaker: <span style="color: #000">Unknown')},this.speakerSelected=function(){this.speaker.html('Speaker: <span style="color: #00a35b">Selected')},this.speakerError=function(){this.speaker.html('Speaker: <span style="color: #761c19">Error')},this.microphoneStatusShow=function(){this.microphone.css("display","inline")},this.microphoneStatusHide=function(){this.microphone.css("display","none")},this.microphoneUnknown=function(){this.microphone.html('Microphone: <span style="color: #000">Unknown')},this.microphoneSelected=function(){this.microphone.html('Microphone: <span style="color: #00a35b">Selected')},this.microphoneError=function(){this.microphone.html('Microphone: <span style="color: #761c19">Error')}}function u(){this.show=function(){$(".call-pane").addClass("pw-start").addClass("pw-connecting"),$(".phone-widget").addClass("start"),$(".phone-widget__start").css("display","flex"),$(".calling-from-info").css("display","none"),$(".call-pane__number").css("display","none"),$(".call-pane__dial-block").css("display","none")},this.hide=function(){$(".call-pane").removeClass("pw-start").removeClass("pw-connecting"),$(".phone-widget").removeClass("start"),$(".phone-widget__start").css("display","none"),$(".calling-from-info").css("display","flex"),$(".call-pane__number").css("display","block"),$(".call-pane__dial-block").css("display","block")}}function h(e){this.warningIndicator=e,this.statusPanel=new d,this.connectingPanel=new u,this.phoneConnected=function(){this.statusPanel.phoneConnected(),this.connectingPanel.hide(),this.warningIndicator.remove(l.phoneDisconnected),PhoneWidget.openCallTab()},this.phoneDisconnected=function(){this.statusPanel.phoneDisconnected(),this.connectingPanel.show(),this.warningIndicator.notReady(l.phoneDisconnected)},this.twilioUnknown=function(){this.statusPanel.twilioUnknown(),this.warningIndicator.notReady(l.twilioError)},this.twilioRegistered=function(){this.statusPanel.twilioRegistered(),this.warningIndicator.remove(l.twilioError)},this.twilioError=function(){this.statusPanel.twilioError(),this.warningIndicator.notReady(l.twilioError)},this.speakerUnknown=function(){this.statusPanel.speakerUnknown(),this.warningIndicator.notReady(l.speakerError)},this.speakerSelected=function(){this.statusPanel.speakerSelected(),this.warningIndicator.remove(l.speakerError)},this.speakerError=function(){this.statusPanel.speakerError(),this.warningIndicator.notReady(l.speakerError)},this.microphoneUnknown=function(){this.statusPanel.microphoneUnknown(),this.warningIndicator.notReady(l.microphoneError)},this.microphoneSelected=function(){this.statusPanel.microphoneSelected(),this.warningIndicator.remove(l.microphoneError)},this.microphoneError=function(){this.statusPanel.microphoneError(),this.warningIndicator.notReady(l.microphoneError)}}function m(e,t){const a=e,n=t;const i=new function(){this.actions=[],this.enqueue=function(e){this.actions.push(e)},this.dequeue=function(){return this.actions.length>0?this.actions.shift():null}};setInterval(()=>{let e=i.dequeue();if(null===e)return;let t=PhoneWidget.getDeviceState().getDeviceId();null!==t?socketSend("PhoneDeviceReady",e,{userId:a,deviceId:t}):n.add({name:"Change device status. Action: "+e,message:"Device ID must be set!"})},200),this.phoneConnected=function(){},this.phoneDisconnected=function(){},this.twilioUnknown=function(){i.enqueue("TwilioNotReady")},this.twilioRegistered=function(){i.enqueue("TwilioReady")},this.twilioError=function(){i.enqueue("TwilioNotReady")},this.speakerUnknown=function(){i.enqueue("SpeakerNotReady")},this.speakerSelected=function(){i.enqueue("SpeakerReady")},this.speakerError=function(){i.enqueue("SpeakerNotReady")},this.microphoneUnknown=function(){i.enqueue("MicrophoneNotReady")},this.microphoneSelected=function(){i.enqueue("MicrophoneReady")},this.microphoneError=function(){i.enqueue("MicrophoneNotReady")}}function f(l,r,d,u,h,m,f,p,g){if(this.userId=l,this.phone=new t(r),this.twilio=new n(r),this.speaker=new o(r),this.microphone=new s(r),this.logger=g,this.view=d,this.warningIndicator=u,this.isInitiated=!0,this.deviceId=null,this.resetDevices=function(e){this.logger.error("Reset devices. ("+e+")"),this.twilioUnknown(),this.speakerUnknown(),this.microphoneUnknown()},this.ready=function(){this.warningIndicator.ready(),this.logger.success("Phone Device Ready."),console.log("Phone Device Ready.")},this.isReady=function(){return this.phone.isReady()&&this.twilio.isReady()&&this.speaker.isReady()&&this.microphone.isReady()},this.phoneConnected=function(e,t){PhoneWidget.audio.incoming.addDevice(e,t),this.setDeviceId(e),this.phone.connected(),this.view.phoneConnected(),this.logger.success("Phone Device connected."),this.isReady()&&this.ready(),widgetIcon.connect()},this.phoneDisconnected=function(e){PhoneWidget.audio.incoming.removeDevice(this.deviceId),this.removeDeviceId(),this.phone.disconnected(),this.view.phoneDisconnected(),this.logger.error("Phone Device disconnected. ("+e+")"),widgetIcon.disconnect()},this.twilioUnknown=function(){this.twilio.unknown(),this.view.twilioUnknown(),this.logger.error("Twilio Device unknown.")},this.twilioRegistered=function(){this.twilio.registered(),this.view.twilioRegistered(),this.logger.success("Twilio Device registered."),this.isReady()&&this.ready()},this.twilioError=function(){this.twilio.error(),this.view.twilioError(),this.logger.error("Twilio Device error.")},this.speakerUnknown=function(){this.speaker.unknown(),this.view.speakerUnknown(),this.logger.error("Speaker Unknown.")},this.speakerSelected=function(){this.speaker.selected(),this.view.speakerSelected(),this.logger.success("Speaker Selected."),this.isReady()&&this.ready()},this.speakerError=function(){this.speaker.error(),this.view.speakerError(),this.logger.error("Speaker Error.")},this.microphoneUnknown=function(){this.microphone.unknown(),this.view.microphoneUnknown(),this.logger.error("Microphone Unknown.")},this.microphoneSelected=function(){this.microphone.selected(),this.view.microphoneSelected(),this.logger.success("Microphone Selected."),this.isReady()&&this.ready()},this.microphoneError=function(){this.microphone.error(),this.view.microphoneError(),this.logger.error("Microphone Error.")},this.setDeviceId=function(e){this.deviceId=e,this.logger.success("Device ID was installed.")},this.getDeviceId=function(){return this.deviceId},this.removeDeviceId=function(){this.deviceId=null,this.logger.error("Device ID was removed.")},h===e.connected)return this.phoneConnected(),m===a.registered?(this.twilioRegistered(),f===i.selected?this.speakerSelected():f===i.error?this.speakerError():this.speakerUnknown(),void(p===c.selected?this.microphoneSelected():p===c.error?this.microphoneError():this.microphoneUnknown())):m===a.error?void this.twilioError():void this.twilioUnknown();this.phone.disconnected(),this.view.phoneDisconnected(),this.logger.add("Waiting to install Phone Device ID."),widgetIcon.disconnect()}window.phoneWidget.device.state.initialize={Init:function(t,n){const o=new r;return new f(t,new m(t,n),new h(o),o,e.disconnected,a.unknown,i.unknown,c.unknown,n)}}}();var PhoneWidget=function(){let e=null,t={ajaxCallRedirectGetAgents:"",callStatusUrl:"",clearMissedCallsUrl:"",ajaxCreateLeadUrl:"",ajaxClientGetInfoJsonUrl:"/client/ajax-get-info-json",ajaxCreateLeadWithInvalidClientUrl:"",redialSourceType:null,getCallHistoryFromNumberUrl:"",ajaxCheckRecording:"",getUserByPhoneUrl:"",ajaxBlackList:"",ajaxCheckUserForCallUrl:"",ajaxGetPhoneListIdUrl:"",enableAcceptedPanel:!1},a=new window.phoneWidget.requesters.CallRequester,n=new window.phoneWidget.queue.Queue,i={wait:n,direct:new window.phoneWidget.queue.Direct(n),hold:new window.phoneWidget.queue.Hold(n),general:new window.phoneWidget.queue.General(n),outgoing:new window.phoneWidget.queue.Queue,active:window.phoneWidget.queue.Active(),priority:new window.phoneWidget.queue.Priority},o={conference:window.phoneWidget.storage.conference},c={active:PhoneWidgetPaneActive,outgoing:PhoneWidgetPaneOutgoing,incoming:PhoneWidgetPaneIncoming,accepted:PhoneWidgetPaneAccepted,queue:new PhoneWidgetPaneQueue(i)},s={incoming:{}},l={listen:{name:null,id:null},barge:{name:null,id:null},coach:{name:null,id:null}},r="",d=null,u=new Audio("/js/sounds/incoming_call.mp3");u.volume=.3,u.loop=!0;let h={isInitiated:!1},m=new window.phoneWidget.logger.Logger,f=null,p=!1;function g(){return h}function v(){let e=g();if(!0===e.isInitiated)return e.getDeviceId();createNotify("Phone Device","Device is not initiated. Please refresh page or try again later.","error")}function _(){PhoneWidgetContactInfo.hide(),PhoneWidgetDialpad.hide(),function(){let e=i.outgoing.getLast();if(null!==e)return c.outgoing.init(e),!0;return!1}()||function(){let e=i.active.getLast();if(null!==e){let t=o.conference.one(e.data.conferenceSid);return null!==t&&t.getCountParticipants()>2?(c.active.init(e,t),!0):(c.active.init(e),!0)}return!1}()||(w(),$("#tab-phone .call-pane-initial").removeClass("is_active"),$("#tab-phone .call-pane").addClass("is_active"))}function w(){let t=i.direct.count()+i.general.count(),a=i.hold.count(),n=i.active.count()+a;if(t<1&&n<1)return void widgetIcon.update({type:"default",timer:!1,text:null,currentCalls:null,status:1===e.getStatus()});let o="";if(t>0&&n>0)o=t+"+"+n;else if(t>0&&n<1)o=t>1?t:"";else if(t<1&&n>0){if(a<1){let t=i.active.getLast();return null===t?void console.log("Not found last active call"):t.data.isHold?void widgetIcon.update({type:"hold",timer:!0,timerStamp:t.getHoldDuration(),text:"on hold",currentCalls:null,status:1===e.getStatus()}):void widgetIcon.update({type:"inProgress",timer:!0,timerStamp:t.getDuration(),text:"on call",currentCalls:null,status:1===e.getStatus()})}o=1===a?"":n}widgetIcon.update({type:"incoming",timer:!1,text:null,currentCalls:o,status:1===e.getStatus()})}function y(e){console.log("incoming call");let t=n.add(e);return null===t?(console.log("Call is already exist in Wait Queue"),!1):"hold"===t.data.queue?(console.log("hold call"),c.queue.refresh(),q(t,!1),!1):(c.queue.refresh(),c.queue.hide(),i.active.count()>0||i.outgoing.count()>0||c.incoming.isActive()||c.accepted.isActive()?q(t,!0):(P(t,!0),c.incoming.init(t,i.direct.count()+i.general.count(),i.active.count()+i.hold.count())),s.incoming.refresh(),w(),void E())}function R(e){console.log("outgoing call");let t=null;if(e.callSid){if(null===(t=i.outgoing.add(e)))return console.log("Call is already exist in Outgoing Queue"),!1}else t=new window.phoneWidget.call.Call(e);PhoneWidget.freeDialButton(),c.outgoing.init(t),E(),C();let a=i.direct.count()+i.general.count(),n=i.active.count()+i.hold.count();(a>0||n>0)&&c.incoming.initWidgetIcon(a,n),s.incoming.refresh()}function b(e){i.active.remove(e),i.outgoing.remove(e),n.remove(e),o.conference.removeByParticipantCallSid(e);let t=j(e);s.incoming.refresh(),window.phoneWidget.notifier.on(e),s.incoming.on(e),c.queue.refresh();let a=!1;c.active.isEqual(e)&&(c.active.removeCallSid(),c.active.removeCallInProgressIndicator(),c.active.isActive()&&(a=!0),(i.wait.count()>0||i.priority.count()>0)&&window.phoneWidget.notifier.refresh()&&(E(),c.queue.openAllCalls(),s.incoming.refresh())),c.outgoing.isEqual(e)&&(c.outgoing.removeCallSid(),c.outgoing.isActive()&&(a=!0)),c.incoming.isEqual(e)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(a=!0)),c.accepted.isEqual(e)?(c.accepted.removeCallSid(),c.accepted.isActive()&&(a=!0)):c.accepted.isActive()&&(a=!1,t=!1),a||t?(_(),s.incoming.refresh()):c.incoming.isActive()&&c.incoming.initWidgetIcon(i.direct.count()+i.general.count(),i.active.count()+i.hold.count()),0===i.active.count()&&0===i.hold.count()&&(i.direct.count()>0||i.general.count()>0)&&s.incoming.refresh()}function E(){$(".phone-widget").addClass("is_active"),$(".js-toggle-phone-widget").removeClass("is-mirror")}function C(){$(".phone-widget__tab").removeClass("is_active"),$("[data-toggle-tab]").removeClass("is_active"),$("#tab-phone").addClass("is_active"),$("[data-toggle-tab]").each(function(e){"tab-phone"===$(this).data("toggle-tab")&&$(this).addClass("is_active")})}function S(e){return v()?!!h.isReady()||(createNotify(e,"Please try again after some seconds. Device is not ready.","warning"),!1):(createNotify(e,"Not found Device ID. Please refresh current page!","error"),!1)}function N(e){if(!S("Accept Call"))return!1;let t=n.one(e);return null===t?(createNotify("Error","Not found call on Wait Queue","error"),!1):!!t.setAcceptCallRequestState()&&void a.accept(t,v())}function k(e){if(!S("Accept Call"))return!1;let t=n.one(e);return null===t?(createNotify("Error","Not found call on Wait Queue","error"),!1):!!t.setAcceptCallRequestState()&&void a.acceptWarmTransfer(t,v())}function I(e){$('[data-toggle-tab="tab-history"]').attr("data-missed-calls",e)}function x(e){let t=i.active.one(e);return null===t?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!t.setHoldRequestState()&&void a.hold(t)}function D(e){let t=i.active.one(e);return null===t?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!t.setUnHoldRequestState()&&void a.unHold(t)}function P(e,t){return window.phoneWidget.notifier.addAndShowOnlyDesktop(e.data.callSid,window.phoneWidget.notifier.types.incomingCall,U(e,t))}function q(e,t){return window.phoneWidget.notifier.add(e.data.callSid,window.phoneWidget.notifier.types.incomingCall,U(e,t))}function W(e,t){return window.phoneWidget.notifier.add(window.phoneWidget.notifier.keys.priorityCall,window.phoneWidget.notifier.types.priorityCall,A(e,t))}function A(e,t){return{project:e.project,department:e.department,isShow:t,eventName:window.phoneWidget.events.priorityQueueAccepted}}function U(e,t){return{callSid:e.data.callSid,queue:e.data.queue,name:e.data.contact.name,phone:e.data.contact.phone,project:e.data.project,department:e.data.department,duration:e.data.duration,canCallInfo:e.data.contact.canCallInfo,isInternal:e.data.isInternal,fromInternal:e.data.fromInternal,eventName:e.getEventUpdateName(),isShow:t,isWarmTransfer:e.data.isWarmTransfer}}function j(e){return window.phoneWidget.notifier.remove(e)}function T(e){let t=window.phoneWidget.notifier.hide(e);return s.incoming.refresh(),t}function H(){E(),c.queue.openAllCalls(),window.phoneWidget.notifier.refresh(),s.incoming.refresh(),w()}function L(e){if(!e)return createNotify("Hangup","Not found Call Sid","error"),!1;let t=null;return null===(t=i.active.one(e))&&null===(t=i.outgoing.one(e))?(createNotify("Hangup","Not found Call on Active or Outgoing Queue","error"),!1):!!t.setHangupRequestState()&&void a.hangup(t)}function M(){let e=localStorage.getItem("activeCall");return e?JSON.parse(e):null}function B(e){if(!t.enableAcceptedPanel)return;let a={...e};c.accepted.init(a),w(),c.queue.hide(),E(),C()}function O(e){if(e.isSentAcceptCallRequestState())return;if(null===f)return void createNotify("Accept internal Call","Not found twilioInternalIncomingConnection","error");let t=e.data.callSid;f.parameters.CallSid===t?(e.setAcceptCallRequestState(),a.acceptInternalCall(e,f)):createNotify("Accept internal Call","Accepted Call Sid("+t+") is not equal twilioInternalIncomingConnection CallSid("+f.parameters.CallSid+")","error")}function F(){u.pause()}function Q(){if(!S("Create Call"))return!1;let e=$("#call-pane__dial-number-value"),t=$("#call-pane__dial-number").val(),n={toUserId:e.attr("data-user-id"),from:e.attr("data-phone-from")||d.getData.value,to:t,historyCallSid:e.attr("data-history-call-sid"),projectId:e.attr("data-project-id")||d.getData.projectId,clientId:e.attr("data-client-id"),leadId:e.attr("data-lead-id"),caseId:e.attr("data-case-id"),fromCase:e.attr("data-from-case"),fromLead:e.attr("data-from-lead"),fromContacts:e.attr("data-from-contacts"),deviceId:v()};$("#btn-new-make-call").html('<i class="fa fa-spinner fa-spin"> </i>').attr("disabled",!0),a.createCall(n)}function V(e){$("#call-pane__dial-number").val(e.formatted?e.formatted:"").attr("readonly","readonly"),e.title&&e.title.length>0?$("#call-to-label").text(e.title):$("#call-to-label").text(""),$("#call-pane__dial-number-value").attr("data-user-id",e.user_id?e.user_id:"").attr("data-phone-to",e.phone_to?e.phone_to:"").attr("data-phone-from",e.phone_from?e.phone_from:"").attr("data-history-call-sid",e.history_call_sid?e.history_call_sid:"").attr("data-project-id",e.project_id?e.project_id:"").attr("data-client-id",e.client_id?e.client_id:"").attr("data-lead-id",e.lead_id?e.lead_id:"").attr("data-case-id",e.case_id?e.case_id:"").attr("data-from-case",e.from_case?e.from_case:"").attr("data-from-lead",e.from_lead?e.from_lead:"").attr("data-from-contacts",e.from_contacts?e.from_contacts:""),soundNotification("button_tiny"),$(".dialpad_btn_init").attr("disabled","disabled").addClass("disabled"),$(".call-pane__correction").attr("disabled","disabled")}function G(){$("#call-pane__dial-number-value").attr("data-user-id","").attr("data-phone-to","").attr("data-phone-from","").attr("data-history-call-sid","").attr("data-project-id","").attr("data-client-id","").attr("data-lead-id","").attr("data-case-id","").attr("data-from-case","").attr("data-from-lead","").attr("data-from-contacts","")}function z(){f=null}return{init:function(n){a.init(n),s.incoming=new window.phoneWidget.audio.Incoming(i,window.phoneWidget.notifier,c.incoming,c.outgoing),h=new window.phoneWidget.device.state.initialize.Init(n.userId,m),Object.assign(t,n),l=n.conferenceSources,r=n.leadViewPageShortUrl,d=n.phoneNumbers,(e=new widgetStatus(".call-status-switcher",n.updateStatusUrl)).setStatus(n.status),w(),I(n.countMissedCalls),c.active.setup(n.btnHoldShow,n.btnTransferShow,n.canRecordingDisabled,n.canAddBlockList,n.btnReconnectShow),$(document).on("click",".queue-separator .list_item_mute",function(e){let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(t);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;if(n.data.isMute){if(!n.setUnMuteRequestState())return!1;a.unMute(n)}else{if(!n.setMuteRequestState())return!1;a.mute(n)}}),$(document).on("click",".call-pane-calling #call-pane__mute",function(e){$(this);let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(t);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;if(n.data.isMute){if(!n.setUnMuteRequestState())return!1;a.unMute(n)}else{if(!n.setMuteRequestState())return!1;a.mute(n)}}),$(document).on("click",".wg-transfer-call",function(e){e.preventDefault();let a=$(this).attr("data-call-sid");if(!a)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(a);return null===n?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!n.canTransfer()&&void function(e){if(void 0===t.ajaxCallRedirectGetAgents)return alert("Ajax call redirect url is not set"),!1;let a=$("#web-phone-redirect-agents-modal");a.modal("show").find(".modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),$("#web-phone-redirect-agents-modal-label").html("Transfer Call"),$.get(t.ajaxCallRedirectGetAgents,{sid:e}).done(function(e){a.find(".modal-body").html(e)})}(n.data.callSid)}),$(document).on("click","#btn-accept-call",function(){let e=$(this),t=$(this).attr("data-type-action");return"acceptWarmTransfer"===t?(k(e.attr("data-call-sid")),!1):"accept"===t?(N(e.attr("data-call-sid")),!1):void console.log("Undefined type action")}),$(document).on("click",".btn-item-call-queue",function(){let e=$(this),t=$(this).attr("data-type-action");if("accept"===t)return N(e.attr("data-call-sid")),!1;if("acceptInternal"===t){let t=i.direct.one(e.attr("data-call-sid"));return null===t?(createNotify("Accept Internal Call","Not found Call on Direct Incoming Queue","error"),!1):(O(t),!1)}return"hangup"===t?(L(e.attr("data-call-sid")),!1):"return"===t?(function(e){if(!S("Return Hold Call"))return!1;let t=i.hold.one(e);null===t?createNotify("Error","Not found call on Hold Queue","error"):t.setReturnHoldCallRequestState()&&a.returnHoldCall(t,v())}(e.attr("data-call-sid")),!1):"acceptWarmTransfer"===t?(k(e.attr("data-call-sid")),!1):void console.log("Undefined type action")}),$(document).on("click",".btn-item-call-priority",function(){!S("Accept Call")||i.priority.isAccepted()||a.acceptPriorityCall(window.phoneWidget.notifier.keys.priorityCall,v())}),$(document).on("click","#hide-incoming-call",function(e){e.preventDefault();let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;c.incoming.isEqual(t)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(c.incoming.hide(),T(t),_(),i.wait.count()>0&&0===i.active.count()&&0===i.outgoing.count()&&(c.queue.openAllCalls(),s.incoming.refresh())))}),$(document).on("click","#active_call_add_note_submit",function(e){e.preventDefault();let t=$(this).data("call-sid");if(!t)return createNotify("Warning","Call SID is undefined","warning"),!1;let n=i.active.one(t);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;let o=document.getElementById("active_call_add_note"),c=o.value.trim();return c?!!n.setAddNoteRequestState()&&void a.addNote(n,c,o):(createNotify("Warning","Note value is empty","warning"),!1)}),$(document).on("click","#wg-add-note",function(e){e.preventDefault(),$(".additional-info.add-note").slideDown(200)}),$(document).on("click",".additional-info.add-note .additional-info__close",function(){$(".add-note").slideUp(150)}),$(document).on("click",".call-pane-calling #wg-dialpad",function(){"true"===$(this).attr("data-active")&&$(".dial-popup").slideDown(150)}),$(document).on("click",".dial-popup .additional-info__close",function(){$(".dial-popup").slideUp(150)}),$(document).on("click",".call-pane__info",function(){let e=$(this),a=e.html(),n=e.data("call-id");$.ajax({type:"post",url:t.ajaxClientGetInfoJsonUrl,dataType:"json",data:{callId:n},beforeSend:function(){e.html('<i class="fa fa-spin fa-spinner" />')},success:function(e){e.error?createNotify("Error",e.message,"error"):(PhoneWidgetContactInfo.load(e),$(".contact-info").slideDown(150))},complete:function(){e.html(a)},error:function(e){createNotify("Error",e.responseText,"error")}})}),$(document).on("click",".additional-info.contact-info .additional-info__close",function(){$(".contact-info").slideUp(150)}),$(document).on("click","#wg-hold-call",function(e){let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let a=i.active.one(t);return null===a?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!a.canHoldUnHold()&&void(a.data.isHold?D(a.data.callSid):x(a.data.callSid))}),$(document).on("click",".list_item_hold",function(e){let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let a=i.active.one(t);return null===a?(createNotify("Error","Not found Call on Active Queue","error"),!1):!!a.canHoldUnHold()&&void(a.data.isHold?D(a.data.callSid):x(a.data.callSid))}),$(document).on("click","#cancel-active-call",function(e){L($(this).attr("data-call-sid"))}),$(document).on("click","#cancel-outgoing-call",function(e){e.preventDefault();let t=$(this),n=t.attr("data-call-sid");if(!n)return createNotify("Hangup","Please try again after some seconds.","warning"),!1;let o=i.outgoing.one(n);return null===o?(createNotify("Error","Not found Call on Outgoing Queue","error"),!1):!!o.setHangupRequestState()&&void a.hangupOutgoingCall(o)}),$(document).on("click",".btn-history-call-info",function(e){e.preventDefault();let t=$(this).attr("data-call-sid");if(void 0===t)return createNotify("Call Info","Not found Call Sid","error"),!1;a.callLogInfo(t)}),$(document).on("click",".pw-btn-call-info",function(e){e.preventDefault();let t=$(this).attr("data-call-sid");if(void 0===t)return createNotify("Call Info","Not found Call Sid","error"),!1;a.callInfo(t)}),$(document).on("click",".cw-btn-client-info",function(e){e.preventDefault();let t=$(this).attr("data-client-id"),n=$(this).attr("data-is-client"),i=$(this).attr("data-call-sid");if(void 0===t)return createNotify("Client Info","Not found Client ID","error"),!1;a.clientInfo(t,i,"true"===n)}),$(document).on("click",".pw-notification-hide",function(e){e.preventDefault();let t=$(this).attr("data-key");T(t),c.incoming.isEqual(t)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(c.incoming.hide(),_())),s.incoming.refresh(),0!==i.active.count()||0!==i.outgoing.count()||c.incoming.isActive()||c.queue.openAllCalls()}),$(document).on("click","#incoming-sound-indicator",function(){"1"===$(this).attr("data-status")?s.incoming.muted():s.incoming.unMuted()}),$(document).on("click","#wg-call-record",function(e){let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(t);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;n.data.recordingDisabled?createNotify("Error","Enable recording is not allowed.","error"):function(e){let t=i.active.one(e);null===t?createNotify("Error","Not found Call on Active Queue","error"):t.setRecordingDisableRequestState()&&a.recordingDisable(t)}(n.data.callSid)}),$(document).on("click",".btn-add-in-blacklist",function(e){e.preventDefault();let t=$(this).data("phone");if(void 0===t)return createNotify("Call Info","Phone number not found","error"),!1;a.addPhoneBlackList(t)}),$(document).on("click",".cw-btn-create-lead",function(e){e.preventDefault();let a=$(this),n=a.attr("data-call-sid"),i=a.html();$.ajax({type:"post",data:{callSid:n},url:t.ajaxCreateLeadUrl,dataType:"json",beforeSend:function(){a.addClass("disabled").html('<i class="fa fa-spin fa-spinner" />')},success:function(e){if(e.error)createNotify("Error",e.message,"error");else{if("client is invalid"===e.message)return void function(e){var a=$("#modal-md");$.ajax({type:"get",url:t.ajaxCreateLeadWithInvalidClientUrl,data:{callSid:e},dataType:"html",beforeSend:function(){a.find(".modal-body").html('<div style="text-align:center;font-size: 40px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),a.find(".modal-title").html("Create New Lead"),a.modal("show")},success:function(e){a.find(".modal-body").html(e),a.find(".modal-title").html("Create New Lead"),$("#preloader").addClass("d-none")},error:function(){createNotifyByObject({title:"Error",type:"error",text:"Internal Server Error. Try again letter.",hide:!0}),setTimeout(function(){$("#modal-md").modal("hide")},300)}})}(n);e.warning&&createNotify("Warning",e.message,"warning"),createNotify("Success","Lead created successfully","success"),PhoneWidgetContactInfo.load(e.contactData),window.open(e.url,"_blank").focus()}},complete:function(){a.removeClass("disabled").html(i)},error:function(e){createNotify("Error",e.responseText,"error")}})}),$(document).on("click","#wg-reconnect-call",function(e){if("true"!==$(this).attr("data-active"))return!1;let t=$(this).attr("data-call-sid");if(!t)return createNotify("Error","Not found Call SID","error"),!1;let n=i.active.one(t);if(null===n)return createNotify("Error","Not found Call on Active Queue","error"),!1;!function(e){let t=i.active.one(e);null===t?createNotify("Error","Not found Call on Active Queue","error"):t.setReconnectRequestState()&&a.reconnect(t)}(n.data.callSid)}),$(document).on("click",".btn-transfer",function(e){e.preventDefault();let t=$(e.target),n=t.data("type"),i=t.data("value");t.attr("disabled",!0);let o=$("#web-phone-redirect-agents-modal");o.find(".modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>');let c=$(this).attr("data-call-sid");return c?i&&n?void a.transfer(c,i,n,o):(createNotifyByObject({title:"Transfer call",type:"error",text:"Please try again after some seconds",hide:!0}),!1):(createNotifyByObject({title:"Transfer call",type:"error",text:"Not found Call SID!",hide:!0}),!1)}),$(document).on("click",".btn-warm-transfer-to-user",function(e){e.preventDefault();let t=$(e.target),n=t.data("user-id"),i=t.data("call-sid");t.attr("disabled",!0);let o=$("#web-phone-redirect-agents-modal");if(o.find(".modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),!i)return createNotifyByObject({title:"Transfer call",type:"error",text:"Not found Call SID!",hide:!0}),!1;a.warmTransferToUser(i,n,o)}),$(document).on("click",".btn-transfer-number",function(e){e.preventDefault();let t=$(e.target),n=t.data("type"),i=t.data("value");t.attr("disabled",!0);let o=$(this).attr("data-call-sid"),c=null,s=M();if(s&&(c=s.To),!o)return createNotifyByObject({title:"Transfer call",type:"error",text:"Not found active Connection CallSid",hide:!0}),!1;if(i.length<2)return console.error("Error call forward param TO"),!1;let l=$("#web-phone-redirect-agents-modal");l.find(".modal-body").html('<div style="text-align:center;font-size: 60px;"><i class="fa fa-spin fa-spinner"></i> Loading ...</div>'),a.transferNumber(o,n,c,i,l)}),$(document).on("click","#btn-make-call-case-communication-block",function(e){e.preventDefault();let t=$("#call-to-number").val(),a=$("#call-from-number").val();return t?a?(V({formatted:t,title:$("#call-client-name").val(),phone_to:t,phone_from:a,case_id:$("#call-case-id").val(),from_case:!0}),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active"),$(".phone-widget").addClass("is_active"),void Q()):(createNotify("Make call","Please select Phone from","error"),!1):(createNotify("Make call","Please select Phone number","error"),!1)}),$(document).on("click","#btn-make-call-lead-communication-block",function(e){e.preventDefault();let t=$("#call-to-number").val(),a=$("#call-from-number").val();return t?a?(V({formatted:t,title:$("#call-client-name").val(),phone_to:t,phone_from:a,lead_id:$("#call-lead-id").val(),from_lead:!0}),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active"),$(".phone-widget").addClass("is_active"),void Q()):(createNotify("Make call","Please select Phone from","error"),!1):(createNotify("Make call","Please select Phone number","error"),!1)}),$(document).on("click",".phone-dial-history",function(e){e.preventDefault();let t=$(this),a=!!t.data("user-id");$(".widget-phone__contact-info-modal").hide(),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active"),V({formatted:t.data("phone"),title:a?"":t.data("title"),user_id:t.data("user-id"),phone_to:t.data("phone"),history_call_sid:a?"":t.data("call-sid")})}),$(document).on("click","#btn-new-make-call",function(e){e.preventDefault(),Q()}),$(document).on("click",".btn-contacts-call",function(e){e.preventDefault();let t=$(this).data("phone-number"),a=$(this).data("title"),n=$(this).data("user-id"),i=$(this).data("contact-id"),o=$(".js-toggle-phone-widget");o.length&&($(".phone-widget").addClass("is_active"),$(".js-toggle-phone-widget").addClass("is-mirror"),V({formatted:t,title:a,user_id:n,phone_to:t,client_id:i,from_contacts:!0}))}),$(document).on("click",".phone-dial-contacts",function(e){e.preventDefault();let t=$(this),a=!!t.data("user-id");$(".widget-phone__contact-info-modal").hide(),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active"),V({formatted:t.data("phone"),title:a?"":t.data("title"),user_id:t.data("user-id"),phone_to:t.data("phone"),client_id:t.data("contact-id"),from_contacts:!0})}),$(document).on("input","#call-pane__dial-number",function(e){G()}),$(document).on("click","li.call-contact-card",function(){let e=$(this).data("phone"),t=$(this).data("title"),a=$(this).data("user-id"),n=$(this).data("contact-id");V({formatted:e,title:t,user_id:a,phone_to:e,client_id:n,from_contacts:!0}),$(".suggested-contacts").removeClass("is_active")}),$(document).on("click",".contact-dial-to-user",function(){let e=PhoneWidgetContacts.decodeContact($(this).data("contact"));V({formatted:e.name,title:"",user_id:e.id}),$(".phone-widget__header-actions a[data-toggle-tab]").removeClass("is_active"),$(".phone-widget__tab").removeClass("is_active"),$('.phone-widget__header-actions a[data-toggle-tab="tab-phone"]').addClass("is_active"),$("#tab-phone").addClass("is_active")}),window.addEventListener("storage",function(e){if("activeCall"===e.key){let t=JSON.parse(e.newValue);void 0!==t.acceptType&&B(t)}}),p=!0},volumeIndicatorsChange:function(e,t){$("#wg-call-microphone .sound-ovf").css("right",-Math.floor(100*e)+"%"),$("#wg-call-volume .sound-ovf").css("right",-Math.floor(100*t)+"%")},refreshCallStatus:function(e){"In progress"===e.status?function(e){console.log("active call"),n.remove(e.callSid),i.outgoing.remove(e.callSid),j(e.callSid);let t=i.active.add(e);if(null===t)return s.incoming.refresh(),console.log("Call is already exist in Active Queue"),!1;if(PhoneWidget.freeDialButton(),s.incoming.refresh(),c.outgoing.isEqual(t.data.callSid)&&(c.outgoing.removeCallSid(),c.outgoing.hide()),void 0!==e.conference&&null!==e.conference){o.conference.remove(e.conference.sid);let a=o.conference.add(e.conference);if(null===a)console.log("conference not added");else if(a.getCountParticipants()>2)return c.active.init(t,a),E(),C(),c.queue.refresh(),void c.queue.hide()}c.active.init(t),E(),C(),c.queue.refresh(),c.queue.hide()}(e):"Ringing"===e.status||"Queued"===e.status?2===parseInt(e.typeId)?y(e):1===parseInt(e.typeId)&&R(e):("Completed"===e.status||e.isEnded||5===parseInt(e.cua_status_id))&&b(e.callSid)},panes:c,requestIncomingCall:y,requestOutgoingCall:R,changeStatus:function(t){e.setStatus(t),c.active.isActive()||c.outgoing.isActive()||widgetIcon.update({type:"default",timer:!1,text:null,currentCalls:null,status:1===e.getStatus()})},requestClearMissedCalls:function(){$.ajax({type:"post",data:{},url:t.clearMissedCallsUrl}).done(function(e){I(e.count)}).fail(function(){createNotify("Clear missed calls","Server error","error")})},socket:function(e){"add_missed_call"!==e.command?"update_count_missed_calls"!==e.command?"hold"!==e.command?"unhold"!==e.command?"conferenceUpdate"!==e.command?"addCallToHistory"!==e.command?"recordingDisable"!==e.command?"recordingEnable"!==e.command?"addPriorityCall"!==e.command?"removePriorityCall"!==e.command?"resetPriorityCall"!==e.command?"mute"!==e.command?"unmute"!==e.command||function(e){let t=i.active.one(e.call.sid);null!==t&&t.unMute()}(e):function(e){let t=i.active.one(e.call.sid);null!==t&&t.mute()}(e):(console.log("reset priority call"),i.priority.reset(),i.priority.count()<1&&window.phoneWidget.notifier.remove(window.phoneWidget.notifier.keys.priorityCall),c.queue.refresh(),s.incoming.refresh()):function(e){console.log("remove priority call"),i.priority.remove(e.project,e.department),i.priority.count()<1&&window.phoneWidget.notifier.remove(window.phoneWidget.notifier.keys.priorityCall),c.queue.refresh(),s.incoming.refresh()}(e):function(e){console.log("add priority call"),i.priority.add(e.project,e.department),i.active.count()>0||i.outgoing.count()>0?W(e,!1):W(e,!0),c.queue.refresh(),s.incoming.refresh(),E()}(e):function(e){let t=i.active.one(e);null!==t&&t.recordingEnable()}(e.call.sid):function(e){let t=i.active.one(e);null!==t&&t.recordingDisable()}(e.call.sid):function(e){if($("#tab-history .simplebar-content .history-tab-today-first-block").length>0)$("#tab-history .simplebar-content .history-tab-today-first-block").prepend(e.call);else{let t='<span class="section-separator">Today</span><ul class="phone-widget__list-item calls-history history-tab-today-first-block">'+e.call+"</ul>";$("#tab-history .simplebar-content").prepend(t),window.historySimpleBar.recalculate()}}(e):function(e){console.log("conference update");let t=null;if(e.conference.participants.forEach(function(e){null===t&&(t=i.active.one(e.callSid))}),null===t)return void console.log("not found call in active queue");let a=o.conference.one(e.conference.sid);if(null!==a){let n=e.conference.participants.length,i=a.getCountParticipants();return i<3&&n<3?(o.conference.remove(e.conference.sid),void(a=o.conference.add(e.conference))):i<3&&n>2?(o.conference.remove(e.conference.sid),a=o.conference.add(e.conference),void(c.accepted.isActive()?c.accepted.isEqual(t.data.callSid)&&c.active.init(t,a):c.active.init(t,a))):i>2&&n>2?void o.conference.update(e.conference):i>2&&n<3?(o.conference.remove(e.conference.sid),o.conference.add(e.conference),void(c.accepted.isActive()?c.accepted.isEqual(t.data.callSid)&&c.active.init(t):c.active.init(t))):void console.log("not found rule for conference update")}(a=o.conference.add(e.conference)).getCountParticipants()>2?c.accepted.isActive()?c.accepted.isEqual(t.data.callSid)&&c.active.init(t,a):c.active.init(t,a):c.accepted.isActive()?c.accepted.isEqual(t.data.callSid)&&c.active.init(t):c.active.init(t)}(e):function(e){let t=i.active.one(e);null!==t&&(t.unHold(),w())}(e.call.sid):function(e){let t=i.active.one(e);null!==t&&(t.hold(),w())}(e.call.sid):I(e.count):function(){let e=$('[data-toggle-tab="tab-history"]').attr("data-missed-calls");e++,$('[data-toggle-tab="tab-history"]').attr("data-missed-calls",e)}()},queues:i,removeIncomingRequest:function(e){let t=n.remove(e);c.queue.refresh(),j(e),s.incoming.refresh(),window.phoneWidget.notifier.on(e),s.incoming.on(e),t&&w(),c.incoming.isEqual(e)&&(c.incoming.removeCallSid(),c.incoming.isActive()&&(c.incoming.hide(),_()))},sendHoldRequest:x,sendUnHoldRequest:D,storage:o,callRequester:a,completeCall:b,updateCurrentCalls:function(t,a){e.setStatus(a),w(),n.reset(),i.outgoing.reset(),i.active.reset(),o.conference.reset(),i.priority.reset(),c.queue.refresh(),_(),window.phoneWidget.notifier.reset(),function(e){if(e.isEmpty)return;let t=!1;e.hold.forEach(function(e){let a=n.add(e);null!==a&&(t=!0,P(a,!0))});let a=null,l=!1;e.incoming.forEach(function(e){let t=n.add(e);null!==t&&(P(t,!0),l=!0,a=t)});let r=!1;e.outgoing.forEach(function(e){i.outgoing.add(e),r=!0});let d=!1;if(e.active.forEach(function(e){i.active.add(e),d=!0}),e.conferences.forEach(function(e){o.conference.add(e)}),e.priority.forEach(function(e){i.priority.addMany(e.project,e.department,e.count),i.active.count()>0||i.outgoing.count()>0?W(e,!1):W(e,!0)}),E(),c.queue.refresh(),"incoming"===e.lastActive&&0===i.active.count()&&0===i.outgoing.count()&&null!==a)return c.incoming.init(a,i.direct.count()+i.general.count(),i.active.count()+i.hold.count()),C(),void s.incoming.refresh();s.incoming.refresh(),!t||d||r||l?(d&&window.phoneWidget.notifier.minimize(),_()):H()}(t)},iconUpdate:w,audio:s,showCallingPanel:function(){$("#tab-phone .call-pane-initial").removeClass("is_active"),$("#tab-phone .call-pane-calling").addClass("is_active")},openCallTab:C,hidePhoneNotifications:function(){window.phoneWidget.notifier.minimize()},openHoldCallPanel:H,setActiveCall:function(e){let t={};t.CallSid=e.parameters.CallSid,t.To=e.parameters.To;let a={};for(let[t,n]of e.customParameters.entries())a[t]=n;"acceptType"in a&&(a.callSid=e.parameters.CallSid,B(t=Object.assign(t,a))),localStorage.setItem("activeCall",JSON.stringify(t))},getActiveCallSid:function(){let e=M();return e?e.CallSid:null},acceptInternalCall:O,rejectInternalCall:function(e){if(null===f)return void createNotify("Reject internal Call","Not found twilioInternalIncomingConnection","error");let t=e.data.callSid;f.parameters.CallSid===t?(e.setRejectInternalRequest(),f.reject(),z(),F()):createNotify("Reject internal Call","Rejected Call Sid("+t+") is not equal twilioInternalIncomingConnection CallSid("+f.parameters.CallSid+")","error")},incomingSoundOff:F,webCallLeadRedial:function(e,t,n,i,o,c){a.webCallLeadRedial(e,t,n,i,o,c)},joinListen:function(e){if(!S("Listen Call"))return!1;a.joinConference(l.listen.name,l.listen.id,e,v())},joinCoach:function(e){if(!S("Coach Call"))return!1;a.joinConference(l.coach.name,l.coach.id,e,v())},joinBarge:function(e){if(!S("Barge Call"))return!1;a.joinConference(l.barge.name,l.barge.id,e,v())},getLeadViewPageShortUrl:function(){return r},freeDialButton:function(){$("#btn-new-make-call").html('<i class="fas fa-phone"> </i>').attr("disabled",!1)},soundDisconnect:function(){soundNotification("disconnect_sound",.3)},soundConnect:function(){soundNotification("connect_sound",.99)},resetDialNumberData:G,getDeviceState:g,addLog:function(e,t){return m.add(e,t)},clearLog:function(){return m.clear()},setTwilioInternalIncomingConnection:function(e){f=e},removeTwilioInternalIncomingConnection:z,isInitiated:function(){return!0===p},addLogError:function(e){return m.error(e)},addLogSuccess:function(e){return m.success(e)},refreshPanes:_}}();!function(){var e,t,a;$("#call-pane__dial-number").on("keyup",(e=function(){$(".suggested-contacts").removeClass("is_active");let e=$("#contact-list-calls-ajax");if(e.find("input[name=q]").val().length<3)return!1;e.submit()},t=300,a=0,function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,i)},t||0)}));$("#contact-list-calls-ajax").on("beforeSubmit",function(e){e.preventDefault();let t=$(this);return!(t.find("input[name=q]").val().length<3)&&($.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serializeArray(),dataType:"json"}).done(function(e){let t="";e.results.length<1||($.each(e.results,function(e,a){t+=function(e){console.log(e);let t="";3===e.type&&(t='<div class="contact-info-card__status"><i class="far fa-user '+e.user_status_class+' "></i></div>');let a=3===e.type?e.id:"";return'<li class="calls-history__item contact-info-card call-contact-card" data-contact-id="'+e.id+'" data-user-id="'+a+'" data-phone="'+(a?e.title:e.phone)+'" data-title="'+(a?"":e.title)+'"><div class="collapsible-toggler">'+t+'<div class="contact-info-card__details"><div class="contact-info-card__line history-details"><strong class="contact-info-card__name">'+e.name+"</strong></div></div></div></li>"}(a)}),$(".suggested-contacts").html(t).addClass("is_active"),$(".call-pane__dial-clear-all").addClass("is-shown"))}).fail(function(){createNotifyByObject({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})}),!1)})}();let PhoneWidgetSms=function(){let e="",t="",a={},n={1:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',2:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',3:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',4:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',5:'<span class="pw-msg-item__status pw-msg-item__status--delivered"> <i class="fa fa-check-double"></i> </span>',6:'<span class="pw-msg-item__status pw-msg-item__status--error"> <i class="fa fa-exclamation-circle"></i> </span>',7:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>',8:'<span class="pw-msg-item__status"> <i class="fa fa-check"></i> </span>'};function i(){return a}function o(e){return void 0===n[e.status]?"":n[e.status]}function c(e){return"web-phone-widget-sms-"+e.id}function s(){let e=$(document).find(".messages-modal__messages-scroll").find($(".simplebar-content-wrapper"))[0];e&&$(e).scrollTop($(e)[0].scrollHeight)}function l(e,t){return"phone-widget-sms-messages-container-"+e.id+"-"+r(e.phone)+"-"+e.type+"-"+r(t.phone)}function r(e){return e.substr(1)}function d(e,t){if(!t)return!1;let a=!1;if(t.find(".messages-modal__msg-list").map(function(){if(e.group===$(this).data("group"))return $(this).append(u(e)),a=!0,!1}),!a){let a='<span class="section-separator">'+e.group+"</span>";a+='<ul class="messages-modal__msg-list" data-group="'+e.group+'">',a+=u(e),a+="</ul>",t.append(a)}}function u(e){let t="";return 1===e.type&&(t=" pw-msg-item--user"),'<li class="messages-modal__msg-item pw-msg-item'+t+'"><div class="pw-msg-item__avatar"><div class="agent-text-avatar"><span>'+e.avatar+'</span></div></div><div class="pw-msg-item__msg-main"><div class="pw-msg-item__data"><span class="pw-msg-item__name">'+e.name+'</span><span class="pw-msg-item__timestamp">'+e.time+'</span><span class="'+c(e)+'">'+o(e)+'</span></div><div class="pw-msg-item__msg-wrap"><p class="pw-msg-item__msg">'+e.text+"</p></div></div></li>"}function h(e,t){let a="."+l(e,t),n=$(document).find(a);return n||!1}return{init:function(n,i,o){e=n,t=i,a=o},getUserPhones:i,showModalSelectNumber:function(e){let t="";$.each(i(),function(a,n){var i;t+='<span class="phone-widget-userPhones btn btn-success" style="margin-left: 0;margin-right: 7px" data-contact="'+(i=e,btoa(JSON.stringify(i)))+'" data-user-phone="'+n+'">'+n+"</span>"});let a=$("#modal-df");a.find(".modal-body").html(t),a.find(".modal-title").html("Select your phone number"),a.modal("show")},loadSmses:function(a,n){let i=$(".widget-phone__messages-modal"),o={contactId:a.id,contactPhone:a.phone,contactType:a.type,userPhone:n.phone};$(".phone-widget__tab").addClass("ovf-hidden"),i.html("").show(),i.append('<div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div>'),$.ajax({type:"POST",url:e,data:o,dataType:"json"}).done(function(e){if(i.html(""),!e.success)return i.append(function(e){let t='<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div style="padding: 20px;color:red"><p><strong>Errors:</strong></p>';return $.each(e,function(e,a){$.each(a,function(e,a){t+='<div style="padding: 5px 0 5px 0;">'+a+"</div>"})}),t+="</div>"}(e.errors)),!1;let a=(n=e.contact,o=e.user,'<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div class="modal-messaging__contact-info"><div class="modal-messaging__info-list"><div class="modal-messaging__info-item" style="margin-bottom:0">SMS to <span class="modal-messaging__contact-name">'+n.name+'</span></div><span class="modal-messaging__info-number">'+n.phone+'</span><div class="modal-messaging__info-item" style="margin-bottom:0">From: <span class="modal-messaging__contact-name">'+o.phone+'</span></div></div></div><div class="messages-modal__messages-scroll"><div class="messages-modal__body '+l(e.contact,e.user)+'"></div></div>'+function(e,a){return'<div class="messages-modal__footer"><form id="phone-widget-send-sms-form" action="'+t+'" method="post"><div class="messages-modal__input-group"><input name="text" type="text" class="messages-modal__msg-input" placeholder="Your Message"><input name="contactType" type="hidden" value="'+e.type+'"><input name="contactId" type="hidden" value="'+e.id+'"><input name="contactPhone" type="hidden" value="'+e.phone+'"><input name="userPhone" type="hidden" value="'+a.phone+'"><button class="messages-modal__send-btn"><i class="fa fa-paper-plane"></i></button></div></form></div>'}(e.contact,e.user));var n,o;i.append(a),function(e,t){$.each(e,function(e,a){d(a,t)})}(e.smses,h(e.contact,e.user)),function(){let e=$(document).find(".messages-modal__messages-scroll");new SimpleBar(e[0]),s()}()}).fail(function(e){i.html("");let t="Server Error. Try again later";e.status&&403===e.status&&(t="Access denied"),createNotifyByObject({title:"Get sms",type:"error",text:t,hide:!0})})},addSms:d,decode:function(e){return JSON.parse(atob(e))},sendStart:function(){$(document).find(".messages-modal__msg-input").prop("disabled","disabled"),$(document).find(".messages-modal__send-btn").prop("disabled","disabled").html('<i class="fa fa-spinner fa-spin"></i>')},sendFinish:function(){$(document).find(".messages-modal__msg-input").prop("disabled",!1).val(""),$(document).find(".messages-modal__send-btn").prop("disabled",!1).html('<i class="fa fa-paper-plane"></i>')},getSmsesContainer:h,scrollDown:s,socket:function(e){return"update_status"===e.command?(function(e){let t=$(document).find("."+c(e));t&&t.html(o(e))}(e.sms),!0):"add"===e.command?(d(e.sms,h(e.contact,e.user)),s(),!0):void 0}}}();$(document).on("click",".js-trigger-messages-modal",function(){let e=PhoneWidgetSms.getUserPhones().length;if(e<1)return createNotifyByObject({title:"Get sms messages",type:"error",text:"Not found user phones.",hide:!0}),!1;let t={id:$(this).data("contact-id"),phone:$(this).data("contact-phone"),type:$(this).data("contact-type")};if(e>1)return PhoneWidgetSms.showModalSelectNumber(t),!1;let a={phone:PhoneWidgetSms.getUserPhones()[0]};PhoneWidgetSms.loadSmses(t,a)}),$(document).on("click",".phone-widget-userPhones",function(){$("#modal-df").modal("hide");let e=PhoneWidgetSms.decode($(this).data("contact")),t={phone:$(this).data("user-phone")};PhoneWidgetSms.loadSmses(e,t)}),$(document).on("click",".messages-modal__send-btn",function(e){e.preventDefault();let t=$("#phone-widget-send-sms-form"),a=t.serializeArray();return PhoneWidgetSms.sendStart(),$.ajax({type:t.attr("method"),url:t.attr("action"),data:a,dataType:"json"}).done(function(e){if(PhoneWidgetSms.sendFinish(),!e.success){let t="";return $.each(e.errors,function(e,a){$.each(a,function(e,a){t+=a+"<br>"})}),createNotifyByObject({title:"Send sms",type:"error",text:t,hide:!0}),!1}PhoneWidgetSms.addSms(e.sms,PhoneWidgetSms.getSmsesContainer(e.contact,e.user)),PhoneWidgetSms.scrollDown()}).fail(function(){PhoneWidgetSms.sendFinish(),createNotifyByObject({title:"Send sms",type:"error",text:"Server Error. Try again later",hide:!0})}),!1});let PhoneWidgetContacts=function(){let e="",t="",a="",n=null,i=null,o=!0,c=[];function s(){return a}function l(){return n}function r(){$($current).append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>')}function d(){$($current).find(".wg-history-load").remove()}function u(e,t){return function(e,t){var a="data-selected-contact";$(document).on("change",e,function(){if($(this).is(":checked")){$(".submit-selected-contacts").slideDown(250);var e=$("["+a+'="'+$(this).attr(a)+'"]');$(e).prop("checked",!1),$(this).prop("checked",!0),t.hasOwnProperty("id")&&t.id===parseInt($(this).attr(a))&&(h($(this),a),c.push(t))}else h($(this),a);0===c.length&&$(".submit-selected-contacts").slideUp(150),$(".selection-amount__selected").html(c.length),console.log(c)})}("[data-selected-contact]",e),"1"==window.localStorage.getItem("contactSelectableState")&&e.phones.length>=2?'<li class="actions-list__option actions-list__option--if-selectable"><div class="checkbox"><input type="checkbox" name="checkedContact'+t+'2" id="checkedContact'+t+'2" value="'+e.phones[t]+'" data-selected-contact="'+e.id+'"><label for="checkedContact'+t+'2"></label><label for="checkedContact'+t+'2" data-area-label></label></div></li>':""}function h(e,t){for(var a=0;a<c.length;a++)c[a].id===parseInt($(e).attr(t))&&c.splice(c.indexOf(c[a]),1)}function m(e){let t='<li class="calls-history__item contact-info-card is-collapsible"><div class="collapsible-toggler collapsed" data-toggle="'+function(e){return"1"==window.localStorage.getItem("contactSelectableState")&&e.phones.length<2?"":"collapse"}(e)+'" data-target="#collapse'+e.id+'" aria-expanded="false" aria-controls="collapse'+e.id+'"><div class="contact-info-card__status"><div class="agent-text-avatar"><span>'+e.avatar+'</span></div></div><div class="contact-info-card__details"><div class="contact-info-card__line history-details"><strong class="contact-info-card__name">'+e.name+'</strong></div><div class="contact-info-card__line history-details"><span class="contact-info-card__call-type">'+e.description+"</span></div>"+function(e,t){return"1"==window.localStorage.getItem("contactSelectableState")&&e.phones.length<=1?'<div class="select-contact"><div class="checkbox"><input type="checkbox" name="checkedContact'+e.id+'" id="checkedContact'+e.id+'" value="'+e.phones[0]+'" data-selected-contact="'+e.id+'"><label for="checkedContact'+e.id+'"></label><label for="checkedContact'+e.id+'" data-area-label></label></div></div>':'<a class="collapsible-arrow"><i class="fas fa-chevron-right"></i></a>'}(e)+'</div></div><div id="collapse'+e.id+'" class="collapse collapsible-container" aria-labelledby="headingOne" data-parent="#contacts-tab"><ul class="contact-options-list"><li class="contact-options-list__option js-toggle-contact-info" data-contact="'+f(e)+'"><i class="fa fa-user"></i>';return e.isInternal&&(t+='<li class="contact-options-list__option dial-to-user contact-dial-to-user" data-contact="'+f(e)+'"> <i class="fa fa-phone"> </i></li>'),t+='</ul><ul class="contact-full-info">',e.phones&&e.phones.forEach(function(a,n){t+=g(a,n,e)}),e.emails&&e.emails.forEach(function(a,n){t+=p(a,n,e)}),t+="</ul></div></li>"}function f(e){return btoa(JSON.stringify(e))}function p(e,t,a){return'<li class="contact-full-info__email"><div class="form-group"><label for="">Email '+(t+1)+'</label><input readonly type="email" class="form-control" value="'+e+'" autocomplete="off"></div><ul class="actions-list"><li class="actions-list__option js-trigger-email-modal" data-contact="'+f(a)+'" data-contact-email="'+e+'"><i class="fa fa-envelope"></i></li></ul></li>'}function g(a,n,i){let o='<li class="contact-full-info__phone"><div class="form-group"><label for="">Phone '+(n+1)+'</label><input readonly type="text" class="form-control" value="'+a+'" autocomplete="off"></div><ul class="actions-list"><li class="actions-list__option actions-list__option--phone js-call-tab-trigger">',c=i.isInternal?i.id:"";return o+='<i class="fa fa-phone phone-dial-contacts" data-contact-id="'+i.id+'"  data-user-id="'+c+'" data-phone="'+(c?i.name:a)+'" data-title="'+i.name+'"></i>',o+='</li><li title="'+e+'" class="actions-list__option js-trigger-messages-modal'+t+'" data-contact-id="'+i.id+'" data-contact-phone="'+a+'" data-contact-type="'+i.type+'"><i class="fa fa-comment-alt"></i></li>'+u(i,n)+"</ul></li>"}function v(){$("#list-of-contacts").html('<div style="width:100%;text-align:center;margin-top:20px">No results found</div>')}function _(e){let t="";return $.each(e,function(a,n){if(!a||!n)return;let i='<span class="section-separator">'+a+"</span>";i+='<ul class="phone-widget__list-item calls-history" id="contacts-tab">',$.each(e[a],function(e,t){i+=m(t)}),t+=i+="</ul>"}),t}function w(e){$("#tab-contacts").attr("data-page",e)}return{init:function(n,i,o){e=n,t=i,a=o,window.localStorage.setItem("contactSelectableState",0)},viewContact:function(e){let t='<div class="widget-phone__contact-info-modal widget-modal contact-modal-info"><a class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a><div class="contact-modal-info__user"><div class="agent-text-avatar"><span>'+e.avatar+'</span></div><h3 class="contact-modal-info__name">'+e.name+'</h3></div><div class="contact-modal-info__body"><span class="section-separator">General info</span><ul class="contact-modal-info__contacts contact-full-info"><li><div class="form-group"><label for="">Type</label>',a="person";return e.is_company&&(a="company"),t+='<div class="form-control-wrap" data-type="'+a+'">',t+='<select readonly type="text" class="form-control select-contact-type" autocomplete="off" readonly disabled>',e.is_company?t+='<option value="company" selected="selected">Company</option> <option value="person">Person</option>':t+='<option value="company">Company</option> <option value="person" selected="selected">Person</option>',t+="</select></div></div></li>",e.phones&&e.phones.forEach(function(a,n){t+=g(a,n,e)}),e.emails&&e.emails.forEach(function(a,n){t+=p(a,n,e)}),t+="</ul></div></div>"},decodeContact:function(e){return JSON.parse(atob(e))},delay:function(e,t){var a=0;return function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,i)},t||0)}},requestFullList:function(){r(),$.ajax({type:"post",url:s(),data:{},dataType:"json"}).done(function(e){if(e.results.length<1)return d(),void v();var t;w(e.page),t=e.results,n=t;let a=_(l());d(),$("#list-of-contacts").html("").append(a),i.recalculate()}).fail(function(e){console.log(e),d(),createNotifyByObject({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})})},initLazyLoadFullList:function(e){var t=!1;(i=e).getScrollElement().addEventListener("scroll",function(e){if(o&&e.target.scrollTop+e.target.clientHeight===e.target.scrollHeight&&!t){var a=$("#tab-contacts").attr("data-page");$.ajax({url:s(),type:"post",data:{page:a},dataType:"json",beforeSend:function(){r(),t=!0},success:function(e){var a;w(e.page),(a=e.results)&&$.each(a,function(e,t){e&&t&&(n[e]?$.each(a[e],function(t,a){n[e][n[e].length]=a}):n[e]=t)});let o=_(l());d(),$("#list-of-contacts").html("").append(o),i.recalculate(),e.rows||(t=!1)},complete:function(){d()},error:function(e,t){}})}})},fullListIsEmpty:function(){return!n},loadFullList:function(){if(r(),n){let e=_(n);d(),$("#list-of-contacts").html("").append(e)}else d(),$("#list-of-contacts").html("")},requestSearchList:function(e){r(),$.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serializeArray(),dataType:"json"}).done(function(e){if(e.results.length<1)return d(),void v();let t=_(e.results);d(),$("#list-of-contacts").html("").append(t)}).fail(function(){d(),createNotifyByObject({title:"Search contacts",type:"error",text:"Server Error. Try again later",hide:!0})})},setCurrentFullListContainer:function(){return o=!0},setCurrentSearchListContainer:function(){return o=!1}}}();$("#contact-list-ajax").on("beforeSubmit",function(e){e.preventDefault();let t=$(this);return t.find("input[name=q]").val().length<2?(PhoneWidgetContacts.setCurrentFullListContainer(),!1):(PhoneWidgetContacts.setCurrentSearchListContainer(),PhoneWidgetContacts.requestSearchList(t),!1)}),$("#contact-list-ajax-q").on("keyup",PhoneWidgetContacts.delay(function(){let e=$("#contact-list-ajax");if(e.find("input[name=q]").val().length<2)return PhoneWidgetContacts.setCurrentFullListContainer(),PhoneWidgetContacts.loadFullList(),!1;PhoneWidgetContacts.setCurrentSearchListContainer(),e.submit()},300)),$(document).on("click",".js-toggle-contact-info",function(){let e=PhoneWidgetContacts.decodeContact($(this).data("contact")),t=PhoneWidgetContacts.viewContact(e);$(".widget-phone__contact-info-modal").html(t),$(".widget-phone__contact-info-modal").show()});let PhoneWidgetEmail=function(){let e="",t={};function a(){return t}function n(){$(document).find(".email-modal").find(".wg-history-load").remove()}return{init:function(a,n){e=a,t=n},getUserEmails:a,showModalSelectNumber:function(e,t){let n="";$.each(a(),function(a,i){n+='<span class="phone-widget-userEmails btn btn-success" style="margin-left: 0;margin-right: 7px" data-contact-email="'+t+'" data-contact="'+e+'" data-user-email="'+i+'">'+i+"</span>"});let i=$("#modal-df");i.find(".modal-body").html(n),i.find(".modal-title").html("Select your email address"),i.modal("show")},decode:function(e){return JSON.parse(atob(e))},show:function(t,a,n){let i=$(document).find(".email-modal");i.html("");let o='<a href="#" class="widget-modal__close"><i class="fa fa-arrow-left"></i>Back to contacts</i></a>    <div class="modal-messaging__contact-info">        <div class="modal-messaging__info-list">            <div class="modal-messaging__info-item">Email to <span class="modal-messaging__contact-name">'+t.name+'</span></div>            <span class="modal-messaging__info-number">'+a+'</span>            <div class="modal-messaging__info-item" style="margin-bottom:0">Email From: <span class="modal-messaging__contact-name">'+n.email+'</span></div>        </div>    </div>    <div class="email-modal__messages-scroll">        <div class="email-modal__body"><form id="phone-widget-send-email-form" action="'+e+'" method="post">               <input name="contactType" type="hidden" value="'+t.type+'">               <input name="contactId" type="hidden" value="'+t.id+'">               <input name="contactEmail" type="hidden" value="'+a+'">               <input name="userEmail" type="hidden" value="'+n.email+'">            <div class="email-modal__input-group">                <div class="email-modal__subject-block">                    <div class="email-modal__modal-input-list"> <input type="text" name="subject" class="email-modal__contact-input" placeholder="Subject"> </div>                </div>                <textarea class="email-modal__msg-input" placeholder="Your Message" name="text" cols="30" rows="10"></textarea>            </div>            <button class="email-modal__send-btn"><span>SEND</span><i class="fa fa-paper-plane"></i></button>            </form>        </div>    </div>';i.append(o),i.show(),$(".phone-widget__tab").addClass("ovf-hidden")},send:function(e){let t=e.serializeArray();$(document).find(".email-modal").append('<div class="wg-history-load"><div style="width:100%;text-align:center;margin-top:20px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>'),$.ajax({type:e.attr("method"),url:e.attr("action"),data:t,dataType:"json"}).done(function(t){if(n(),!t.success){let e=function(e){let t="";return $.each(e,function(e,a){$.each(a,function(e,a){t+=a+"<br>"})}),t}(t.errors);return createNotifyByObject({title:"Send email",type:"error",text:e,hide:!0}),!1}e.find(".email-modal__contact-input").val(""),e.find(".email-modal__msg-input").val("");let a="Success";t.message&&(a=t.message),createNotifyByObject({title:"Send email",type:"success",text:a,hide:!0})}).fail(function(){n(),createNotifyByObject({title:"Send email",type:"error",text:"Server Error. Try again later",hide:!0})})}}}();$(document).on("click",".js-trigger-email-modal",function(){let e=PhoneWidgetEmail.getUserEmails().length;if(e<1)return createNotifyByObject({title:"Send email",type:"error",text:"Not found user emails.",hide:!0}),!1;if(e>1)return PhoneWidgetEmail.showModalSelectNumber($(this).data("contact"),$(this).data("contact-email")),!1;let t=PhoneWidgetEmail.decode($(this).data("contact")),a=$(this).data("contact-email"),n={email:PhoneWidgetEmail.getUserEmails()[0]};PhoneWidgetEmail.show(t,a,n)}),$(document).on("click",".phone-widget-userEmails",function(){$("#modal-df").modal("hide");let e=PhoneWidgetEmail.decode($(this).data("contact")),t=$(this).data("contact-email"),a={email:$(this).data("user-email")};PhoneWidgetEmail.show(e,t,a)}),$(document).on("click",".email-modal__send-btn",function(e){e.preventDefault();let t=$(document).find("#phone-widget-send-email-form");PhoneWidgetEmail.send(t)});