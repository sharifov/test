!function(t){"use strict";t.fn.multipleInput=function(e){return u[e]?u[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.multipleInput"),!1):u.init.apply(this,arguments)};var e="afterInit",n="beforeAddRow",i="afterAddRow",r="beforeDeleteRow",l="afterDeleteRow",a={id:null,inputId:null,template:null,jsTemplates:[],jsInit:[],max:1,min:1,attributes:{},indexPlaceholder:"multiple_index",showGeneralError:!1,prepend:!1},o=!1,u={init:function(n){if("object"==typeof n){var i=t.extend(!0,{},a,n||{}),r=t("#"+i.id),l=r.closest("form"),u=i.inputId;for(c in i.jsInit)window.eval(i.jsInit[c]);r.data("multipleInput",{settings:i,currentIndex:0}),r.on("click.multipleInput",".js-input-remove",function(e){e.stopPropagation(),p(t(this))}),r.on("click.multipleInput",".js-input-plus",function(e){e.stopPropagation(),s(t(this))}),r.on("click.multipleInput",".js-input-clone",function(e){e.stopPropagation(),s(t(this),m(t(this)))});var c=0,f=t.Event(e),h=setInterval(function(){if("object"==typeof l.data("yiiActiveForm")){var e=l.yiiActiveForm("find",u),n={enableAjaxValidation:!1,validateOnBlur:!1,validateOnChange:!1,validateOnType:!1,validationDelay:500};"object"==typeof e&&(t.each(e,function(t,e){-1===["id","input","container"].indexOf(t)&&(n[t]=e)}),i.showGeneralError||l.yiiActiveForm("remove",u)),t.each(i.attributes,function(e,r){r=t.extend({},n,r),i.attributes[e]=r}),r.data("multipleInput").settings=i,r.find(".multiple-input-list").find("input, select, textarea").each(function(){d(t(this))}),r.data("multipleInput").currentIndex=v(r),o=!0,clearInterval(h),r.trigger(f)}else c++;(0===l.length||c>10)&&(r.data("multipleInput").currentIndex=v(r),o=!1,clearInterval(h),r.trigger(f))},100)}else console.error("Options must be an object")},add:function(e){s(t(this),e)},remove:function(e){var n=null;n=void 0!==e?t(this).find(".js-input-remove:eq("+e+")"):t(this).find(".js-input-remove").last(),p(n)},clear:function(){t(this).find(".js-input-remove").each(function(){p(t(this))})},option:function(e,n){n=n||null;var i=t(this).data("multipleInput"),r=i.settings;if(null===n){if(!r.hasOwnProperty(e))throw new Error('Option "'+e+'" does not exist');return r[e]}r.hasOwnProperty(e)&&(r[e]=n,i.settings=r,t(this).data("multipleInput",i))}},s=function(e,r){var l=t(e).closest(".multiple-input").first(),a=l.data("multipleInput"),u=a.settings,s=u.template,p=l.children(".multiple-input-list").first();if(!(null!==u.max&&v(l)>=u.max)){s=h("{"+u.indexPlaceholder+"}",a.currentIndex,s);var c=t(s),m=a.currentIndex,g=t.Event(n);if(l.trigger(g,[c,m]),!1!==g.result){if(u.prepend?c.hide().prependTo(p).fadeIn(300):c.hide().appendTo(p).fadeIn(300),r instanceof Object){var I=[];for(var x in r)r.hasOwnProperty(x)&&I.push(r[x]);r=I}var y;for(var j in u.jsTemplates)y=u.jsTemplates[j],y=h("{"+u.indexPlaceholder+"}",a.currentIndex,y),y=h("%7B"+u.indexPlaceholder+"%7D",a.currentIndex,y),window.eval(y);var w=0;t(s).find("input, select, textarea").each(function(e,n){var i=t(n),l=n.tagName,a=f(i),u=t("#"+a);if(r){var s=r[w];if("INPUT"===l||"TEXTAREA"===l)u.val(s);else if("SELECT"===l){if(s&&-1!==s.indexOf("option"))u.append(s);else u.find('option[value="'+s+'"]').length&&u.val(s)}}o&&d(i),w++}),l.data("multipleInput").currentIndex++;var b=t.Event(i);l.trigger(b,[c,m])}}},p=function(e){var n=e.closest(".multiple-input").first(),i=e.closest(".multiple-input-list__item"),a=n.data("multipleInput").settings,u=v(n);if(u>a.min){var s=t.Event(r);if(n.trigger(s,[i,u]),!1===s.result)return;o&&i.find("input, select, textarea").each(function(e,n){c(t(n))}),i.fadeOut(300,function(){t(this).remove(),s=t.Event(l),n.trigger(s,[i,u])})}},d=function(e){var n=f(e);if(null!==n){var i=t("#"+n),r=i.closest(".multiple-input").first(),l=i.closest("form");if(0!==r.length&&void 0===l.yiiActiveForm("find",n)){var a=r.data("multipleInput"),o={},u=n.replace(/-\d+-([^\d]+)$/,"-$1");a.settings.attributes.hasOwnProperty(u)?o=a.settings.attributes[u]:(u=h(/-\d-/,"-",u),u=h(/-\d/,"",u),a.settings.attributes.hasOwnProperty(u)&&(o=a.settings.attributes[u])),l.yiiActiveForm("add",t.extend({},o,{id:n,input:"#"+n,container:".field-"+n}))}}},c=function(e){var n=f(e);if(null!==n){var i=t("#"+n).closest("form");0!==i.length&&i.yiiActiveForm("remove",n)}},f=function(t){var e=t.attr("id");return void 0===e&&(e=t.data("id")),void 0===e?null:e},v=function(e){return e.find(".multiple-input-list .multiple-input-list__item").filter(function(){return t(this).parents(".multiple-input").first().attr("id")===e.attr("id")}).length},m=function(e){var n={};return e.closest("tr").find("td").each(function(e,i){t(i).find("input, select, textarea").each(function(e,i){var r=t(i),l=f(r),a=t("#"+l);n[l]=a.val()})}),n},h=function(t,e,n){return n instanceof String||"string"==typeof n?n.split(t).join(e):(console.warn("Call replaceAll for non-string value: "+n),n)}}(window.jQuery);