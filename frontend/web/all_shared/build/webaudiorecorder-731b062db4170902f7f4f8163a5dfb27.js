!function(e){var t=function(){for(var e=arguments[0],n=[].slice.call(arguments,1),o=0;o<n.length;++o){var i=n[o];for(key in i){var r=i[key];e[key]="object"==typeof r?t("object"==typeof e[key]?e[key]:{},r):r}}return e},n={wav:"WebAudioRecorderWav.min.js",ogg:"WebAudioRecorderOgg.min.js",mp3:"WebAudioRecorderMp3.min.js"},o={workerDir:"/",numChannels:2,encoding:"wav",options:{timeLimit:300,encodeAfterRecord:!1,progressInterval:1e3,bufferSize:void 0,wav:{mimeType:"audio/wav"},ogg:{mimeType:"audio/ogg",quality:.5},mp3:{mimeType:"audio/mpeg",bitRate:160}}},i=function(e,n){t(this,o,n||{}),this.context=e.context,null==this.context.createScriptProcessor&&(this.context.createScriptProcessor=this.context.createJavaScriptNode),this.input=this.context.createGain(),e.connect(this.input),this.buffer=[],this.initWorker()};t(i.prototype,{isRecording:function(){return null!=this.processor},setEncoding:function(e){this.isRecording()?this.error("setEncoding: cannot set encoding during recording"):this.encoding!==e&&(this.encoding=e,this.initWorker())},setOptions:function(e){this.isRecording()?this.error("setOptions: cannot set options during recording"):(t(this.options,e),this.worker.postMessage({command:"options",options:this.options}))},startRecording:function(){if(this.isRecording())this.error("startRecording: previous recording is running");else{var e=this.numChannels,t=this.buffer,n=this.worker;this.processor=this.context.createScriptProcessor(this.options.bufferSize,this.numChannels,this.numChannels),this.input.connect(this.processor),this.processor.connect(this.context.destination),this.processor.onaudioprocess=function(o){for(var i=0;i<e;++i)t[i]=o.inputBuffer.getChannelData(i);n.postMessage({command:"record",buffer:t})},this.worker.postMessage({command:"start",bufferSize:this.processor.bufferSize}),this.startTime=Date.now()}},recordingTime:function(){return this.isRecording()?.001*(Date.now()-this.startTime):null},cancelRecording:function(){this.isRecording()?(this.input.disconnect(),this.processor.disconnect(),delete this.processor,this.worker.postMessage({command:"cancel"})):this.error("cancelRecording: no recording is running")},finishRecording:function(){this.isRecording()?(this.input.disconnect(),this.processor.disconnect(),delete this.processor,this.worker.postMessage({command:"finish"})):this.error("finishRecording: no recording is running")},cancelEncoding:function(){this.options.encodeAfterRecord?this.isRecording()?this.error("cancelEncoding: recording is not finished"):(this.onEncodingCanceled(this),this.initWorker()):this.error("cancelEncoding: invalid method call")},initWorker:function(){null!=this.worker&&this.worker.terminate(),this.onEncoderLoading(this,this.encoding),this.worker=new Worker(this.workerDir+n[this.encoding]);var e=this;this.worker.onmessage=function(t){var n=t.data;switch(n.command){case"loaded":e.onEncoderLoaded(e,e.encoding);break;case"timeout":e.onTimeout(e);break;case"progress":e.onEncodingProgress(e,n.progress);break;case"complete":e.onComplete(e,n.blob);break;case"error":e.error(n.message)}},this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.numChannels},options:this.options})},error:function(e){this.onError(this,"WebAudioRecorder.min.js:"+e)},onEncoderLoading:function(e,t){},onEncoderLoaded:function(e,t){},onTimeout:function(e){e.finishRecording()},onEncodingProgress:function(e,t){},onEncodingCanceled:function(e){},onComplete:function(e,t){e.onError(e,"WebAudioRecorder.min.js: You must override .onComplete event")},onError:function(e,t){console.log(t)}}),e.WebAudioRecorder=i}(window),function(e,t){"use strict";e.fn.webAudioRecorder=function(n){var o,i,r,s,c,a,d,l,h,u,m,g=t.URL||t.webkitURL,p=t.AudioContext||t.webkitAudioContext,f=document.createElement("div");f.id="format";var b=document.createElement("label");b.innerText="Log",b.className="control-label";var w=document.createElement("pre");w.id="log";var R=document.createElement("label");R.innerText="Record",R.className="control-label";var v=document.createElement("div");v.id="record",v.className="d-flex justify-content-center align-items-center";var k=document.getElementById("visualizer"),E=k.getContext("2d"),y=e("#timer-wrapper"),T=e(this),C=e.extend({},{recordBtnSelector:"",stopBtnSelector:"",showFormatsInfo:!0,showLog:!0,blobUrl:""},n),L=function(e){return(e<10?"0":"")+e};c=function(){var t;i&&(t=0|i.recordingTime(),e("#time-display").html(L(t/60|0)+":"+L(t%60)))},t.setInterval(c,200);var S=function(){console.log("startRecording() called");navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){M("getUserMedia() success, stream created, initializing WebAudioRecorder..."),s=new p,C.showFormatsInfo&&(f.innerHTML="Format: mp3 @ "+s.sampleRate/1e3+"kHz"),o=e,r=s.createMediaStreamSource(e),function(e){s||(s=new p);let t=s.createMediaStreamSource(e),n=s.createAnalyser();n.fftSize=2048;let o=n.frequencyBinCount,i=new Uint8Array(o);t.connect(n),function e(){let t=k.width,r=k.height;requestAnimationFrame(e),n.getByteTimeDomainData(i),E.fillStyle="rgb(255,255,255)",E.fillRect(0,0,t,r),E.lineWidth=2,E.strokeStyle="rgb(0, 0, 0)",E.beginPath();let s=1*t/o,c=0;for(let e=0;e<o;e++){let t=i[e]/128,n=t*r/2;0===e?E.moveTo(c,n):E.lineTo(c,n),c+=s}E.lineTo(k.width,k.height/2),E.stroke()}(),y.show()}(o),(i=new WebAudioRecorder(r,{workerDir:"/js/web-audio-recorder/",encoding:"mp3",numChannels:2,onEncoderLoading:function(e,t){M("Loading "+t+" encoder...")},onEncoderLoaded:function(e,t){M(t+" encoder loaded")}})).onComplete=function(e,t){M("Encoding complete"),x(t),l=W(t,"user-voice-mail.mp3"),d.attr("disabled",!0),a.attr("disabled",!1),m.attr("disabled",!1),o.getAudioTracks()[0].stop()},i.setOptions({timeLimit:20,encodeAfterRecord:!0,mp3:{bitRate:160}}),i.startRecording(),M("Recording started")}).catch(function(e){T.html(e.message),a.attr("disabled",!1),m.attr("disabled",!1),d.attr("disabled",!0)}),a.attr("disabled",!0),m.attr("disabled",!0),d.attr("disabled",!1)},A=function(){console.log("stopRecording() called"),o.getAudioTracks()[0].stop(),d.attr("disabled",!0),a.attr("disabled",!1),m.attr("disabled",!1),i.finishRecording(),y.hide(),M("Recording stopped")},x=function(t){var n;if("object"==typeof t)n=g.createObjectURL(t);else{if("string"!=typeof t)throw new Error("Provided param neither object nor string");n=t}var o=document.createElement("audio");o.controls=!0,o.src=n,o.style.width="100%";var i=document.createElement("button"),r=document.createElement("i");r.className="fa fa-trash",i.appendChild(r),i.className="btn btn-danger",i.style.marginLeft="10px",e(i).on("click",function(){l="",h="",e(this).closest("div").html("")}),h=n,v.innerHTML="",v.appendChild(o),v.appendChild(i)},M=function(e,t){C.showLog&&(w.innerHTML+="\n"+e+" "+(t||""))},W=function(e,t){return new File([e],t,{type:"audio/mpeg"})};return this.init=function(){return!!function(){try{if(!(a=e(C.recordBtnSelector)).length)throw new Error("Record button is not found");if(!(d=e(C.stopBtnSelector)).length)throw new Error("Stop button is not found")}catch(e){return T.html(""),console.log(e.message),!1}return!0}()&&(C.showFormatsInfo&&this.append(f),C.showLog&&(this.append(b),this.append(w)),this.append(R),this.append(v),u=this.closest("form"),m=u.find('[type="submit"]'),a.on("click",S),d.on("click",A),C.blobUrl&&(x(C.blobUrl),t=C.blobUrl,(n=new XMLHttpRequest).open("GET",t,!0),n.responseType="blob",n.onload=function(e){200===this.status&&(l=W(this.response,"user-voice-mail.mp3"))},n.send()),this);var t,n},this.getRecord=function(){return l||""},this.getBlobUrl=function(){return h||""},this.init()}}(jQuery,window);